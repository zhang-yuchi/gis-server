// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.15/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/mixins/ArcGISImageService":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../geometry ../../Graphic ../../rasterRenderers ../../request ../../core/Error ../../core/jsonMap ../../core/lang ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/urlUtils ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../support/commonProperties ../support/DimensionalDefinition ../support/ExportImageServiceParameters ../support/Field ../support/FieldsIndex ../support/imageryRendererUtils ../support/MosaicRule ../support/PixelBlock ../support/RasterFunction ../support/RasterInfo ../support/RasterJobHandler ../support/rasterFormats/RasterCodec ../../renderers/support/RasterSymbolizer ../../tasks/ImageServiceIdentifyTask ../../tasks/QueryTask ../../tasks/support/FeatureSet ../../tasks/support/ImageServiceIdentifyParameters ../../tasks/support/Query".split(" "),
function(D,v,t,g,b,r,p,a,d,h,f,c,k,n,e,l,u,m,q,C,B,G,y,w,x,z,A,E,F,M,N,O,L,H,I,R,Q,S){function T(a){return a?JSON.stringify(a).match(/"rasterFunction":"(.*?")/gi).map(function(a){return a.replace('"rasterFunction":"',"").replace('"',"")}).join("/"):null}Object.defineProperty(v,"__esModule",{value:!0});var V=e.getLogger("esri.layers.mixins.ArcGISImageService"),P=k.strict()({RSP_NearestNeighbor:"nearest",RSP_BilinearInterpolation:"bilinear",RSP_CubicConvolution:"cubic",RSP_Majority:"majority"}),J=k.strict()({esriNoDataMatchAny:"any",
esriNoDataMatchAll:"all"}),X=k.strict()({U1:"u1",U2:"u2",U4:"u4",U8:"u8",S8:"s8",U16:"u16",S16:"s16",U32:"u32",S32:"s32",F32:"f32",F64:"f64",C64:"c64",C128:"c128",UNKNOWN:"unknown"});v.ArcGISImageService=function(e){return function(e){function k(){var a=null!==e&&e.apply(this,arguments)||this;a._functionRasterInfos={};a._rasterJobHandler={instance:null,refCount:0,connectionPromise:null};a._symbolizer=null;a._defaultServiceMosaicRule=null;a.rasterAttributeTableFieldPrefix="Raster.";a.adjustAspectRatio=
null;a.bandCount=null;a.bandIds=void 0;a.capabilities=null;a.compressionQuality=void 0;a.compressionTolerance=.01;a.copyright=null;a.definitionExpression=null;a.exportImageServiceParameters=null;a.rasterInfo=null;a.fields=null;a.fullExtent=null;a.hasMultidimensions=!1;a.imageMaxHeight=4100;a.imageMaxWidth=4100;a.interpolation=void 0;a.multidimensionalInfo=null;a.noData=null;a.noDataInterpretation=void 0;a.objectIdField=null;a.pixelSizeX=null;a.pixelSizeY=null;a.pixelFilter=null;a.raster=void 0;a.viewId=
void 0;a.renderer=null;a.rasterAttributeTable=null;a.rasterFunctionInfos=null;a.serviceDataType=null;a.spatialReference=null;a.pixelType=null;a.serviceRasterInfo=null;a.sourceJSON=null;a.url=null;a.version=null;return a}g(k,e);k.prototype.initialize=function(){this._set("exportImageServiceParameters",new y.ExportImageServiceParameters({layer:this}))};k.prototype.readDefaultServiceMosaicRule=function(a,c){return A.fromJSON(c)};Object.defineProperty(k.prototype,"rasterFunctionNamesIndex",{get:function(){var a=
new Map;if(!this.rasterFunctionInfos||1>this.rasterFunctionInfos.length)return a;this.rasterFunctionInfos.forEach(function(c){a.set(c.name.toLowerCase().replace(/ /gi,"_"),c.name)});return a},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"queryTask",{get:function(){return new I({url:this.url})},enumerable:!0,configurable:!0});k.prototype.readCapabilities=function(a){return a&&a.split(",").map(function(a){return a.trim()})};k.prototype.writeCompressionQuality=function(a,c,f){null!=
a&&"lerc"!==this.format&&(c[f]=a)};k.prototype.writeCompressionTolerance=function(a,c,f){"lerc"===this.format&&null!=a&&(c[f]=a)};Object.defineProperty(k.prototype,"fieldsIndex",{get:function(){return this.fields?new x(this.fields):null},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"format",{get:function(){return this._get("format")||(null!=this.pixelFilter?"lerc":"jpgpng")},set:function(a){a&&-1<"png png8 png24 png32 jpg bmp jpgpng lerc tiff".split(" ").indexOf(a.toLowerCase())&&
this._set("format",a.toLowerCase())},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"mosaicRule",{set:function(a){a&&a.mosaicMethod&&(a=A.fromJSON(t({},a.toJSON(),{mosaicMethod:a.mosaicMethod,mosaicOperation:a.mosaicOperation})));this._set("mosaicRule",a)},enumerable:!0,configurable:!0});k.prototype.readMosaicRule=function(a,c){return A.fromJSON(a||c.mosaicRule||c)};k.prototype.writeMosaicRule=function(a,c,f){a=this.mosaicRule;var e=this.definitionExpression;a?e&&e!==a.where&&(a=
a.clone(),a.where=e):e&&(a=new A({where:e}));this._isValidCustomizedMosaicRule(a)&&(c[f]=a.toJSON())};k.prototype.writeNoData=function(a,c,f){null!=a&&"number"===typeof a&&(c[f]=a)};k.prototype.readObjectIdField=function(a,c){a||(a=(a=c.fields.filter(function(a){return"esriFieldTypeOID"===a.type||"oid"===a.type}))&&a[0]&&a[0].name);return a};Object.defineProperty(k.prototype,"parsedUrl",{get:function(){return this.url?m.urlToObject(this.url):null},enumerable:!0,configurable:!0});k.prototype.readRenderer=
function(a,c,f){a=h.read(c&&c.layerDefinition&&c.layerDefinition.drawingInfo&&c.layerDefinition.drawingInfo.renderer,f)||void 0;if(null!=a)return z.isSupportedRendererType(a)||V.warn("ArcGISImageService","Imagery layer doesn't support given renderer type."),a};Object.defineProperty(k.prototype,"rasterFields",{get:function(){var a=this.rasterAttributeTableFieldPrefix||"Raster.",c=new w({name:"Raster.ItemPixelValue",alias:"Item Pixel Value",domain:null,editable:!1,length:50,type:"string"}),f=new w({name:"Raster.ServicePixelValue",
alias:"Service Pixel Value",domain:null,editable:!1,length:50,type:"string"}),e=new w({name:"Raster.ServicePixelValue.Raw",alias:"Raw Service Pixel Value",domain:null,editable:!1,length:50,type:"string"}),b=this.fields?n.clone(this.fields):[];b.push(f);this.capabilities&&this.capabilities.some(function(a){return"catalog"===a.toLowerCase()})&&this.fields&&0<this.fields.length&&b.push(c);10.4<=this.version&&this.rasterFunctionInfos&&this.rasterFunctionInfos.some(function(a){return"none"===a.name.toLowerCase()})&&
b.push(e);this.rasterFunctionInfos&&this.rasterFunctionInfos.filter(function(a){return"none"!==a.name.toLowerCase()}).forEach(function(a){b.push(new w({name:"Raster.ServicePixelValue."+a.name,alias:a.name,domain:null,editable:!1,length:50,type:"string"}))});null==this.pixelFilter||"esriImageServiceDataTypeVector-UV"!==this.serviceDataType&&"esriImageServiceDataTypeVector-MagDir"!==this.serviceDataType||(b.push(new w({name:"Raster.Magnitude",alias:"Magnitude",domain:null,editable:!1,type:"double"})),
b.push(new w({name:"Raster.Direction",alias:"Direction",domain:null,editable:!1,type:"double"})));(c=this.rasterInfo.attributeTable&&this.rasterInfo.attributeTable.fields||null)&&0<c.length&&(c=c.filter(function(a){return"esriFieldTypeOID"!==a.type&&"value"!==a.name.toLowerCase()}).map(function(c){var f=n.clone(c);f.name=a+c.name;return f}),b=b.concat(c));return b},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"renderingRule",{set:function(a){a&&a.rasterFunction&&(a=F.fromJSON(t({},
a.toJSON(),{rasterFunction:a.rasterFunction,rasterFunctionArguments:a.rasterFunctionArguments})));this._set("renderingRule",a)},enumerable:!0,configurable:!0});k.prototype.readRenderingRule=function(a,c){a=c.rasterFunctionInfos;return c.renderingRule||a&&a.length&&"None"!==a[0].name?F.fromJSON(c.renderingRule||{rasterFunctionInfos:c.rasterFunctionInfos}):null};k.prototype.writeRenderingRule=function(a,c,f){this._isRFTJson(a)||(c[f]=a.toJSON())};k.prototype.readSpatialReference=function(c,f){return(c=
c||f.extent.spatialReference)?a.SpatialReference.fromJSON(c):null};k.prototype.readPixelType=function(a){return X.fromJSON(a)||a};k.prototype.writePixelType=function(a,c,f){if(l.isNone(this.serviceRasterInfo)||this.pixelType!==this.serviceRasterInfo.pixelType)c[f]=X.toJSON(a)};k.prototype.readVersion=function(a,c){(a=c.currentVersion)||(a=c.hasOwnProperty("fields")||c.hasOwnProperty("timeInfo")?10:9.3);return a};k.prototype.applyFilter=function(a){var c=a;this.pixelFilter&&(c=this._clonePixelData(a),
this.pixelFilter(c));return c};k.prototype.applyRenderer=function(a,c){return p(this,void 0,void 0,function(){var f,e,b,m;return r(this,function(d){switch(d.label){case 0:f=a;if(this._isPicture()||!this.renderer||!this._symbolizer||this.pixelFilter)return[3,5];e=JSON.stringify(this._cachedRendererJson)!==JSON.stringify(this.renderer.toJSON());b=this._rasterJobHandler.instance;if(!b)return[3,4];if(!e)return[3,2];this._symbolizer.bind();return[4,b.updateSymbolizer(this._symbolizer,c)];case 1:d.sent(),
this._cachedRendererJson=this.renderer.toJSON(),d.label=2;case 2:return[4,b.symbolize(a.pixelBlock,c)];case 3:return m=d.sent(),f={extent:a.extent,pixelBlock:m},[3,5];case 4:f={extent:a.extent,pixelBlock:this._symbolizer.symbolize(a.pixelBlock)},d.label=5;case 5:return[2,f]}})})};k.prototype.destroy=function(){this._shutdownJobHandler()};k.prototype.increaseRasterJobHandlerUsage=function(){this._rasterJobHandler.refCount++};k.prototype.decreaseRasterJobHandlerUsage=function(){this._rasterJobHandler.refCount--;
0>=this._rasterJobHandler.refCount&&this._shutdownJobHandler()};k.prototype.fetchImage=function(a,f,e,b){var m=this;void 0===b&&(b={});if(null==a||null==f||null==e)return u.reject(new c("imagery-layer:fetch-image","Insufficient parameters for requesting an image. A valid extent, width and height values are required."));var d=this.renderer||this._symbolizer?this.generateRasterInfo(this.renderingRule,{signal:b.signal}):null;return u.when(d).then(function(c){c&&(m.rasterInfo=c);c={imageServiceParameters:m.getExportImageServiceParameters(a,
f,e,b.timeExtent),imageProps:{extent:a,width:f,height:e,format:m.format},requestAsImageElement:b.requestAsImageElement&&!m.pixelFilter||!1,signal:b.signal};return m._requestArrayBuffer(c)})};k.prototype.fetchKeyProperties=function(a){a=a&&a.renderingRule&&a.renderingRule.toJSON();return f(this.parsedUrl.path+"/keyProperties",{query:this._getQueryParams({renderingRule:10.3<=this.version&&a?JSON.stringify(a):null})}).then(function(a){return a.data})};k.prototype.fetchRasterAttributeTable=function(a){a=
a&&a.renderingRule&&a.renderingRule.toJSON();return 10.1>this.version?u.reject(new c("#fetchRasterAttributeTable()","Failed to get rasterAttributeTable")):f(this.parsedUrl.path+"/rasterAttributeTable",{query:this._getQueryParams({renderingRule:10.3<=this.version&&a?JSON.stringify(a):null})}).then(function(a){return R.fromJSON(a.data)})};k.prototype.getCatalogItemRasterInfo=function(c,e){return p(this,void 0,void 0,function(){var b,m,d,k,h;return r(this,function(l){switch(l.label){case 0:return b=
f(this.parsedUrl.path+"/"+c+"/info",t({query:this._getQueryParams(),responseType:"json"},e)).then(function(a){return a.data}),m=f(this.parsedUrl.path+"/"+c+"/info/keyProperties",t({query:this._getQueryParams(),responseType:"json"},e)).then(function(a){return a.data}).catch(function(){}),[4,u.all([b,m])];case 1:d=l.sent();if(!d[0])return[2,void 0];k=a.Extent.fromJSON(d[0].extent);h=d[0].statistics?d[0].statistics.map(function(a){return{min:a[0],max:a[1],avg:a[2],stddev:a[3]}}):null;return[2,new M({bandCount:d[0].bandCount,
extent:k,spatialReference:k.sr,pixelSize:new a.Point({x:d[0].pixelSizeX,y:d[0].pixelSizeY,spatialReference:k.sr}),pixelType:d[0].pixelType.toLowerCase(),statistics:h,histograms:d[0].histograms,keyProperties:d[1]})]}})})};k.prototype.getCatalogItemICSInfo=function(c,e){return p(this,void 0,void 0,function(){var b,d,m,k,h,l,n,q,g,x,w,p,C,z,y,B,A,F,G,E,M,N,Z,v,H,W,L,O,I;return r(this,function(r){switch(r.label){case 0:return[4,f(this.parsedUrl.path+"/"+c+"/info/ics",t({query:this._getQueryParams(),responseType:"json"},
e))];case 1:d=(b=r.sent().data)&&b.ics;if(!d)return[2,void 0];m=10.7<=this.version?f(this.parsedUrl.path+"/"+c+"/info/icstopixel",t({query:this._getQueryParams(),responseType:"json"},e)).then(function(a){return a.data}).catch(function(){return{}}):{};k=d.extent.spatialReference;if(!k)for(h in d.geodataXform)d.geodataXform[h].spatialReference&&(k=d.geodataXform[h].spatialReference);l={geometries:JSON.stringify({geometryType:"esriGeometryEnvelope",geometries:[d.extent]}),inSR:k.wkid||k,outSR:"0:"+c};
n=f(this.parsedUrl.path+"/project",t({query:this._getQueryParams(l),responseType:"json"},e)).then(function(a){return a.data});q=5;g=(d.extent.xmin+d.extent.xmax)/2;x=(d.extent.ymax-d.extent.ymin)/(q+1);w=d.extent.ymin+x;p=[];for(C=0;C<q;C++)p.push({x:g,y:w+x*C});z={geometries:JSON.stringify({geometryType:"esriGeometryPoint",geometries:p}),inSR:k.wkid||k,outSR:"0:"+c};y=f(this.parsedUrl.path+"/project",t({query:this._getQueryParams(z),responseType:"json"},e)).then(function(a){return a.data});return[4,
u.all([m,n,y])];case 2:B=r.sent();A=B[0].ipxf;null==A&&(F=d.geodataXform&&d.geodataXform.xf_0)&&"topup"===F.name.toLowerCase()&&(A={affine:{name:"ics [sensor: Frame] to pixel (column, row) transformation",coefficients:F.coefficients,cellsizeRatio:0,type:"GeometricXform"}});if(G=a.Extent.fromJSON(B[1]&&B[1].geometries&&B[1].geometries[0]))G.spatialReference=new a.SpatialReference({wkid:0,imageCoordinateSystem:d});E=B[2].geometries.filter(function(a){return null!=a});M=E.length;for(C=H=v=Z=N=0;C<M;C++)N+=
E[C].x,Z+=E[C].y,v+=E[C].x*E[C].x,H+=E[C].x*E[C].y;W=(M*H-N*Z)/(M*v-N*N);L=0;O=E[q-1].x>E[0].x;I=E[q-1].y>E[0].y;Infinity===W?L=I?90:270:0===W?L=O?0:180:0<W?L=O?180*Math.atan(W)/Math.PI:180*Math.atan(W)/Math.PI+180:0>W&&(L=I?180+180*Math.atan(W)/Math.PI:360+180*Math.atan(W)/Math.PI);return[2,{ics:d,icsToPixelTransform:A,icsExtent:G,northDirection:L}]}})})};k.prototype.generateRasterInfo=function(a,c){return p(this,void 0,void 0,function(){var f,e;return r(this,function(b){switch(b.label){case 0:if((!a||
"none"===a.functionName.toLowerCase())&&l.isSome(this.serviceRasterInfo))return[2,this.serviceRasterInfo];f=T(a);if(this._functionRasterInfos[f])return[2,this._functionRasterInfos[f]];e=this._generateRasterInfo(a,c);this._functionRasterInfos[f]=e;b.label=1;case 1:return b.trys.push([1,3,,4]),[4,e];case 2:return[2,b.sent()];case 3:return b.sent(),this._functionRasterInfos[f]=null,[2,null];case 4:return[2]}})})};k.prototype.getExportImageServiceParameters=function(a,c,f,e){a=a.clone().shiftCentralMeridian();
var b=a.spatialReference;if(b.imageCoordinateSystem)var d=b.imageCoordinateSystem,m=d.id,d=d.referenceServiceName,b=null!=m?d?-1<this.parsedUrl.path.toLowerCase().indexOf("/"+d.toLowerCase()+"/")?"0:"+m:JSON.stringify({icsid:m,icsns:d}):"0:"+m:JSON.stringify({ics:b.imageCoordinateSystem});else b=b.wkid||JSON.stringify(b.toJSON());l.isSome(this.serviceRasterInfo)&&this.pixelType!==this.serviceRasterInfo.pixelType&&(this.exportImageServiceParameters.pixelType=this.pixelType);var m=this.exportImageServiceParameters.toJSON(),
d=m.bandIds,k=m.noData,h=m.mosaicRule,u=m.renderingRule;d instanceof Array&&0<d.length&&(m.bandIds=d.join(","));k instanceof Array&&0<k.length&&(m.noData=k.join(","));var n=this.timeInfo;h&&h.multidimensionalDefinition&&e&&n&&n.startField&&(h.multidimensionalDefinition=h.multidimensionalDefinition.filter(function(a){return a.dimensionName!==n.startField}));m.mosaicRule=h&&JSON.stringify(h);m.renderingRule=u&&JSON.stringify(u);d={};if(e)if(k=e.toJSON(),e=k.start,k=k.end,e&&k&&e===k)d.time=""+e;else if(null!=
e||null!=k)d.time=(null==e?"null":e)+","+(null==k?"null":k);return t({bbox:a.xmin+","+a.ymin+","+a.xmax+","+a.ymax,bboxSR:b,imageSR:b,size:c+","+f},m,d)};k.prototype.queryRasters=function(a){return this.queryTask.execute(a)};k.prototype.queryVisibleRasters=function(f,e){var b=this;if(!f)return u.reject(new c("imagery-layer: query-visible-rasters","missing query parameter"));var d=e||{pixelSize:null,returnDomainValues:!1,returnTopmostRaster:!1,showNoDataRecords:!1};e=d.pixelSize;var m=d.returnDomainValues,
k=d.returnTopmostRaster,h=d.showNoDataRecords,l=!1,n=d=null,q=this.rasterFunctionNamesIndex;if(f.outFields&&10.4<=this.version){var g=f.outFields.filter(function(a){return-1<a.toLowerCase().indexOf("raster.servicepixelvalue")&&24<a.length}).map(function(a){a=a.slice(25);return[b._updateRenderingRulesFunctionName(a,q),a]}),d=g.map(function(a){return new F({functionName:a[0]})}),n=g.map(function(a){return a[1]}),l=f.outFields.some(function(a){return-1===a.toLowerCase().indexOf("raster.servicepixelvalue")});
0===d.length?this.renderingRule?(d.push(this.renderingRule),n.push(this.renderingRule.functionName)):d=null:this.renderingRule&&!d.some(function(a){return a.functionName===b.renderingRule.functionName})&&(d.push(this.renderingRule),n.push(this.renderingRule.functionName))}var x=!f.outSpatialReference||f.outSpatialReference.equals(this.spatialReference);e=this._getQueryParams({geometry:f.geometry,timeExtent:f.timeExtent,mosaicRule:this.exportImageServiceParameters.mosaicRule,renderingRule:10.4>this.version?
this.renderingRule:null,renderingRules:d,pixelSize:e,returnCatalogItems:l,returnGeometry:x,maxItemCount:k?1:null});delete e.f;var w=new Q(e),p=new H({url:this.url}),C=this.generateRasterInfo(this.renderingRule);return u.create(function(e){C.then(function(){p.execute(w).then(function(d){var k=f.outFields;if(l&&!x&&d.catalogItems&&d.catalogItems.features&&0<d.catalogItems.features.length){var u=b.objectIdField||"ObjectId",q=d.catalogItems.features,g=q.map(function(a){return a.attributes&&a.attributes[u]}),
g=new S({objectIds:g,returnGeometry:!0,outSpatialReference:f.outSpatialReference,outFields:[u]});return b.queryRasters(g).then(function(c){c&&c.features&&0<c.features.length&&c.features.forEach(function(c){q.forEach(function(e){e.attributes[u]===c.attributes[u]&&(e.geometry=new a.Polygon(c.geometry),e.geometry.spatialReference=f.outSpatialReference)})});e(b._processVisibleRastersResponse(d,{returnDomainValues:m,templateRRFunctionNames:n,showNoDataRecords:h,templateFields:k}))}).catch(function(){throw new c("imagery-layer:query-visible-rasters",
"encountered error when querying visible rasters geometry");})}e(b._processVisibleRastersResponse(d,{returnDomainValues:m,templateRRFunctionNames:n,showNoDataRecords:h,templateFields:k}))}).catch(function(){throw new c("imagery-layer:query-visible-rasters","encountered error when querying visible rasters");})})})};k.prototype._fetchService=function(a){return p(this,void 0,void 0,function(){var c,e,b,d,m,k,h=this;return r(this,function(n){switch(n.label){case 0:return(c=this.sourceJSON)?[3,2]:[4,f(this.parsedUrl.path,
{query:this._getQueryParams(),responseType:"json",signal:a})];case 1:e=n.sent(),b=e.data,d=e.ssl,this.sourceJSON=c=b,d&&(this.url=this.url.replace(/^http:/i,"https:")),n.label=2;case 2:return this.read(c,{origin:"service",url:this.parsedUrl}),l.isSome(this.serviceRasterInfo)&&!this.rasterInfo&&(this.rasterInfo=this.serviceRasterInfo),m=l.isSome(this.serviceRasterInfo)?u.resolve(this.serviceRasterInfo):this._fetchAuxiliaryRasterInfo({serviceInfo:c,signal:a}).then(function(a){h._set("serviceRasterInfo",
a);return a}),k=this.renderingRule&&"none"!==this.renderingRule.functionName.toLowerCase()?this.generateRasterInfo(this.renderingRule,{signal:a}):null,[2,u.all([m,k]).then(function(a){a[1]?h._set("rasterInfo",a[1]):h._set("rasterInfo",a[0]);h._configDefaultRenderer();h.watch("renderer",function(){return h._configDefaultRenderer()});h.watch("renderingRule",function(a){(h.renderer||h._symbolizer||h.popupEnabled&&h.popupTemplate)&&h.generateRasterInfo(a).then(function(a){a&&(h.rasterInfo=a)})});(a=l.isSome(h.serviceRasterInfo)&&
h.serviceRasterInfo.multidimensionalInfo)&&h._updateMultidimensionalDefinition(a)})]}})})};k.prototype._initJobHandler=function(){return p(this,void 0,void 0,function(){var a,c=this;return r(this,function(f){switch(f.label){case 0:if(null!=this._rasterJobHandler.connectionPromise)return[2,this._rasterJobHandler.connectionPromise];a=new N;this._rasterJobHandler.connectionPromise=a.initialize().then(function(){c._rasterJobHandler.instance=a},function(){return null});return[4,this._rasterJobHandler.connectionPromise];
case 1:return f.sent(),[2]}})})};k.prototype._shutdownJobHandler=function(){this._rasterJobHandler.instance&&this._rasterJobHandler.instance.destroy();this._rasterJobHandler.instance=null;this._rasterJobHandler.connectionPromise=null;this._rasterJobHandler.refCount=0};k.prototype._isPicture=function(){return!this.format||-1<this.format.indexOf("jpg")||-1<this.format.indexOf("png")};k.prototype._configDefaultRenderer=function(){if(!this._isPicture()&&!this.pixelFilter){if(!this.bandIds&&3<=this.rasterInfo.bandCount){var a=
z.getDefaultBandCombination(this.rasterInfo);!a||3===this.rasterInfo.bandCount&&0===a[0]&&1===a[1]&&2===a[2]||(this.bandIds=a)}this.renderer||(this.renderer=z.createDefaultRenderer(this.rasterInfo,this.bandIds));this._symbolizer?(this._symbolizer.renderer=this.renderer,this._symbolizer.rasterInfo=this.rasterInfo):this._symbolizer=new L({renderer:this.renderer,rasterInfo:this.rasterInfo});this._symbolizer.bind()||(this._symbolizer=null)}};k.prototype._clonePixelData=function(a){return null==a?a:{extent:a.extent&&
a.extent.clone(),pixelBlock:a.pixelBlock&&a.pixelBlock.clone()}};k.prototype._getQueryParams=function(a){return t({raster:this.raster,viewId:this.viewId,f:"json"},a)};k.prototype._decodePixelBlock=function(a,c,f){return this._rasterJobHandler.instance?this._rasterJobHandler.instance.decode({data:a,options:c}):O.decode(a,c,f)};k.prototype._fetchAuxiliaryRasterInfo=function(e){var b=e&&e.serviceInfo;if(!b)return u.reject(new c("imagery-layer:fetch-metadata","valid serviceInfo is required"));var d=e.renderingRule?
JSON.stringify(e.renderingRule.toJSON()):null,m=e.signal;e=b.hasRasterAttributeTable&&10.1<=this.version?f(this.parsedUrl.path+"/rasterAttributeTable",{query:this._getQueryParams({renderingRule:10.1<=this.version?d:null}),signal:m}).then(function(a){return R.fromJSON(a.data)}).catch(function(){return null}):!1;var k=b.hasColormap&&10.1<=this.version?f(this.parsedUrl.path+"/colormap",{query:this._getQueryParams({renderingRule:10.6<=this.version?d:null}),signal:m}).then(function(a){return a.data&&a.data.colormap}):
!1,h=b.hasHistograms&&10.1<=this.version?f(this.parsedUrl.path+"/histograms",{query:this._getQueryParams({renderingRule:10.1<=this.version?d:null}),signal:m}).then(function(a){return a.data&&a.data.histograms}):!1,d=10.3<=this.version?f(this.parsedUrl.path+"/keyProperties",{query:this._getQueryParams({renderingRule:d}),signal:m}).then(function(a){return a.data}).catch(function(){}):!1,m=b.hasMultidimensions&&10.3<=this.version?f(this.parsedUrl.path+"/multidimensionalInfo",{query:this._getQueryParams(),
signal:m}).then(function(a){return a.data&&a.data.multidimensionalInfo}):!1;return u.all([e,k,h,d,m]).then(function(c){var f=null;if(b.minValues&&b.minValues.length===b.bandCount)for(var f=[],e=0;e<b.minValues.length;e++)f.push({min:b.minValues[e],max:b.maxValues[e],avg:b.meanValues[e],stddev:b.stdvValues[e]});var e=Math.ceil((b.extent.xmax-b.extent.xmin)/b.pixelSizeX-.1),d=Math.ceil((b.extent.ymax-b.extent.ymin)/b.pixelSizeY-.1),m=a.SpatialReference.fromJSON(b.spatialReference||b.extent.spatialReference);
return new M({width:e,height:d,bandCount:b.bandCount,extent:a.Extent.fromJSON(b.extent),spatialReference:m,pixelSize:new a.Point({x:b.pixelSizeX,y:b.pixelSizeY,spatialReference:m}),pixelType:b.pixelType.toLowerCase(),statistics:f,attributeTable:c[0]||null,colormap:c[1]||null,histograms:c[2]||null,keyProperties:c[3]||null,multidimensionalInfo:c[4]||null})})};k.prototype._requestArrayBuffer=function(a){var e=this,b=a.imageProps,d=a.signal;if(a.requestAsImageElement&&!this.pixelFilter&&b.format&&-1<
b.format.indexOf("png"))return f(this.parsedUrl.path+"/exportImage",{responseType:"image",query:this._getQueryParams(t({f:"image"},a.imageServiceParameters)),signal:d}).then(function(a){return{imageElement:a.data,params:b}});var m=this._initJobHandler();a=f(this.parsedUrl.path+"/exportImage",{responseType:"array-buffer",query:this._getQueryParams(t({f:"image"},a.imageServiceParameters)),signal:d});return u.all([a,m]).then(function(a){a=a[0].data;var f=b.format||"jpgpng",m=f;"bsq"!==m&&"bip"!==m&&
(m=O.getFormat(a));if(!m)throw new c("imagery-layer:fetch-image","unsupported format signature "+String.fromCharCode.apply(null,new Uint8Array(a)));var m=-1<f.indexOf("png")&&("png"===m||"jpg"===m),k={signal:d};return m?O.decode(a,t({useCanvas:!0},b),k).then(function(a){return{pixelData:{pixelBlock:a,extent:b.extent},params:b}}):e._decodePixelBlock(a,{width:b.width,height:b.height,planes:null,pixelType:null,noDataValue:null,format:f},k).then(function(a){return{pixelData:{pixelBlock:a,extent:b.extent},
params:b}})})};k.prototype._generateRasterInfo=function(a,c){return p(this,void 0,void 0,function(){var e,b;return r(this,function(d){switch(d.label){case 0:return[4,f(this.parsedUrl.path,t({query:this._getQueryParams({renderingRule:a}),responseType:"json"},c))];case 1:return e=d.sent().data,[4,this._fetchAuxiliaryRasterInfo(t({serviceInfo:e,renderingRule:a},c))];case 2:return b=d.sent(),[2,b]}})})};k.prototype._isValidCustomizedMosaicRule=function(a){return a&&JSON.stringify(a.toJSON())!==JSON.stringify(this._defaultServiceMosaicRule&&
this._defaultServiceMosaicRule.toJSON())};k.prototype._updateMultidimensionalDefinition=function(a){if(!this._isValidCustomizedMosaicRule(this.mosaicRule)){var c=a.variables[0].dimensions;a=[];for(var f in c)if(c.hasOwnProperty(f)){var e=c[f],b=e.extent,d=!0,m=[b[0]];e.hasRanges&&!0===e.hasRanges?(d=!1,m=[e.values[0]]):"stdz"===e.name.toLowerCase()&&Math.abs(b[1])<=Math.abs(b[0])&&(m=[b[1]]);a.push(new G({variableName:"",dimensionName:c[f].name,isSlice:d,values:m}))}0<a.length&&(this.mosaicRule=this.mosaicRule||
new A,f=this.mosaicRule.multidimensionalDefinition,!f||f&&0>=f.length)&&(this.mosaicRule.multidimensionalDefinition=a)}};k.prototype._formatAttributeValue=function(a,c){if("string"===typeof a&&(c=(c=this._getFieldInfo(this.popupTemplate&&this.popupTemplate.fieldInfos,c))&&c.format)){var f=void 0,e=void 0;return-1<a.trim().indexOf(",")?(f=",",this._formatDelimitedString(a,f,f+" ",c)):-1<a.trim().indexOf(" ")?(f=e=" ",this._formatDelimitedString(a,f,e,c)):this._formatNumberFromString(a,c)}return a};
k.prototype._getFieldInfo=function(a,c){if(a&&a.length&&c){var f=c.toLowerCase(),e=void 0;a.some(function(a){return!a.fieldName||a.fieldName.toLowerCase()!==f&&a.fieldName.toLowerCase()!==f.replace(/ /g,"_")?!1:(e=a,!0)});return e}};k.prototype._formatDelimitedString=function(a,c,f,e){var b=this;return a&&c&&f&&e?a.trim().split(c).map(function(a){return b._formatNumberFromString(a,e)}).join(f):a};k.prototype._formatNumberFromString=function(a,c){if(!a||!c)return a;var f=Number(a);return isNaN(f)?
a:c.format(f)};k.prototype._processVisibleRastersResponse=function(a,c){c=c||{};var f=a.value,e=c.templateRRFunctionNames,b=c.showNoDataRecords,m=c.returnDomainValues,k=c.templateFields;c=a.processedValues;var h=a.catalogItems&&a.catalogItems.features,u=a.properties&&a.properties.Values&&a.properties.Values.map(function(a){return a.replace(/ /gi,", ")})||[],n=this.objectIdField||"ObjectId";a="string"===typeof f&&-1<f.toLowerCase().indexOf("nodata");var q=[];!f||h||a||(h={},h[n]=0,h=new d(this.fullExtent,
null,h),u=[f],h=[h]);if(!h)return[];this._updateResponseFieldNames(h,k);for(var g,x,n=0;n<h.length;n++){k=h[n];if(null!=f&&!a){g=u[n];x=this.renderingRule&&c&&0<c.length&&e&&0<e.length&&-1<e.indexOf(this.renderingRule.functionName)?c[e.indexOf(this.renderingRule.functionName)]:f;if("nodata"===g.toLowerCase()&&!b)continue;k.attributes["Raster.ItemPixelValue"]=this._formatAttributeValue(g,"Raster.ItemPixelValue");k.attributes["Raster.ServicePixelValue"]=this._formatAttributeValue(x,"Raster.ServicePixelValue");
this._updateFeatureWithMagDirValues(k,g);var w=this.fields&&0<this.fields.length;x=this.renderingRule&&l.isSome(this.serviceRasterInfo)&&this.serviceRasterInfo.attributeTable?w?g:f:x;this.renderingRule||(x=w?g:f);this._updateFeatureWithRasterAttributeTableValues(k,x)}k.sourceLayer=this;m&&this._updateFeatureWithDomainValues(k);if(e&&c&&e.length===c.length)for(g=0;g<e.length;g++)w="Raster.ServicePixelValue."+e[g],k.attributes[w]=this._formatAttributeValue(c[g],w);q.push(h[n])}return q};k.prototype._updateFeatureWithRasterAttributeTableValues=
function(a,c){var f=this,e=this.rasterInfo&&this.rasterInfo.attributeTable||l.isSome(this.serviceRasterInfo)&&this.serviceRasterInfo.attributeTable,b=e&&e.features;if(b){var e=e.fields,d=e.map(function(a){return a.name}).filter(function(a){return"value"===a.toLowerCase()}),m=d&&d[0];if(m){var k=b.filter(function(a){return a.attributes[m]===(null!=c?parseInt(c,10):null)});k&&k[0]&&e.forEach(function(c){var e=f.rasterAttributeTableFieldPrefix+c.name;a.attributes[e]=f._formatAttributeValue(k[0].attributes[c.name],
e)})}}};k.prototype._updateFeatureWithMagDirValues=function(c,f){if(this.pixelFilter&&("esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType)){var e=f.replace(" ",",").split(",").map(function(a){return parseFloat(a)});f=e.map(function(a){return[a]});e=e.map(function(a){return{minValue:a,maxValue:a,noDataValue:null}});f=new E({height:1,width:1,pixelType:"f32",pixels:f,statistics:e});this.pixelFilter({pixelBlock:f,extent:new a.Extent(0,
0,0,0,this.spatialReference)});c.attributes["Raster.Magnitude"]=f.pixels[0][0];c.attributes["Raster.Direction"]=f.pixels[1][0]}};k.prototype._updateFeatureWithDomainValues=function(a){var c=this.fields&&this.fields.filter(function(a){return a.domain&&"coded-value"===a.domain.type});null!=c&&c.forEach(function(c){var f=a.attributes[c.name];if(null!=f){var e=c.domain.codedValues.filter(function(a){return a.code===f})[0];e&&(a.attributes[c.name]=e.name)}})};k.prototype._updateResponseFieldNames=function(a,
c){if(c&&!(1>c.length)){var f=this.fieldsIndex;f&&a.forEach(function(a){if(a&&a.attributes)for(var e=0;e<c.length;e++){var b=c[e];if(f.has(b)){var d=f.get(b).name;d!==b&&(a.attributes[b]=a.attributes[d],delete a.attributes[d])}}})}};k.prototype._updateRenderingRulesFunctionName=function(a,c){if(a&&!(1>a.length)){if("Raw"===a)return a.replace("Raw","None");var f=a.toLowerCase().replace(/ /gi,"_");return c.has(f)?c.get(f):a}};k.prototype._isRFTJson=function(a){return a.name&&a.arguments&&a.function&&
a.hasOwnProperty("functionType")};b([q.property()],k.prototype,"_functionRasterInfos",void 0);b([q.property()],k.prototype,"_rasterJobHandler",void 0);b([q.property()],k.prototype,"_symbolizer",void 0);b([q.property()],k.prototype,"_defaultServiceMosaicRule",void 0);b([q.reader("_defaultServiceMosaicRule",["defaultMosaicMethod"])],k.prototype,"readDefaultServiceMosaicRule",null);b([q.property()],k.prototype,"_cachedRendererJson",void 0);b([q.property()],k.prototype,"rasterAttributeTableFieldPrefix",
void 0);b([q.property({readOnly:!0,dependsOn:["rasterFunctionInfos"]})],k.prototype,"rasterFunctionNamesIndex",null);b([q.property({readOnly:!0,dependsOn:["url"]})],k.prototype,"queryTask",null);b([q.property()],k.prototype,"adjustAspectRatio",void 0);b([q.property({readOnly:!0}),q.aliasOf("serviceRasterInfo.bandCount")],k.prototype,"bandCount",void 0);b([q.property({type:[C.Integer],json:{write:!0}})],k.prototype,"bandIds",void 0);b([q.property({readOnly:!0})],k.prototype,"capabilities",void 0);
b([q.reader("capabilities")],k.prototype,"readCapabilities",null);b([q.property({type:Number})],k.prototype,"compressionQuality",void 0);b([q.writer("compressionQuality")],k.prototype,"writeCompressionQuality",null);b([q.property({type:Number})],k.prototype,"compressionTolerance",void 0);b([q.writer("compressionTolerance")],k.prototype,"writeCompressionTolerance",null);b([q.property({json:{read:{source:"copyrightText"}}})],k.prototype,"copyright",void 0);b([q.property({type:String,json:{read:{source:"layerDefinition.definitionExpression"},
write:{target:"layerDefinition.definitionExpression"}}})],k.prototype,"definitionExpression",void 0);b([q.property({readOnly:!0,constructOnly:!0})],k.prototype,"exportImageServiceParameters",void 0);b([q.property()],k.prototype,"rasterInfo",void 0);b([q.property({readOnly:!0,type:[w]})],k.prototype,"fields",void 0);b([q.property({readOnly:!0,dependsOn:["fields"]})],k.prototype,"fieldsIndex",null);b([q.property({type:String,json:{write:!0}})],k.prototype,"format",null);b([q.property({type:a.Extent})],
k.prototype,"fullExtent",void 0);b([q.property({readOnly:!0})],k.prototype,"hasMultidimensions",void 0);b([q.property({json:{read:{source:"maxImageHeight"}}})],k.prototype,"imageMaxHeight",void 0);b([q.property({json:{read:{source:"maxImageWidth"}}})],k.prototype,"imageMaxWidth",void 0);b([q.property({type:String,json:{read:{reader:P.read},write:{writer:P.write}}})],k.prototype,"interpolation",void 0);b([q.property({type:A})],k.prototype,"mosaicRule",null);b([q.reader("mosaicRule",["mosaicRule","defaultMosaicMethod"])],
k.prototype,"readMosaicRule",null);b([q.writer("mosaicRule")],k.prototype,"writeMosaicRule",null);b([q.property({readOnly:!0}),q.aliasOf("serviceRasterInfo.multidimensionalInfo")],k.prototype,"multidimensionalInfo",void 0);b([q.property()],k.prototype,"noData",void 0);b([q.writer("noData")],k.prototype,"writeNoData",null);b([q.property({type:String,json:{read:{reader:J.read},write:{writer:J.write}}})],k.prototype,"noDataInterpretation",void 0);b([q.property({type:String,readOnly:!0,json:{read:{source:["fields"]}}})],
k.prototype,"objectIdField",void 0);b([q.reader("objectIdField")],k.prototype,"readObjectIdField",null);b([q.property({readOnly:!0,dependsOn:["url"]})],k.prototype,"parsedUrl",null);b([q.property({readOnly:!0}),q.aliasOf("serviceRasterInfo.pixelSize.x")],k.prototype,"pixelSizeX",void 0);b([q.property({readOnly:!0}),q.aliasOf("serviceRasterInfo.pixelSize.y")],k.prototype,"pixelSizeY",void 0);b([q.property({type:Function})],k.prototype,"pixelFilter",void 0);b([q.property()],k.prototype,"raster",void 0);
b([q.property()],k.prototype,"viewId",void 0);b([q.property({types:h.rasterRendererTypes,json:{read:{source:"layerDefinition.drawingInfo.renderer"},write:{target:"layerDefinition.drawingInfo.renderer"}}})],k.prototype,"renderer",void 0);b([q.reader("renderer")],k.prototype,"readRenderer",null);b([q.property(B.opacityDrawingInfo)],k.prototype,"opacity",void 0);b([q.property({readOnly:!0}),q.aliasOf("serviceRasterInfo.attributeTable")],k.prototype,"rasterAttributeTable",void 0);b([q.property({readOnly:!0,
dependsOn:["fields","rasterInfo"]})],k.prototype,"rasterFields",null);b([q.property({readOnly:!0})],k.prototype,"rasterFunctionInfos",void 0);b([q.property({type:F})],k.prototype,"renderingRule",null);b([q.reader("renderingRule",["renderingRule","rasterFunctionInfos"])],k.prototype,"readRenderingRule",null);b([q.writer("renderingRule")],k.prototype,"writeRenderingRule",null);b([q.property()],k.prototype,"serviceDataType",void 0);b([q.property({readOnly:!0,type:a.SpatialReference})],k.prototype,"spatialReference",
void 0);b([q.reader("spatialReference",["spatialReference","extent"])],k.prototype,"readSpatialReference",null);b([q.property()],k.prototype,"pixelType",void 0);b([q.reader("pixelType")],k.prototype,"readPixelType",null);b([q.writer("pixelType")],k.prototype,"writePixelType",null);b([q.property({constructOnly:!0,type:M})],k.prototype,"serviceRasterInfo",void 0);b([q.property()],k.prototype,"sourceJSON",void 0);b([q.property(B.url)],k.prototype,"url",void 0);b([q.property({readOnly:!0})],k.prototype,
"version",void 0);b([q.reader("version",["currentVersion","fields","timeInfo"])],k.prototype,"readVersion",null);return k=b([q.subclass("esri.layers.mixins.ArcGISImageService")],k)}(q.declared(e))}})},"esri/rasterRenderers":function(){define("require exports ./core/Warning ./renderers/ClassBreaksRenderer ./renderers/RasterColormapRenderer ./renderers/RasterStretchRenderer ./renderers/UniqueValueRenderer".split(" "),function(D,v,t,g,b,r,p){function a(a,f){if(!a)return null;var c;c=a?d[a.type]||null:
null;if(c)return c=new c,c.read(a,f),c;f&&f.messages&&a&&f.messages.push(new t("renderer:unsupported","Renderers of type '"+(a.type||"unknown")+"' are not supported",{definition:a,context:f}));return null}Object.defineProperty(v,"__esModule",{value:!0});v.ClassBreaksRenderer=g;v.RasterColormapRenderer=b;v.RasterStretchRenderer=r;v.UniqueValueRenderer=p;v.rasterRendererTypes={key:"type",base:null,typeMap:{"unique-value":p,"class-breaks":g,"raster-colormap":b,"raster-stretch":r}};var d={uniqueValue:p,
classBreaks:g,rasterStretch:r,rasterColormap:b};v.read=a;v.fromJSON=function(b,f){return a(b,f)}})},"esri/renderers/RasterColormapRenderer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/paramHelper ../core/JSONSupport ../core/accessorSupport/decorators ./support/ColormapInfo ./support/colorRampUtils".split(" "),function(D,v,t,g,b,r,p,a,d){return function(b){function f(a){a=b.call(this,a)||this;a.type="raster-colormap";
return a}t(f,b);c=f;f.createFromColormap=function(f){if(!f)return null;var b=5===f[0].length;f=f.sort(function(a){return a[0]-a[1]});b=b?f.map(function(c){return a.fromJSON({value:c[0],color:c.slice(1,5),label:String(c[0])})}):f.map(function(c){return a.fromJSON({value:c[0],color:c.slice(1,4).concat([255]),label:String(c[0])})});return new c({colormapInfos:b})};f.createFromColorramp=function(a){a=d.convertColorRampToColormap(a,256);return c.createFromColormap(a)};f.prototype.clone=function(){return new c({colormapInfos:this.colormapInfos.map(function(a){return a.toJSON()})})};
f.prototype.extractColormap=function(){return this.colormapInfos.map(function(a){return[a.value,a.color.r,a.color.g,a.color.b,1<a.color.a?a.color.a:255*a.color.a&255]}).sort(function(a,c){return a[0]-c[0]})};var c;g([p.property({type:[a],json:{write:!0}})],f.prototype,"colormapInfos",void 0);g([p.enumeration.serializable()({rasterColormap:"raster-colormap"})],f.prototype,"type",void 0);return f=c=g([p.subclass("esri.renderers.RasterColormapRenderer")],f)}(p.declared(r.JSONSupport))})},"esri/renderers/support/ColormapInfo":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/paramHelper ../../Color ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(D,v,t,g,b,r,p,a){return function(b){function d(){var a=null!==b&&b.apply(this,arguments)||this;a.value=null;a.label=null;a.color=null;return a}t(d,b);g([a.property({type:Number,json:{write:!0}})],d.prototype,"value",void 0);g([a.property({type:String,json:{write:!0}})],d.prototype,"label",void 0);g([a.property({type:r,json:{write:!0}})],d.prototype,"color",void 0);return d=g([a.subclass("esri.renderers.support.ColormapInfo")],d)}(a.declared(p.JSONSupport))})},"esri/renderers/support/colorRampUtils":function(){define(["require",
"exports","../../Color","../../core/colorUtils"],function(D,v,t,g){function b(a,b){if(!a||!b||a.length!==b.length)return!1;for(var d=0;d<a.length;d++)if(a[d]>b[d]+2||a[d]<b[d]-2)return!1;return!0}function r(a,b,h){a=g.toLAB(a);b=g.toLAB(b);return g.toRGB({l:a.l*(1-h)+h*b.l,a:a.a*(1-h)+h*b.a,b:a.b*(1-h)+h*b.b})}function p(a,d){if(a){d=d?d:v.PREDEFINED_JSON_COLOR_RAMPS;var h=null,f;"algorithmic"===a.type?d.some(function(c){if(b(a.fromColor.toRgb(),c.fromColor)&&b(a.toColor.toRgb(),c.toColor))return h=
c.id,!0}):"multipart"===a.type&&d.some(function(c){if(a.colorRamps&&c.colorRamps&&a.colorRamps.length===c.colorRamps.length&&(f=a.colorRamps,!c.colorRamps.some(function(a,c){if(!b(f[c].fromColor.toRgb(),(new t(a.fromColor)).toRgb())||!b(f[c].toColor.toRgb(),(new t(a.toColor)).toRgb()))return!0}))){if(h)return!0;h=c.id}});return h}}Object.defineProperty(v,"__esModule",{value:!0});v.PREDEFINED_JSON_COLOR_RAMPS=[{id:"aspect_predefined",type:"multipart",colorRamps:[{fromColor:[190,190,190],toColor:[255,
45,8]},{fromColor:[255,45,8],toColor:[255,181,61]},{fromColor:[255,181,61],toColor:[255,254,52]},{fromColor:[255,254,52],toColor:[0,251,50]},{fromColor:[0,251,50],toColor:[255,254,52]},{fromColor:[0,253,255],toColor:[0,181,255]},{fromColor:[0,181,255],toColor:[26,35,253]},{fromColor:[26,35,253],toColor:[255,57,251]},{fromColor:[255,57,251],toColor:[255,45,8]}]},{id:"blackToWhite_predefined",fromColor:[0,0,0],toColor:[255,255,255]},{id:"blueBright_predefined",fromColor:[204,204,255],toColor:[0,0,224]},
{id:"blueLightToDark_predefined",fromColor:[211,229,232],toColor:[46,100,140]},{id:"blueGreenBright_predefined",fromColor:[203,245,234],toColor:[48,207,146]},{id:"blueGreenLightToDark_predefined",fromColor:[216,242,237],toColor:[21,79,74]},{id:"brownLightToDark_predefined",fromColor:[240,236,170],toColor:[102,72,48]},{id:"brownToBlueGreenDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[156,85,31],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[33,130,145]}]},{id:"brownToBlueGreenDivergingDark_predefined",
type:"multipart",colorRamps:[{fromColor:[110,70,45],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[48,100,102]}]},{id:"coefficientBias_predefined",fromColor:[214,214,255],toColor:[0,57,148]},{id:"coldToHotDiverging_predefined",type:"multipart",colorRamps:[{fromColor:[69,117,181],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[214,47,39]}]},{id:"conditionNumber_predefined",type:"multipart",colorRamps:[{fromColor:[0,97,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,34,
0]}]},{id:"cyanToPurple_predefined",type:"multipart",colorRamps:[{fromColor:[0,245,245],toColor:[0,0,245]},{fromColor:[0,0,245],toColor:[245,0,245]}]},{id:"cyanLightToBlueDark_predefined",type:"multipart",colorRamps:[{fromColor:[182,237,240],toColor:[31,131,224]},{fromColor:[31,131,224],toColor:[9,9,145]}]},{id:"distance_predefined",fromColor:[255,200,0],toColor:[0,0,255]},{id:"elevation1_predefined",type:"multipart",colorRamps:[{fromColor:[175,240,233],toColor:[255,255,179]},{fromColor:[255,255,
179],toColor:[0,128,64]},{fromColor:[0,128,64],toColor:[252,186,3]},{fromColor:[252,186,3],toColor:[128,0,0]},{fromColor:[120,0,0],toColor:[105,48,13]},{fromColor:[105,48,13],toColor:[171,171,171]},{fromColor:[171,171,171],toColor:[255,252,255]}]},{id:"elevation2_predefined",type:"multipart",colorRamps:[{fromColor:[118,219,211],toColor:[255,255,199]},{fromColor:[255,255,199],toColor:[255,255,128]},{fromColor:[255,255,128],toColor:[217,194,121]},{fromColor:[217,194,121],toColor:[135,96,38]},{fromColor:[135,
96,38],toColor:[150,150,181]},{fromColor:[150,150,181],toColor:[181,150,181]},{fromColor:[181,150,181],toColor:[255,252,255]}]},{id:"errors_predefined",fromColor:[255,235,214],toColor:[196,10,10]},{id:"grayLightToDark_predefined",fromColor:[219,219,219],toColor:[69,69,69]},{id:"greenBright_predefined",fromColor:[204,255,204],toColor:[14,204,14]},{id:"greenLightToDark_predefined",fromColor:[220,245,233],toColor:[34,102,51]},{id:"greenToBlue_predefined",type:"multipart",colorRamps:[{fromColor:[32,204,
16],toColor:[0,242,242]},{fromColor:[0,242,242],toColor:[2,33,227]}]},{id:"orangeBright_predefined",fromColor:[255,235,204],toColor:[240,118,5]},{id:"orangeLightToDark_predefined",fromColor:[250,233,212],toColor:[171,65,36]},{id:"partialSpectrum_predefined",type:"multipart",colorRamps:[{fromColor:[242,241,162],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]},{fromColor:[252,3,69],toColor:[176,7,237]},{fromColor:[176,7,237],toColor:[2,29,173]}]},{id:"partialSpectrum1Diverging_predefined",
type:"multipart",colorRamps:[{fromColor:[135,38,38],toColor:[240,149,12]},{fromColor:[240,149,12],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[74,80,181]},{fromColor:[74,80,181],toColor:[39,32,122]}]},{id:"partialSpectrum2Diverging_predefined",type:"multipart",colorRamps:[{fromColor:[115,77,42],toColor:[201,137,52]},{fromColor:[201,137,52],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[91,63,176]},{fromColor:[91,63,176],toColor:[81,13,97]}]},{id:"pinkToYellowGreenDivergingBright_predefined",
type:"multipart",colorRamps:[{fromColor:[158,30,113],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[99,110,45]}]},{id:"pinkToYellowGreenDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[97,47,73],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[22,59,15]}]},{id:"precipitation_predefined",type:"multipart",colorRamps:[{fromColor:[194,82,60],toColor:[237,161,19]},{fromColor:[237,161,19],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,219,0]},{fromColor:[0,219,
0],toColor:[32,153,143]},{fromColor:[32,153,143],toColor:[11,44,122]}]},{id:"prediction_predefined",type:"multipart",colorRamps:[{fromColor:[40,146,199],toColor:[250,250,100]},{fromColor:[250,250,100],toColor:[232,16,20]}]},{id:"purpleBright_predefined",fromColor:[255,204,255],toColor:[199,0,199]},{id:"purpleToGreenDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[77,32,150],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[20,122,11]}]},{id:"purpleToGreenDivergingDark_predefined",
type:"multipart",colorRamps:[{fromColor:[67,14,89],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[24,79,15]}]},{id:"purpleBlueBright_predefined",fromColor:[223,184,230],toColor:[112,12,242]},{id:"purpleBlueLightToDark_predefined",fromColor:[229,213,242],toColor:[93,44,112]},{id:"purpleRedBright_predefined",fromColor:[255,204,225],toColor:[199,0,99]},{id:"purpleRedLightToDark_predefined",fromColor:[250,215,246],toColor:[143,17,57]},{id:"redBright_predefined",fromColor:[255,204,204],toColor:[219,
0,0]},{id:"redLightToDark_predefined",fromColor:[255,224,224],toColor:[143,10,10]},{id:"redToBlueDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[196,69,57],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[48,95,207]}]},{id:"redToBlueDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[107,13,13],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[13,53,97]}]},{id:"redToGreen_predefined",type:"multipart",colorRamps:[{fromColor:[245,0,0],toColor:[245,
245,0]},{fromColor:[245,245,0],toColor:[0,245,0]}]},{id:"redToGreenDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[186,20,20],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[54,145,33]}]},{id:"redToGreenDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[97,21,13],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[16,69,16]}]},{id:"slope_predefined",type:"multipart",colorRamps:[{fromColor:[56,168,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,
0,0]}]},{id:"spectrumFullBright_predefined",type:"multipart",colorRamps:[{fromColor:[255,0,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,0,255]}]},{id:"spectrumFullDark_predefined",type:"multipart",colorRamps:[{fromColor:[153,0,0],toColor:[153,153,0]},{fromColor:[153,153,0],toColor:[0,153,153]},{fromColor:[0,153,153],toColor:[0,0,153]}]},{id:"spectrumFullLight_predefined",type:"multipart",colorRamps:[{fromColor:[255,153,153],toColor:[255,255,
153]},{fromColor:[255,255,153],toColor:[153,255,255]},{fromColor:[153,255,255],toColor:[153,153,255]}]},{id:"surface_predefined",type:"multipart",colorRamps:[{fromColor:[112,153,89],toColor:[242,238,162]},{fromColor:[242,238,162],toColor:[242,206,133]},{fromColor:[242,206,133],toColor:[194,140,124]},{fromColor:[194,140,124],toColor:[255,242,255]}]},{id:"temperature_predefined",type:"multipart",colorRamps:[{fromColor:[255,252,255],toColor:[255,0,255]},{fromColor:[255,0,255],toColor:[0,0,255]},{fromColor:[0,
0,255],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,255,0]},{fromColor:[0,255,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,128,0]},{fromColor:[255,128,0],toColor:[128,0,0]}]},{id:"whiteToBlack_predefined",fromColor:[255,255,255],toColor:[0,0,0]},{id:"yellowToDarkRed_predefined",type:"multipart",colorRamps:[{fromColor:[255,255,128],toColor:[242,167,46]},{fromColor:[242,167,46],toColor:[107,0,0]}]},{id:"yellowToGreenToDarkBlue_predefined",type:"multipart",colorRamps:[{fromColor:[255,
255,128],toColor:[56,224,9]},{fromColor:[56,224,9],toColor:[26,147,171]},{fromColor:[26,147,171],toColor:[12,16,120]}]},{id:"yellowToRed_predefined",fromColor:[245,245,0],toColor:[255,0,0]},{id:"yellowGreenBright_predefined",fromColor:[236,252,204],toColor:[157,204,16]},{id:"yellowGreenLightToDark_predefined",fromColor:[215,240,175],toColor:[96,107,45]}];v.PREDEFINED_COLOR_RAMP_NAME_MAP={aspect_predefined:"Aspect",blackToWhite_predefined:"Black to White",blueBright_predefined:"Blue Bright",blueLightToDark_predefined:"Blue Light to Dark",
blueGreenBright_predefined:"Blue-Green Bright",blueGreenLightToDark_predefined:"Blue-Green Light to Dark",brownLightToDark_predefined:"Brown Light to Dark",brownToBlueGreenDivergingBright_predefined:"Brown to Blue Green Diverging, Bright",brownToBlueGreenDivergingDark_predefined:"Brown to Blue Green Diverging, Dark",coefficientBias_predefined:"Coefficient Bias",coldToHotDiverging_predefined:"Cold to Hot Diverging",conditionNumber_predefined:"Condition Number",cyanToPurple_predefined:"Cyan to Purple",
cyanLightToBlueDark_predefined:"Cyan-Light to Blue-Dark",distance_predefined:"Distance",elevation1_predefined:"Elevation #1",elevation2_predefined:"Elevation #2",errors_predefined:"Errors",grayLightToDark_predefined:"Gray Light to Dark",greenBright_predefined:"Green Bright",greenLightToDark_predefined:"Green Light to Dark",greenToBlue_predefined:"Green to Blue",orangeBright_predefined:"Orange Bright",orangeLightToDark_predefined:"Orange Light to Dark",partialSpectrum_predefined:"Partial Spectrum",
partialSpectrum1Diverging_predefined:"Partial Spectrum 1 Diverging",partialSpectrum2Diverging_predefined:"Partial Spectrum 2 Diverging",pinkToYellowGreenDivergingBright_predefined:"Pink to YellowGreen Diverging, Bright",pinkToYellowGreenDivergingDark_predefined:"Pink to YellowGreen Diverging, Dark",precipitation_predefined:"Precipitation",prediction_predefined:"Prediction",purpleBright_predefined:"Purple Bright",purpleToGreenDivergingBright_predefined:"Purple to Green Diverging, Bright",purpleToGreenDivergingDark_predefined:"Purple to Green Diverging, Dark",
purpleBlueBright_predefined:"Purple-Blue Bright",purpleBlueLightToDark_predefined:"Purple-Blue Light to Dark",purpleRedBright_predefined:"Purple-Red Bright",purpleRedLightToDark_predefined:"Purple-Red Light to Dark",redBright_predefined:"Red Bright",redLightToDark_predefined:"Red Light to Dark",redToBlueDivergingBright_predefined:"Red to Blue Diverging, Bright",redToBlueDivergingDark_predefined:"Red to Blue Diverging, Dark",redToGreen_predefined:"Red to Green",redToGreenDivergingBright_predefined:"Red to Green Diverging, Bright",
redToGreenDivergingDark_predefined:"Red to Green Diverging, Dark",slope_predefined:"Slope",spectrumFullBright_predefined:"Spectrum-Full Bright",spectrumFullDark_predefined:"Spectrum-Full Dark",spectrumFullLight_predefined:"Spectrum-Full Light",surface_predefined:"Surface",temperature_predefined:"Temperature",whiteToBlack_predefined:"White to Black",yellowToDarkRed_predefined:"Yellow to Dark Red",yellowToGreenToDarkBlue_predefined:"Yellow to Green to Dark Blue",yellowToRed_predefined:"Yellow to Red",
yellowGreenBright_predefined:"Yellow-Green Bright",yellowGreenLightToDark_predefined:"Yellow-Green Light to Dark"};v.getColorRampId=p;v.getColorRampName=function(a){return(a=p(a))?v.PREDEFINED_COLOR_RAMP_NAME_MAP[a]:null};v.convertColorRampToColormap=function(a,b){if(a&&b){for(var d="multipart"===a.type?a.colorRamps.length:1,f=[],c=[],k,n,e,l,u,m=0,q=0;q<d;q++)f[q]={start:null,end:null},f[q].start=m,f[q].end=m+1/d,m=f[q].end;d=function(d){l=d/b;f.forEach(function(f,m){l>=f.start&&l<f.end&&(u=(l-f.start)/
(f.end-f.start),"multipart"===a.type?(k=new t(a.colorRamps[m].fromColor),n=new t(a.colorRamps[m].toColor)):(k=new t(a.fromColor),n=new t(a.toColor)),e=r(k,n,u),0===d?c.push([d,k.r,k.g,k.b]):d===b-1?c.push([d,n.r,n.g,n.b]):(e=r(k,n,u),c.push([d,e.r,e.g,e.b])))})};for(q=0;q<b;q++)d(q);return c}}})},"esri/core/colorUtils":function(){define(["require","exports"],function(D,v){function t(a,c){var f=[],b,e;if(a[0].length!==c.length)throw"dimensions do not match";var d=a.length,h=a[0].length,m=0;for(b=0;b<
d;b++){for(e=m=0;e<h;e++)m+=a[b][e]*c[e];f.push(m)}return f}function g(a){a=[a.r/255,a.g/255,a.b/255].map(function(a){return.04045>=a?a/12.92:Math.pow((a+.055)/1.055,2.4)});a=t(d,a);return{x:100*a[0],y:100*a[1],z:100*a[2]}}function b(a){a=t(h,[a.x/100,a.y/100,a.z/100]).map(function(a){return Math.min(1,Math.max(.0031308>=a?12.92*a:1.055*Math.pow(a,1/2.4)-.055,0))});return{r:Math.round(255*a[0]),g:Math.round(255*a[1]),b:Math.round(255*a[2])}}function r(a){a=[a.x/95.047,a.y/100,a.z/108.883].map(function(a){return a>
Math.pow(6/29,3)?Math.pow(a,1/3):1/3*Math.pow(29/6,2)*a+4/29});return{l:116*a[1]-16,a:500*(a[0]-a[1]),b:200*(a[1]-a[2])}}function p(a){var c=a.l;a=[(c+16)/116+a.a/500,(c+16)/116,(c+16)/116-a.b/200].map(function(a){return a>6/29?Math.pow(a,3):3*Math.pow(6/29,2)*(a-4/29)});return{x:95.047*a[0],y:100*a[1],z:108.883*a[2]}}function a(a){if("r"in a&&"g"in a&&"b"in a)return a;if("l"in a&&"c"in a&&"h"in a){var c=a.c,f=a.h;return b(p({l:a.l,a:c*Math.cos(f),b:c*Math.sin(f)}))}if("l"in a&&"a"in a&&"b"in a)return b(p(a));
if("x"in a&&"y"in a&&"z"in a)return b(a);if("h"in a&&"s"in a&&"v"in a){f=(a.h+360)%360/60;c=a.v/100*255;a=a.s/100*c;var d=a*(1-Math.abs(f%2-1));switch(Math.floor(f)){case 0:f={r:a,g:d,b:0};break;case 1:f={r:d,g:a,b:0};break;case 2:f={r:0,g:a,b:d};break;case 3:f={r:0,g:d,b:a};break;case 4:f={r:d,g:0,b:a};break;case 5:case 6:f={r:a,g:0,b:d};break;default:f={r:0,g:0,b:0}}f.r=Math.round(f.r+c-a);f.g=Math.round(f.g+c-a);f.b=Math.round(f.b+c-a);return f}}Object.defineProperty(v,"__esModule",{value:!0});
var d=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],h=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];v.toRGB=a;v.toHSV=function(b){if("h"in b&&"s"in b&&"v"in b)return b;var c=a(b);b=c.r;var f=c.g,c=c.b,d=Math.max(b,f,c),e=d-Math.min(b,f,c),h;0===e?h=0:d===b?h=(f-c)/e%6:d===f?h=(c-b)/e+2:d===c&&(h=(b-f)/e+4);0>h&&(h+=6);return{h:60*h,s:100*(0===e?0:e/d),v:100/255*d}};v.toLAB=function(b){return"l"in b&&"a"in b&&"b"in b?b:r(g(a(b)))};v.toLCH=function(b){if(!("l"in
b&&"c"in b&&"h"in b)){var c=r(g(a(b)));b=c.l;var f=c.a,d=c.b,c=Math.sqrt(f*f+d*d),f=Math.atan2(d,f),f=0<f?f:f+2*Math.PI;b={l:b,c:c,h:f}}return b};v.toXYZ=function(b){return"x"in b&&"y"in b&&"z"in b?b:g(a(b))};v.darken=function(a,c){a=r(g(a));a.l*=1-c;return b(p(a))}})},"esri/renderers/RasterStretchRenderer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/paramHelper ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators ./support/stretchRendererUtils ../tasks/support/colorRamps".split(" "),
function(D,v,t,g,b,r,p,a,d,h){return function(b){function c(a){a=b.call(this,a)||this;a.colorRamp=null;a.computeGamma=!1;a.dynamicRangeAdjustment=!1;a.gamma=[];a.maxPercent=null;a.minPercent=null;a.numberOfStandardDeviations=null;a.outputMax=null;a.outputMin=null;a.sigmoidStrengthLevel=null;a.statistics=[];a.histograms=null;a.useGamma=!1;a.stretchType="none";a.type="raster-stretch";return a}t(c,b);f=c;c.prototype.readColorRamp=function(a){if(a)return h.fromJSON(a)};c.prototype.writeStatistics=function(a,
c,b){null==a||0===a.length?a=null:a[0]instanceof Array||(a=a.map(function(a){return[a.min,a.max,a.avg,a.stddev]}));c[b]=a};c.prototype.readStretchType=function(a,c){a=c.stretchType;"number"===typeof a&&(a=d.stretchTypeFunctionEnum[a]);return d.stretchTypeJSONDict.read(a)};c.prototype.clone=function(){return new f({stretchType:this.stretchType,outputMin:this.outputMin,outputMax:this.outputMax,useGamma:this.useGamma,computeGamma:this.computeGamma,statistics:p.clone(this.statistics),gamma:p.clone(this.gamma),
sigmoidStrengthLevel:this.sigmoidStrengthLevel,numberOfStandardDeviations:this.numberOfStandardDeviations,minPercent:this.minPercent,maxPercent:this.maxPercent,colorRamp:p.clone(this.colorRamp),histograms:p.clone(this.histograms),dynamicRangeAdjustment:this.dynamicRangeAdjustment})};var f;g([a.property({types:h.types,json:{write:!0}})],c.prototype,"colorRamp",void 0);g([a.reader("colorRamp")],c.prototype,"readColorRamp",null);g([a.property({type:Boolean,json:{write:!0}})],c.prototype,"computeGamma",
void 0);g([a.property({type:Boolean,json:{write:{target:"dra"},read:{source:"dra"}}})],c.prototype,"dynamicRangeAdjustment",void 0);g([a.property({type:[Number],json:{write:{allowNull:!0}}})],c.prototype,"gamma",void 0);g([a.property({type:Number,json:{write:{allowNull:!0}}})],c.prototype,"maxPercent",void 0);g([a.property({type:Number,json:{write:{allowNull:!0}}})],c.prototype,"minPercent",void 0);g([a.property({type:Number,json:{write:{allowNull:!0}}})],c.prototype,"numberOfStandardDeviations",
void 0);g([a.property({type:Number,json:{read:{source:"max"},write:{target:"max",allowNull:!0}}})],c.prototype,"outputMax",void 0);g([a.property({type:Number,json:{read:{source:"min"},write:{target:"min",allowNull:!0}}})],c.prototype,"outputMin",void 0);g([a.property({type:Number,json:{write:{allowNull:!0}}})],c.prototype,"sigmoidStrengthLevel",void 0);g([a.property({json:{write:{allowNull:!0}}})],c.prototype,"statistics",void 0);g([a.property()],c.prototype,"histograms",void 0);g([a.writer("statistics")],
c.prototype,"writeStatistics",null);g([a.property({type:Boolean,json:{write:!0}})],c.prototype,"useGamma",void 0);g([a.property({type:d.stretchTypeJSONDict.apiValues,json:{type:d.stretchTypeJSONDict.jsonValues,write:d.stretchTypeJSONDict.write}})],c.prototype,"stretchType",void 0);g([a.reader("stretchType",["stretchType"])],c.prototype,"readStretchType",null);g([a.enumeration.serializable()({rasterStretch:"raster-stretch"})],c.prototype,"type",void 0);return c=f=g([a.subclass("esri.renderers.RasterStretchRenderer")],
c)}(a.declared(r.JSONSupport))})},"esri/renderers/support/stretchRendererUtils":function(){define(["require","exports","../../core/jsonMap"],function(D,v,t){Object.defineProperty(v,"__esModule",{value:!0});v.stretchTypeJSONDict=new t.default({none:"none",standardDeviation:"standard-deviation",histogramEqualization:"histogram-equalization",minMax:"min-max",percentClip:"percent-clip",sigmoid:"sigmoid"});v.stretchTypeFunctionEnum={0:"none",3:"standardDeviation",4:"histogramEqualization",5:"minMax",6:"percentClip",
9:"sigmoid"}})},"esri/layers/support/DimensionalDefinition":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType".split(" "),function(D,v,t,g,b,r,p,a){return function(b){function d(a){a=b.call(this,a)||this;a.variableName=null;a.dimensionName=null;a.values=[];a.isSlice=!1;return a}t(d,b);f=d;d.prototype.clone=function(){return new f({variableName:this.variableName,
dimensionName:this.dimensionName,values:r.clone(this.values),isSlice:this.isSlice})};var f;g([p.property({type:String,json:{write:!0}})],d.prototype,"variableName",void 0);g([p.property({type:String,json:{write:!0}})],d.prototype,"dimensionName",void 0);g([p.property({type:a.types.array(a.types.oneOf([a.types.native(Number),a.types.array(a.types.native(Number))])),json:{write:!0}})],d.prototype,"values",void 0);g([p.property({type:Boolean,json:{write:!0}})],d.prototype,"isSlice",void 0);return d=
f=g([p.subclass("esri.layers.support.DimensionalDefinition")],d)}(p.declared(b.JSONSupport))})},"esri/layers/support/ExportImageServiceParameters":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/jsonMap ../../core/JSONSupport ../../core/accessorSupport/decorators ./imageryRendererUtils ./MosaicRule".split(" "),function(D,v,t,g,b,r,p,a,d,h){Object.defineProperty(v,"__esModule",{value:!0});
var f=new r.default({RSP_NearestNeighbor:"nearest",RSP_BilinearInterpolation:"bilinear",RSP_CubicConvolution:"cubic",RSP_Majority:"majority"}),c=new r.default({esriNoDataMatchAny:"any",esriNoDataMatchAll:"all"});D=function(k){function n(){var a=null!==k&&k.apply(this,arguments)||this;a.layer=null;a.adjustAspectRatio=void 0;a.bandIds=void 0;a.compression=void 0;a.compressionQuality=void 0;a.compressionTolerance=.01;a.format=null;a.interpolation=null;a.noData=null;a.noDataInterpretation=void 0;a.pixelType=
void 0;a.lercVersion=2;return a}g(n,k);n.prototype.writeAdjustAspectRatio=function(a,c,b){10.3>this.layer.version||(c[b]=a)};n.prototype.writeCompressionQuality=function(a,c,b){this.format&&-1<this.format.toLowerCase().indexOf("jpg")&&null!=a&&(c[b]=a)};n.prototype.writeCompressionTolerance=function(a,c,b){"lerc"===this.format&&null!=a&&(c[b]=a)};n.prototype.writeLercVersion=function(a,c,b){"lerc"===this.format&&10.5<=this.layer.version&&(c[b]=a)};Object.defineProperty(n.prototype,"version",{get:function(){var a=
this.layer;a.bandIds;a.format;a.compressionQuality;a.compressionTolerance;a.interpolation;a.noData;a.noDataInterpretation;a.mosaicRule;a.renderingRule;a.adjustAspectRatio;a.pixelFilter;a.renderer;a.definitionExpression;return(this._get("version")||0)+1},set:function(a){this._set("version",a)},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"mosaicRule",{get:function(){var a=this.layer,c=a.mosaicRule,a=a.definitionExpression;c?a&&a!==c.where&&(c=c.clone(),c.where=a):a&&(c=new h({where:a}));
return c},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"renderingRule",{get:function(){var a=this.layer,c=a.renderingRule,b=a.pixelFilter;(!a.format||-1<a.format.indexOf("jpg")||-1<a.format.indexOf("png"))&&!b&&(c=this.combineRendererWithRenderingRule());return c},enumerable:!0,configurable:!0});n.prototype.combineRendererWithRenderingRule=function(){var a=this.layer,c=a.rasterInfo,b=a.renderingRule,f=a.renderer;return f&&d.isSupportedRendererType(f)?d.combineRenderingRules(d.convertRendererToRenderingRule(f,
{rasterAttributeTable:c.attributeTable,pixelType:c.pixelType,convertColorRampToColormap:10.6>a.version}),b):b};b([a.property()],n.prototype,"layer",void 0);b([a.property({json:{write:!0}})],n.prototype,"adjustAspectRatio",void 0);b([a.writer("adjustAspectRatio")],n.prototype,"writeAdjustAspectRatio",null);b([a.property({json:{write:!0}}),a.aliasOf("layer.bandIds")],n.prototype,"bandIds",void 0);b([a.property({json:{write:!0}})],n.prototype,"compression",void 0);b([a.property({json:{write:!0}}),a.aliasOf("layer.compressionQuality")],
n.prototype,"compressionQuality",void 0);b([a.writer("compressionQuality")],n.prototype,"writeCompressionQuality",null);b([a.property({json:{write:!0}}),a.aliasOf("layer.compressionTolerance")],n.prototype,"compressionTolerance",void 0);b([a.writer("compressionTolerance")],n.prototype,"writeCompressionTolerance",null);b([a.property({json:{write:!0}}),a.aliasOf("layer.format")],n.prototype,"format",void 0);b([a.property({type:String,json:{read:{reader:f.read},write:{writer:f.write}}}),a.aliasOf("layer.interpolation")],
n.prototype,"interpolation",void 0);b([a.property({json:{write:!0}}),a.aliasOf("layer.noData")],n.prototype,"noData",void 0);b([a.property({type:String,json:{read:{reader:c.read},write:{writer:c.write}}}),a.aliasOf("layer.noDataInterpretation")],n.prototype,"noDataInterpretation",void 0);b([a.property({json:{write:!0}})],n.prototype,"pixelType",void 0);b([a.property({json:{write:!0}})],n.prototype,"lercVersion",void 0);b([a.writer("lercVersion")],n.prototype,"writeLercVersion",null);b([a.property({type:Number,
dependsOn:"layer.adjustAspectRatio layer.bandIds layer.format layer.compressionQuality layer.compressionTolerance layer.definitionExpression layer.interpolation layer.noData layer.noDataInterpretation layer.mosaicRule layer.renderingRule layer.pixelFilter layer.renderer lercVersion pixelType".split(" ")})],n.prototype,"version",null);b([a.property({dependsOn:["layer.mosaicRule","layer.definitionExpression"],json:{write:!0}})],n.prototype,"mosaicRule",null);b([a.property({dependsOn:["layer.renderingRule",
"layer.renderer","layer.rasterInfo","layer.format"],json:{write:!0}})],n.prototype,"renderingRule",null);return n=b([a.subclass("esri.layers.mixins.ExportImageServiceParameters")],n)}(a.declared(p.JSONSupport));v.ExportImageServiceParameters=D})},"esri/layers/support/imageryRendererUtils":function(){define("require exports ../../rasterRenderers ../../core/arrayUtils ../../core/lang ./RasterFunction ../../renderers/support/colorRampUtils ../../renderers/support/stretchRendererUtils".split(" "),function(D,
v,t,g,b,r,p,a){function d(a){var c=a.Raster;return c&&"esri.layers.support.RasterFunction"===c.declaredClass?d(c.functionArguments):a}function h(a,b){var d=[],e=[],m=[],h=[],k=b.pixelType,l=(b=b.rasterAttributeTable)&&b.features,u=c(b);if(l&&Array.isArray(l)&&a.classBreakInfos)return a.classBreakInfos.forEach(function(c,b){var f=c.symbol.color,d;f.a&&l.forEach(function(e){d=e.attributes[a.field];(d>=c.minValue&&d<c.maxValue||b===a.classBreakInfos.length-1&&d>=c.minValue)&&h.push([e.attributes[u],
f.r,f.g,f.b])})}),k=k?f(h,k):h,b=new r,b.functionName="Colormap",b.functionArguments={},b.functionArguments.Colormap=k,b.variableName="Raster",b;a.classBreakInfos.forEach(function(a,c){var b=a.symbol&&a.symbol.color;b.a?(0===c?d.push(a.minValue,a.maxValue+1E-6):d.push(a.minValue+1E-6,a.maxValue+1E-6),e.push(c),h.push([c,b.r,b.g,b.b])):m.push(a.minValue,a.maxValue)});k=k?f(h,k):h;b=new r;b.functionName="Remap";b.functionArguments={InputRanges:d,OutputValues:e,NoDataRanges:m};b.variableName="Raster";
var g=new r;g.functionName="Colormap";g.functionArguments={Colormap:k,Raster:b};return g}function f(a,c){(c=n[String(c).toLowerCase()])&&a.push([Math.floor(c[0]-1),0,0,0],[Math.ceil(c[1]+1),0,0,0]);return a}function c(a){if(a)return(a=(a=a.fields)&&g.find(a,function(a){return a&&a.name&&"value"===a.name.toLowerCase()}))&&a.name}function k(a,b){var d=[],e=b.pixelType,m=(b=b.rasterAttributeTable)&&b.features,h=c(b),k=!1;a.uniqueValueInfos&&a.uniqueValueInfos.forEach(function(c){var b=c.symbol.color;
b.a&&(a.field!==h&&m?m&&m.forEach(function(f){String(f.attributes[a.field])===String(c.value)&&d.push([f.attributes[h],b.r,b.g,b.b])}):isNaN(c.value)?k=!0:d.push([c.value,b.r,b.g,b.b]))});if(k)return null;e=e&&0<d.length?f(d,e):d;b=new r;b.functionName="Colormap";b.functionArguments={};b.functionArguments.Colormap=e;b.variableName="Raster";return b}Object.defineProperty(v,"__esModule",{value:!0});var n={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767]},e={type:"multipart",
colorRamps:[{fromColor:[0,0,255],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]}]};v.isSupportedRendererType=function(a){a=a.type;return"raster-stretch"===a||"unique-value"===a||"class-breaks"===a};v.combineRenderingRules=function(a,c){if(!a||!c)return b.clone(a||c);a=b.clone(a);"none"!==c.functionName.toLowerCase()&&(d(a.functionArguments).Raster=c);return a};v.convertRendererToRenderingRule=function(c,b){b=b||{};switch(c.type){case "raster-stretch":var d=
new r;d.functionName="Stretch";var e=l[a.stretchTypeJSONDict.toJSON(c.stretchType)],m={StretchType:e,Statistics:c.statistics,DRA:c.dynamicRangeAdjustment,UseGamma:c.useGamma,Gamma:c.gamma,ComputeGamma:c.computeGamma};null!=c.outputMin&&(m.Min=c.outputMin);null!=c.outputMax&&(m.Max=c.outputMax);e===l.standardDeviation?(m.NumberOfStandardDeviations=c.numberOfStandardDeviations,d.outputPixelType="u8"):e===l.percentClip?(m.MinPercent=c.minPercent,m.MaxPercent=c.maxPercent,d.outputPixelType="u8"):e===
l.minMax?d.outputPixelType="u8":e===l.sigmoid&&(m.SigmoidStrengthLevel=c.sigmoidStrengthLevel);d.functionArguments=m;d.variableName="Raster";if(c.colorRamp){var e=c.colorRamp,m=new r,g=p.getColorRampName(e);m.functionArguments=g?{colorRamp:g}:!b.convertColorRampToColormap||"algorithmic"!==e.type&&"multipart"!==e.type?{colorRamp:c.colorRamp.toJSON()}:{Colormap:p.convertColorRampToColormap(e,256)};m.variableName="Raster";m.functionName="Colormap";m.functionArguments.Raster=d;c=m}else c=d;return c;case "class-breaks":return h(c,
b);case "unique-value":return k(c,b);case "raster-colormap":return(c=c.extractColormap())&&0!==c.length?(c=(b=b.pixelType)?f(c,b):c,b=new r,b.functionName="Colormap",b.functionArguments={},b.functionArguments.Colormap=c,c=b):c=void 0,c}};v.createDefaultRenderer=function(a,c){if(a){var b=a.attributeTable,f=a.dataType,d=a.bandCount,m=a.pixelType,h=a.colormap,k=a.statistics,l=a.histograms;c&&0<c.length&&(k=k?c.map(function(a){return k[a]}):null,l=l?c.map(function(a){return l[a]}):null);var g;if(1===
d&&h&&0<h.length)g=t.RasterColormapRenderer.createFromColormap(h);else if(1===d&&b){var n=b.fields.filter(function(a){return"red"===a.name.toLowerCase()})[0],u=b.fields.filter(function(a){return"green"===a.name.toLowerCase()})[0],p=b.fields.filter(function(a){return"blue"===a.name.toLowerCase()})[0];a=b.fields.filter(function(a){return"value"===a.name})[0];var r=b.fields.filter(function(a){return"classname"===a.name.toLowerCase()})[0];r||(r=b.fields.filter(function(a){return"string"===a.type})[0])||
(r=a);n&&u&&p&&r&&(g=t.UniqueValueRenderer.fromJSON({field1:r.name,uniqueValueInfos:b.features.map(function(a){return{value:a.attributes[r.name],label:a.attributes[r.name],symbol:{color:[a.attributes[n.name],a.attributes[u.name],a.attributes[p.name],255],type:"esriSFS",style:"esriSFSSolid"}}})}))}g||(b=void 0,g=!1,d=c=a=void 0,"u8"===m&&"processed"===f?(b="min-max",k=k||[{min:0,max:255},{min:0,max:255},{min:0,max:255}]):"u8"===m||"elevation"===f?(b="min-max",g=k?!1:!0):"scientific"===f?(b="min-max",
g=k?!1:!0,a=e):l&&0<l.length?(b="percent-clip",d=c=.25):k?b="min-max":(b="percent-clip",g=!0),g=t.RasterStretchRenderer.fromJSON({stretchType:b,dra:g,colorRamp:a,min:0,max:255,statistics:g?null:k,histograms:g?null:l,maxPercent:c,minPercent:d}));return g}};v.getDefaultBandCombination=function(a){var c=a.bandCount;if(1===c)return null;if(2===c)return[0];a=a.keyProperties&&a.keyProperties.BandProperties;var b,f,d,e,h;if(a&&a.length===c){for(var k=0;k<a.length;k++)a[k].BandName&&"red"===a[k].BandName.toLowerCase()&&
(f=k),a[k].BandName&&"green"===a[k].BandName.toLowerCase()&&(d=k),a[k].BandName&&"blue"===a[k].BandName.toLowerCase()&&(e=k),a[k].BandName&&"nearinfrared"===a[k].BandName.toLowerCase()&&(h=k);void 0!==f&&void 0!==d&&void 0!==e?b=[f,d,e]:void 0!==f&&void 0!==d&&void 0!==h&&(b=[h,f,d])}!b&&3<c&&(b=[0,1,2]);return b};var l={none:0,standardDeviation:3,histogramEqualization:4,minMax:5,percentClip:6,sigmoid:9}})},"esri/layers/support/RasterFunction":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/lang ../../core/SetUtils ../../core/accessorSupport/decorators".split(" "),
function(D,v,t,g,b,r,p,a){var d=p.createSetFromValues(["Raster","Raster2","DEM","FillRaster"]),h=p.createSetFromValues(["Rasters"]),f=function(a){return a&&a.rasterFunction?n.fromJSON(a):a},c=function(a){return a&&a instanceof n?a.toJSON():a},k;(function(a){a[a.MOSAIC=0]="MOSAIC";a[a.GROUP=1]="GROUP";a[a.ITEM=2]="ITEM"})(k||(k={}));var n=function(b){function e(a){a=b.call(this,a)||this;a.functionArguments=null;a.functionName=null;a.outputPixelType="unknown";a.variableName=null;a.description=null;
a.functionDefinition=null;a.thumbnail=null;return a}t(e,b);n=e;e.prototype.readFunctionArguments=function(a,c){a=c.arguments||c.rasterFunctionArguments;if(null==a)a=null;else{c={};for(var b=0,e=Object.keys(a);b<e.length;b++){var m=e[b];d.has(m)?c[m]=f(a[m]):h.has(m)&&Array.isArray(a[m])?c[m]=a[m].map(f):c[m]=a[m]}a=c}return a};e.prototype.writeFunctionArguments=function(a,b,f){for(var e={},m=0,k=Object.keys(a);m<k.length;m++){var l=k[m];d.has(l)?e[l]=c(a[l]):h.has(l)&&Array.isArray(a[l])?e[l]=a[l].map(c):
e[l]=c(a[l])}this.functionDefinition?b.arguments=e:b[f]=e};e.prototype.readFunctionName=function(a,c){a=c.rasterFunctionInfos;var b=c.name;return b?b:a&&a.length&&"None"!==a[0].name?a[0].name:c.rasterFunction};e.prototype.writeFunctionName=function(a,c,b){this.functionDefinition?c.name=a:c[b]=a};e.prototype.readFunctionType=function(a){return k[a]};e.prototype.writeFunctionType=function(a,c,b){c[b]=k[a]};e.prototype.clone=function(){return new n({functionName:this.functionName,functionArguments:r.clone(this.functionArguments),
outputPixelType:this.outputPixelType,variableName:this.variableName,name:this.functionName,description:this.description,functionType:this.functionType,functionDefinition:this.functionDefinition,thumbnail:this.thumbnail})};var n;g([a.property({json:{type:Object,write:{target:"rasterFunctionArguments"}}})],e.prototype,"functionArguments",void 0);g([a.reader("functionArguments",["rasterFunctionArguments","arguments"])],e.prototype,"readFunctionArguments",null);g([a.writer("functionArguments")],e.prototype,
"writeFunctionArguments",null);g([a.property({json:{type:String,write:{target:"rasterFunction"}}})],e.prototype,"functionName",void 0);g([a.reader("functionName",["rasterFunction","rasterFunctionInfos","name"])],e.prototype,"readFunctionName",null);g([a.writer("functionName")],e.prototype,"writeFunctionName",null);g([a.enumeration.serializable()({C128:"c128",C64:"c64",F32:"f32",F64:"f64",S16:"s16",S32:"s32",S8:"s8",U1:"u1",U16:"u16",U2:"u2",U32:"u32",U4:"u4",U8:"u8",UNKNOWN:"unknown"},{ignoreUnknown:!1}),
a.property({json:{default:"unknown"}})],e.prototype,"outputPixelType",void 0);g([a.property({type:String,json:{read:!0,write:!0}})],e.prototype,"variableName",void 0);g([a.property({type:String,json:{read:!0,write:!0,origins:{"web-document":{read:!1,write:!1}}}})],e.prototype,"description",void 0);g([a.property({json:{origins:{"web-document":{read:!1,write:!1}}}})],e.prototype,"functionType",void 0);g([a.reader("functionType")],e.prototype,"readFunctionType",null);g([a.writer("functionType")],e.prototype,
"writeFunctionType",null);g([a.property({type:Object,json:{read:{source:"function"},write:{target:"function"},origins:{"web-document":{read:!1,write:!1}}}})],e.prototype,"functionDefinition",void 0);g([a.property({type:String,json:{read:!0,write:!0,origins:{"web-document":{read:!1,write:!1}}}})],e.prototype,"thumbnail",void 0);return e=n=g([a.subclass("esri.layers.support.RasterFunction")],e)}(a.declared(b.JSONSupport));return n})},"esri/layers/support/MosaicRule":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/jsonMap ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ../../geometry/Point ./DimensionalDefinition ./RasterFunction".split(" "),
function(D,v,t,g,b,r,p,a,d,h,f){var c=b.strict()({MT_FIRST:"first",MT_LAST:"last",MT_MIN:"min",MT_MAX:"max",MT_MEAN:"mean",MT_BLEND:"blend",MT_SUM:"sum"}),k=b.strict()({esriMosaicNone:"none",esriMosaicCenter:"center",esriMosaicNadir:"nadir",esriMosaicViewpoint:"viewpoint",esriMosaicAttribute:"attribute",esriMosaicLockRaster:"lock-raster",esriMosaicNorthwest:"northwest",esriMosaicSeamline:"seamline"});return function(b){function e(a){a=b.call(this,a)||this;a.ascending=!0;a.itemRenderingRule=null;a.lockRasterIds=
null;a.method=null;a.multidimensionalDefinition=null;a.objectIds=null;a.operation=null;a.sortField=null;a.sortValue=null;a.viewpoint=null;a.where=null;return a}t(e,b);l=e;e.prototype.readAscending=function(a,c){return null!=c.ascending?c.ascending:null!=c.sortAscending?c.sortAscending:!0};e.prototype.readMethod=function(a,c){a=c.mosaicMethod||c.defaultMosaicMethod;switch(a?a.toLowerCase().replace("esrimosaic",""):""){case "byattribute":case "attribute":a="esriMosaicAttribute";break;case "lockraster":a=
"esriMosaicLockRaster";break;case "center":a="esriMosaicCenter";break;case "northwest":a="esriMosaicNorthwest";break;case "nadir":a="esriMosaicNadir";break;case "viewpoint":a="esriMosaicViewpoint";break;case "seamline":a="esriMosaicSeamline";break;case "none":a="esriMosaicNone";break;default:a="esriMosaicNone"}return k.fromJSON(a)};e.prototype.readOperation=function(a,b){a=b.mosaicOperation;b=b.mosaicOperator&&b.mosaicOperator.toLowerCase();b=a||(b?c.toJSON(b):null);return c.fromJSON(b)||"first"};
e.prototype.castSortValue=function(a){return null==a||"string"===typeof a||"number"===typeof a?a:""+a};e.prototype.clone=function(){return new l({ascending:this.ascending,itemRenderingRule:p.clone(this.itemRenderingRule),lockRasterIds:p.clone(this.lockRasterIds),method:this.method,multidimensionalDefinition:p.clone(this.multidimensionalDefinition),objectIds:p.clone(this.objectIds),operation:this.operation,sortField:this.sortField,sortValue:this.sortValue,viewpoint:p.clone(this.viewpoint),where:this.where})};
var l;g([a.property({type:Boolean,json:{write:!0}})],e.prototype,"ascending",void 0);g([a.reader("ascending",["ascending","sortAscending"])],e.prototype,"readAscending",null);g([a.property({type:f,json:{write:!0}})],e.prototype,"itemRenderingRule",void 0);g([a.property({type:[Number],json:{write:{overridePolicy:function(){return{enabled:"lock-raster"===this.method}}}}})],e.prototype,"lockRasterIds",void 0);g([a.property({type:String,json:{type:k.jsonValues,write:{target:"mosaicMethod",writer:k.write}}})],
e.prototype,"method",void 0);g([a.reader("method",["mosaicMethod","defaultMosaicMethod"])],e.prototype,"readMethod",null);g([a.property({type:[h],json:{write:!0}})],e.prototype,"multidimensionalDefinition",void 0);g([a.property({type:[Number],json:{read:{source:"fids"},write:{target:"fids"}}})],e.prototype,"objectIds",void 0);g([a.property({json:{type:c.jsonValues,read:{reader:c.read},write:{target:"mosaicOperation",writer:c.write}}})],e.prototype,"operation",void 0);g([a.reader("operation",["mosaicOperation",
"mosaicOperator"])],e.prototype,"readOperation",null);g([a.property({type:String,json:{write:{overridePolicy:function(){return{enabled:"attribute"===this.method}}}}})],e.prototype,"sortField",void 0);g([a.property({type:[String,Number],json:{write:{allowNull:!0,overridePolicy:function(){return{enabled:"attribute"===this.method,allowNull:!0}}}}})],e.prototype,"sortValue",void 0);g([a.cast("sortValue")],e.prototype,"castSortValue",null);g([a.property({type:d,json:{write:!0}})],e.prototype,"viewpoint",
void 0);g([a.property({type:String,json:{write:!0}})],e.prototype,"where",void 0);return e=l=g([a.subclass("esri.layers.support.MosaicRule")],e)}(a.declared(r.JSONSupport))})},"esri/layers/support/PixelBlock":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/compilerUtils ../../core/Error ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators".split(" "),function(D,v,t,g,b,r,p,a,d,h){var f=
d.getLogger("esri.layers.support.PixelBlock");return function(c){function d(a){a=c.call(this,a)||this;a.width=null;a.height=null;a.pixelType="f32";a.validPixelCount=null;a.mask=null;a.maskIsAlpha=!1;a.pixels=null;a.statistics=null;return a}t(d,c);n=d;d.createEmptyBand=function(a,c){return new (n.getPixelArrayConstructor(a))(c)};d.getPixelArrayConstructor=function(a){var c;switch(a){case "u1":case "u2":case "u4":case "u8":c=Uint8Array;break;case "u16":c=Uint16Array;break;case "u32":c=Uint32Array;break;
case "s8":c=Int8Array;break;case "s16":c=Int16Array;break;case "s32":c=Int32Array;break;case "u32":c=Uint32Array;break;case "f32":c=Float32Array;break;case "f64":c=Float64Array;break;case "c64":case "c128":case "unknown":c=Float32Array;break;default:b.neverReached(a)}return c};d.prototype.castPixelType=function(a){if(!a)return"f32";a=a.toLowerCase();-1<["u1","u2","u4"].indexOf(a)?a="u8":-1==="unknown u8 s8 u16 s16 u32 s32 f32 f64".split(" ").indexOf(a)&&(a="f32");return a};d.prototype.getPlaneCount=
function(){return this.pixels&&this.pixels.length};d.prototype.addData=function(a){if(!a.pixels||a.pixels.length!==this.width*this.height)throw new r("pixelblock:invalid-or-missing-pixels","add data requires valid pixels array that has same length defined by pixel block width * height");this.pixels||(this.pixels=[]);this.statistics||(this.statistics=[]);this.pixels.push(a.pixels);this.statistics.push(a.statistics||{minValue:null,maxValue:null})};d.prototype.getAsRGBA=function(){var a=new ArrayBuffer(this.width*
this.height*4);switch(this.pixelType){case "s8":case "s16":case "u16":case "s32":case "u32":case "f32":case "f64":this._fillFromNon8Bit(a);break;default:this._fillFrom8Bit(a)}return new Uint8ClampedArray(a)};d.prototype.getAsRGBAFloat=function(){var a=new Float32Array(this.width*this.height*4);this._fillFrom32Bit(a);return a};d.prototype.updateStatistics=function(){var a=this;this.statistics=this.pixels.map(function(c){return a._calculateBandStatistics(c,a.mask)});var c=this.mask,b=0;if(c)for(var d=
0;d<c.length;d++)c[d]&&b++;else b=this.width*this.height;this.validPixelCount=b};d.prototype.clamp=function(a){if(a&&"f64"!==a&&"f32"!==a){var c;switch(a){case "u8":c=[0,255];break;case "u16":c=[0,65535];break;case "u32":c=[0,4294967295];break;case "s8":c=[-128,127];break;case "s16":c=[-32768,32767];break;case "s32":c=[-2147483648,2147483647];break;default:c=[-3.4*1E39,3.4*1E39]}var b=c[0];c=c[1];for(var d=this.pixels,f=this.width*this.height,e=d.length,h,k,g,p=[],x=0;x<e;x++){g=n.createEmptyBand(a,
f);h=d[x];for(var z=0;z<f;z++)k=h[z],g[z]=k>c?c:k<b?b:k;p.push(g)}this.pixels=p;this.pixelType=a}};d.prototype.clone=function(){var c=new n({width:this.width,height:this.height,pixelType:this.pixelType,maskIsAlpha:this.maskIsAlpha,validPixelCount:this.validPixelCount});this.mask&&(c.mask=this.mask instanceof Uint8Array?new Uint8Array(this.mask):this.mask.slice(0));var b,d=n.getPixelArrayConstructor(this.pixelType);if(this.pixels&&0<this.pixels.length){c.pixels=[];var f=this.pixels[0].slice;for(b=
0;b<this.pixels.length;b++)c.pixels[b]=f?this.pixels[b].slice(0,this.pixels[b].length):new d(this.pixels[b])}if(this.statistics)for(c.statistics=[],b=0;b<this.statistics.length;b++)c.statistics[b]=a.clone(this.statistics[b]);return c};d.prototype._fillFrom8Bit=function(a){var c=this.mask,b=this.maskIsAlpha,d=this.pixels;if(a&&d&&d.length){var e,h,k;e=h=k=d[0];3<=d.length?(h=d[1],k=d[2]):2===d.length&&(h=d[1]);a=new Uint32Array(a);d=this.width*this.height;if(e.length!==d)f.error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");
else if(c&&c.length===d)if(b)for(b=0;b<d;b++)c[b]&&(a[b]=c[b]<<24|k[b]<<16|h[b]<<8|e[b]);else for(b=0;b<d;b++)c[b]&&(a[b]=-16777216|k[b]<<16|h[b]<<8|e[b]);else for(b=0;b<d;b++)a[b]=-16777216|k[b]<<16|h[b]<<8|e[b]}else f.error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")};d.prototype._fillFromNon8Bit=function(a){var c=this.pixels,b=this.mask,d=this.statistics;if(a&&c&&c.length){var e=this.pixelType,h=1,k=0,h=1;d&&0<d.length?(k=d.map(function(a){return a.minValue}).reduce(function(a,
c){return Math.min(a,c)}),h=d.map(function(a){return a.maxValue-a.minValue}).reduce(function(a,c){return Math.max(a,c)}),h=255/h):(h=255,"s8"===e?(k=-128,h=127):"u16"===e?h=65535:"s16"===e?(k=-32768,h=32767):"u32"===e?h=4294967295:"s32"===e?(k=-2147483648,h=2147483647):"f32"===e?(k=-3.4*1E39,h=3.4*1E39):"f64"===e&&(k=-Number.MAX_VALUE,h=Number.MAX_VALUE),h=255/(h-k));a=new Uint32Array(a);var e=this.width*this.height,g,n,d=g=n=c[0];if(d.length!==e)return f.error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");
if(2<=c.length)if(g=c[1],3<=c.length&&(n=c[2]),b&&b.length===e)for(c=0;c<e;c++)b[c]&&(a[c]=-16777216|(n[c]-k)*h<<16|(g[c]-k)*h<<8|(d[c]-k)*h);else for(c=0;c<e;c++)a[c]=-16777216|(n[c]-k)*h<<16|(g[c]-k)*h<<8|(d[c]-k)*h;else if(b&&b.length===e)for(c=0;c<e;c++)g=(d[c]-k)*h,b[c]&&(a[c]=-16777216|g<<16|g<<8|g);else for(c=0;c<e;c++)g=(d[c]-k)*h,a[c]=-16777216|g<<16|g<<8|g}else f.error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")};d.prototype._fillFrom32Bit=function(a){var c=
this.pixels,b=this.mask;if(!a||!c||!c.length)return f.error("getAsRGBAFloat()","Unable to convert to RGBA. The input pixel block is empty.");var d,e,h;d=e=h=c[0];3<=c.length?(e=c[1],h=c[2]):2===c.length&&(e=c[1]);var k=this.width*this.height;if(d.length!==k)return f.error("getAsRGBAFloat()","Unable to convert to RGBA. The pixelblock is invalid.");var g=0;if(b&&b.length===k)for(c=0;c<k;c++)a[g++]=d[c],a[g++]=e[c],a[g++]=h[c],a[g++]=b[c]&1;else for(c=0;c<k;c++)a[g++]=d[c],a[g++]=e[c],a[g++]=h[c],a[g++]=
1};d.prototype._calculateBandStatistics=function(a,c){var b=Infinity,d=-Infinity,f=a.length,e,h=0;if(c)for(e=0;e<f;e++)c[e]&&(h=a[e],b=h<b?h:b,d=h>d?h:d);else for(e=0;e<f;e++)h=a[e],b=h<b?h:b,d=h>d?h:d;return{minValue:b,maxValue:d}};var n;g([h.property({json:{write:!0}})],d.prototype,"width",void 0);g([h.property({json:{write:!0}})],d.prototype,"height",void 0);g([h.property({json:{write:!0}})],d.prototype,"pixelType",void 0);g([h.cast("pixelType")],d.prototype,"castPixelType",null);g([h.property({json:{write:!0}})],
d.prototype,"validPixelCount",void 0);g([h.property({json:{write:!0}})],d.prototype,"mask",void 0);g([h.property({json:{write:!0}})],d.prototype,"maskIsAlpha",void 0);g([h.property({json:{write:!0}})],d.prototype,"pixels",void 0);g([h.property({json:{write:!0}})],d.prototype,"statistics",void 0);return d=n=g([h.subclass("esri.layers.support.PixelBlock")],d)}(h.declared(p.JSONSupport))})},"esri/layers/support/RasterInfo":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ../../geometry/Extent ../../tasks/support/FeatureSet".split(" "),
function(D,v,t,g,b,r,p,a,d){return function(h){function f(a){a=h.call(this,a)||this;a.attributeTable=null;a.bandCount=null;a.colormap=null;a.extent=null;a.format=void 0;a.height=null;a.width=null;a.histograms=null;a.keyProperties=null;a.multidimensionalInfo=null;a.noDataValue=null;a.pixelSize=null;a.pixelType=null;a.spatialReference=null;a.statistics=null;a.storageInfo=null;return a}g(f,h);Object.defineProperty(f.prototype,"dataType",{get:function(){var a=this.keyProperties&&this.keyProperties.DataType;
return a?a.toLowerCase():"generic"},enumerable:!0,configurable:!0});b([p.property({type:d,json:{write:!0}})],f.prototype,"attributeTable",void 0);b([p.property({json:{write:!0}})],f.prototype,"bandCount",void 0);b([p.property({json:{write:!0}})],f.prototype,"colormap",void 0);b([p.property({type:String,readOnly:!0})],f.prototype,"dataType",null);b([p.property({type:a,json:{write:!0}})],f.prototype,"extent",void 0);b([p.property({json:{write:!0}})],f.prototype,"format",void 0);b([p.property({json:{write:!0}})],
f.prototype,"height",void 0);b([p.property({json:{write:!0}})],f.prototype,"width",void 0);b([p.property({json:{write:!0}})],f.prototype,"histograms",void 0);b([p.property({json:{write:!0}})],f.prototype,"keyProperties",void 0);b([p.property({json:{write:!0}})],f.prototype,"multidimensionalInfo",void 0);b([p.property()],f.prototype,"noDataValue",void 0);b([p.property({json:{write:!0}})],f.prototype,"pixelSize",void 0);b([p.property({json:{write:!0}})],f.prototype,"pixelType",void 0);b([p.property({json:{write:!0}})],
f.prototype,"spatialReference",void 0);b([p.property({json:{write:!0}})],f.prototype,"statistics",void 0);b([p.property({json:{write:!0}})],f.prototype,"storageInfo",void 0);return f=b([p.subclass("esri.layers.support.RasterInfo")],f)}(p.declared(r.JSONSupport))})},"esri/layers/support/RasterJobHandler":function(){define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/tsSupport/assignHelper ../../core/Error ../../core/promiseUtils ../../core/workers ./PixelBlock".split(" "),
function(D,v,t,g,b,r,p,a,d){return function(){function h(){this._workerThread=null;this._destroyed=!1}h.prototype.initialize=function(){return g(this,void 0,void 0,function(){var b;return t(this,function(c){switch(c.label){case 0:return[4,a.open("RasterWorker")];case 1:return b=c.sent(),this._destroyed?b.close():this._workerThread=b,[2]}})})};h.prototype.destroy=function(){this._destroyed=!0;this._workerThread&&(this._workerThread.close(),this._workerThread=null)};h.prototype.decode=function(a,c){return g(this,
void 0,void 0,function(){var b;return t(this,function(f){switch(f.label){case 0:if(!this._workerThread)throw new r("raster-jobhandler:no-connection","no available worker connection");return[4,this._workerThread.invoke("decode",a,c)];case 1:return b=f.sent(),[2,b?new d(b):null]}})})};h.prototype.symbolize=function(a,c){return g(this,void 0,void 0,function(){var b;return t(this,function(f){switch(f.label){case 0:if(!this._workerThread)throw new r("raster-jobhandler:no-connection","no available worker connection");
return[4,this._workerThread.invoke("symbolize",a.toJSON(),c)];case 1:return b=f.sent(),[2,b?new d(b):null]}})})};h.prototype.updateSymbolizer=function(a,c){return g(this,void 0,void 0,function(){var b;return t(this,function(d){switch(d.label){case 0:if(!this._workerThread)throw new r("raster-jobhandler:no-connection","no available worker connection");b=a&&a.renderer&&"raster-stretch"===a.renderer.type&&a.renderer.histograms;return[4,p.all(this._workerThread.broadcast("updateSymbolizer",{symbolizerJSON:a.toJSON(),
histograms:b},c))];case 1:return d.sent(),[2]}})})};h.prototype.stretch=function(a,c){return g(this,void 0,void 0,function(){var b,f;return t(this,function(e){switch(e.label){case 0:if(!this._workerThread)throw new r("raster-jobhandler:no-connection","no available worker connection");if(!a||!a.pixelBlock)return[2,null];b={srcPixelBlock:a.pixelBlock.toJSON(),stretchParams:a.stretchParams};return[4,this._workerThread.invoke("stretch",b,c)];case 1:return f=e.sent(),[2,f?new d(f):null]}})})};h.prototype.mosaicAndTransform=
function(a,c){return g(this,void 0,void 0,function(){var f,h;return t(this,function(e){switch(e.label){case 0:if(!this._workerThread)throw new r("raster-jobhandler:no-connection","no available worker connection");if(!(a&&a.srcPixelBlocks&&0<a.srcPixelBlocks.length))return[2,null];f=b({},a,{srcPixelBlocks:a.srcPixelBlocks.map(function(a){return a?a.toJSON():null})});return[4,this._workerThread.invoke("mosaicAndTransform",f,c)];case 1:return h=e.sent(),[2,h?new d(h):null]}})})};return h}()})},"esri/layers/support/rasterFormats/RasterCodec":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/assignHelper ../../../core/Error ../PixelBlock ./ImageCanvasDecoder ./JpgPlus ./Lerc2Codec ./LercCodec ./Png ./Raw ./TiffDecoder".split(" "),
function(D,v,t,g,b,r,p,a,d,h,f,c,k,n){function e(a,c){if(!w)throw new r("rasterCoded:decode","lerc decoder is not supported on big endian platform");var b=c.width,d=c.height,e=c.pixelType,h=y(e),k=h.pixelTypeCtor;c=null==c.noDataValue?h.noDataValue:c.noDataValue;for(var h=0,m,g=0,n,x=a.byteLength-10;g<x;){var l=f.decode(a,{inputOffset:g,encodedMaskData:m,returnMask:0===h?!0:!1,returnEncodedMask:0===h?!0:!1,returnFileInfo:!0,pixelType:k,noDataValue:c});if(b&&d&&(l.width!==b||l.height!==d))throw new r("rasterCoded:decode",
"lerc decoded result has width or height different from specified in options");g=l.fileInfo.eofOffset;0===h&&(m=l.encodedMaskData,n=new p({width:l.width,height:l.height,pixels:[],pixelType:e,mask:l.maskData,statistics:[]}));h++;n.addData({pixels:l.pixelData,statistics:{minValue:l.minValue,maxValue:l.maxValue,noDataValue:l.noDataValue}});10<x-g&&(l=String.fromCharCode.apply(null,new Uint8Array(a,g,10)),g=-1<g+l.indexOf("CntZ")?l.indexOf("CntZ"):0)}return n}function l(a,c){if(!w)throw new r("rasterCoded:decode",
"lerc decoder is not supported on big endian platform");var b=0,d=0,f=0,e,k,m,g=a.byteLength-10,n=[],l=c.width;for(c=c.height;d<g;){k=h.decode(a,{inputOffset:d,maskData:e,returnFileInfo:!0});if(l&&c&&(k.width!==l||k.height!==c))throw new r("rasterCoded:decode","lerc2 decoded result has width or height different from what's specified in options");d=k.fileInfo.eofOffset;0===b&&(f=k.fileInfo.numValidPixel,e=k.maskData,m=new p({width:k.width,height:k.height,pixels:[],pixelType:k.fileInfo.pixelType,mask:k.maskData,
statistics:[]}));k.fileInfo.mask&&0<k.fileInfo.mask.numBytes&&n.push(k.maskData);b++;m.addData({pixels:k.pixelData,statistics:{minValue:k.minValue,maxValue:k.maxValue}});10<g-d&&(k=String.fromCharCode.apply(null,new Uint8Array(a,d,10)),d+=-1<k.indexOf("Lerc")?k.indexOf("Lerc"):0)}d=b=a=0;if(1<n.length){d=m.width*m.height;e=new Uint8Array(d);e.set(n[0]);for(a=1;a<n.length;a++)for(f=n[a],b=0;b<d;b++)e[b]&=f[b];for(b=f=0;b<d;b++)f+=e[b];m.mask=e}m.validPixelCount=f;return m}function u(a){a=n.decode(a);
a=new p({width:a.width,height:a.height,pixels:a.pixels,pixelType:a.pixelType.toLowerCase(),mask:a.mask,statistics:null});a.updateStatistics();return a}function m(a){a=d.decode(a);a=new p({width:a.width,height:a.height,pixels:a.pixels,pixelType:"U8",mask:a.mask,statistics:null});a.updateStatistics();return a}function q(a,b){a=new Uint8Array(a);var d=new c(a);a=b.width;var f=b.height;b=a*f;for(var d=d.decode(),e=0,h=0,h=new Uint8Array(b),e=0;e<b;e++)h[e]=d[4*e+3];f=new p({width:a,height:f,pixels:[],
pixelType:"U8",mask:h,statistics:[]});for(e=0;3>e;e++){a=new Uint8Array(b);for(h=0;h<b;h++)a[h]=d[4*h+e];f.addData({pixels:a})}f.updateStatistics();return f}function C(c,d,f){return g(this,void 0,void 0,function(){var e,h,k,m;return t(this,function(g){switch(g.label){case 0:return e=new a,h=b({applyJpegMask:!1},d),[4,e.decode(c,h,f)];case 1:return k=g.sent(),m=new p(k),m.updateStatistics(),[2,m]}})})}function B(a){if(null==a)throw new r("rasterCodec:decode","parameter encodeddata is required.");a=
new Uint8Array(a,0,10);var c="";255===a[0]&&216===a[1]?c="jpg":137===a[0]&&80===a[1]&&78===a[2]&&71===a[3]?c="png":67===a[0]&&110===a[1]&&116===a[2]&&90===a[3]&&73===a[4]&&109===a[5]&&97===a[6]&&103===a[7]&&101===a[8]&&32===a[9]?c="lerc":76===a[0]&&101===a[1]&&114===a[2]&&99===a[3]&&50===a[4]&&32===a[5]?c="lerc2":73===a[0]&&73===a[1]&&42===a[2]&&0===a[3]||77===a[0]&&77===a[1]&&0===a[2]&&42===a[3]?c="tiff":-1<String.fromCharCode.apply(null,a).toLowerCase().indexOf("error")&&(c="error");return c}function G(a){var c=
null;switch(a){case "lerc":c=e;break;case "lerc2":c=l;break;case "jpg":c=m;break;case "png":c=q;break;case "bsq":case "bip":c=function(c,b){var d=y(b.pixelType).pixelTypeCtor,f=k.decode;c=f(c,{width:b.width,height:b.height,pixelType:d,format:a});b=new p({width:b.width,height:b.height,pixels:c.pixels,pixelType:b.pixelType,mask:c.mask,statistics:null});b.updateStatistics();return b};break;case "tiff":c=u;break;case "error":c=function(){throw new r("rasterCodec:decode","input data contains error");};
break;default:c=function(){throw new r("rasterCodec:decode","unsupported raster format");}}return c}function y(a){var c=null,b=null;switch(a?a.toLowerCase():"f32"){case "u1":case "u2":case "u4":case "u8":b=Math.pow(2,8)-1;c=Uint8Array;break;case "u16":b=b||Math.pow(2,16)-1;c=Uint16Array;break;case "u32":b=b||Math.pow(2,32)-1;c=Uint32Array;break;case "s8":b=b||0-Math.pow(2,7);c=Int8Array;break;case "s16":b=b||0-Math.pow(2,15);c=Int16Array;break;case "s32":b=b||0-Math.pow(2,31);c=Int32Array;break;default:c=
Float32Array}return{pixelTypeCtor:c,noDataValue:b}}var w=function(){var a=new ArrayBuffer(4),c=new Uint8Array(a);(new Uint32Array(a))[0]=1;return 1===c[0]}();return function(){function a(){}a.getFormat=function(a){a=B(a);"lerc2"===a?a="lerc":"error"===a&&(a="");return a};a.decode=function(a,c,d){return g(this,void 0,void 0,function(){var f,e,h;return t(this,function(k){switch(k.label){case 0:if(null==a)throw new r("rasterCodec:decode","missing encodeddata parameter.");if(null==c||null==c.width||null==
c.height)throw new r("rasterCodec:decode","requires width and height in options parameter.");f=c.format&&c.format.toLowerCase();if("tiff"===f&&c.customOptions)return k=n.decodeTileOrStrip(a,c.customOptions),k=new p({width:k.width,height:k.height,pixels:k.pixels,pixelType:k.pixelType.toLowerCase(),mask:k.mask,statistics:null}),k.updateStatistics(),[2,k];if(!f||"bsq"!==f&&"bip"!==f)f=B(a);return!c.useCanvas||"jpg"!==f&&"png"!==f?[3,2]:[4,C(a,c,d)];case 1:return h=k.sent(),[3,3];case 2:e=G(f);c.isPoint&&
(c=b({},c),c.width++,c.height++);h=e(a,c);if(c.isPoint){var m=h,g=void 0;void 0===g&&(g=1);if(m){var l=m.pixels,q=m.width,w=m.mask;if(l&&0!==l.length){var x=l.length,u=q-1,y=m.height-1,z=[],A,F,E,M,t,v,N=p.getPixelArrayConstructor(m.pixelType);if(0===g){for(g=0;g<x;g++){M=l[g];t=new N(u*y);for(A=0;A<y;A++)for(E=A*q,F=0;F<u;F++)t[A*u+F]=M[E+F];z.push(t)}if(w)for(v=new Uint8Array(u*y),A=0;A<y;A++)for(E=A*q,F=0;F<u;F++)v[A*u+F]=w[E+F]}else{for(g=0;g<x;g++){M=l[g];t=new N(u*y);for(A=0;A<y;A++)for(E=A*
q,F=0;F<u;F++)t[A*u+F]=(M[E+F]+M[E+F+1]+M[E+q+F]+M[E+q+F+1])/4;z.push(t)}if(w)for(v=new Uint8Array(u*y),A=0;A<y;A++)for(E=A*q,F=0;F<u;F++)v[A*u+F]=Math.min.apply(null,[w[E+F],w[E+F+1],w[E+q+F],w[E+q+F+1]])}m.width=u;m.height=y;m.mask=v;m.pixels=z}}}k.label=3;case 3:return[2,h]}})})};return a}()})},"esri/layers/support/rasterFormats/ImageCanvasDecoder":function(){define("require exports ../../../core/Error ../../../core/promiseUtils ../../../core/promiseUtils ./Zlib".split(" "),function(D,v,t,g,b,
r){return function(){function p(a){a&&(this.canvas=a.canvas,this.ctx=a.ctx||a.canvas&&a.canvas.getContext("2d"))}p.getFormat=function(a){if(!a||10>a.byteLength)return"";a=new Uint8Array(a,0,10);var b="";255===a[0]&&216===a[1]?b="jpeg":137===a[0]&&80===a[1]&&78===a[2]&&71===a[3]&&(b="png");return b};p.prototype.decode=function(a,d,h){var f=this;if(!a||10>a.byteLength)throw new t("imagecanvasdecoder: decode","required a valid encoded data as input.");var c=p.getFormat(a);if(""===c)throw new t("imagecanvasdecoder: decode",
"encoded data format is not a supported format (jpeg or png).");var k=d.width,n=d.height,e=d.applyJpegMask;if(e&&(!k||!n))throw new t("imagecanvasdecoder: decode","image width and height are needed to apply jpeg mask directly to canvas");return g.create(function(l,u){var m=null;"jpeg"===c&&e&&(m=p.getMask(a,d));var q=new Blob([new Uint8Array(a)],{type:"image/"+c}),C=URL.createObjectURL(q),r=new Image,G;r.src=C;r.onload=function(){URL.revokeObjectURL(C);if(g.isAborted(h))u(b.createAbortError());else{k=
r.width;n=r.height;if(f.canvas){if(f.canvas.width!==k||f.canvas.height!==n)f.canvas.width=k,f.canvas.height=n;f.ctx.clearRect(0,0,k,n)}else f.canvas=document.createElement("canvas"),f.canvas.width=k,f.canvas.height=n,f.ctx=f.canvas.getContext("2d");f.ctx.drawImage(r,0,0);var a=f.ctx.getImageData(0,0,k,n);G=a.data;var c;if(d.renderOnCanvas){if(m)for(c=0;c<m.length;c++)G[4*c+3]=m[c]?255:0;f.ctx.putImageData(a,0,0);l(null)}else{var a=k*n,e=new Uint8Array(a),p=new Uint8Array(a),q=new Uint8Array(a);if(m)for(c=
0;c<a;c++)e[c]=G[4*c],p[c]=G[4*c+1],q[c]=G[4*c+2];else for(m=new Uint8Array(a),c=0;c<a;c++)e[c]=G[4*c],p[c]=G[4*c+1],q[c]=G[4*c+2],m[c]=G[4*c+3];l({width:k,height:n,pixels:[e,p,q],mask:m,pixelType:"u8"})}}};r.onerror=function(){URL.revokeObjectURL(C);u("cannot load image")}})};p.getMask=function(a,b){var d=null;try{var f=new Uint8Array(a);a=0;var c=f.length-2;for(a=Math.ceil(f.length/2);a<c&&(255!==f[a]||217!==f[a+1]);a++);a+=2;if(a<f.length-1)for(var k=(new r(f.subarray(a))).getBytes(),d=new Uint8Array(b.width*
b.height),f=b=0;f<k.length;f++)for(c=7;0<=c;c--)d[b++]=k[f]>>c&1}catch(n){}return d};return p}()})},"esri/layers/support/rasterFormats/Zlib":function(){define([],function(){var D=function(){function v(){this.bufferLength=this.pos=0;this.eof=!1;this.buffer=null}v.prototype={ensureBuffer:function(t){var g=this.buffer,b=g?g.byteLength:0;if(t<b)return g;for(var r=512;r<t;)r<<=1;t=new Uint8Array(r);for(r=0;r<b;++r)t[r]=g[r];return this.buffer=t},getByte:function(){for(var t=this.pos;this.bufferLength<=
t;){if(this.eof)return null;this.readBlock()}return this.buffer[this.pos++]},getBytes:function(t){var g=this.pos;if(t){this.ensureBuffer(g+t);for(t=g+t;!this.eof&&this.bufferLength<t;)this.readBlock();var b=this.bufferLength;t>b&&(t=b)}else{for(;!this.eof;)this.readBlock();t=this.bufferLength}this.pos=t;return this.buffer.subarray(g,t)},lookChar:function(){for(var t=this.pos;this.bufferLength<=t;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos])},getChar:function(){for(var t=
this.pos;this.bufferLength<=t;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos++])},makeSubStream:function(t,g,b){for(var r=t+g;this.bufferLength<=r&&!this.eof;)this.readBlock();return new Stream(this.buffer,t,g,b)},skip:function(t){t||(t=1);this.pos+=t},reset:function(){this.pos=0}};return v}();return function(){function v(a){throw Error(a);}function t(a){var b=0,d=a[b++],c=a[b++];-1!=d&&-1!=c||v("Invalid header in flate stream");8!=(d&15)&&v("Unknown compression method in flate stream");
0!=((d<<8)+c)%31&&v("Bad FCHECK in flate stream");c&32&&v("FDICT bit set in flate stream");this.bytes=a;this.bytesPos=b;this.codeBuf=this.codeSize=0;D.call(this)}if(!self||!self.Uint32Array)return null;var g=new Uint32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),b=new Uint32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]),r=new Uint32Array([1,2,3,4,65541,65543,131081,
131085,196625,196633,262177,262193,327745,327777,393345,393409,459009,459137,524801,525057,590849,591361,657409,658433,724993,727041,794625,798721,868353,876545]),p=[new Uint32Array([459008,524368,524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,459020,524392,524328,59E4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,589992,524292,524420,
524356,590056,459014,524380,524316,589976,459030,524412,524348,590040,459022,524396,524332,590008,524300,524428,524364,590072,459009,524370,524306,524570,459025,524402,524338,590020,459017,524386,524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,589980,459031,524414,
524350,590044,459023,524398,524334,590012,524302,524430,524366,590076,459008,524369,524305,524569,459024,524401,524337,590018,459016,524385,524321,589986,524289,524417,524353,590050,459012,524377,524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,590010,524301,524429,
524365,590074,459009,524371,524307,524571,459025,524403,524339,590022,459017,524387,524323,589990,524291,524419,524355,590054,459013,524379,524315,589974,459029,524411,524347,590038,459021,524395,524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,524568,459024,524400,
524336,590017,459016,524384,524320,589985,524288,524416,524352,590049,459012,524376,524312,589969,459028,524408,524344,590033,459020,524392,524328,590001,524296,524424,524360,590065,459010,524372,524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,589989,524290,524418,
524354,590053,459013,524378,524314,589973,459029,524410,524346,590037,459021,524394,524330,590005,524298,524426,524362,590069,459011,524374,524310,524574,459027,524406,524342,590029,459019,524390,524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,589971,459028,524409,
524345,590035,459020,524393,524329,590003,524297,524425,524361,590067,459010,524373,524309,524573,459026,524405,524341,590027,459018,524389,524325,589995,524293,524421,524357,590059,459014,524381,524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,590007,524299,524427,
524363,590071,459011,524375,524311,524575,459027,524407,524343,590031,459019,524391,524327,589999,524295,524423,524359,590063,459015,524383,524319,589983,459031,524415,524351,590047,459023,524399,524335,590015,524303,524431,524367,590079]),9],a=[new Uint32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5];t.prototype=Object.create(D.prototype);
t.prototype.getBits=function(a){for(var b=this.codeSize,d=this.codeBuf,c=this.bytes,k=this.bytesPos,g;b<a;)"undefined"==typeof(g=c[k++])&&v("Bad encoding in flate stream"),d|=g<<b,b+=8;this.codeBuf=d>>a;this.codeSize=b-=a;this.bytesPos=k;return d&(1<<a)-1};t.prototype.getCode=function(a){var b=a[0],d=a[1];a=this.codeSize;for(var c=this.codeBuf,k=this.bytes,g=this.bytesPos;a<d;){var e;"undefined"==typeof(e=k[g++])&&v("Bad encoding in flate stream");c|=e<<a;a+=8}d=b[c&(1<<d)-1];b=d>>16;d&=65535;(0==
a||a<b||0==b)&&v("Bad encoding in flate stream");this.codeBuf=c>>b;this.codeSize=a-b;this.bytesPos=g;return d};t.prototype.generateHuffmanTable=function(a){for(var b=a.length,d=0,c=0;c<b;++c)a[c]>d&&(d=a[c]);for(var k=1<<d,g=new Uint32Array(k),e=1,l=0,p=2;e<=d;++e,l<<=1,p<<=1)for(var m=0;m<b;++m)if(a[m]==e){for(var q=0,r=l,c=0;c<e;++c)q=q<<1|r&1,r>>=1;for(c=q;c<k;c+=p)g[c]=e<<16|m;++l}return[g,d]};t.prototype.readBlock=function(){function d(a,c,b,d,f){for(a=a.getBits(b)+d;0<a--;)c[l++]=f}var h=this.getBits(3);
h&1&&(this.eof=!0);h>>=1;if(0==h){var f=this.bytes,c=this.bytesPos,k;"undefined"==typeof(k=f[c++])&&v("Bad block header in flate stream");var n=k;"undefined"==typeof(k=f[c++])&&v("Bad block header in flate stream");n|=k<<8;"undefined"==typeof(k=f[c++])&&v("Bad block header in flate stream");h=k;"undefined"==typeof(k=f[c++])&&v("Bad block header in flate stream");(h|k<<8)!=(~n&65535)&&v("Bad uncompressed block length in flate stream");this.codeSize=this.codeBuf=0;k=this.bufferLength;h=this.ensureBuffer(k+
n);this.bufferLength=n=k+n;for(var e=k;e<n;++e){if("undefined"==typeof(k=f[c++])){this.eof=!0;break}h[e]=k}this.bytesPos=c}else{if(1==h)c=p,k=a;else if(2==h){h=this.getBits(5)+257;k=this.getBits(5)+1;for(var f=this.getBits(4)+4,c=Array(g.length),l=0;l<f;)c[g[l++]]=this.getBits(3);c=this.generateHuffmanTable(c);l=f=0;k=h+k;for(n=Array(k);l<k;)e=this.getCode(c),16==e?d(this,n,2,3,f):17==e?d(this,n,3,3,f=0):18==e?d(this,n,7,11,f=0):n[l++]=f=e;c=this.generateHuffmanTable(n.slice(0,h));k=this.generateHuffmanTable(n.slice(h,
k))}else v("Unknown block type in flate stream");n=(h=this.buffer)?h.length:0;for(e=this.bufferLength;;){var u=this.getCode(c);if(256>u)e+1>=n&&(h=this.ensureBuffer(e+1),n=h.length),h[e++]=u;else{if(256==u){this.bufferLength=e;break}var u=u-257,u=b[u],m=u>>16;0<m&&(m=this.getBits(m));f=(u&65535)+m;u=this.getCode(k);u=r[u];m=u>>16;0<m&&(m=this.getBits(m));u=(u&65535)+m;e+f>=n&&(h=this.ensureBuffer(e+f),n=h.length);for(m=0;m<f;++m,++e)h[e]=h[e-u]}}}};return t}()})},"esri/layers/support/rasterFormats/JpgPlus":function(){define(["require",
"exports","./Jpg","./Zlib"],function(D,v,t,g){return function(){function b(){}b.decode=function(b){var p=new Uint8Array(b),a=new t;a.parse(p);b=a.width;var d=a.height,h=a.numComponents,f=a.eof,a=a.getData(b,d,!0),c,k=b*d,n=0,e=0,l=0;if(f<p.length-1)for(p=(new g(p.subarray(f))).getBytes(),c=new Uint8Array(k),n=f=0;n<p.length;n++)for(l=7;0<=l;l--)c[f++]=p[n]>>l&1;p=null;if(1===h)p=[a,a,a];else{p=[];for(n=0;3>n;n++)h=new Uint8Array(k),p.push(h);for(e=l=0;e<k;e++)for(n=0;3>n;n++)p[n][e]=a[l++]}return{width:b,
height:d,pixels:p,mask:c}};return b}()})},"esri/layers/support/rasterFormats/Jpg":function(){define([],function(){var D=function(){function v(t){this.message="JPEG error: "+t}v.prototype=Error();v.prototype.name="JpegError";return v.constructor=v}();return function(){function v(){this.decodeTransform=null;this.colorTransform=-1}function t(a,b){for(var d=0,f=[],c,k,g=16;0<g&&!a[g-1];)g--;f.push({children:[],index:0});var e=f[0],l;for(c=0;c<g;c++){for(k=0;k<a[c];k++){e=f.pop();for(e.children[e.index]=
b[d];0<e.index;)e=f.pop();e.index++;for(f.push(e);f.length<=c;)f.push(l={children:[],index:0}),e.children[e.index]=l.children,e=l;d++}c+1<g&&(f.push(l={children:[],index:0}),e.children[e.index]=l.children,e=l)}return f[0].children}function g(a,b,h,f,c,k,g,e,l){function d(){if(0<F)return F--,E>>F&1;E=a[b++];if(255===E){var c=a[b++];if(c)throw new D("unexpected marker "+(E<<8|c).toString(16));}F=7;return E>>>7}function m(a){for(;;){a=a[d()];if("number"===typeof a)return a;if("object"!==typeof a)throw new D("invalid huffman sequence");
}}function n(a){for(var c=0;0<a;)c=c<<1|d(),a--;return c}function C(a){if(1===a)return 1===d()?1:-1;var c=n(a);return c>=1<<a-1?c:c+(-1<<a)+1}function B(a,c){var b=m(a.huffmanTableDC),b=0===b?0:C(b);a.blockData[c]=a.pred+=b;for(b=1;64>b;){var d=m(a.huffmanTableAC),f=d&15,d=d>>4;if(0===f){if(15>d)break;b+=16}else b+=d,a.blockData[c+p[b]]=C(f),b++}}function G(a,c){var b=m(a.huffmanTableDC),b=0===b?0:C(b)<<l;a.blockData[c]=a.pred+=b}function y(a,c){a.blockData[c]|=d()<<l}function w(a,c){if(0<M)M--;else for(var b=
k;b<=g;){var d=m(a.huffmanTableAC),f=d&15,d=d>>4;if(0===f){if(15>d){M=n(d)+(1<<d)-1;break}b+=16}else b+=d,a.blockData[c+p[b]]=C(f)*(1<<l),b++}}function x(a,c){for(var b=k,f=0,e;b<=g;){e=p[b];switch(t){case 0:f=m(a.huffmanTableAC);e=f&15;f>>=4;if(0===e)15>f?(M=n(f)+(1<<f),t=4):(f=16,t=1);else{if(1!==e)throw new D("invalid ACn encoding");v=C(e);t=f?2:3}continue;case 1:case 2:a.blockData[c+e]?a.blockData[c+e]+=d()<<l:(f--,0===f&&(t=2===t?3:0));break;case 3:a.blockData[c+e]?a.blockData[c+e]+=d()<<l:(a.blockData[c+
e]=v<<l,t=0);break;case 4:a.blockData[c+e]&&(a.blockData[c+e]+=d()<<l)}b++}4===t&&(M--,0===M&&(t=0))}var z=h.mcusPerLine,A=b,E=0,F=0,M=0,t=0,v,L=f.length,H,I,R,Q,S;e=h.progressive?0===k?0===e?G:y:0===e?w:x:B;var T=0;h=1===L?f[0].blocksPerLine*f[0].blocksPerColumn:z*h.mcusPerColumn;for(var V,P;T<h;){var J=c?Math.min(h-T,c):h;for(I=0;I<L;I++)f[I].pred=0;M=0;if(1===L)for(H=f[0],S=0;S<J;S++)e(H,64*((H.blocksPerLine+1)*(T/H.blocksPerLine|0)+T%H.blocksPerLine)),T++;else for(S=0;S<J;S++){for(I=0;I<L;I++)for(H=
f[I],V=H.h,P=H.v,R=0;R<P;R++)for(Q=0;Q<V;Q++)e(H,64*((H.blocksPerLine+1)*((T/z|0)*H.v+R)+(T%z*H.h+Q)));T++}F=0;(H=r(a,b))&&H.invalid&&(console.log("decodeScan - unexpected MCU data, next marker is: "+H.invalid),b=H.offset);H=H&&H.marker;if(!H||65280>=H)throw new D("marker was not found");if(65488<=H&&65495>=H)b+=2;else break}(H=r(a,b))&&H.invalid&&(console.log("decodeScan - unexpected Scan data, next marker is: "+H.invalid),b=H.offset);return b-A}function b(a,b){a=b.blocksPerLine;for(var d=b.blocksPerColumn,
f=new Int16Array(64),c=0;c<d;c++)for(var k=0;k<a;k++){var g=64*((b.blocksPerLine+1)*c+k),e=f,l=b.quantizationTable,p=b.blockData,m=void 0,q=void 0,r=void 0,B=void 0,G=void 0,y=void 0,w=void 0,x=void 0,z=void 0,A=x=void 0,E=w=q=y=void 0,F=void 0,z=void 0;if(!l)throw new D("missing required Quantization Table.");for(var t=0;64>t;t+=8)z=p[g+t],x=p[g+t+1],A=p[g+t+2],y=p[g+t+3],q=p[g+t+4],w=p[g+t+5],E=p[g+t+6],F=p[g+t+7],z*=l[t],0===(x|A|y|q|w|E|F)?(z=5793*z+512>>10,e[t]=z,e[t+1]=z,e[t+2]=z,e[t+3]=z,e[t+
4]=z,e[t+5]=z,e[t+6]=z,e[t+7]=z):(x*=l[t+1],A*=l[t+2],y*=l[t+3],q*=l[t+4],w*=l[t+5],E*=l[t+6],F*=l[t+7],m=5793*z+128>>8,q=5793*q+128>>8,r=A,B=E,G=2896*(x-F)+128>>8,x=2896*(x+F)+128>>8,y<<=4,w<<=4,m=m+q+1>>1,q=m-q,z=3784*r+1567*B+128>>8,r=1567*r-3784*B+128>>8,B=z,G=G+w+1>>1,w=G-w,x=x+y+1>>1,y=x-y,m=m+B+1>>1,B=m-B,q=q+r+1>>1,r=q-r,z=2276*G+3406*x+2048>>12,G=3406*G-2276*x+2048>>12,x=z,z=799*y+4017*w+2048>>12,y=4017*y-799*w+2048>>12,w=z,e[t]=m+x,e[t+7]=m-x,e[t+1]=q+w,e[t+6]=q-w,e[t+2]=r+y,e[t+5]=r-y,
e[t+3]=B+G,e[t+4]=B-G);for(l=0;8>l;++l)z=e[l],x=e[l+8],A=e[l+16],y=e[l+24],q=e[l+32],w=e[l+40],E=e[l+48],F=e[l+56],0===(x|A|y|q|w|E|F)?(z=5793*z+8192>>14,z=-2040>z?0:2024<=z?255:z+2056>>4,p[g+l]=z,p[g+l+8]=z,p[g+l+16]=z,p[g+l+24]=z,p[g+l+32]=z,p[g+l+40]=z,p[g+l+48]=z,p[g+l+56]=z):(m=5793*z+2048>>12,q=5793*q+2048>>12,r=A,B=E,G=2896*(x-F)+2048>>12,x=2896*(x+F)+2048>>12,m=(m+q+1>>1)+4112,q=m-q,z=3784*r+1567*B+2048>>12,r=1567*r-3784*B+2048>>12,B=z,G=G+w+1>>1,w=G-w,x=x+y+1>>1,y=x-y,m=m+B+1>>1,B=m-B,q=
q+r+1>>1,r=q-r,z=2276*G+3406*x+2048>>12,G=3406*G-2276*x+2048>>12,x=z,z=799*y+4017*w+2048>>12,y=4017*y-799*w+2048>>12,w=z,z=m+x,F=m-x,x=q+w,E=q-w,A=r+y,w=r-y,y=B+G,q=B-G,z=16>z?0:4080<=z?255:z>>4,x=16>x?0:4080<=x?255:x>>4,A=16>A?0:4080<=A?255:A>>4,y=16>y?0:4080<=y?255:y>>4,q=16>q?0:4080<=q?255:q>>4,w=16>w?0:4080<=w?255:w>>4,E=16>E?0:4080<=E?255:E>>4,F=16>F?0:4080<=F?255:F>>4,p[g+l]=z,p[g+l+8]=x,p[g+l+16]=A,p[g+l+24]=y,p[g+l+32]=q,p[g+l+40]=w,p[g+l+48]=E,p[g+l+56]=F)}return b.blockData}function r(a,
b,h){var d=a.length-1;h=h<b?h:b;if(b>=d)return null;var c=a[b]<<8|a[b+1];if(65472<=c&&65534>=c)return{invalid:null,marker:c,offset:b};for(b=a[h]<<8|a[h+1];!(65472<=b&&65534>=b);){if(++h>=d)return null;b=a[h]<<8|a[h+1]}return{invalid:c.toString(16),marker:b,offset:h}}if(!self||!self.Uint8ClampedArray)return null;var p=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,
54,47,55,62,63]);v.prototype={parse:function(a){function d(){var b=a[c]<<8|a[c+1];c+=2;return b}function h(){var b=d(),b=c+b-2,f=r(a,b,c);f&&f.invalid&&(console.log("readDataBlock - incorrect length, next marker is: "+f.invalid),b=f.offset);b=a.subarray(c,b);c+=b.length;return b}function f(a){for(var c=Math.ceil(a.samplesPerLine/8/a.maxH),b=Math.ceil(a.scanLines/8/a.maxV),d=0;d<a.components.length;d++){A=a.components[d];var f=Math.ceil(Math.ceil(a.samplesPerLine/8)*A.h/a.maxH),e=Math.ceil(Math.ceil(a.scanLines/
8)*A.v/a.maxV);A.blockData=new Int16Array(64*b*A.v*(c*A.h+1));A.blocksPerLine=f;A.blocksPerColumn=e}a.mcusPerLine=c;a.mcusPerColumn=b}var c=0,k=null,n=null,e,l,u=[],m=[],q=[],C=d();if(65496!==C)throw new D("SOI not found");for(C=d();65497!==C;){var B,G;switch(C){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:B=h();65504===C&&74===B[0]&&70===B[1]&&73===B[2]&&70===
B[3]&&0===B[4]&&(k={version:{major:B[5],minor:B[6]},densityUnits:B[7],xDensity:B[8]<<8|B[9],yDensity:B[10]<<8|B[11],thumbWidth:B[12],thumbHeight:B[13],thumbData:B.subarray(14,14+3*B[12]*B[13])});65518===C&&65===B[0]&&100===B[1]&&111===B[2]&&98===B[3]&&101===B[4]&&(n={version:B[5]<<8|B[6],flags0:B[7]<<8|B[8],flags1:B[9]<<8|B[10],transformCode:B[11]});break;case 65499:for(var C=d()+c-2,y;c<C;){var w=a[c++],x=new Uint16Array(64);if(0===w>>4)for(B=0;64>B;B++)y=p[B],x[y]=a[c++];else if(1===w>>4)for(B=
0;64>B;B++)y=p[B],x[y]=d();else throw new D("DQT - invalid table spec");u[w&15]=x}break;case 65472:case 65473:case 65474:if(e)throw new D("Only single frame JPEGs supported");d();e={};e.extended=65473===C;e.progressive=65474===C;e.precision=a[c++];e.scanLines=d();e.samplesPerLine=d();e.components=[];e.componentIds={};B=a[c++];for(C=x=w=0;C<B;C++){y=a[c];G=a[c+1]>>4;var z=a[c+1]&15;w<G&&(w=G);x<z&&(x=z);G=e.components.push({h:G,v:z,quantizationId:a[c+2],quantizationTable:null});e.componentIds[y]=G-
1;c+=3}e.maxH=w;e.maxV=x;f(e);break;case 65476:y=d();for(C=2;C<y;){w=a[c++];x=new Uint8Array(16);for(B=G=0;16>B;B++,c++)G+=x[B]=a[c];z=new Uint8Array(G);for(B=0;B<G;B++,c++)z[B]=a[c];C+=17+G;(0===w>>4?q:m)[w&15]=t(x,z)}break;case 65501:d();l=d();break;case 65498:d();y=a[c++];B=[];for(var A,C=0;C<y;C++)w=e.componentIds[a[c++]],A=e.components[w],w=a[c++],A.huffmanTableDC=q[w>>4],A.huffmanTableAC=m[w&15],B.push(A);C=a[c++];y=a[c++];w=a[c++];C=g(a,c,e,B,l,C,y,w>>4,w&15);c+=C;break;case 65535:255!==a[c]&&
c--;break;default:if(255===a[c-3]&&192<=a[c-2]&&254>=a[c-2])c-=3;else throw new D("unknown marker "+C.toString(16));}C=d()}this.width=e.samplesPerLine;this.height=e.scanLines;this.jfif=k;this.eof=c;this.adobe=n;this.components=[];for(C=0;C<e.components.length;C++){A=e.components[C];if(k=u[A.quantizationId])A.quantizationTable=k;this.components.push({output:b(e,A),scaleX:A.h/e.maxH,scaleY:A.v/e.maxV,blocksPerLine:A.blocksPerLine,blocksPerColumn:A.blocksPerColumn})}this.numComponents=this.components.length},
_getLinearizedBlockData:function(a,b){var d=this.width/a,f=this.height/b,c,k,g,e,p,u,m=0,q,r=this.components.length,B=a*b*r,t=new Uint8ClampedArray(B),y=new Uint32Array(a);for(u=0;u<r;u++){c=this.components[u];k=c.scaleX*d;g=c.scaleY*f;m=u;q=c.output;e=c.blocksPerLine+1<<3;for(p=0;p<a;p++)c=0|p*k,y[p]=(c&4294967288)<<3|c&7;for(k=0;k<b;k++)for(c=0|k*g,c=e*(c&4294967288)|(c&7)<<3,p=0;p<a;p++)t[m]=q[c+y[p]],m+=r}if(b=this.decodeTransform)for(u=0;u<B;)for(a=c=0;c<r;c++,u++,a+=2)t[u]=(t[u]*b[a]>>8)+b[a+
1];return t},_isColorConversionNeeded:function(){return this.adobe?!!this.adobe.transformCode:3===this.numComponents?0===this.colorTransform?!1:!0:1===this.colorTransform?!0:!1},_convertYccToRgb:function(a){for(var b,h,f,c=0,k=a.length;c<k;c+=3)b=a[c],h=a[c+1],f=a[c+2],a[c]=b-179.456+1.402*f,a[c+1]=b+135.459-.344*h-.714*f,a[c+2]=b-226.816+1.772*h;return a},_convertYcckToRgb:function(a){for(var b,h,f,c,k=0,g=0,e=a.length;g<e;g+=4)b=a[g],h=a[g+1],f=a[g+2],c=a[g+3],a[k++]=-122.67195406894+h*(-6.60635669420364E-5*
h+4.37130475926232E-4*f-5.4080610064599E-5*b+4.8449797120281E-4*c-.154362151871126)+f*(-9.57964378445773E-4*f+8.17076911346625E-4*b-.00477271405408747*c+1.53380253221734)+b*(9.61250184130688E-4*b-.00266257332283933*c+.48357088451265)+c*(-3.36197177618394E-4*c+.484791561490776),a[k++]=107.268039397724+h*(2.19927104525741E-5*h-6.40992018297945E-4*f+6.59397001245577E-4*b+4.26105652938837E-4*c-.176491792462875)+f*(-7.78269941513683E-4*f+.00130872261408275*b+7.70482631801132E-4*c-.151051492775562)+b*(.00126935368114843*
b-.00265090189010898*c+.25802910206845)+c*(-3.18913117588328E-4*c-.213742400323665),a[k++]=-20.810012546947+h*(-5.70115196973677E-4*h-2.63409051004589E-5*f+.0020741088115012*b-.00288260236853442*c+.814272968359295)+f*(-1.53496057440975E-5*f-1.32689043961446E-4*b+5.60833691242812E-4*c-.195152027534049)+b*(.00174418132927582*b-.00255243321439347*c+.116935020465145)+c*(-3.43531996510555E-4*c+.24165260232407);return a},_convertYcckToCmyk:function(a){for(var b,h,f,c=0,k=a.length;c<k;c+=4)b=a[c],h=a[c+
1],f=a[c+2],a[c]=434.456-b-1.402*f,a[c+1]=119.541-b+.344*h+.714*f,a[c+2]=481.816-b-1.772*h;return a},_convertCmykToRgb:function(a){for(var b,h,f,c,k=0,g=1/255,e=0,p=a.length;e<p;e+=4)b=a[e]*g,h=a[e+1]*g,f=a[e+2]*g,c=a[e+3]*g,a[k++]=255+b*(-4.387332384609988*b+54.48615194189176*h+18.82290502165302*f+212.25662451639585*c-285.2331026137004)+h*(1.7149763477362134*h-5.6096736904047315*f-17.873870861415444*c-5.497006427196366)+f*(-2.5217340131683033*f-21.248923337353073*c+17.5119270841813)-c*(21.86122147463605*
c+189.48180835922747),a[k++]=255+b*(8.841041422036149*b+60.118027045597366*h+6.871425592049007*f+31.159100130055922*c-79.2970844816548)+h*(-15.310361306967817*h+17.575251261109482*f+131.35250912493976*c-190.9453302588951)+f*(4.444339102852739*f+9.8632861493405*c-24.86741582555878)-c*(20.737325471181034*c+187.80453709719578),a[k++]=255+b*(.8842522430003296*b+8.078677503112928*h+30.89978309703729*f-.23883238689178934*c-14.183576799673286)+h*(10.49593273432072*h+63.02378494754052*f+50.606957656360734*
c-112.23884253719248)+f*(.03296041114873217*f+115.60384449646641*c-193.58209356861505)-c*(22.33816807309886*c+180.12613974708367);return a},getData:function(a,b,h){if(4<this.numComponents)throw new D("Unsupported color mode");a=this._getLinearizedBlockData(a,b);if(1===this.numComponents&&h){h=a.length;b=new Uint8ClampedArray(3*h);for(var d=0,c=0;c<h;c++){var k=a[c];b[d++]=k;b[d++]=k;b[d++]=k}return b}if(3===this.numComponents&&this._isColorConversionNeeded())return this._convertYccToRgb(a);if(4===
this.numComponents){if(this._isColorConversionNeeded())return h?this._convertYcckToRgb(a):this._convertYcckToCmyk(a);if(h)return this._convertCmykToRgb(a)}return a}};return v}()})},"esri/layers/support/rasterFormats/Lerc2Codec":function(){define([],function(){var D={unstuff:function(g,b,r,p,a,d,h,f){var c=(1<<r)-1,k=0,n,e=0,l,u;g[g.length-1]<<=8*(4*g.length-Math.ceil(r*p/8));if(a)for(n=0;n<p;n++)0===e&&(u=g[k++],e=32),e>=r?(l=u>>>e-r&c,e-=r):(e=r-e,l=(u&c)<<e&c,u=g[k++],e=32-e,l+=u>>>e),b[n]=a[l];
else for(a=Math.ceil((f-d)/h),n=0;n<p;n++)0===e&&(u=g[k++],e=32),e>=r?(l=u>>>e-r&c,e-=r):(e=r-e,l=(u&c)<<e&c,u=g[k++],e=32-e,l+=u>>>e),b[n]=l<a?d+l*h:f},unstuffLUT:function(g,b,r,p,a,d){var h=(1<<b)-1,f=0,c=0,k=0,n=k=0,e,l=[];g[g.length-1]<<=8*(4*g.length-Math.ceil(b*r/8));for(var u=Math.ceil((d-p)/a),c=0;c<r;c++)0===k&&(e=g[f++],k=32),k>=b?(n=e>>>k-b&h,k-=b):(k=b-k,n=(e&h)<<k&h,e=g[f++],k=32-k,n+=e>>>k),l[c]=n<u?p+n*a:d;l.unshift(p);return l},unstuff2:function(g,b,r,p,a,d,h,f){var c=(1<<r)-1,k=0,
n,e=0,l=0,u,m,q;if(a)for(n=0;n<p;n++)0===e&&(m=g[k++],e=32,l=0),e>=r?(u=m>>>l&c,e-=r,l+=r):(q=r-e,u=m>>>l&c,m=g[k++],e=32-q,u|=(m&(1<<q)-1)<<r-q,l=q),b[n]=a[u];else for(a=Math.ceil((f-d)/h),n=0;n<p;n++)0===e&&(m=g[k++],e=32,l=0),e>=r?(u=m>>>l&c,e-=r,l+=r):(q=r-e,u=m>>>l&c,m=g[k++],e=32-q,u|=(m&(1<<q)-1)<<r-q,l=q),b[n]=u<a?d+u*h:f;return b},unstuffLUT2:function(g,b,r,p,a,d){for(var h=(1<<b)-1,f=0,c=0,k=0,n=0,e=0,l=0,u,m=[],q=Math.ceil((d-p)/a),c=0;c<r;c++)0===n&&(u=g[f++],n=32,l=0),n>=b?(e=u>>>l&h,
n-=b,l+=b):(k=b-n,e=u>>>l&h,u=g[f++],n=32-k,e|=(u&(1<<k)-1)<<b-k,l=k),m[c]=e<q?p+e*a:d;m.unshift(p);return m},originalUnstuff:function(g,b,r,p){var a=(1<<r)-1,d=0,h,f=0,c,k;g[g.length-1]<<=8*(4*g.length-Math.ceil(r*p/8));for(h=0;h<p;h++)0===f&&(k=g[d++],f=32),f>=r?(c=k>>>f-r&a,f-=r):(f=r-f,c=(k&a)<<f&a,k=g[d++],f=32-f,c+=k>>>f),b[h]=c;return b},originalUnstuff2:function(g,b,r,p){var a=(1<<r)-1,d=0,h,f=0,c=0,k,n,e;for(h=0;h<p;h++)0===f&&(n=g[d++],f=32,c=0),f>=r?(k=n>>>c&a,f-=r,c+=r):(e=r-f,k=n>>>c&
a,n=g[d++],f=32-e,k|=(n&(1<<e)-1)<<r-e,c=e),b[h]=k;return b}},v={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(g){for(var b=65535,r=65535,p=g.length,a=Math.floor(p/2),d=0;a;){var h=359<=a?359:a,a=a-h;do b+=g[d++]<<8,r+=b+=g[d++];while(--h);b=(b&65535)+(b>>>16);r=(r&65535)+(r>>>16)}p&1&&(r+=b+=g[d]<<8);return((r&65535)+(r>>>16)<<16|(b&65535)+(b>>>16))>>>0},readHeaderInfo:function(g,b){var r=b.ptr,p=new Uint8Array(g,r,6),a={};a.fileIdentifierString=String.fromCharCode.apply(null,p);if(0!==
a.fileIdentifierString.lastIndexOf("Lerc2",0))throw"Unexpected file identifier string (expect Lerc2 ): "+a.fileIdentifierString;var r=r+6,p=new DataView(g,r,8),d=p.getInt32(0,!0);a.fileVersion=d;r+=4;3<=d&&(a.checksum=p.getUint32(4,!0),r+=4);p=new DataView(g,r,12);a.height=p.getUint32(0,!0);a.width=p.getUint32(4,!0);r+=8;4<=d?(a.numDims=p.getUint32(8,!0),r+=4):a.numDims=1;p=new DataView(g,r,40);a.numValidPixel=p.getUint32(0,!0);a.microBlockSize=p.getInt32(4,!0);a.blobSize=p.getInt32(8,!0);a.imageType=
p.getInt32(12,!0);a.maxZError=p.getFloat64(16,!0);a.zMin=p.getFloat64(24,!0);a.zMax=p.getFloat64(32,!0);r+=40;b.headerInfo=a;b.ptr=r;if(3<=d&&(g=this.computeChecksumFletcher32(new Uint8Array(g,r-(4<=d?52:48),a.blobSize-14)),g!==a.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(g,b){var r=b.headerInfo,p=this.getDataTypeArray(r.imageType),a=r.numDims*this.getDataTypeSize(r.imageType),d=this.readSubArray(g,b.ptr,p,a);g=this.readSubArray(g,b.ptr+a,p,a);b.ptr+=2*a;a=!0;for(b=0;b<
r.numDims;b++)if(d[b]!==g[b]){a=!1;break}r.minValues=d;r.maxValues=g;return a},readSubArray:function(g,b,r,p){if(r===Uint8Array)g=new Uint8Array(g,b,p);else{var a=new ArrayBuffer(p);(new Uint8Array(a)).set(new Uint8Array(g,b,p));g=new r(a)}return g},readMask:function(g,b){var r=b.ptr,p=b.headerInfo,a=p.width*p.height,d=p.numValidPixel,h=new DataView(g,r,4),p={};p.numBytes=h.getUint32(0,!0);r+=4;if((0===d||a===d)&&0!==p.numBytes)throw"invalid mask";if(0===d)d=new Uint8Array(Math.ceil(a/8)),p.bitset=
d,h=new Uint8Array(a),b.pixels.resultMask=h,r+=p.numBytes;else if(0<p.numBytes){d=new Uint8Array(Math.ceil(a/8));h=new DataView(g,r,p.numBytes);g=h.getInt16(0,!0);var f=2,c=0,k=0;do{if(0<g)for(;g--;)d[c++]=h.getUint8(f++);else for(k=h.getUint8(f++),g=-g;g--;)d[c++]=k;g=h.getInt16(f,!0);f+=2}while(f<p.numBytes);if(-32768!==g||c<d.length)throw"Unexpected end of mask RLE encoding";h=new Uint8Array(a);for(f=f=g=0;f<a;f++)f&7?(g=d[f>>3],g<<=f&7):g=d[f>>3],g&128&&(h[f]=1);b.pixels.resultMask=h;p.bitset=
d;r+=p.numBytes}b.ptr=r;b.mask=p;return!0},readDataOneSweep:function(g,b,r){var p=b.ptr,a=b.headerInfo,d=a.numDims,h=a.width*a.height,a=a.numValidPixel*v.getDataTypeSize(a.imageType)*d,f=b.pixels.resultMask;if(r===Uint8Array)g=new Uint8Array(g,p,a);else{var c=new ArrayBuffer(a);(new Uint8Array(c)).set(new Uint8Array(g,p,a));g=new r(c)}if(g.length===h*d)b.pixels.resultPixels=g;else{b.pixels.resultPixels=new r(h*d);var k=c=r=0,n=0;if(1<d)for(k=0;k<d;k++)for(n=k*h,c=0;c<h;c++)f[c]&&(b.pixels.resultPixels[n+
c]=g[r++]);else for(c=0;c<h;c++)f[c]&&(b.pixels.resultPixels[c]=g[r++])}b.ptr=p+a;return!0},readHuffmanTree:function(g,b){var r=this.HUFFMAN_LUT_BITS_MAX,p=new DataView(g,b.ptr,16);b.ptr+=16;if(2>p.getInt32(0,!0))throw"unsupported Huffman version";var a=p.getInt32(4,!0),d=p.getInt32(8,!0),p=p.getInt32(12,!0);if(d>=p)return!1;var h=new Uint32Array(p-d);v.decodeBits(g,b,h);var f=[],c,k,n;for(c=d;c<p;c++)k=c-(c<a?0:a),f[k]={first:h[c-d],second:null};c=g.byteLength-b.ptr;h=new ArrayBuffer(4*Math.ceil(c/
4));(new Uint8Array(h)).set(new Uint8Array(g,b.ptr,c));g=new Uint32Array(h);b=0;var e,h=0;e=g[0];for(c=d;c<p;c++)k=c-(c<a?0:a),n=f[k].first,0<n&&(f[k].second=e<<b>>>32-n,32-b>=n?(b+=n,32===b&&(b=0,h++,e=g[h])):(b+=n-32,h++,e=g[h],f[k].second|=e>>>32-b));var l=e=0,u=new t;for(c=0;c<f.length;c++)void 0!==f[c]&&(e=Math.max(e,f[c].first));var l=e>=r?r:e,r=[],m,q;for(c=d;c<p;c++)if(k=c-(c<a?0:a),n=f[k].first,0<n)if(d=[n,k],n<=l)for(k=f[k].second<<l-n,m=1<<l-n,n=0;n<m;n++)r[k|n]=d;else for(k=f[k].second,
m=u,--n;0<=n;n--)(q=k>>>n&1)?(m.right||(m.right=new t),m=m.right):(m.left||(m.left=new t),m=m.left),0!==n||m.val||(m.val=d[1]);return{decodeLut:r,numBitsLUTQick:l,numBitsLUT:e,tree:u,stuffedData:g,srcPtr:h,bitPos:b}},readHuffman:function(g,b,r){var p=b.headerInfo,a=p.numDims,d=b.headerInfo.height,h=b.headerInfo.width,f=h*d,c=this.readHuffmanTree(g,b);g=c.decodeLut;var k=c.tree,n=c.stuffedData,e=c.srcPtr,l=c.bitPos,u=c.numBitsLUTQick,c=c.numBitsLUT,m=0===b.headerInfo.imageType?128:0,q,C,B=b.pixels.resultMask,
t,y,w,x,z,A,E=0;0<l&&(e++,l=0);var F=n[e],v=1===b.encodeMode,N=new r(f*a),O=N,L;for(L=0;L<p.numDims;L++){1<a&&(O=new r(N.buffer,f*L,f),E=0);if(b.headerInfo.numValidPixel===h*d)for(w=z=0;w<d;w++)for(x=0;x<h;x++,z++){C=0;q=t=F<<l>>>32-u;32-l<u&&(q=t|=n[e+1]>>>64-l-u);if(g[q])C=g[q][1],l+=g[q][0];else for(q=t=F<<l>>>32-c,32-l<c&&(q=t|=n[e+1]>>>64-l-c),q=k,A=0;A<c;A++)if(q=(y=t>>>c-A-1&1)?q.right:q.left,!q.left&&!q.right){C=q.val;l=l+A+1;break}32<=l&&(l-=32,e++,F=n[e]);C-=m;v?(C=0<x?C+E:0<w?C+O[z-h]:
C+E,C&=255,E=O[z]=C):O[z]=C}else for(w=z=0;w<d;w++)for(x=0;x<h;x++,z++)if(B[z]){C=0;q=t=F<<l>>>32-u;32-l<u&&(q=t|=n[e+1]>>>64-l-u);if(g[q])C=g[q][1],l+=g[q][0];else for(q=t=F<<l>>>32-c,32-l<c&&(q=t|=n[e+1]>>>64-l-c),q=k,A=0;A<c;A++)if(q=(y=t>>>c-A-1&1)?q.right:q.left,!q.left&&!q.right){C=q.val;l=l+A+1;break}32<=l&&(l-=32,e++,F=n[e]);C-=m;v?(C=0<x&&B[z-1]?C+E:0<w&&B[z-h]?C+O[z-h]:C+E,C&=255,E=O[z]=C):O[z]=C}b.ptr=b.ptr+4*(e+1)+(0<l?4:0)}b.pixels.resultPixels=N},decodeBits:function(g,b,r,p,a){var d=
b.headerInfo,h=d.fileVersion,f=0,c=new DataView(g,b.ptr,5<=g.byteLength-b.ptr?5:g.byteLength-b.ptr),k=c.getUint8(0);f++;var n=k>>6,e=0===n?4:3-n,l=0<(k&32)?!0:!1,n=k&31,k=0;if(1===e)k=c.getUint8(f),f++;else if(2===e)k=c.getUint16(f,!0),f+=2;else if(4===e)k=c.getUint32(f,!0),f+=4;else throw"Invalid valid pixel count type";var e=2*d.maxZError,u,m;a=1<d.numDims?d.maxValues[a]:d.zMax;if(l){b.counter.lut++;l=c.getUint8(f);f++;d=Math.ceil((l-1)*n/8);u=Math.ceil(d/4);u=new ArrayBuffer(4*u);m=new Uint8Array(u);
b.ptr+=f;m.set(new Uint8Array(g,b.ptr,d));f=new Uint32Array(u);b.ptr+=d;for(c=0;l-1>>>c;)c++;d=Math.ceil(k*c/8);u=Math.ceil(d/4);u=new ArrayBuffer(4*u);m=new Uint8Array(u);m.set(new Uint8Array(g,b.ptr,d));g=new Uint32Array(u);b.ptr+=d;b=3<=h?D.unstuffLUT2(f,n,l-1,p,e,a):D.unstuffLUT(f,n,l-1,p,e,a);3<=h?D.unstuff2(g,r,c,k,b):D.unstuff(g,r,c,k,b)}else b.counter.bitstuffer++,c=n,b.ptr+=f,0<c&&(d=Math.ceil(k*c/8),u=Math.ceil(d/4),u=new ArrayBuffer(4*u),m=new Uint8Array(u),m.set(new Uint8Array(g,b.ptr,
d)),g=new Uint32Array(u),b.ptr+=d,3<=h?null==p?D.originalUnstuff2(g,r,c,k):D.unstuff2(g,r,c,k,!1,p,e,a):null==p?D.originalUnstuff(g,r,c,k):D.unstuff(g,r,c,k,!1,p,e,a))},readTiles:function(g,b,r){var p=b.headerInfo,a=p.width,d=p.height,h=p.microBlockSize,f=p.imageType,c=v.getDataTypeSize(f),k=Math.ceil(a/h),n=Math.ceil(d/h);b.pixels.numBlocksY=n;b.pixels.numBlocksX=k;for(var e=b.pixels.ptr=0,l=0,u=0,m=0,q=0,C=0,t=0,G=0,y=0,w=0,x=0,z=0,A=0,t=A=t=0,E,F=new r(h*h),M=d%h||h,N=a%h||h,O=p.numDims,L,H=b.pixels.resultMask,
I=b.pixels.resultPixels,R=5<=p.fileVersion?14:15,D=p.zMax,u=0;u<n;u++)for(q=u!==n-1?h:M,m=0;m<k;m++)for(C=m!==k-1?h:N,x=u*a*h+m*h,z=a-C,L=0;L<O;L++){1<O?(A=I,x=u*a*h+m*h,I=new r(b.pixels.resultPixels.buffer,a*d*L*c,a*d),D=p.maxValues[L]):A=null;t=g.byteLength-b.ptr;e=new DataView(g,b.ptr,Math.min(10,t));l={};t=0;G=e.getUint8(0);t++;E=5<=p.fileVersion?G&4:0;y=G>>6&255;w=G>>2&R;if(w!==(m*h>>3&R))throw"integrity issue";if(E&&0===L)throw"integrity issue";G&=3;if(3<G)throw b.ptr+=t,"Invalid block encoding ("+
G+")";if(2===G){if(E)if(H)for(e=0;e<q;e++)for(l=0;l<C;l++)H[x]&&(I[x]=A[x]),x++;else for(e=0;e<q;e++)for(l=0;l<C;l++)I[x]=A[x],x++;b.counter.constant++;b.ptr+=t}else if(0===G){if(E)throw"integrity issue";b.counter.uncompressed++;b.ptr+=t;A=q*C*c;t=g.byteLength-b.ptr;A=A<t?A:t;t=new ArrayBuffer(0===A%c?A:A+c-A%c);E=new Uint8Array(t);E.set(new Uint8Array(g,b.ptr,A));t=new r(t);A=0;if(H)for(e=0;e<q;e++){for(l=0;l<C;l++)H[x]&&(I[x]=t[A++]),x++;x+=z}else for(e=0;e<q;e++){for(l=0;l<C;l++)I[x++]=t[A++];
x+=z}b.ptr+=A*c}else if(y=v.getDataTypeUsed(E&&6>f?4:f,y),w=v.getOnePixel(l,t,y,e),t+=v.getDataTypeSize(y),3===G)if(b.ptr+=t,b.counter.constantoffset++,H)for(e=0;e<q;e++){for(l=0;l<C;l++)H[x]&&(I[x]=E?Math.min(D,A[x]+w):w),x++;x+=z}else for(e=0;e<q;e++){for(l=0;l<C;l++)I[x]=E?Math.min(D,A[x]+w):w,x++;x+=z}else if(b.ptr+=t,v.decodeBits(g,b,F,w,L),t=0,E)if(H)for(e=0;e<q;e++){for(l=0;l<C;l++)H[x]&&(I[x]=F[t++]+A[x]),x++;x+=z}else for(e=0;e<q;e++){for(l=0;l<C;l++)I[x]=F[t++]+A[x],x++;x+=z}else if(H)for(e=
0;e<q;e++){for(l=0;l<C;l++)H[x]&&(I[x]=F[t++]),x++;x+=z}else for(e=0;e<q;e++){for(l=0;l<C;l++)I[x++]=F[t++];x+=z}}},formatFileInfo:function(g){return{fileIdentifierString:g.headerInfo.fileIdentifierString,fileVersion:g.headerInfo.fileVersion,imageType:g.headerInfo.imageType,height:g.headerInfo.height,width:g.headerInfo.width,numValidPixel:g.headerInfo.numValidPixel,microBlockSize:g.headerInfo.microBlockSize,blobSize:g.headerInfo.blobSize,maxZError:g.headerInfo.maxZError,pixelType:v.getPixelType(g.headerInfo.imageType),
eofOffset:g.eofOffset,mask:g.mask?{numBytes:g.mask.numBytes}:null,pixels:{numBlocksX:g.pixels.numBlocksX,numBlocksY:g.pixels.numBlocksY,maxValue:g.headerInfo.zMax,minValue:g.headerInfo.zMin,noDataValue:g.noDataValue}}},constructConstantSurface:function(g){var b=g.headerInfo.zMax,r=g.headerInfo.numDims,p=g.headerInfo.height*g.headerInfo.width,a=0,d=0,h=0,f=g.pixels.resultMask,c=g.pixels.resultPixels;if(f)if(1<r)for(a=0;a<r;a++)for(h=a*p,b=g.headerInfo.maxValues[a],d=0;d<p;d++)f[d]&&(c[h+d]=b);else for(d=
0;d<p;d++)f[d]&&(c[d]=b);else if(1<r)for(a=0;a<r;a++)for(h=a*p,b=g.headerInfo.maxValues[a],d=0;d<p;d++)c[h+d]=b;else for(d=0;d<p;d++)c[d]=b},getDataTypeArray:function(g){switch(g){case 0:g=Int8Array;break;case 1:g=Uint8Array;break;case 2:g=Int16Array;break;case 3:g=Uint16Array;break;case 4:g=Int32Array;break;case 5:g=Uint32Array;break;case 6:g=Float32Array;break;case 7:g=Float64Array;break;default:g=Float32Array}return g},getPixelType:function(g){switch(g){case 0:g="S8";break;case 1:g="U8";break;
case 2:g="S16";break;case 3:g="U16";break;case 4:g="S32";break;case 5:g="U32";break;case 6:g="F32";break;case 7:g="F64";break;default:g="F32"}return g},isValidPixelValue:function(g,b){if(null==b)return!1;switch(g){case 0:g=-128<=b&&127>=b;break;case 1:g=0<=b&&255>=b;break;case 2:g=-32768<=b&&32767>=b;break;case 3:g=0<=b&&65536>=b;break;case 4:g=-2147483648<=b&&2147483647>=b;break;case 5:g=0<=b&&4294967296>=b;break;case 6:g=-3.4027999387901484E38<=b&&3.4027999387901484E38>=b;break;case 7:g=4.9E-324<=
b&&1.7976931348623157E308>=b;break;default:g=!1}return g},getDataTypeSize:function(g){var b=0;switch(g){case 0:case 1:b=1;break;case 2:case 3:b=2;break;case 4:case 5:case 6:b=4;break;case 7:b=8;break;default:b=g}return b},getDataTypeUsed:function(g,b){var r=g;switch(g){case 2:case 4:r=g-b;break;case 3:case 5:r=g-2*b;break;case 6:r=0===b?g:1===b?2:1;break;case 7:r=0===b?g:g-2*b+1;break;default:r=g}return r},getOnePixel:function(g,b,r,p){g=0;switch(r){case 0:g=p.getInt8(b);break;case 1:g=p.getUint8(b);
break;case 2:g=p.getInt16(b,!0);break;case 3:g=p.getUint16(b,!0);break;case 4:g=p.getInt32(b,!0);break;case 5:g=p.getUInt32(b,!0);break;case 6:g=p.getFloat32(b,!0);break;case 7:g=p.getFloat64(b,!0);break;default:throw"the decoder does not understand this pixel type";}return g}},t=function(g,b,r){this.val=g;this.left=b;this.right=r};return{decode:function(g,b){b=b||{};var r=b.noDataValue,p=0,a={};a.ptr=b.inputOffset||0;a.pixels={};if(v.readHeaderInfo(g,a)){var p=a.headerInfo,d=p.fileVersion,h=v.getDataTypeArray(p.imageType);
if(5<d)throw"unsupported lerc version 2."+d;v.readMask(g,a);p.numValidPixel===p.width*p.height||a.pixels.resultMask||(a.pixels.resultMask=b.maskData);var f=p.width*p.height;a.pixels.resultPixels=new h(f*p.numDims);a.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0};if(0!==p.numValidPixel)if(p.zMax===p.zMin)v.constructConstantSurface(a);else if(4<=d&&v.checkMinMaxRanges(g,a))v.constructConstantSurface(a);else{var c=new DataView(g,a.ptr,2),k=c.getUint8(0);a.ptr++;if(k)v.readDataOneSweep(g,
a,h);else if(1<d&&1>=p.imageType&&1E-5>Math.abs(p.maxZError-.5)){c=c.getUint8(1);a.ptr++;a.encodeMode=c;if(2<c||4>d&&1<c)throw"Invalid Huffman flag "+c;c?v.readHuffman(g,a,h):v.readTiles(g,a,h)}else v.readTiles(g,a,h)}a.eofOffset=a.ptr;b.inputOffset?(g=a.headerInfo.blobSize+b.inputOffset-a.ptr,1<=Math.abs(g)&&(a.eofOffset=b.inputOffset+a.headerInfo.blobSize)):(g=a.headerInfo.blobSize-a.ptr,1<=Math.abs(g)&&(a.eofOffset=a.headerInfo.blobSize));g={width:p.width,height:p.height,pixelData:a.pixels.resultPixels,
minValue:p.zMin,maxValue:p.zMax,validPixelCount:p.numValidPixel,dimCount:p.numDims,dimStats:{minValues:p.minValues,maxValues:p.maxValues},maskData:a.pixels.resultMask};if(a.pixels.resultMask&&v.isValidPixelValue(p.imageType,r)){d=a.pixels.resultMask;for(p=0;p<f;p++)d[p]||(g.pixelData[p]=r);g.noDataValue=r}a.noDataValue=r;b.returnFileInfo&&(g.fileInfo=v.formatFileInfo(a));return g}},getBandCount:function(g){for(var b=0,r=0,p={ptr:0,pixels:{}};r<g.byteLength-58;)v.readHeaderInfo(g,p),r+=p.headerInfo.blobSize,
b++,p.ptr=r;return b}}})},"esri/layers/support/rasterFormats/LercCodec":function(){define(["../../../core/mathUtils"],function(D){var v={};v.defaultNoDataValue=D.clampFloat32(-Infinity);v.decode=function(g,b){var r;b=b||{};var p=b.inputOffset||0,a=b.encodedMaskData||null===b.encodedMaskData,d={},h=new Uint8Array(g,p,10);d.fileIdentifierString=String.fromCharCode.apply(null,h);if("CntZImage"!=d.fileIdentifierString.trim())throw"Unexpected file identifier string: "+d.fileIdentifierString;p+=10;h=new DataView(g,
p,24);d.fileVersion=h.getInt32(0,!0);d.imageType=h.getInt32(4,!0);d.height=h.getUint32(8,!0);d.width=h.getUint32(12,!0);d.maxZError=h.getFloat64(16,!0);p+=24;if(!a)if(h=new DataView(g,p,16),d.mask={},d.mask.numBlocksY=h.getUint32(0,!0),d.mask.numBlocksX=h.getUint32(4,!0),d.mask.numBytes=h.getUint32(8,!0),d.mask.maxValue=h.getFloat32(12,!0),p+=16,0<d.mask.numBytes){var a=new Uint8Array(Math.ceil(d.width*d.height/8)),h=new DataView(g,p,d.mask.numBytes),f=h.getInt16(0,!0),c=2,k=0;do{if(0<f)for(;f--;)a[k++]=
h.getUint8(c++);else for(var n=h.getUint8(c++),f=-f;f--;)a[k++]=n;f=h.getInt16(c,!0);c+=2}while(c<d.mask.numBytes);if(-32768!==f||k<a.length)throw"Unexpected end of mask RLE encoding";d.mask.bitset=a;p+=d.mask.numBytes}else 0===(d.mask.numBytes|d.mask.numBlocksY|d.mask.maxValue)&&(a=new Uint8Array(Math.ceil(d.width*d.height/8)),d.mask.bitset=a);h=new DataView(g,p,16);d.pixels={};d.pixels.numBlocksY=h.getUint32(0,!0);d.pixels.numBlocksX=h.getUint32(4,!0);d.pixels.numBytes=h.getUint32(8,!0);d.pixels.maxValue=
h.getFloat32(12,!0);p+=16;a=d.pixels.numBlocksX;h=d.pixels.numBlocksY;a+=0<d.width%a?1:0;f=h+(0<d.height%h?1:0);d.pixels.blocks=Array(a*f);c=1E9;for(n=k=0;n<f;n++)for(var e=0;e<a;e++){var l=0,h=new DataView(g,p,Math.min(10,g.byteLength-p)),u={};d.pixels.blocks[k++]=u;var m=h.getUint8(0);l++;u.encoding=m&63;if(3<u.encoding)throw"Invalid block encoding ("+u.encoding+")";if(2===u.encoding)p++,c=Math.min(c,0);else{if(0!==m&&2!==m){m>>=6;u.offsetType=m;if(2===m)u.offset=h.getInt8(1),l++;else if(1===m)u.offset=
h.getInt16(1,!0),l+=2;else if(0===m)u.offset=h.getFloat32(1,!0),l+=4;else throw"Invalid block offset type";c=Math.min(u.offset,c);if(1===u.encoding)if(m=h.getUint8(l),l++,u.bitsPerPixel=m&63,m>>=6,u.numValidPixelsType=m,2===m)u.numValidPixels=h.getUint8(l),l++;else if(1===m)u.numValidPixels=h.getUint16(l,!0),l+=2;else if(0===m)u.numValidPixels=h.getUint32(l,!0),l+=4;else throw"Invalid valid pixel count type";}p+=l;if(3!=u.encoding)if(0===u.encoding){h=(d.pixels.numBytes-1)/4;if(h!==Math.floor(h))throw"uncompressed block has invalid length";
l=new ArrayBuffer(4*h);m=new Uint8Array(l);m.set(new Uint8Array(g,p,4*h));l=new Float32Array(l);for(m=0;m<l.length;m++)c=Math.min(c,l[m]);u.rawData=l;p+=4*h}else 1===u.encoding&&(h=Math.ceil(u.numValidPixels*u.bitsPerPixel/8),l=new ArrayBuffer(4*Math.ceil(h/4)),m=new Uint8Array(l),m.set(new Uint8Array(g,p,h)),u.stuffedData=new Uint32Array(l),p+=h)}}d.pixels.minValue=c;d.eofOffset=p;g=null!=b.noDataValue?D.clampFloat32(b.noDataValue):v.defaultNoDataValue;var a=b.encodedMaskData,u=b.returnMask,h=0,
f=d.pixels.numBlocksX,c=d.pixels.numBlocksY,k=Math.floor(d.width/f),n=Math.floor(d.height/c),e=2*d.maxZError,a=a||(d.mask?d.mask.bitset:null),q,p=new (b.pixelType||Float32Array)(d.width*d.height);u&&a&&(q=new Uint8Array(d.width*d.height));for(var u=new Float32Array(k*n),C,B,l=0;l<=c;l++)if(m=l!==c?n:d.height%c,0!==m)for(var G=0;G<=f;G++){var y=G!==f?k:d.width%f;if(0!==y){var w=l*d.width*n+G*k,x=d.width-y,z=d.pixels.blocks[h],A,E;if(2>z.encoding){if(0===z.encoding)A=z.rawData;else{A=z.stuffedData;
E=z.bitsPerPixel;C=z.numValidPixels;B=z.offset;var F=e,M=u,N=d.pixels.maxValue,O=(1<<E)-1,L=0,H=void 0,I=0,R=void 0,Q=void 0,S=Math.ceil((N-B)/F);A[A.length-1]<<=8*(4*A.length-Math.ceil(E*C/8));for(H=0;H<C;H++)0===I&&(Q=A[L++],I=32),I>=E?(R=Q>>>I-E&O,I-=E):(I=E-I,R=(Q&O)<<I&O,Q=A[L++],I=32-I,R+=Q>>>I),M[H]=R<S?B+R*F:N;A=u}E=0}else r=2===z.encoding?0:z.offset;var T;if(a)for(B=0;B<m;B++){w&7&&(T=a[w>>3],T<<=w&7);for(C=0;C<y;C++)w&7||(T=a[w>>3]),T&128?(q&&(q[w]=1),p[w++]=2>z.encoding?A[E++]:r):(q&&(q[w]=
0),p[w++]=g),T<<=1;w+=x}else if(2>z.encoding)for(B=0;B<m;B++){for(C=0;C<y;C++)p[w++]=A[E++];w+=x}else for(B=0;B<m;B++)if(p.fill)p.fill(r,w,w+y),w+=y+x;else{for(C=0;C<y;C++)p[w++]=r;w+=x}if(1===z.encoding&&E!==z.numValidPixels)throw"Block and Mask do not match";h++}}r=q;q={width:d.width,height:d.height,pixelData:p,minValue:d.pixels.minValue,maxValue:d.pixels.maxValue,noDataValue:g};r&&(q.maskData=r);b.returnEncodedMask&&d.mask&&(q.encodedMaskData=d.mask.bitset?d.mask.bitset:null);if(b.returnFileInfo&&
(q.fileInfo=t(d),b.computeUsedBitDepths)){b=q.fileInfo;r=d.pixels.numBlocksX*d.pixels.numBlocksY;T={};for(A=0;A<r;A++)E=d.pixels.blocks[A],0===E.encoding?T.float32=!0:1===E.encoding?T[E.bitsPerPixel]=!0:T[0]=!0;d=Object.keys(T);b.bitDepths=d}return q};var t=function(g){return{fileIdentifierString:g.fileIdentifierString,fileVersion:g.fileVersion,imageType:g.imageType,height:g.height,width:g.width,maxZError:g.maxZError,eofOffset:g.eofOffset,mask:g.mask?{numBlocksX:g.mask.numBlocksX,numBlocksY:g.mask.numBlocksY,
numBytes:g.mask.numBytes,maxValue:g.mask.maxValue}:null,pixels:{numBlocksX:g.pixels.numBlocksX,numBlocksY:g.pixels.numBlocksY,numBytes:g.pixels.numBytes,maxValue:g.pixels.maxValue,minValue:g.pixels.minValue,noDataValue:this.noDataValue}}};return v})},"esri/layers/support/rasterFormats/Png":function(){define(["./Zlib"],function(D){return function(v){function t(b){var a,d,h,f;this.data=b;this.pos=8;this.palette=[];this.imgData=[];this.transparency={};this.animation=null;this.text={};for(h=null;;){a=
this.readUInt32();f=b=void 0;f=[];for(b=0;4>b;++b)f.push(String.fromCharCode(this.data[this.pos++]));b=f.join("");switch(b){case "IHDR":this.width=this.readUInt32();this.height=this.readUInt32();this.bits=this.data[this.pos++];this.colorType=this.data[this.pos++];this.compressionMethod=this.data[this.pos++];this.filterMethod=this.data[this.pos++];this.interlaceMethod=this.data[this.pos++];break;case "acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||Infinity,frames:[]};
break;case "PLTE":this.palette=this.read(a);break;case "fcTL":h&&this.animation.frames.push(h);this.pos+=4;h={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()};b=this.readUInt16();a=this.readUInt16()||100;h.delay=1E3*b/a;h.disposeOp=this.data[this.pos++];h.blendOp=this.data[this.pos++];h.data=[];break;case "IDAT":case "fdAT":"fdAT"===b&&(this.pos+=4,a-=4);b=(null!=h?h.data:void 0)||this.imgData;for(f=0;0<=a?f<a:f>a;0<=a?++f:--f)b.push(this.data[this.pos++]);
break;case "tRNS":this.transparency={};switch(this.colorType){case 3:this.transparency.indexed=this.read(a);a=255-this.transparency.indexed.length;if(0<a)for(b=0;0<=a?b<a:b>a;0<=a?++b:--b)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(a)[0];break;case 2:this.transparency.rgb=this.read(a)}break;case "tEXt":f=this.read(a);a=f.indexOf(0);b=String.fromCharCode.apply(String,f.slice(0,a));this.text[b]=String.fromCharCode.apply(String,f.slice(a+1));break;case "IEND":h&&
this.animation.frames.push(h);a:{switch(this.colorType){case 0:case 3:case 4:h=1;break a;case 2:case 6:h=3;break a}h=void 0}this.colors=h;this.hasAlphaChannel=4===(d=this.colorType)||6===d;d=this.colors+(this.hasAlphaChannel?1:0);this.pixelBitlength=this.bits*d;a:{switch(this.colors){case 1:d="DeviceGray";break a;case 3:d="DeviceRGB";break a}d=void 0}this.colorSpace=d;this.imgData=new Uint8Array(this.imgData);return;default:this.pos+=a}this.pos+=4;if(this.pos>this.data.length)throw Error("Incomplete or corrupt PNG file");
}}var g,b,r;t.load=function(b,a,d){var h;"function"===typeof a&&(d=a);h=new XMLHttpRequest;h.open("GET",b,!0);h.responseType="arraybuffer";h.onload=function(){var b;b=new Uint8Array(h.response||h.mozResponseArrayBuffer);b=new t(b);"function"===typeof(null!=a?a.getContext:void 0)&&b.render(a);return"function"===typeof d?d(b):void 0};return h.send(null)};t.prototype.read=function(b){var a,d;d=[];for(a=0;0<=b?a<b:a>b;0<=b?++a:--a)d.push(this.data[this.pos++]);return d};t.prototype.readUInt32=function(){var b,
a,d,h;b=this.data[this.pos++]<<24;a=this.data[this.pos++]<<16;d=this.data[this.pos++]<<8;h=this.data[this.pos++];return b|a|d|h};t.prototype.readUInt16=function(){var b,a;b=this.data[this.pos++]<<8;a=this.data[this.pos++];return b|a};t.prototype.decodePixels=function(b){var a,d,h,f,c,k,g,e,l,p,m,q,r,t,G;null==b&&(b=this.imgData);if(0===b.length)return new Uint8Array(0);b=new D(b);b=b.getBytes();e=this.pixelBitlength/8;q=e*this.width;l=new Uint8Array(q*this.height);k=b.length;for(d=p=m=0;p<k;){switch(b[p++]){case 0:for(f=
a=0;a<q;f=a+=1)l[d++]=b[p++];break;case 1:for(f=r=0;r<q;f=r+=1)a=b[p++],c=f<e?0:l[d-e],l[d++]=(a+c)%256;break;case 2:for(f=c=0;c<q;f=c+=1)a=b[p++],h=(f-f%e)/e,r=m&&l[(m-1)*q+h*e+f%e],l[d++]=(r+a)%256;break;case 3:for(f=G=0;G<q;f=G+=1)a=b[p++],h=(f-f%e)/e,c=f<e?0:l[d-e],r=m&&l[(m-1)*q+h*e+f%e],l[d++]=(a+Math.floor((c+r)/2))%256;break;case 4:for(f=G=0;G<q;f=G+=1)a=b[p++],h=(f-f%e)/e,c=f<e?0:l[d-e],0===m?r=t=0:(r=l[(m-1)*q+h*e+f%e],t=h&&l[(m-1)*q+(h-1)*e+f%e]),g=c+r-t,f=Math.abs(g-c),h=Math.abs(g-r),
g=Math.abs(g-t),c=f<=h&&f<=g?c:h<=g?r:t,l[d++]=(a+c)%256;break;default:throw Error("Invalid filter algorithm: "+b[p-1]);}m++}return l};t.prototype.decodePalette=function(){var b,a,d,h,f,c,k,g,e;d=this.palette;c=this.transparency.indexed||[];f=new Uint8Array((c.length||0)+d.length);a=k=b=h=0;for(g=d.length;k<g;a=k+=3)f[h++]=d[a],f[h++]=d[a+1],f[h++]=d[a+2],f[h++]=null!=(e=c[b++])?e:255;return f};t.prototype.copyToImageData=function(b,a){var d,h,f,c,k,g,e;h=this.colors;e=null;d=this.hasAlphaChannel;
this.palette.length&&(e=null!=(f=this._decodedPalette)?f:this._decodedPalette=this.decodePalette(),h=4,d=!0);b=b.data||b;g=b.length;c=e||a;f=k=0;if(1===h)for(;f<g;)h=e?4*a[f/4]:k,k=c[h++],b[f++]=k,b[f++]=k,b[f++]=k,b[f++]=d?c[h++]:this.transparency.grayscale&&this.transparency.grayscale===k?0:255,k=h;else for(;f<g;)h=e?4*a[f/4]:k,b[f++]=c[h++],b[f++]=c[h++],b[f++]=c[h++],b[f++]=d?c[h++]:this.transparency.rgb&&this.transparency.rgb[1]===c[h-3]&&this.transparency.rgb[3]===c[h-2]&&this.transparency.rgb[5]===
c[h-1]?0:255,k=h};t.prototype.decode=function(){var b;b=new Uint8Array(this.width*this.height*4);this.copyToImageData(b,this.decodePixels());return b};r=(b=v.document&&v.document.createElement("canvas"))&&b.getContext("2d");g=function(g){r.width=g.width;r.height=g.height;r.clearRect(0,0,g.width,g.height);r.putImageData(g,0,0);g=new Image;g.src=b.toDataURL();return g};t.prototype.decodeFrames=function(b){var a,d,h,f,c,k,p;if(this.animation){k=this.animation.frames;p=[];a=f=0;for(c=k.length;f<c;a=++f)a=
k[a],d=b.createImageData(a.width,a.height),h=this.decodePixels(new Uint8Array(a.data)),this.copyToImageData(d,h),a.imageData=d,p.push(a.image=g(d));return p}};t.prototype.renderFrame=function(b,a){var d,h;h=this.animation.frames;d=h[a];h=h[a-1];0===a&&b.clearRect(0,0,this.width,this.height);1===(null!=h?h.disposeOp:void 0)?b.clearRect(h.xOffset,h.yOffset,h.width,h.height):2===(null!=h?h.disposeOp:void 0)&&b.putImageData(h.imageData,h.xOffset,h.yOffset);0===d.blendOp&&b.clearRect(d.xOffset,d.yOffset,
d.width,d.height);return b.drawImage(d.image,d.xOffset,d.yOffset)};t.prototype.animate=function(b){var a,d,h,f,c,k,g=this;d=0;k=this.animation;f=k.numFrames;h=k.frames;c=k.numPlays;return(a=function(){var e,k;e=d++%f;k=h[e];g.renderFrame(b,e);if(1<f&&d/f<c)return g.animation._timeout=setTimeout(a,k.delay)})()};t.prototype.stopAnimation=function(){var b;return clearTimeout(null!=(b=this.animation)?b._timeout:void 0)};t.prototype.render=function(b){var a;b._png&&b._png.stopAnimation();b._png=this;b.width=
this.width;b.height=this.height;b=b.getContext("2d");if(this.animation)return this.decodeFrames(b),this.animate(b);a=b.createImageData(this.width,this.height);this.copyToImageData(a,this.decodePixels());return b.putImageData(a,0,0)};return t}(this)})},"esri/layers/support/rasterFormats/Raw":function(){define(["require","exports"],function(D,v){var t=function(g){var b=1;switch(g){case Uint8Array:case Int8Array:b=1;break;case Uint16Array:case Int16Array:b=2;break;case Uint32Array:case Int32Array:case Float32Array:b=
4;break;case Float64Array:b=8}return b};return function(){function g(){}g.decode=function(b,g){var p=g.pixelType,a=[],d=g.width*g.height,h=Math.floor(b.byteLength/(g.width*g.height*t(g.pixelType))),f=g.bandIds,c=g.format;g=f&&f.length||Math.floor(b.byteLength/(g.width*g.height*t(g.pixelType)));var k=b.byteLength-b.byteLength%(d*t(p)),n=new p(b,0,d*h),e,l,r,m;if("bip"===c)for(c=0;c<g;c++){r=new p(d);m=f?f[c]:c;for(e=0;e<d;e++)r[e]=n[e*h+m];a.push(r)}else if("bsq"===c)for(c=0;c<g;c++)m=f?f[c]:c,a.push(n.subarray(m*
d,(m+1)*d));if(k<b.byteLength-1)if(b=b.slice(k),8*b.byteLength<d)l=null;else{b=new Uint8Array(b,0,Math.ceil(d/8));p=new Uint8Array(d);for(l=g=l=f=h=0;l<b.length-1;l++)for(f=b[l],g=7;0<=g;g--)p[h++]=f>>g&1;for(g=7;h<d-1;)f=b[b.length-1],p[h++]=f>>g&1,g--;l=p}return{pixels:a,mask:l}};return g}()})},"esri/layers/support/rasterFormats/TiffDecoder":function(){define("require exports ../../../core/tsSupport/assignHelper ../rasterDatasets/byteStreamUtils ./Jpg ./TiffTags ./Zlib".split(" "),function(D,v,
t,g,b,r,p){function a(a,b){var c="unknown";3===a?c="f32":1===a?1===b?c="u1":2===b?c="u2":4===b?c="u4":8>=b?c="u8":16>=b?c="u16":32>=b&&(c="u32"):2===a&&(8>=b?c="s8":16>=b?c="s16":32>=b&&(c="s32"));return c}function d(a){var b=null;switch(a?a.toLowerCase():"f32"){case "u1":case "u2":case "u4":case "u8":b=Uint8Array;break;case "u16":b=Uint16Array;break;case "u32":b=Uint32Array;break;case "s8":b=Int8Array;break;case "s16":b=Int16Array;break;case "s32":b=Int32Array;break;default:b=Float32Array}return b}
function h(a,b){return{x:b[0]*a.x+b[1]*a.y+b[2],y:b[3]*a.x+b[4]*a.y+b[5]}}function f(a,b){return(a=a.get(b))&&a.values}function c(a,b){return(a=a.get(b))&&a.values[0]}function k(a,b,c,d,f,e){void 0===d&&(d=0);void 0===f&&(f=r.TIFF_TAGS);void 0===e&&(e=4);var h=(new DataView(a,c,2)).getUint16(0,b),g=4+2*e,k=2+h*g;if(c+k>a.byteLength)return{success:!1,ifd:null,nextIFD:null,requiredBufferSize:k};var m=c+k+4<=a.byteLength?(new DataView(a,c+k,4)).getUint32(0,b):null;c+=2;for(var l=new Map,q,p,w,x,u,y,
t=0;t<h;t++){q=new DataView(a,c+g*t,g);p=q.getUint16(0,b);x=q.getUint16(2,b);w=r.getTagName(p,f);if(2===e)u=q.getUint16(4,b),y=q.getUint16(6,b);else if(4===e)u=q.getUint32(4,b),y=q.getUint32(8,b);else if(8===e)if(y=u=0,b)for(var C=0;8>C;C++)u+=q.getUint8(4+C)*Math.pow(2,8*C),y+=q.getUint8(12+C)*Math.pow(2,8*C);else for(C=0;8>C;C++)u+=q.getUint8(4+C)*Math.pow(2,8*(7-C)),y+=q.getUint8(12+C)*Math.pow(2,8*(7-C));q={id:p,type:x,valueCount:u,valueOffset:y,values:null};n(a,b,q,d);l.set(w,q)}return{success:!0,
ifd:l,nextIFD:m,requiredBufferSize:k}}function n(a,b,c,d,f){void 0===d&&(d=0);if(c.values)return!0;var e=c.type,h=c.valueCount,g=c.valueOffset,k=[],m=q[e],l=8*m,p=h*m,n=h*q[e]*8;if(32<n&&p>(f?a.byteLength:a?a.byteLength-g+d:0))return c.offlineOffsetSize=[g,p],c.values=null,!1;if(32>=n)if(b||(g>>>=32-n),1===h)k=[g];else for(a=0;a<h;a++)k.push(g<<l*a>>>32-l);else for(g-=d,f&&(g=0),l=g;l<g+p;l+=m){switch(e){case 1:h=(new DataView(a,l,1)).getUint8(0);break;case 2:h=(new DataView(a,l,1)).getUint8(0);break;
case 3:h=(new DataView(a,l,2)).getUint16(0,b);break;case 4:h=(new DataView(a,l,4)).getUint32(0,b);break;case 5:h=(new DataView(a,l,4)).getUint32(0,b)/(new DataView(a,l+4,4)).getUint32(0,b);break;case 6:h=(new DataView(a,l,1)).getInt8(0);break;case 7:h=(new DataView(a,l,1)).getUint8(0);break;case 8:h=(new DataView(a,l,2)).getInt16(0,b);break;case 9:h=(new DataView(a,l,4)).getInt32(0,b);break;case 10:h=(new DataView(a,l,4)).getInt32(0,b)/(new DataView(a,l+4,4)).getInt32(0,b);break;case 11:h=(new DataView(a,
l,4)).getFloat32(0,b);break;case 12:h=(new DataView(a,l,8)).getFloat64(0,b);break;default:h=null}k.push(h)}if(2===e){e="";g=k;k=[];for(a=0;a<g.length;a++)0===g[a]&&""!==e?(k.push(e),e=""):e+=String.fromCharCode(g[a]);""===e&&0!==k.length||k.push(e)}c.values=k;return!0}function e(b){var d=b[0],e=c(d,"TILEWIDTH"),g=c(d,"TILELENGTH"),k=c(d,"IMAGEWIDTH"),m=c(d,"IMAGELENGTH"),l=c(d,"BITSPERSAMPLE"),q=c(d,"SAMPLESPERPIXEL"),p=c(d,"SAMPLEFORMAT")||1,n=a(p,l),r=f(d,"PLANARCONFIGURATION")?2===f(d,"PLANARCONFIGURATION")[0]:
!1,u=f(d,"GDAL_NODATA"),C;null!=u&&("string"===typeof u[0]?(C=u.map(function(a){return parseFloat(a)}),C.some(function(a){return isNaN(a)})&&(C=null)):"number"===typeof u[0]&&(C=u));var t=c(d,"COMPRESSION")||1;switch(t){case 1:u="NONE";break;case 2:case 3:case 4:case 32771:u="CCITT";break;case 5:u="LZW";break;case 6:case 7:u="JPEG";break;case 32773:u="PACKBITS";break;case 8:case 32946:u="DEFLATE";break;case 34712:u="JPEG2000";break;default:u=String(t)}var y=!0,B="";1!==t&&6!==t&&8!==t&&32946!==t&&
(y=!1,B+="unsupported tag compression "+t);3<p&&(y=!1,B+="unsupported tag sampleFormat "+p);0!==l%8&&(y=!1,B+="unsupported tag bitsPerSample "+l);var l=c(d,"GEOASCIIPARAMS"),v;l&&(v=(v=l.split("|").filter(function(a){return-1<a.indexOf("ESRI PE String \x3d ")})[0])?v.replace("ESRI PE String \x3d ",""):"",v=0===v.indexOf("PROJCS")||0===v.indexOf("GEOGCS")?{wkid:null,wkt:v}:null);var l=f(d,"GEOTIEPOINTS"),p=f(d,"GEOPIXELSCALE"),t=f(d,"GEOTRANSMATRIX"),D=d.has("GEOKEYDIRECTORY")?d.get("GEOKEYDIRECTORY").data:
null,d=!1;if(D){var d=2===c(D,"GTRasterTypeGeoKey"),P=c(D,"GTModelTypeGeoKey");2===P?(D=c(D,"GeographicTypeGeoKey"),1024<D&&32766>D&&(v={wkid:D})):1===P&&(D=c(D,"ProjectedCSTypeGeoKey"),1024<D&&32766>D&&(v={wkid:D}))}var J,X;p&&l&&6<=l.length?(J=[p[0],0,l[3]-l[0]*p[0],0,-Math.abs(p[1]),l[4]-l[1]*p[1]],d&&(J[2]-=.5*J[0]+.5*J[1],J[5]-=.5*J[3]+.5*J[4])):t&&16===t.length&&(J=[t[0],t[1],t[3],t[4],t[5],t[7]]);if(J){X=[{x:0,y:m},{x:0,y:0},{x:k,y:m},{x:k,y:0}];d=void 0;p=l=Number.POSITIVE_INFINITY;D=t=Number.NEGATIVE_INFINITY;
for(P=0;P<X.length;P++)d=h(X[P],J),l=d.x>l?l:d.x,t=d.x<t?t:d.x,p=d.y>p?p:d.y,D=d.y<D?D:d.y;X={xmin:l,xmax:t,ymin:p,ymax:D,spatialReference:v}}J=b.filter(function(a){return 1===c(a,"NEWSUBFILETYPE")});var K,U,Y,Z;0<J.length&&(K=Math.round(Math.log(k/c(J[0],"IMAGEWIDTH"))/Math.LN2),U=Math.round(Math.log(k/c(J[J.length-1],"IMAGEWIDTH"))/Math.LN2),Y=c(J[J.length-1],"TILEWIDTH"),Z=c(J[J.length-1],"TILEHEIGHT"));Y=0<U?Y||e:null;Z=0<U?Z||g:null;var W;e&&(W=[{maxCol:Math.ceil(k/e)-1,maxRow:Math.ceil(m/g)-
1,minRow:0,minCol:0}],J.forEach(function(a){W.push({maxCol:Math.ceil(c(a,"IMAGEWIDTH")/c(a,"TILEWIDTH"))-1,maxRow:Math.ceil(c(a,"IMAGELENGTH")/c(a,"TILELENGTH"))-1,minRow:0,minCol:0})}));b=c(b[0],"GDAL_METADATA");b=G(b);return{width:k,height:m,tileWidth:e,tileHeight:g,planes:q,isBSQ:r,pixelType:n,compression:u,noData:C,isSupported:y,message:B,extent:X,firstPyramidLevel:K,maximumPyramidLevel:U,pyramidBlockWidth:Y,pyramidBlockHeight:Z,tileBoundary:W,metadata:b}}function l(a){var b=new DataView(a,0,
8),c=b.getUint16(0,!1),d=null;if(18761===c)d=!0;else if(19789===c)d=!1;else throw"unexpected endianess byte";if(42!==b.getUint16(2,d))throw"unexpected tiff identifier";c=b.getUint32(4,d);b=[];do if(c=u(a,d,c),c.success)b.push(c.ifd),c=c.nextIFD;else break;while(0<c);a=e(b);return t({},a,{littleEndian:d,ifds:b})}function u(a,b,c,d,f,e){void 0===d&&(d=0);void 0===f&&(f=r.TIFF_TAGS);void 0===e&&(e=4);c=k(a,b,c,d,f,e);var h,m=c.ifd;m&&(r.ifdTags.forEach(function(c,f){m.has(f)&&(h=m.get(f),h.data=k(a,
b,h.valueOffset-d,d,c).ifd)}),m.has("GEOKEYDIRECTORY")&&(h=m.get("GEOKEYDIRECTORY"),(f=h.values)&&4<f.length&&(f=f[0]+"."+f[1]+"."+f[2],h.data=k(a,b,h.valueOffset+6-d,d,r.GEO_KEYS,2).ifd,h.data&&h.data.set("GEOTIFFVersion",{id:0,type:2,valueCount:1,valueOffset:null,values:[f]}))),m.has("XMP")&&(h=m.get("XMP"),f=h.values,"number"===typeof f[0]&&7===h.type&&(h.values=[g.bytesToUTF8(new Uint8Array(f))])));return c}Object.defineProperty(v,"__esModule",{value:!0});var m=function(){var a=new ArrayBuffer(4),
b=new Uint8Array(a);(new Uint32Array(a))[0]=1;return 1===b[0]}(),q=[0,1,1,2,4,8,1,1,2,4,8,4,8],C=function(f,e,h,g,k){e=m===e;var l=c(h,"BITSPERSAMPLE"),q=c(h,"SAMPLEFORMAT")||1,l=a(q,l),q=c(h,"COMPRESSION")[0]||1;h=d(l);var n,u;1===q?(n=f.slice(g,g+k),u=new Uint8Array(n)):8===q||32946===q?(u=new Uint8Array(f,g,k),u=new p(u),f=u.getBytes(),n=new ArrayBuffer(f.length),u=new Uint8Array(n),u.set(f)):6===q&&(u=new Uint8Array(f,g,k),n=new b,n.parse(u),f=n.getData(n.width,n.height,!0),n=new ArrayBuffer(f.length),
u=new Uint8Array(n),u.set(f));if("u8"!==l&&"s8"!==l&&!e)switch(n=new ArrayBuffer(u.length),e=new Uint8Array(n),l){case "u16":case "s16":for(l=0;l<u.length;l+=2)e[l]=u[l+1],e[l+1]=u[l];break;case "u32":case "s32":case "f32":for(l=0;l<u.length;l+=4)e[l]=u[l+3],e[l+1]=u[l+2],e[l+2]=u[l+1],e[l+3]=u[l]}return new h(n)},B=function(a,b,c){if(!(a&&0<a.length&&b&&c))return null;for(var d,f,e,h=a[0].length,g=a.length,k=new Uint8Array(h),m=0;m<g;m++)if(d=a[m],f=b[m],e=c[m],0===m)for(var l=0;l<h;l++)k[l]=d[l]<
f||d[l]>e?0:1;else for(l=0;l<h;l++)k[l]&&(k[l]=d[l]<f||d[l]>e?0:1);return k},G=function(a){if(!a)return null;var b=a.match(/<Item(.*?)Item>/gi);if(!b||0===b.length)return null;a=new Map;for(var c,d,f,e,h=0;h<b.length;h++)c=b[h],d=c.slice(6,c.indexOf("\x3e")),f=c.indexOf("sample\x3d"),-1<f&&(e=c.slice(f+8,c.indexOf('"',f+8))),f=c.indexOf("name\x3d"),-1<f&&(d=c.slice(f+6,c.indexOf('"',f+6))),d&&(c=c.slice(c.indexOf("\x3e")+1,c.indexOf("\x3c/Item\x3e")).trim(),null!=e?a.has(d)?a.get(d)[e]=c:a.set(d,
[c]):a.set(d,c)),e=null;b=a.get("STATISTICS_MINIMUM");d=a.get("STATISTICS_MAXIMUM");c=a.get("STATISTICS_MEAN");f=a.get("STATISTICS_STDDEV");e=null;if(b&&d)for(e=[],h=0;h<b.length;h++)e.push({min:parseFloat(b[h]),max:parseFloat(d[h]),avg:c&&parseFloat(c[h]),stddev:f&&parseFloat(f[h])});d=a.get("BandName");c=a.get("WavelengthMin");f=a.get("WavelengthMax");b=null;if(d)for(b=[],h=0;h<d.length;h++)b.push({BandName:d[h],WavelengthMin:c&&parseFloat(c[h]),WavelengthMax:f&&parseFloat(f[h])});h=a.get("DataType");
return{statistics:e,bandProperties:b,dataType:h,rawMetadata:a}};v.parseFieldValues=n;v.getImageInfo=e;v.parseHeader=l;v.parseSignature=function(a){var b=new DataView(a,0,8),c=b.getUint16(0,!1);a=null;if(18761===c)a=!0;else if(19789===c)a=!1;else throw"unexpected endianess byte";if(42!==b.getUint16(2,a))throw"unexpected tiff identifier";b=b.getUint32(4,a);return{littleEndian:a,firstIFD:b}};v.parseIFD=u;v.decodeTileOrStrip=function(a,b){var f=b.headerInfo,e=b.ifd,h=C(a,f.littleEndian,e,b.offset||0,
b.size||a.byteLength);a=f.pixelType;for(var g=f.isBSQ,k=f.planes,m=d(a),l=h.length/k,q,p=[],n=0;n<k;n++){q=new m(l);if(g)q=h.slice(l*n,l*(n+1));else for(var u=0;u<l;u++)q[u]=h[u*k+n];p.push(q)}var h=c(e,"TILEWIDTH"),e=c(e,"TILELENGTH"),g=f.noData?f.noData[0]:null,f=(k=f.metadata?f.metadata.statistics:null)?k.map(function(a){return a.min}):null,k=k?k.map(function(a){return a.max}):null,r;if(null!=g)if(r=new Uint8Array(l),1E24<Math.abs(g))for(b=0;b<l;b++)r[b]=1E-6>Math.abs((p[0][b]-g)/g)?0:1;else for(b=
0;b<l;b++)r[b]=p[0][b]===g?0:1;else f&&k&&b.applyMinMaxConstraint&&(r=B(p,f,k));return{pixelType:a,width:h,height:e,pixels:p,mask:r,noDataValue:g}};v.decode=function(a,c){c=c||l(a);var e=c.ifds,h=c.noData;if(0===e.length)throw"no valid image file directory";e=e[0];h=h?h[0]:null;if(c.tileWidth){var g=f(e,"TILEOFFSETS");if(void 0===g)e=null;else{for(var k=f(e,"TILEBYTECOUNTS"),q=c.tileWidth,n=c.tileHeight,u=c.width,r=c.height,t=c.pixelType,w=c.isBSQ,B=c.planes,G=u*r,v=f(e,"BITSPERSAMPLE")[0],y=d(t),
D=[],V=0;V<B;V++)D.push(new y(G));var P,J,X,K,U,Y,Z,W,G=Math.ceil(u/q);if(0===v%8)for(v=0;v<g.length;v++)for(P=Math.floor(v/G)*n,K=v%G*q,V=P*u+K,y=C(a,c.littleEndian,e,g[v],k[v]),Y=0,U=V,K=Math.min(q,u-K),Z=Math.min(n,r-P),P=0;P<B;P++)if(W=D[P],w)for(J=0;J<Z;J++)for(U=V+J*u,Y=q*n*P+J*q,X=0;X<K;X++,U++,Y++)W[U]=y[Y];else for(J=0;J<Z;J++)for(U=V+J*u,Y=J*q*B+P,X=0;X<K;X++,U++,Y+=B)W[U]=y[Y];e={width:u,height:r,pixelType:t,pixels:D}}}else if(n=c,D=m===n.littleEndian,G=f(e,"STRIPOFFSETS"),void 0===G)e=
null;else{c=n.width;g=n.height;k=n.pixelType;n=n.planes;u=c*g;v=f(e,"BITSPERSAMPLE")[0];r=d(k);t=new r(u*n);y=f(e,"STRIPBYTECOUNTS");V=f(e,"ROWSPERSTRIP")[0];U=f(e,"COMPRESSION")?f(e,"COMPRESSION")[0]:1;K=V;if(0===v%8)for(e=0;e<G.length;e++){Y=e*V*c*n;K=(e+1)*V>g?g-e*V:V;if("u8"===k||"s8"===k||D)8===U||32946===U?(w=new Uint8Array(a,G[e],y[e]),w=new p(w),P=w.getBytes(),B=new ArrayBuffer(P.length),w=new Uint8Array(B),w.set(P),w.length!==K*c*n*v/8&&console.log("strip byte counts is different than expected")):
6===U?(w=new Uint8Array(a,G[e],y[e]),B=new b,B.parse(w),K=B.getData(B.width,B.height,!0),B=new ArrayBuffer(K.length),w=new Uint8Array(B),w.set(K)):1===U&&(y[e]!==K*c*n*v/8&&console.log("strip byte counts is different than expected"),B=a.slice(G[e],G[e]+y[e]));else switch(6===U||8===U||32946===U?(w=new Uint8Array(a,G[e],y[e]),w=new p(w),w=w.getBytes(),B=new ArrayBuffer(w.length),q=new Uint8Array(B),w.length!==K*c*n*v/8&&console.log("strip byte counts is different than expected")):1===U&&(y[e]!==K*
c*n*v/8&&console.log("strip byte counts is different than expected"),B=new ArrayBuffer(y[e]),w=new Uint8Array(a,G[e],y[e]),q=new Uint8Array(B)),k){case "u16":case "s16":for(K=0;K<w.length;K+=2)q[K]=w[K+1],q[K+1]=w[K];break;case "u32":case "s32":case "f32":for(K=0;K<w.length;K+=4)q[K]=w[K+3],q[K+1]=w[K+2],q[K+2]=w[K+1],q[K+3]=w[K]}K=new r(B);t.set(K,Y)}w=[];if(1===n)w.push(t);else for(e=0;e<n;e++){q=new r(u);for(a=0;a<u;a++)q[a]=t[a*n+e];w.push(q)}e={width:c,height:g,pixelType:k,pixels:w}}if(null!==
h){e.mask=new Uint8Array(e.width*e.height);if(1E24<Math.abs(h))for(a=0;a<e.width*e.height;a++)e.mask[a]=1E-6>Math.abs((e.pixels[0][a]-h)/h)?0:1;else for(a=0;a<e.width*e.height;a++)e.mask[a]=e.pixels[0][a]===h?0:1;e.noDataValue=h}return e}})},"esri/layers/support/rasterDatasets/byteStreamUtils":function(){define(["require","exports"],function(D,v){Object.defineProperty(v,"__esModule",{value:!0});v.bytesToUTF8=function(t,g){for(var b=0,r="",p=0,a=0,d=t.length;b<d;)if(a=t[b++],p=a>>4,8>p?p=1:15===p?
(p=4,a=(a&7)<<18|(t[b++]&63)<<12|(t[b++]&63)<<6|t[b++]&63):14===p?(p=3,a=(a&15)<<12|(t[b++]&63)<<6|t[b++]&63):(p=2,a=(a&31)<<6|t[b++]&63),0!==a||g)r+=String.fromCharCode(a);return r}})},"esri/layers/support/rasterFormats/TiffTags":function(){define(["require","exports"],function(D,v){var t=function(){var b=[];b[254]="NEWSUBFILETYPE";b[255]="SUBFILETYPE";b[256]="IMAGEWIDTH";b[257]="IMAGELENGTH";b[258]="BITSPERSAMPLE";b[259]="COMPRESSION";b[262]="PHOTOMETRICINTERPRETATION";b[263]="THRESHHOLDING";b[264]=
"CELLWIDTH";b[265]="CELLLENGTH";b[266]="FILLORDER";b[269]="DOCUMENTNAME";b[270]="IMAGEDESCRIPTION";b[271]="MAKE";b[272]="MODEL";b[273]="STRIPOFFSETS";b[274]="ORIENTATION";b[277]="SAMPLESPERPIXEL";b[278]="ROWSPERSTRIP";b[279]="STRIPBYTECOUNTS";b[280]="MINSAMPLEVALUE";b[281]="MAXSAMPLEVALUE";b[282]="XRESOLUTION";b[283]="YRESOLUTION";b[284]="PLANARCONFIGURATION";b[285]="PAGENAME";b[286]="XPOSITION";b[287]="YPOSITION";b[288]="FREEOFFSETS";b[289]="FREEBYTECOUNTS";b[290]="GRAYRESPONSEUNIT";b[291]="GRAYRESPONSECURVE";
b[292]="T4OPTIONS";b[293]="T6OPTIONS";b[296]="RESOLUTIONUNIT";b[297]="PAGENUMBER";b[300]="COLORRESPONSEUNIT";b[301]="TRANSFERFUNCTION";b[305]="SOFTWARE";b[306]="DATETIME";b[315]="ARTIST";b[316]="HOSTCOMPUTER";b[317]="PREDICTOR";b[318]="WHITEPOINT";b[319]="PRIMARYCHROMATICITIES";b[320]="COLORMAP";b[321]="HALFTONEHINTS";b[322]="TILEWIDTH";b[323]="TILELENGTH";b[324]="TILEOFFSETS";b[325]="TILEBYTECOUNTS";b[326]="BADFAXLINES";b[327]="CLEANFAXDATA";b[328]="CONSECUTIVEBADFAXLINES";b[330]="SUBIFD";b[332]=
"INKSET";b[333]="INKNAMES";b[334]="NUMBEROFINKS";b[336]="DOTRANGE";b[337]="TARGETPRINTER";b[338]="EXTRASAMPLES";b[339]="SAMPLEFORMAT";b[340]="SMINSAMPLEVALUE";b[341]="SMAXSAMPLEVALUE";b[342]="TRANSFERRANGE";b[347]="JPEGTABLES";b[512]="JPEGPROC";b[513]="JPEGIFOFFSET";b[514]="JPEGIFBYTECOUNT";b[515]="JPEGRESTARTINTERVAL";b[517]="JPEGLOSSLESSPREDICTORS";b[518]="JPEGPOINTTRANSFORM";b[519]="JPEGQTABLES";b[520]="JPEGDCTABLES";b[521]="JPEGACTABLES";b[529]="YCBCRCOEFFICIENTS";b[530]="YCBCRSUBSAMPLING";b[531]=
"YCBCRPOSITIONING";b[532]="REFERENCEBLACKWHITE";b[700]="XMP";b[33550]="GEOPIXELSCALE";b[33922]="GEOTIEPOINTS";b[33432]="COPYRIGHT";b[42112]="GDAL_METADATA";b[42113]="GDAL_NODATA";b[50844]="RPCCOEFFICIENT";b[34264]="GEOTRANSMATRIX";b[34735]="GEOKEYDIRECTORY";b[34736]="GEODOUBLEPARAMS";b[34737]="GEOASCIIPARAMS";b[34665]="EXIFIFD";b[34853]="GPSIFD";b[40965]="INTEROPERABILITYIFD";return b}();D=function(){var b=[].concat(t);b[36864]="ExifVersion";b[40960]="FlashpixVersion";b[40961]="ColorSpace";b[42240]=
"Gamma";b[37121]="ComponentsConfiguration";b[37122]="CompressedBitsPerPixel";b[40962]="PixelXDimension";b[40963]="PixelYDimension";b[37500]="MakerNote";b[37510]="UserComment";b[40964]="RelatedSoundFile";b[36867]="DateTimeOriginal";b[36868]="DateTimeDigitized";b[36880]="OffsetTime";b[36881]="OffsetTimeOriginal";b[36882]="OffsetTimeDigitized";b[37520]="SubSecTime";b[37521]="SubSecTimeOriginal";b[37522]="SubSecTimeDigitized";b[37888]="Temperature";b[37889]="Humidity";b[37890]="Pressure";b[37891]="WaterDepth";
b[37892]="Acceleration";b[37893]="CameraElevationAngle";b[42016]="ImageUniqueID";b[42032]="CameraOwnerName";b[42033]="BodySerialNumber";b[42034]="LensSpecification";b[42035]="LensMake";b[42036]="LensModel";b[42037]="LensSerialNumber";b[33434]="ExposureTime";b[33437]="FNumber";b[34850]="ExposureProgram";b[34852]="SpectralSensitivity";b[34855]="PhotographicSensitivity";b[34856]="OECF";b[34864]="SensitivityType";b[34865]="StandardOutputSensitivity";b[34866]="RecommendedExposureIndex";b[34867]="ISOSpeed";
b[34868]="ISOSpeedLatitudeyyy";b[34869]="ISOSpeedLatitudezzz";b[37377]="ShutterSpeedValue";b[37378]="ApertureValue";b[37379]="BrightnessValue";b[37380]="ExposureBiasValue";b[37381]="MaxApertureValue";b[37382]="SubjectDistance";b[37383]="MeteringMode";b[37384]="LightSource";b[37385]="Flash";b[37386]="FocalLength";b[37396]="SubjectArea";b[41483]="FlashEnergy";b[41484]="SpatialFrequencyResponse";b[41486]="FocalPlaneXResolution";b[41487]="FocalPlaneYResolution";b[41488]="FocalPlaneResolutionUnit";b[41492]=
"SubjectLocation";b[41493]="ExposureIndex";b[41495]="SensingMethod";b[41728]="FileSource";b[41729]="SceneType";b[41730]="CFAPattern";b[41985]="CustomRendered";b[41986]="ExposureMode";b[41987]="WhiteBalance";b[41988]="DigitalZoomRatio";b[41989]="FocalLengthIn35mmFilm";b[41990]="SceneCaptureType";b[41991]="GainControl";b[41992]="Contrast";b[41993]="Saturation";b[41994]="Sharpness";b[41995]="DeviceSettingDescription";b[41996]="SubjectDistanceRange";return b}();v=function(){var b=[];b[1024]="GTModelTypeGeoKey";
b[1025]="GTRasterTypeGeoKey";b[1026]="GTCitationGeoKey";b[2048]="GeographicTypeGeoKey";b[2049]="GeogCitationGeoKey";b[2050]="GeogGeodeticDatumGeoKey";b[2051]="GeogPrimeMeridianGeoKey";b[2052]="GeogLinearUnitsGeoKey";b[2053]="GeogLinearUnitSizeGeoKey";b[2054]="GeogAngularUnitsGeoKey";b[2055]="GeogAngularUnitSizeGeoKey";b[2056]="GeogEllipsoidGeoKey";b[2057]="GeogSemiMajorAxisGeoKey";b[2058]="GeogSemiMinorAxisGeoKey";b[2059]="GeogInvFlatteningGeoKey";b[2061]="GeogPrimeMeridianLongGeoKey";b[2060]="GeogAzimuthUnitsGeoKey";
b[3072]="ProjectedCSTypeGeoKey";b[3073]="PCSCitationGeoKey";b[3074]="ProjectionGeoKey";b[3075]="ProjCoordTransGeoKey";b[3076]="ProjLinearUnitsGeoKey";b[3077]="ProjLinearUnitSizeGeoKey";b[3078]="ProjStdParallel1GeoKey";b[3079]="ProjStdParallel2GeoKey";b[3080]="ProjNatOriginLongGeoKey";b[3081]="ProjNatOriginLatGeoKey";b[3082]="ProjFalseEastingGeoKey";b[3083]="ProjFalseNorthingGeoKey";b[3084]="ProjFalseOriginLongGeoKey";b[3085]="ProjFalseOriginLatGeoKey";b[3086]="ProjFalseOriginEastingGeoKey";b[3087]=
"ProjFalseOriginNorthingGeoKey";b[3088]="ProjCenterLongGeoKey";b[3090]="ProjCenterEastingGeoKey";b[3091]="ProjCenterNorthingGeoKey";b[3092]="ProjScaleAtNatOriginGeoKey";b[3093]="ProjScaleAtCenterGeoKey";b[3094]="ProjAzimuthAngleGeoKey";b[3095]="ProjStraightVertPoleLongGeoKey";b[4096]="VerticalCSTypeGeoKey";b[4097]="VerticalCitationGeoKey";b[4098]="VerticalDatumGeoKey";b[4099]="VerticalUnitsGeoKey";return b}();var g=new Map;g.set("EXIFIFD",D);g.set("GPSIFD","GPSVersionID GPSLatitudeRef GPSLatitude GPSLongitudeRef GPSLongitude GPSAltitudeRef GPSAltitude GPSTimeStamp GPSSatellites GPSStatus GPSMeasureMode GPSDOP GPSSpeedRef GPSSpeed GPSTrackRef GPSTrack GPSImgDirectionRef GPSImgDirection GPSMapDatum GPSDestLatitudeRef GPSDestLatitude GPSDestLongitudeRef GPSDestLongitude GPSDestBearingRef GPSDestBearing GPSDestDistanceRef GPSDestDistance GPSProcessingMethod GPSAreaInformation GPSDateStamp GPSDifferential GPSHPositioningError".split(" "));
return{TIFF_TAGS:t,ifdTags:g,GEO_KEYS:v,getTagName:function(b,g){g=(g||t)[b];void 0===g&&(g="unknown"+String(b));return g}}})},"esri/renderers/support/RasterSymbolizer":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../rasterRenderers ../../core/JSONSupport ../../core/Logger ../../core/accessorSupport/decorators ../../layers/support/RasterInfo ../../layers/support/rasterFunctions/pixelUtils ../support/colorRampUtils".split(" "),
function(D,v,t,g,b,r,p,a,d,h,f,c,k,n){var e=h.getLogger("esri.renderers.support.RasterSymbolizer");return function(d){function h(a){return d.call(this,a)||this}g(h,d);h.prototype.readRenderer=function(b,c,d){return a.read(b,d)};h.prototype.bind=function(){this.lookup={};if(!this.renderer)return!1;var a;switch(this.renderer.type){case "unique-value":a=this._updateUVRenderer(this.renderer);break;case "raster-colormap":a=this._updateColormapRenderer(this.renderer);break;case "raster-stretch":a=this._updateStretchRenderer(this.renderer);
break;case "class-breaks":a=this._updateClassBreaksRenderer(this.renderer)}return a};h.prototype.symbolize=function(a){if(!this.isValidPixelBlock(a))return a;try{3<a.pixels.length&&(a=k.extractBands(a,[0,1,2]));var b=void 0;switch(this.renderer.type){case "unique-value":case "raster-colormap":b=this._symbolize_colormap(a);break;case "class-breaks":b=this._symbolize_classBreaks(a);break;case "raster-stretch":b=this._symbolize_stretch(a)}return b}catch(C){return e.error("symbolize",C.message),a}};h.prototype.simpleStretch=
function(a,b){if(!this.isValidPixelBlock(a))return a;try{return 3<a.pixels.length&&(a=k.extractBands(a,[0,1,2])),k.stretch(a,b)}catch(C){return e.error("symbolize",C.message),a}};h.prototype.generateWebGLParameters=function(a){if(-1<["unique-value","raster-colormap","class-breaks"].indexOf(this.renderer.type)){var b=this.lookup.lut;return{colormap:b.indexedColormap,colormapOffset:b.colormapOffset,type:"lut"}}var c=this.renderer,d=b=null,e=this.lookup&&this.lookup.colorRampLut;c.colorRamp&&e&&(b=e.indexedColormap,
d=e.offset);var e=c.gamma,f=c.useGamma,h=this.getStretchCutoff(c,a),c=h.minCutOff,g=h.maxCutOff,k=h.outMin,h=h.outMax;a&&a.pixels&&2===a.pixels.length&&(a=a.clone(),a.statistics=[a.statistics[0]],a.pixels=[a.pixels[0]]);a=Math.min(3,a&&a.getPlaneCount()||this.rasterInfo.bandCount);var m=new Float32Array(a),l=null==b?255:1,n;for(n=0;n<a;n++)m[n]=(h-k)/(g[n]-c[n])/l;var p=new Float32Array(a);if(f)for(n=0;n<a;n++)p[n]=1<e[n]?2<e[n]?6.5+Math.pow(e[n]-2,2.5):6.5+100*Math.pow(2-e[n],4):1;return{bandCount:a,
outMin:k/l,outMax:h/l,minCutOff:c,maxCutOff:g,factor:m,useGamma:f,gamma:f?e:[1,1,1],gammaCorrection:f?p:[1,1,1],colormap:b,colormapOffset:d,type:"stretch"}};h.prototype._isLUTChanged=function(a){if(!this.lookup)return!0;if("raster-stretch"===this.renderer.type){var b=this.renderer.colorRamp;if(a)return JSON.stringify(b.toJSON())!==JSON.stringify(this.lookup.rendererJson.colorRamp);a=t({},this.renderer.toJSON());b=t({},this.lookup.rendererJson);a.colorRamp=null;b.colorRamp=null}return JSON.stringify(this.renderer.toJSON())!==
JSON.stringify(this.lookup.rendererJson)};h.prototype._symbolize_colormap=function(a){return this._isLUTChanged()&&!this.bind()?a:k.colorize(a,this.lookup.lut)};h.prototype._symbolize_classBreaks=function(a){var b=-1<["u8","u16","s8","s16"].indexOf(this.rasterInfo.pixelType);return this._isLUTChanged()&&!this.bind()?a:b?k.colorize(a,this.lookup.lut):k.remapColor(a,this.lookup.lut)};h.prototype._symbolize_stretch=function(a){var b=this.rasterInfo.pixelType,c=this.renderer,d=-1<["u8","u16","s8","s16"].indexOf(b),
e=c.gamma,f=c.useGamma;if(d){if(c.dynamicRangeAdjustment)d=this.getStretchCutoff(c,a),b=k.createStretchLUT(t({pixelType:b},d,{gamma:f?e:null}));else{if(this._isLUTChanged()&&(e=this.bind(),!e))return a;b=this.lookup?this.lookup.lut:null}if(!b)return a;b=k.lookupPixels(a,b)}else d=this.getStretchCutoff(c,a),b=k.stretch(a,t({},d,{gamma:f?e:null}));if(c.colorRamp){if(this._isLUTChanged(!0)&&(e=this.bind(),!e))return a;b=k.colorize(b,this.lookup.colorRampLut)}return b};h.prototype._updateUVRenderer=function(a){var b=
this.rasterInfo,c=b.bandCount,d=b.attributeTable,e=b.statistics,b=-1<["u8","s8"].indexOf(b.pixelType)&&e&&null!=e[0].min&&null!=e[0].max;if(1!==c||!d&&!b)return!1;var f=a.field;if(!f)return!1;var h=[];if(d){var g=d.fields.filter(function(a){return"value"===a.name.toLowerCase()})[0];if(!g)return!1;d.features.forEach(function(b){var c=a.uniqueValueInfos.filter(function(a){return String(a.value)===String(b.attributes[f])})[0];(c=c&&c.symbol&&c.symbol.color)&&h.push([b.attributes[g.name],c.r,c.g,c.b,
1<c.a?c.a:Math.round(255*c.a)])})}else{if("Value"!==f.toLowerCase())return!1;a.uniqueValueInfos.forEach(function(a){var b=a&&a.symbol&&a.symbol.color;b&&h.push([parseInt(a.value,10),b.r,b.g,b.b,1<b.a?b.a:Math.round(255*b.a)])})}if(0===h.length)return!1;c=k.createColormapLUT({colormap:h});this.lookup={rendererJson:a.toJSON(),lut:c};return this.canRenderInWebGL=!0};h.prototype._updateColormapRenderer=function(a){var b=a.extractColormap();if(!b||0===b.length)return!1;b=k.createColormapLUT({colormap:b});
this.lookup={rendererJson:a.toJSON(),lut:b};return this.canRenderInWebGL=!0};h.prototype._updateClassBreaksRenderer=function(a){var b=-1<["u8","u16","s8","s16"].indexOf(this.rasterInfo.pixelType),c=a.classBreakInfos;if(!c||0===c.length)return!1;var d=c.sort(function(a,b){return a.minValue-b.minValue}),c=d[d.length-1];if(!b)return b=d.map(function(a){return{value:a.minValue,mappedColor:[a.symbol.color.r,a.symbol.color.g,a.symbol.color.b,1<a.symbol.color.a?a.symbol.color.a:Math.round(255*a.symbol.color.a)]}}),
b.push({value:c.maxValue,mappedColor:[c.symbol.color.g,c.symbol.color.b,1<c.symbol.color.a?c.symbol.color.a:Math.round(255*c.symbol.color.a)]}),this.lookup={rendererJson:a.toJSON(),lut:b},this.canRenderInWebGL=!1,!0;var e=[],f,h=0;d.forEach(function(a){f=Math.ceil(a.minValue);h=Math.floor(a.maxValue);for(var b=f;b<h;b++)e.push([b,a.symbol.color.r,a.symbol.color.g,a.symbol.color.b,1<a.symbol.color.a?a.symbol.color.a:Math.round(255*a.symbol.color.a)])});e.push([c.maxValue,c.symbol.color.r,c.symbol.color.g,
c.symbol.color.b,1<c.symbol.color.a?c.symbol.color.a:Math.round(255*c.symbol.color.a)]);b=k.createColormapLUT({colormap:e,fillUnspecified:!1});this.lookup={rendererJson:a.toJSON(),lut:b};return this.canRenderInWebGL=!0};h.prototype._updateStretchRenderer=function(a){if(!(a.statistics||this.rasterInfo.statistics||a.dynamicRangeAdjustment))return!1;var b=a.histograms||this.rasterInfo.histograms;if(!a.dynamicRangeAdjustment&&"percent-clip"===a.stretchType&&!b)return!1;var c=a.gamma,d=a.useGamma,b=a.colorRamp,
e=this.rasterInfo.pixelType;if(!a.dynamicRangeAdjustment&&-1<["u8","u16","s8","s16"].indexOf(e)){var f=this.getStretchCutoff(a),c=k.createStretchLUT(t({pixelType:e},f,{gamma:d?c:null}));this.lookup={rendererJson:a.toJSON(),lut:c}}b&&(b=n.convertColorRampToColormap(b,256),this.lookup.colorRampLut=k.createColormapLUT({colormap:b}),this.lookup.rendererJson=a.toJSON());return this.canRenderInWebGL=!0};h.prototype.getStretchCutoff=function(a,b){var c,d,e=a.stretchType;a.dynamicRangeAdjustment?"min-max"===
e&&b.statistics?c=b.statistics.map(function(a){return[a.minValue,a.maxValue,0,0]}):(d=k.estimateStatisticsHistograms(b),c=d.statistics,d=d.histograms):(c=a.statistics&&0<a.statistics.length?a.statistics:this.rasterInfo.statistics,d=a.histograms||this.rasterInfo.histograms);b=c||d?(c||d).length:this.rasterInfo.bandCount;var f=[],h=[],g,l,m,n,p,q;c[0]instanceof Array||(c=c.map(function(a){return[a.min,a.max,a.avg,a.stddev]}));switch(e){case "min-max":for(e=0;e<b;e++)f[e]=c[e][0],h[e]=c[e][1];break;
case "standard-deviation":for(e=0;e<b;e++)f[e]=c[e][2]-a.numberOfStandardDeviations*c[e][3],h[e]=c[e][2]+a.numberOfStandardDeviations*c[e][3],f[e]<c[e][0]&&(f[e]=c[e][0]),h[e]>c[e][1]&&(h[e]=c[e][1]);break;case "percent-clip":for(e=0;e<b;e++){c=d[e];n=new Uint32Array(c.size);m=c.counts;l=0;g=(c.max-c.min)/c.size;p=-.5===c.min&&1===g?.5:0;for(q=0;q<c.size;q++)l+=m[q],n[q]=l;m=a.minPercent*l/100;for(q=0;q<c.size;q++)if(n[q]>m){f[e]=c.min+g*(q+p);break}m=(1-a.maxPercent/100)*l;for(q=c.size-2;0<=q;q--)if(n[q]<
m){h[e]=c.min+g*(q+2-p);break}}break;default:for(e=0;e<b;e++)f[e]=c[e][0],h[e]=c[e][1]}return{minCutOff:f,maxCutOff:h,outMax:a.outputMax||255,outMin:a.outputMin||0}};h.prototype.isValidPixelBlock=function(a){return!!(a&&a.pixels&&0<a.pixels.length&&0!==a.validPixelCount)};b([f.property({types:a.rasterRendererTypes,json:{write:!0}})],h.prototype,"renderer",void 0);b([f.reader("renderer")],h.prototype,"readRenderer",null);b([f.property({type:c,json:{write:!0}})],h.prototype,"rasterInfo",void 0);b([f.property({json:{write:!0}})],
h.prototype,"lookup",void 0);b([f.property({})],h.prototype,"canRenderInWebGL",void 0);return h=b([f.subclass("esri.renderers.support.RasterSymbolizer")],h)}(f.declared(d.JSONSupport))})},"esri/layers/support/rasterFunctions/pixelUtils":function(){define(["require","exports","../PixelBlock"],function(D,v,t){function g(a,b){a=Math.min(Math.max(a,-100),100);b=Math.min(Math.max(b,-100),100);var d,f,c=new Uint8Array(256);for(d=0;256>d;d++)0<a&&100>a?f=(200*d-25500+510*b)/(2*(100-a))+128:0>=a&&-100<a?
f=(200*d-25500+510*b)*(100+a)/2E4+128:100===a?(f=200*d-25500+256*(100-a)+510*b,f=0<f?255:0):-100===a&&(f=128),c[d]=255<f?255:0>f?0:f;return c}function b(a,b,h,f,c,g,n,e){return{xmin:c<=h*a?0:c<h*a+a?c-h*a:a,ymin:g<=f*b?0:g<f*b+b?g-f*b:b,xmax:c+n<=h*a?0:c+n<h*a+a?c+n-h*a:a,ymax:g+e<=f*b?0:g+e<f*b+b?g+e-f*b:b}}function r(a,d,h,f){var c=a.filter(function(a){return p(a)})[0];if(null==c)return null;var g=f?f.width:d.width;f=f?f.height:d.height;var n=c.width,e=c.height,l=d.width/n;d=d.height/e;var u=h?
h.x:0;h=h?h.y:0;var m=c.pixelType,q=t.getPixelArrayConstructor(m),r=c.pixels.length,c=[],B,v,y,w,x,z,A,E,F,D;for(x=0;x<r;x++){v=new q(g*f);for(z=0;z<d;z++)for(A=0;A<l;A++)if(y=a[z*l+A])for(B=y.pixels[x],D=b(n,e,A,z,u,h,g,f),E=D.ymin;E<D.ymax;E++)for(y=(z*e+E-h)*g+(A*n-u),w=E*n,F=D.xmin;F<D.xmax;F++)v[y+F]=B[w+F];c.push(v)}var N;if(a.some(function(a){return null==a||a.mask&&0<a.mask.length}))for(N=new Uint8Array(g*f),z=0;z<d;z++)for(A=0;A<l;A++)if(q=(y=a[z*l+A])?y.mask:null,D=b(n,e,A,z,u,h,g,f),q)for(E=
D.ymin;E<D.ymax;E++)for(y=(z*e+E-h)*g+(A*n-u),w=E*n,F=D.xmin;F<D.xmax;F++)N[y+F]=q[w+F];else if(y)for(E=D.ymin;E<D.ymax;E++)for(y=(z*e+E-h)*g+(A*n-u),w=E*n,F=D.xmin;F<D.xmax;F++)N[y+F]=1;else for(E=D.ymin;E<D.ymax;E++)for(y=(z*e+E-h)*g+(A*n-u),w=E*n,F=D.xmin;F<D.xmax;F++)N[y+F]=0;a=new t({width:g,height:f,pixels:c,pixelType:m,mask:N});a.updateStatistics();return a}Object.defineProperty(v,"__esModule",{value:!0});var p=function(a){return a&&"esri.layers.support.PixelBlock"===a.declaredClass&&a.pixels&&
0<a.pixels.length};v.extractBands=function(a,b){if(!b||!p(a))return a;var d=a.pixels.length;return b&&b.some(function(a){return a>=d})||1===d&&1===b.length&&0===b[0]||d===b.length&&!b.some(function(a,b){return a!==b})?a:new t({pixelType:a.pixelType,width:a.width,height:a.height,mask:a.mask,validPixelCount:a.validPixelCount,maskIsAlpha:a.maskIsAlpha,pixels:b.map(function(b){return a.pixels[b]}),statistics:a.statistics&&b.map(function(b){return a.statistics[b]})})};v.createColormapLUT=function(a){if(a){var b=
a.colormap;if(b&&0!==b.length){var b=b.sort(function(a,b){return a[0]-b[0]}),h=0;0>b[0][0]&&(h=b[0][0]);var f=Math.max(256,b[b.length-1][0]-h+1),c=new Uint8Array(4*f),g=[],n=0,e=0,l=5===b[0].length;if(65536<f)return b.forEach(function(a){g[a[0]-h]=l?a.slice(1):a.slice(1).concat([255])}),{indexed2DColormap:g,offset:h,alphaSpecified:l};if(a.fillUnspecified)for(a=b[e],n=a[0]-h;n<f;n++)c[4*n]=a[1],c[4*n+1]=a[2],c[4*n+2]=a[3],c[4*n+3]=l?a[4]:255,n===a[0]-h&&(a=e===b.length-1?a:b[++e]);else for(n=0;n<b.length;n++)a=
b[n],e=4*(a[0]-h),c[e]=a[1],c[e+1]=a[2],c[e+2]=a[3],c[e+3]=l?a[4]:255;return{indexedColormap:c,offset:h,alphaSpecified:l}}}};v.colorize=function(a,b){if(!p(a)||!b&&(b.indexedColormap||b.indexed2DColormap))return a;var d=a.clone(),f=d.pixels,c=d.mask,g=d.width*d.height;if(1!==f.length)return a;var n=b.indexedColormap;a=b.indexed2DColormap;var e=b.offset;b=b.alphaSpecified;var l=n.length-1,u=0,f=f[0],m=new Uint8Array(f.length),q=new Uint8Array(f.length),r=new Uint8Array(f.length),t=0;if(n)if(c)for(u=
0;u<g;u++)c[u]&&(t=4*(f[u]-e),t<e||t>l?c[u]=0:(m[u]=n[t],q[u]=n[t+1],r[u]=n[t+2],c[u]=n[t+3]));else{c=new Uint8Array(g);for(u=0;u<g;u++)t=4*(f[u]-e),t<e||t>l?c[u]=0:(m[u]=n[t],q[u]=n[t+1],r[u]=n[t+2],c[u]=n[t+3]);d.mask=c}else if(c)for(u=0;u<g;u++)c[u]&&(n=a[f[u]],m[u]=n[0],q[u]=n[1],r[u]=n[2],c[u]=n[3]);else{c=new Uint8Array(g);for(u=0;u<g;u++)n=a[f[u]],m[u]=n[0],q[u]=n[1],r[u]=n[2],c[u]=n[3];d.mask=c}d.pixels=[m,q,r];d.statistics=null;d.pixelType="u8";d.maskIsAlpha=b;return d};v.estimateStatisticsHistograms=
function(a){if(!p(a))return null;a.statistics||a.updateStatistics();var b=a.pixels,h=a.mask,f=a.pixelType,c=a.statistics;a=a.width*a.height;var g=b.length,n,e,l,u,m,q=[],r=[],t,v,y;for(u=0;u<g;u++){t=new Uint32Array(256);y=b[u];if("u8"===f)if(n=-.5,e=255.5,h)for(m=0;m<a;m++)h[m]&&t[y[m]]++;else for(m=0;m<a;m++)t[y[m]]++;else{n=c[u].minValue;e=c[u].maxValue;l=(e-n)/256;v=new Uint32Array(257);if(h)for(m=0;m<a;m++)h[m]&&v[Math.floor((y[m]-n)/l)]++;else for(m=0;m<a;m++)v[Math.floor((y[m]-n)/l)]++;for(m=
0;255>m;m++)t[m]=v[m];t[255]=v[255]+v[256]}q.push({min:n,max:e,size:256,counts:t});for(m=y=v=l=0;256>m;m++)l+=t[m],v+=m*t[m];v/=l;for(m=0;256>m;m++)y+=t[m]*Math.pow(m-v,2);t=Math.sqrt(y/(l-1));l=(e-n)/256;m=(v+.5)*l+n;t*=l;r.push({min:n,max:e,avg:m,stddev:t})}return{statistics:r,histograms:q}};v.createStretchLUT=function(a){var b=a.minCutOff,h=a.maxCutOff,f=a.gamma,c=a.pixelType,k=a.outMin||0,n=a.outMax||255;if(-1===["u8","u16","s8","s16"].indexOf(c))return null;var e=b.length,l,p=0;"s8"===c?p=-127:
"s16"===c&&(p=-32767);var m=256;-1<["u16","s16"].indexOf(c)&&(m=65536);for(var q=[],r=n-k,c=0;c<e;c++)q[c]=h[c]-b[c];l=f&&f.length>=e;var t=[];if(l)for(c=0;c<e;c++)t[c]=1<f[c]?2<f[c]?6.5+Math.pow(f[c]-2,2.5):6.5+100*Math.pow(2-f[c],4):1;var v,y=[],w,x,z;if(l)for(c=0;c<e;c++){z=[];for(l=0;l<m;l++)w=l+p,v=(w-b[c])/q[c],x=1,1<f[c]&&(x-=Math.pow(1/r,v*t[c])),z[l]=w<h[c]&&w>b[c]?Math.floor(x*r*Math.pow(v,1/f[c]))+k:w>=h[c]?n:k;y[c]=z}else for(c=0;c<e;c++){z=[];for(l=0;l<m;l++)w=l+p,z[l]=w<=b[c]?k:w>=h[c]?
n:Math.floor((w-b[c])/q[c]*r)+k;y[c]=z}if(null!=a.contrastOffset)for(a=g(a.contrastOffset,a.brightnessOffset),c=0;c<e;c++)for(z=y[c],l=0;l<m;l++)z[l]=a[z[l]];return{lut:y,offset:p}};v.createContrastBrightnessLUT=g;v.stretch=function(a,b){if(!p(a))return null;a=a.clone();var d=a.pixels,f=a.mask,c=b.minCutOff,g=b.maxCutOff,n=b.gamma,e=b.outMin||0;b=b.outMax||255;var l=a.width*a.height,r=d.length,m,q,t,v,D,y=b-e,w=[];for(m=0;m<r;m++)w[m]=g[m]-c[m];q=n&&n.length>=r;var x=[];if(q)for(m=0;m<r;m++)x[m]=
1<n[m]?2<n[m]?6.5+Math.pow(n[m]-2,2.5):6.5+100*Math.pow(2-n[m],4):1;if(q)if(null!=f)for(q=0;q<l;q++){if(f[q])for(m=0;m<r;m++)t=d[m][q],D=(t-c[m])/w[m],v=1,1<n[m]&&(v-=Math.pow(1/y,D*x[m])),d[m][q]=t<g[m]&&t>c[m]?Math.floor(v*y*Math.pow(D,1/n[m]))+e:t>=g[m]?b:e}else for(q=0;q<l;q++)for(m=0;m<r;m++)t=d[m][q],D=(t-c[m])/w[m],v=1,1<n[m]&&(v-=Math.pow(1/y,D*x[m])),d[m][q]=t<g[m]&&t>c[m]?Math.floor(v*y*Math.pow(D,1/n[m]))+e:t>=g[m]?b:e;else if(null!=f)for(q=0;q<l;q++){if(f[q])for(m=0;m<r;m++)t=d[m][q],
d[m][q]=t<g[m]&&t>c[m]?Math.floor((t-c[m])/w[m]*y)+e:t>=g[m]?b:e}else for(q=0;q<l;q++)for(m=0;m<r;m++)t=d[m][q],d[m][q]=t<g[m]&&t>c[m]?Math.floor((t-c[m])/w[m]*y)+e:t>=g[m]?b:e;a.pixelType="u8";a.updateStatistics();return a};v.lookupPixels=function(a,b){if(!p(a))return null;var d=a.pixels,f=a.mask,c=a.width*a.height,g=d.length,n=b.lut;b=b.offset;var e,l;n&&1===n[0].length&&(n=d.map(function(){return n}));var r=[],m,q,v;if(b)if(null==f)for(e=0;e<g;e++){m=d[e];q=n[e];v=new Uint8Array(c);for(l=0;l<c;l++)v[l]=
q[m[l]-b];r.push(v)}else for(e=0;e<g;e++){m=d[e];q=n[e];v=new Uint8Array(c);for(l=0;l<c;l++)f[l]&&(v[l]=q[m[l]-b]);r.push(v)}else if(null==f)for(e=0;e<g;e++){m=d[e];q=n[e];v=new Uint8Array(c);for(l=0;l<c;l++)v[l]=q[m[l]];r.push(v)}else for(e=0;e<g;e++){m=d[e];q=n[e];v=new Uint8Array(c);for(l=0;l<c;l++)f[l]&&(v[l]=q[m[l]]);r.push(v)}a=new t({width:a.width,height:a.height,pixels:r,mask:f,pixelType:"u8"});a.updateStatistics();return a};v.remapColor=function(a,b){if(!p(a))return null;a=a.clone();var d=
a.width*a.height,f=b.length,c=Math.floor(f/2),g=b[Math.floor(c)],n=a.pixels[0],e,l,r,m,q,t,v=!1,D=new Uint8Array(d),y=new Uint8Array(d),w=new Uint8Array(d),x=a.mask,z=4===b[0].mappedColor.length;x||(x=new Uint8Array(d),x.fill(z?255:1),a.mask=x);for(q=0;q<d;q++)if(x[q]){e=n[q];v=!1;t=c;l=g;r=0;for(m=f-1;1<m-r;){if(e===l.value){v=!0;break}e>l.value?r=t:m=t;t=Math.floor((r+m)/2);l=b[Math.floor(t)]}v||(e===b[r].value?(l=b[r],v=!0):e===b[m].value?(l=b[m],v=!0):e<b[r].value?(v=!1,l=null):e>b[r].value&&
(e<b[m].value?(l=b[r],v=!0):m===f-1?(v=!1,l=null):(l=b[m],v=!0)));v?(D[q]=l.mappedColor[0],y[q]=l.mappedColor[1],w[q]=l.mappedColor[2],x[q]=l.mappedColor[3]):D[q]=y[q]=w[q]=x[q]=0}a.pixels=[D,y,w];a.mask=x;a.pixelType="u8";a.maskIsAlpha=z;return a};v.getClipBounds=b;v.mosaicPixelData=function(a,b){if(!a||0===a.length)return null;var d=a.filter(function(a){return a.pixelBlock})[0];if(!d)return null;var f=(d.extent.xmax-d.extent.xmin)/d.pixelBlock.width,c=(d.extent.ymax-d.extent.ymin)/d.pixelBlock.height,
g=.01*Math.min(f,c),n=a.sort(function(a,b){return Math.abs(a.extent.ymax-b.extent.ymax)>g?b.extent.ymax-a.extent.ymax:Math.abs(a.extent.xmin-b.extent.xmin)>g?a.extent.xmin-b.extent.xmin:0}),e=Math.min.apply(null,n.map(function(a){return a.extent.xmin})),l=Math.min.apply(null,n.map(function(a){return a.extent.ymin})),p=Math.max.apply(null,n.map(function(a){return a.extent.xmax})),m=Math.max.apply(null,n.map(function(a){return a.extent.ymax}));a={x:Math.round((b.xmin-e)/f),y:Math.round((m-b.ymax)/c)};
e={width:Math.round((p-e)/f),height:Math.round((m-l)/c)};f={width:Math.round((b.xmax-b.xmin)/f),height:Math.round((b.ymax-b.ymin)/c)};if(Math.round(e.width/d.pixelBlock.width)*Math.round(e.height/d.pixelBlock.height)!==n.length||0>a.x||0>a.y||e.width<f.width||e.height<f.height)return null;d=n.map(function(a){return a.pixelBlock});d=r(d,e,a,f);return{extent:b,pixelBlock:d}};v.mosaic=r;v.setValidBoundary=function(a,b,g){if(!p(a))return null;var d=a.width,c=a.height,h=b.x;b=b.y;var n=g.width+h;g=g.height+
b;if(0>h||0>b||n>d||g>c||0===h&&0===b&&n===d&&g===c)return a;a.mask||(a.mask=new Uint8Array(d*c));for(var e=a.mask,l=0;l<c;l++)for(var r=l*d,m=0;m<d;m++)e[r+m]=l<b||l>=g||m<h||m>=n?0:1;a.updateStatistics();return a};v.clip=function(a,b,g){if(!p(a))return null;var d=b.x,c=b.y,h=b.x+g.width;b=b.x+g.height;if(b===a.height&&h===a.width)return a;for(var n=a.pixels,e=a.mask,l=a.width,r=l*a.height,m=n.length,q=[],v=0;v<m;v++){for(var B=n[v],D=t.createEmptyBand(a.pixelType,r),y=0,w=c;w<=b;w++)for(var x=w*
l,z=d;z<=h;z++)D[y++]=B[x+z];q.push(D)}var A;if(e)for(A=new Uint8Array(g.width*g.height),y=0,w=c;w<=b;w++)for(x=w*l,z=d;z<=h;z++)A[y++]=e[x+z];a=new t({width:g.width,height:g.height,pixels:q,mask:A});a.updateStatistics();return a};v.approximateTransform=function(a,b,g,f){if(!p(a))return null;var c=a.pixels,d=a.mask,h=a.pixelType,e=a.width,l=a.height;a=t.getPixelArrayConstructor(h);var r=c.length,m=b.width,q=b.height;b=f.cols;var v=f.rows,B=Math.ceil(m/b),D=Math.ceil(q/v),y=!1;for(f=0;f<g.length;f+=
3)-1===g[f]&&-1===g[f+1]&&-1===g[f+2]&&(y=!0);var w,x,z,A,E,F,M,N=new Float32Array(m*q),O=new Float32Array(m*q),L=0,H,I;for(f=0;f<D;f++)for(var R=0;R<B;R++){w=12*(f*B+R);x=g[w];z=g[w+1];A=g[w+2];E=g[w+3];F=g[w+4];M=g[w+5];for(var Q=0;Q<v;Q++){L=(f*v+Q)*m+R*b;I=(Q+.5)/v;for(var S=0;S<Q;S++)H=(S+.5)/b,N[L+S]=Math.round((x*H+z*I+A)*e-.5),O[L+S]=Math.round((E*H+F*I+M)*l-.5)}w+=6;x=g[w];z=g[w+1];A=g[w+2];E=g[w+3];F=g[w+4];M=g[w+5];for(Q=0;Q<v;Q++)for(L=(f*v+Q)*m+R*b,I=(Q+.5)/v,S=Q;S<b;S++)H=(S+.5)/b,N[L+
S]=Math.round((x*H+z*I+A)*e-.5),O[L+S]=Math.round((E*H+F*I+M)*l-.5)}g=function(a,b){for(var c=0;c<q;c++){w=c*m;for(var d=0;d<m;d++)a[w]=y&&(0>N[w]||0>O[w])?0:b[N[w]+O[w]*e],w++}};l=[];for(f=0;f<r;f++)b=new a(m*q),g(b,c[f]),l.push(b);c=new t({width:m,height:q,pixelType:h,pixels:l});if(d)c.mask=new Uint8Array(m*q),g(c.mask,d);else if(y)for(c.mask=new Uint8Array(m*q),f=0;f<m*q;f++)c.mask[f]=0>N[f]||0>O[f]?0:1;c.updateStatistics();return c}})},"esri/tasks/ImageServiceIdentifyTask":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper ../request ../core/maybe ../core/accessorSupport/decorators ../geometry/support/normalizeUtils ./Task ./support/ImageServiceIdentifyResult".split(" "),
function(D,v,t,g,b,r,p,a,d,h,f){return function(c){function h(){return null!==c&&c.apply(this,arguments)||this}t(h,c);h.prototype.execute=function(a,c){var e=this;return d.normalizeCentralMeridian(a.geometry?[a.geometry]:[]).then(function(d){var f=a.toJSON();d=d&&d[0];p.isSome(d)&&(f.geometry=JSON.stringify(d.toJSON()));f=e._encode(b({f:"json"},e.parsedUrl.query,f));f=b({query:f},e.requestOptions,c);return r(e.parsedUrl.path+"/identify",f)}).then(function(a){return f.fromJSON(a.data)})};return h=
g([a.subclass("esri.tasks.ImageServiceIdentifyTask")],h)}(a.declared(h))})},"esri/tasks/support/ImageServiceIdentifyResult":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ../../geometry/Point ./FeatureSet".split(" "),function(D,v,t,g,b,r,p,a){return function(b){function d(){var a=null!==b&&b.apply(this,arguments)||this;a.catalogItemVisibilities=null;a.catalogItems=null;a.location=
null;a.name=null;a.objectId=null;a.processedValues=null;a.properties=null;a.value=null;return a}t(d,b);g([r.property({json:{write:!0}})],d.prototype,"catalogItemVisibilities",void 0);g([r.property({type:a,json:{write:!0}})],d.prototype,"catalogItems",void 0);g([r.property({type:p,json:{write:!0}})],d.prototype,"location",void 0);g([r.property({json:{write:!0}})],d.prototype,"name",void 0);g([r.property({json:{write:!0}})],d.prototype,"objectId",void 0);g([r.property({json:{write:!0}})],d.prototype,
"processedValues",void 0);g([r.property({json:{write:!0}})],d.prototype,"properties",void 0);g([r.property({json:{write:!0}})],d.prototype,"value",void 0);return d=g([r.subclass("esri.tasks.support.ImageServiceIdentifyResult")],d)}(r.declared(b.JSONSupport))})},"esri/tasks/support/ImageServiceIdentifyParameters":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../TimeExtent ../../core/JSONSupport ../../core/accessorSupport/decorators ../../geometry/Point ../../geometry/support/jsonUtils ../../layers/support/MosaicRule ../../layers/support/RasterFunction".split(" "),
function(D,v,t,g,b,r,p,a,d,h,f,c){return function(k){function n(){var a=null!==k&&k.apply(this,arguments)||this;a.geometry=null;a.renderingRules=null;a.pixelSize=null;a.returnGeometry=!0;a.returnCatalogItems=!0;a.returnPixelValues=!0;a.maxItemCount=null;a.timeExtent=null;a.raster=void 0;a.viewId=void 0;return a}t(n,k);n.prototype.writeGeometry=function(a,b,c){null!=a&&(b.geometryType=h.getJsonType(a),b[c]=JSON.stringify(a.toJSON()))};Object.defineProperty(n.prototype,"mosaicRule",{set:function(a){a&&
a.mosaicMethod&&(a=f.fromJSON(b({},a.toJSON(),{mosaicMethod:a.mosaicMethod,mosaicOperation:a.mosaicOperation})));this._set("mosaicRule",a)},enumerable:!0,configurable:!0});n.prototype.writeMosaicRule=function(a,b,c){null!=a&&(b[c]=JSON.stringify(a.toJSON()))};Object.defineProperty(n.prototype,"renderingRule",{set:function(a){a&&a.rasterFunction&&(a=c.fromJSON(b({},a.toJSON(),{rasterFunction:a.rasterFunction,rasterFunctionArguments:a.rasterFunctionArguments})));this._set("renderingRule",a)},enumerable:!0,
configurable:!0});n.prototype.writeRenderingRule=function(a,b,c){null!=a&&(b[c]=JSON.stringify(a.toJSON()))};n.prototype.writeRenderingRules=function(a,b,c){null!=a&&(b[c]=JSON.stringify(a.map(function(a){return a.toJSON()})))};n.prototype.writePixelSize=function(a,b,c){null!=a&&(b[c]=JSON.stringify(a.toJSON()))};n.prototype.writeTimeExtent=function(a,b,c){if(null!=a){var d=a.start?a.start.getTime():null;a=a.end?a.end.getTime():null;b[c]=null!=d?null!=a?d+","+a:""+d:null}};g([a.property({json:{write:!0}})],
n.prototype,"geometry",void 0);g([a.writer("geometry")],n.prototype,"writeGeometry",null);g([a.property({type:f,json:{write:!0}})],n.prototype,"mosaicRule",null);g([a.writer("mosaicRule")],n.prototype,"writeMosaicRule",null);g([a.property({type:c,json:{write:!0}})],n.prototype,"renderingRule",null);g([a.writer("renderingRule")],n.prototype,"writeRenderingRule",null);g([a.property({type:[c],json:{write:!0}})],n.prototype,"renderingRules",void 0);g([a.writer("renderingRules")],n.prototype,"writeRenderingRules",
null);g([a.property({type:d,json:{write:!0}})],n.prototype,"pixelSize",void 0);g([a.writer("pixelSize")],n.prototype,"writePixelSize",null);g([a.property({type:Boolean,json:{write:!0}})],n.prototype,"returnGeometry",void 0);g([a.property({type:Boolean,json:{write:!0}})],n.prototype,"returnCatalogItems",void 0);g([a.property({type:Boolean,json:{write:!0}})],n.prototype,"returnPixelValues",void 0);g([a.property({type:Number,json:{write:!0}})],n.prototype,"maxItemCount",void 0);g([a.property({type:r,
json:{write:{target:"time"}}})],n.prototype,"timeExtent",void 0);g([a.writer("timeExtent")],n.prototype,"writeTimeExtent",null);g([a.property({json:{write:!0}})],n.prototype,"raster",void 0);g([a.property({json:{write:!0}})],n.prototype,"viewId",void 0);return n=g([a.subclass("esri.tasks.support.ImageServiceIdentifyParameters")],n)}(a.declared(p.JSONSupport))})},"*noref":1}});
define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper ../core/tsSupport/generatorHelper ../core/tsSupport/awaiterHelper ../PopupTemplate ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/accessorSupport/decorators ./Layer ./mixins/ArcGISImageService ./mixins/ArcGISService ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./mixins/TemporalLayer ./support/commonProperties ../support/popupUtils".split(" "),function(D,
v,t,g,b,r,p,a,d,h,f,c,k,n,e,l,u,m,q,C,B,G){return function(e){function h(a,b){a=e.call(this,a)||this;a.legendEnabled=!0;a.isReference=null;a.operationalLayerType="ArcGISImageServiceLayer";a.popupEnabled=!0;a.popupTemplate=null;a.type="imagery";return a}t(h,e);h.prototype.normalizeCtorArgs=function(a,c){return"string"===typeof a?b({url:a},c):a};h.prototype.load=function(a){var b=this,c=d.isSome(a)?a.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"]},a).then(function(){return b._fetchService(c)},
function(){return b._fetchService(c)}));return f.resolve(this)};Object.defineProperty(h.prototype,"defaultPopupTemplate",{get:function(){return this.createPopupTemplate()},enumerable:!0,configurable:!0});h.prototype.createPopupTemplate=function(a){var b=this.rasterFields,c=this.title,d=new Set,e=!1,f=!1;this.capabilities&&(f=(e=this.capabilities&&this.capabilities.some(function(a){return"catalog"===a.toLowerCase()})||this.fields&&0<this.fields.length)&&("esriImageServiceDataTypeVector-UV"===this.serviceDataType||
"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType));var g=new Set;e&&(g.add("raster.itempixelvalue"),f&&g.add("raster.magnitude").add("raster.direction"));for(e=0;e<b.length;e++){var f=b[e],h=f.name.toLowerCase();g.has(h)||-1<h.indexOf("raster.servicepixelvalue.")||d.add(f.name)}return G.createPopupTemplate({fields:b,title:c,visibleFieldNames:d},a)};h.prototype.redraw=function(){this.emit("redraw")};g([c.property(B.legendEnabled)],h.prototype,"legendEnabled",void 0);g([c.property({type:["show",
"hide"]})],h.prototype,"listMode",void 0);g([c.property({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:function(){return{enabled:!1}}}}})],h.prototype,"isReference",void 0);g([c.property({type:["ArcGISImageServiceLayer"]})],h.prototype,"operationalLayerType",void 0);g([c.property(B.popupEnabled)],h.prototype,"popupEnabled",void 0);g([c.property({type:a,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],h.prototype,"popupTemplate",void 0);g([c.property({readOnly:!0,dependsOn:["fields",
"title"]})],h.prototype,"defaultPopupTemplate",null);g([c.property({readOnly:!0,json:{read:!1}})],h.prototype,"type",void 0);return h=g([c.subclass("esri.layers.ImageryLayer")],h)}(c.declared(C.TemporalLayer(m.RefreshableLayer(q.ScaleRangeLayer(l.OperationalLayer(u.PortalLayer(n.ArcGISImageService(e.ArcGISService(h.MultiOriginJSONMixin(k))))))))))});