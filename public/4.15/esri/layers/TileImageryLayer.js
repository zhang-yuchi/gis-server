// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.15/esri/copyright.txt for details.
//>>built
require({cache:{"esri/rasterRenderers":function(){define("require exports ./core/Warning ./renderers/ClassBreaksRenderer ./renderers/RasterColormapRenderer ./renderers/RasterStretchRenderer ./renderers/UniqueValueRenderer".split(" "),function(D,e,z,l,b,p,k){function a(a,g){if(!a)return null;var c;c=a?d[a.type]||null:null;if(c)return c=new c,c.read(a,g),c;g&&g.messages&&a&&g.messages.push(new z("renderer:unsupported","Renderers of type '"+(a.type||"unknown")+"' are not supported",{definition:a,context:g}));
return null}Object.defineProperty(e,"__esModule",{value:!0});e.ClassBreaksRenderer=l;e.RasterColormapRenderer=b;e.RasterStretchRenderer=p;e.UniqueValueRenderer=k;e.rasterRendererTypes={key:"type",base:null,typeMap:{"unique-value":k,"class-breaks":l,"raster-colormap":b,"raster-stretch":p}};var d={uniqueValue:k,classBreaks:l,rasterStretch:p,rasterColormap:b};e.read=a;e.fromJSON=function(b,g){return a(b,g)}})},"esri/renderers/RasterColormapRenderer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/paramHelper ../core/JSONSupport ../core/accessorSupport/decorators ./support/ColormapInfo ./support/colorRampUtils".split(" "),
function(D,e,z,l,b,p,k,a,d){return function(b){function g(a){a=b.call(this,a)||this;a.type="raster-colormap";return a}z(g,b);c=g;g.createFromColormap=function(g){if(!g)return null;var b=5===g[0].length;g=g.sort(function(a){return a[0]-a[1]});b=b?g.map(function(c){return a.fromJSON({value:c[0],color:c.slice(1,5),label:String(c[0])})}):g.map(function(c){return a.fromJSON({value:c[0],color:c.slice(1,4).concat([255]),label:String(c[0])})});return new c({colormapInfos:b})};g.createFromColorramp=function(a){a=
d.convertColorRampToColormap(a,256);return c.createFromColormap(a)};g.prototype.clone=function(){return new c({colormapInfos:this.colormapInfos.map(function(a){return a.toJSON()})})};g.prototype.extractColormap=function(){return this.colormapInfos.map(function(a){return[a.value,a.color.r,a.color.g,a.color.b,1<a.color.a?a.color.a:255*a.color.a&255]}).sort(function(a,c){return a[0]-c[0]})};var c;l([k.property({type:[a],json:{write:!0}})],g.prototype,"colormapInfos",void 0);l([k.enumeration.serializable()({rasterColormap:"raster-colormap"})],
g.prototype,"type",void 0);return g=c=l([k.subclass("esri.renderers.RasterColormapRenderer")],g)}(k.declared(p.JSONSupport))})},"esri/renderers/support/ColormapInfo":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/paramHelper ../../Color ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(D,e,z,l,b,p,k,a){return function(b){function d(){var a=null!==b&&b.apply(this,arguments)||this;
a.value=null;a.label=null;a.color=null;return a}z(d,b);l([a.property({type:Number,json:{write:!0}})],d.prototype,"value",void 0);l([a.property({type:String,json:{write:!0}})],d.prototype,"label",void 0);l([a.property({type:p,json:{write:!0}})],d.prototype,"color",void 0);return d=l([a.subclass("esri.renderers.support.ColormapInfo")],d)}(a.declared(k.JSONSupport))})},"esri/renderers/support/colorRampUtils":function(){define(["require","exports","../../Color","../../core/colorUtils"],function(D,e,z,
l){function b(a,b){if(!a||!b||a.length!==b.length)return!1;for(var d=0;d<a.length;d++)if(a[d]>b[d]+2||a[d]<b[d]-2)return!1;return!0}function p(a,b,f){a=l.toLAB(a);b=l.toLAB(b);return l.toRGB({l:a.l*(1-f)+f*b.l,a:a.a*(1-f)+f*b.a,b:a.b*(1-f)+f*b.b})}function k(a,d){if(a){d=d?d:e.PREDEFINED_JSON_COLOR_RAMPS;var f=null,g;"algorithmic"===a.type?d.some(function(c){if(b(a.fromColor.toRgb(),c.fromColor)&&b(a.toColor.toRgb(),c.toColor))return f=c.id,!0}):"multipart"===a.type&&d.some(function(c){if(a.colorRamps&&
c.colorRamps&&a.colorRamps.length===c.colorRamps.length&&(g=a.colorRamps,!c.colorRamps.some(function(a,c){if(!b(g[c].fromColor.toRgb(),(new z(a.fromColor)).toRgb())||!b(g[c].toColor.toRgb(),(new z(a.toColor)).toRgb()))return!0}))){if(f)return!0;f=c.id}});return f}}Object.defineProperty(e,"__esModule",{value:!0});e.PREDEFINED_JSON_COLOR_RAMPS=[{id:"aspect_predefined",type:"multipart",colorRamps:[{fromColor:[190,190,190],toColor:[255,45,8]},{fromColor:[255,45,8],toColor:[255,181,61]},{fromColor:[255,
181,61],toColor:[255,254,52]},{fromColor:[255,254,52],toColor:[0,251,50]},{fromColor:[0,251,50],toColor:[255,254,52]},{fromColor:[0,253,255],toColor:[0,181,255]},{fromColor:[0,181,255],toColor:[26,35,253]},{fromColor:[26,35,253],toColor:[255,57,251]},{fromColor:[255,57,251],toColor:[255,45,8]}]},{id:"blackToWhite_predefined",fromColor:[0,0,0],toColor:[255,255,255]},{id:"blueBright_predefined",fromColor:[204,204,255],toColor:[0,0,224]},{id:"blueLightToDark_predefined",fromColor:[211,229,232],toColor:[46,
100,140]},{id:"blueGreenBright_predefined",fromColor:[203,245,234],toColor:[48,207,146]},{id:"blueGreenLightToDark_predefined",fromColor:[216,242,237],toColor:[21,79,74]},{id:"brownLightToDark_predefined",fromColor:[240,236,170],toColor:[102,72,48]},{id:"brownToBlueGreenDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[156,85,31],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[33,130,145]}]},{id:"brownToBlueGreenDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[110,
70,45],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[48,100,102]}]},{id:"coefficientBias_predefined",fromColor:[214,214,255],toColor:[0,57,148]},{id:"coldToHotDiverging_predefined",type:"multipart",colorRamps:[{fromColor:[69,117,181],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[214,47,39]}]},{id:"conditionNumber_predefined",type:"multipart",colorRamps:[{fromColor:[0,97,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,34,0]}]},{id:"cyanToPurple_predefined",type:"multipart",
colorRamps:[{fromColor:[0,245,245],toColor:[0,0,245]},{fromColor:[0,0,245],toColor:[245,0,245]}]},{id:"cyanLightToBlueDark_predefined",type:"multipart",colorRamps:[{fromColor:[182,237,240],toColor:[31,131,224]},{fromColor:[31,131,224],toColor:[9,9,145]}]},{id:"distance_predefined",fromColor:[255,200,0],toColor:[0,0,255]},{id:"elevation1_predefined",type:"multipart",colorRamps:[{fromColor:[175,240,233],toColor:[255,255,179]},{fromColor:[255,255,179],toColor:[0,128,64]},{fromColor:[0,128,64],toColor:[252,
186,3]},{fromColor:[252,186,3],toColor:[128,0,0]},{fromColor:[120,0,0],toColor:[105,48,13]},{fromColor:[105,48,13],toColor:[171,171,171]},{fromColor:[171,171,171],toColor:[255,252,255]}]},{id:"elevation2_predefined",type:"multipart",colorRamps:[{fromColor:[118,219,211],toColor:[255,255,199]},{fromColor:[255,255,199],toColor:[255,255,128]},{fromColor:[255,255,128],toColor:[217,194,121]},{fromColor:[217,194,121],toColor:[135,96,38]},{fromColor:[135,96,38],toColor:[150,150,181]},{fromColor:[150,150,
181],toColor:[181,150,181]},{fromColor:[181,150,181],toColor:[255,252,255]}]},{id:"errors_predefined",fromColor:[255,235,214],toColor:[196,10,10]},{id:"grayLightToDark_predefined",fromColor:[219,219,219],toColor:[69,69,69]},{id:"greenBright_predefined",fromColor:[204,255,204],toColor:[14,204,14]},{id:"greenLightToDark_predefined",fromColor:[220,245,233],toColor:[34,102,51]},{id:"greenToBlue_predefined",type:"multipart",colorRamps:[{fromColor:[32,204,16],toColor:[0,242,242]},{fromColor:[0,242,242],
toColor:[2,33,227]}]},{id:"orangeBright_predefined",fromColor:[255,235,204],toColor:[240,118,5]},{id:"orangeLightToDark_predefined",fromColor:[250,233,212],toColor:[171,65,36]},{id:"partialSpectrum_predefined",type:"multipart",colorRamps:[{fromColor:[242,241,162],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]},{fromColor:[252,3,69],toColor:[176,7,237]},{fromColor:[176,7,237],toColor:[2,29,173]}]},{id:"partialSpectrum1Diverging_predefined",type:"multipart",colorRamps:[{fromColor:[135,
38,38],toColor:[240,149,12]},{fromColor:[240,149,12],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[74,80,181]},{fromColor:[74,80,181],toColor:[39,32,122]}]},{id:"partialSpectrum2Diverging_predefined",type:"multipart",colorRamps:[{fromColor:[115,77,42],toColor:[201,137,52]},{fromColor:[201,137,52],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[91,63,176]},{fromColor:[91,63,176],toColor:[81,13,97]}]},{id:"pinkToYellowGreenDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[158,
30,113],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[99,110,45]}]},{id:"pinkToYellowGreenDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[97,47,73],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[22,59,15]}]},{id:"precipitation_predefined",type:"multipart",colorRamps:[{fromColor:[194,82,60],toColor:[237,161,19]},{fromColor:[237,161,19],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,219,0]},{fromColor:[0,219,0],toColor:[32,153,143]},{fromColor:[32,153,
143],toColor:[11,44,122]}]},{id:"prediction_predefined",type:"multipart",colorRamps:[{fromColor:[40,146,199],toColor:[250,250,100]},{fromColor:[250,250,100],toColor:[232,16,20]}]},{id:"purpleBright_predefined",fromColor:[255,204,255],toColor:[199,0,199]},{id:"purpleToGreenDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[77,32,150],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[20,122,11]}]},{id:"purpleToGreenDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[67,
14,89],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[24,79,15]}]},{id:"purpleBlueBright_predefined",fromColor:[223,184,230],toColor:[112,12,242]},{id:"purpleBlueLightToDark_predefined",fromColor:[229,213,242],toColor:[93,44,112]},{id:"purpleRedBright_predefined",fromColor:[255,204,225],toColor:[199,0,99]},{id:"purpleRedLightToDark_predefined",fromColor:[250,215,246],toColor:[143,17,57]},{id:"redBright_predefined",fromColor:[255,204,204],toColor:[219,0,0]},{id:"redLightToDark_predefined",
fromColor:[255,224,224],toColor:[143,10,10]},{id:"redToBlueDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[196,69,57],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[48,95,207]}]},{id:"redToBlueDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[107,13,13],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[13,53,97]}]},{id:"redToGreen_predefined",type:"multipart",colorRamps:[{fromColor:[245,0,0],toColor:[245,245,0]},{fromColor:[245,245,0],toColor:[0,
245,0]}]},{id:"redToGreenDivergingBright_predefined",type:"multipart",colorRamps:[{fromColor:[186,20,20],toColor:[255,255,191]},{fromColor:[255,255,191],toColor:[54,145,33]}]},{id:"redToGreenDivergingDark_predefined",type:"multipart",colorRamps:[{fromColor:[97,21,13],toColor:[204,204,102]},{fromColor:[204,204,102],toColor:[16,69,16]}]},{id:"slope_predefined",type:"multipart",colorRamps:[{fromColor:[56,168,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]}]},{id:"spectrumFullBright_predefined",
type:"multipart",colorRamps:[{fromColor:[255,0,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,0,255]}]},{id:"spectrumFullDark_predefined",type:"multipart",colorRamps:[{fromColor:[153,0,0],toColor:[153,153,0]},{fromColor:[153,153,0],toColor:[0,153,153]},{fromColor:[0,153,153],toColor:[0,0,153]}]},{id:"spectrumFullLight_predefined",type:"multipart",colorRamps:[{fromColor:[255,153,153],toColor:[255,255,153]},{fromColor:[255,255,153],toColor:[153,
255,255]},{fromColor:[153,255,255],toColor:[153,153,255]}]},{id:"surface_predefined",type:"multipart",colorRamps:[{fromColor:[112,153,89],toColor:[242,238,162]},{fromColor:[242,238,162],toColor:[242,206,133]},{fromColor:[242,206,133],toColor:[194,140,124]},{fromColor:[194,140,124],toColor:[255,242,255]}]},{id:"temperature_predefined",type:"multipart",colorRamps:[{fromColor:[255,252,255],toColor:[255,0,255]},{fromColor:[255,0,255],toColor:[0,0,255]},{fromColor:[0,0,255],toColor:[0,255,255]},{fromColor:[0,
255,255],toColor:[0,255,0]},{fromColor:[0,255,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,128,0]},{fromColor:[255,128,0],toColor:[128,0,0]}]},{id:"whiteToBlack_predefined",fromColor:[255,255,255],toColor:[0,0,0]},{id:"yellowToDarkRed_predefined",type:"multipart",colorRamps:[{fromColor:[255,255,128],toColor:[242,167,46]},{fromColor:[242,167,46],toColor:[107,0,0]}]},{id:"yellowToGreenToDarkBlue_predefined",type:"multipart",colorRamps:[{fromColor:[255,255,128],toColor:[56,224,9]},{fromColor:[56,
224,9],toColor:[26,147,171]},{fromColor:[26,147,171],toColor:[12,16,120]}]},{id:"yellowToRed_predefined",fromColor:[245,245,0],toColor:[255,0,0]},{id:"yellowGreenBright_predefined",fromColor:[236,252,204],toColor:[157,204,16]},{id:"yellowGreenLightToDark_predefined",fromColor:[215,240,175],toColor:[96,107,45]}];e.PREDEFINED_COLOR_RAMP_NAME_MAP={aspect_predefined:"Aspect",blackToWhite_predefined:"Black to White",blueBright_predefined:"Blue Bright",blueLightToDark_predefined:"Blue Light to Dark",blueGreenBright_predefined:"Blue-Green Bright",
blueGreenLightToDark_predefined:"Blue-Green Light to Dark",brownLightToDark_predefined:"Brown Light to Dark",brownToBlueGreenDivergingBright_predefined:"Brown to Blue Green Diverging, Bright",brownToBlueGreenDivergingDark_predefined:"Brown to Blue Green Diverging, Dark",coefficientBias_predefined:"Coefficient Bias",coldToHotDiverging_predefined:"Cold to Hot Diverging",conditionNumber_predefined:"Condition Number",cyanToPurple_predefined:"Cyan to Purple",cyanLightToBlueDark_predefined:"Cyan-Light to Blue-Dark",
distance_predefined:"Distance",elevation1_predefined:"Elevation #1",elevation2_predefined:"Elevation #2",errors_predefined:"Errors",grayLightToDark_predefined:"Gray Light to Dark",greenBright_predefined:"Green Bright",greenLightToDark_predefined:"Green Light to Dark",greenToBlue_predefined:"Green to Blue",orangeBright_predefined:"Orange Bright",orangeLightToDark_predefined:"Orange Light to Dark",partialSpectrum_predefined:"Partial Spectrum",partialSpectrum1Diverging_predefined:"Partial Spectrum 1 Diverging",
partialSpectrum2Diverging_predefined:"Partial Spectrum 2 Diverging",pinkToYellowGreenDivergingBright_predefined:"Pink to YellowGreen Diverging, Bright",pinkToYellowGreenDivergingDark_predefined:"Pink to YellowGreen Diverging, Dark",precipitation_predefined:"Precipitation",prediction_predefined:"Prediction",purpleBright_predefined:"Purple Bright",purpleToGreenDivergingBright_predefined:"Purple to Green Diverging, Bright",purpleToGreenDivergingDark_predefined:"Purple to Green Diverging, Dark",purpleBlueBright_predefined:"Purple-Blue Bright",
purpleBlueLightToDark_predefined:"Purple-Blue Light to Dark",purpleRedBright_predefined:"Purple-Red Bright",purpleRedLightToDark_predefined:"Purple-Red Light to Dark",redBright_predefined:"Red Bright",redLightToDark_predefined:"Red Light to Dark",redToBlueDivergingBright_predefined:"Red to Blue Diverging, Bright",redToBlueDivergingDark_predefined:"Red to Blue Diverging, Dark",redToGreen_predefined:"Red to Green",redToGreenDivergingBright_predefined:"Red to Green Diverging, Bright",redToGreenDivergingDark_predefined:"Red to Green Diverging, Dark",
slope_predefined:"Slope",spectrumFullBright_predefined:"Spectrum-Full Bright",spectrumFullDark_predefined:"Spectrum-Full Dark",spectrumFullLight_predefined:"Spectrum-Full Light",surface_predefined:"Surface",temperature_predefined:"Temperature",whiteToBlack_predefined:"White to Black",yellowToDarkRed_predefined:"Yellow to Dark Red",yellowToGreenToDarkBlue_predefined:"Yellow to Green to Dark Blue",yellowToRed_predefined:"Yellow to Red",yellowGreenBright_predefined:"Yellow-Green Bright",yellowGreenLightToDark_predefined:"Yellow-Green Light to Dark"};
e.getColorRampId=k;e.getColorRampName=function(a){return(a=k(a))?e.PREDEFINED_COLOR_RAMP_NAME_MAP[a]:null};e.convertColorRampToColormap=function(a,b){if(a&&b){for(var d="multipart"===a.type?a.colorRamps.length:1,g=[],c=[],k,y,h,n,v,m=0,w=0;w<d;w++)g[w]={start:null,end:null},g[w].start=m,g[w].end=m+1/d,m=g[w].end;d=function(m){n=m/b;g.forEach(function(g,d){n>=g.start&&n<g.end&&(v=(n-g.start)/(g.end-g.start),"multipart"===a.type?(k=new z(a.colorRamps[d].fromColor),y=new z(a.colorRamps[d].toColor)):
(k=new z(a.fromColor),y=new z(a.toColor)),h=p(k,y,v),0===m?c.push([m,k.r,k.g,k.b]):m===b-1?c.push([m,y.r,y.g,y.b]):(h=p(k,y,v),c.push([m,h.r,h.g,h.b])))})};for(w=0;w<b;w++)d(w);return c}}})},"esri/core/colorUtils":function(){define(["require","exports"],function(D,e){function z(a,c){var g=[],b,d;if(a[0].length!==c.length)throw"dimensions do not match";var f=a.length,v=a[0].length,m=0;for(b=0;b<f;b++){for(d=m=0;d<v;d++)m+=a[b][d]*c[d];g.push(m)}return g}function l(a){a=[a.r/255,a.g/255,a.b/255].map(function(a){return.04045>=
a?a/12.92:Math.pow((a+.055)/1.055,2.4)});a=z(d,a);return{x:100*a[0],y:100*a[1],z:100*a[2]}}function b(a){a=z(f,[a.x/100,a.y/100,a.z/100]).map(function(a){return Math.min(1,Math.max(.0031308>=a?12.92*a:1.055*Math.pow(a,1/2.4)-.055,0))});return{r:Math.round(255*a[0]),g:Math.round(255*a[1]),b:Math.round(255*a[2])}}function p(a){a=[a.x/95.047,a.y/100,a.z/108.883].map(function(a){return a>Math.pow(6/29,3)?Math.pow(a,1/3):1/3*Math.pow(29/6,2)*a+4/29});return{l:116*a[1]-16,a:500*(a[0]-a[1]),b:200*(a[1]-
a[2])}}function k(a){var c=a.l;a=[(c+16)/116+a.a/500,(c+16)/116,(c+16)/116-a.b/200].map(function(a){return a>6/29?Math.pow(a,3):3*Math.pow(6/29,2)*(a-4/29)});return{x:95.047*a[0],y:100*a[1],z:108.883*a[2]}}function a(a){if("r"in a&&"g"in a&&"b"in a)return a;if("l"in a&&"c"in a&&"h"in a){var c=a.c,d=a.h;return b(k({l:a.l,a:c*Math.cos(d),b:c*Math.sin(d)}))}if("l"in a&&"a"in a&&"b"in a)return b(k(a));if("x"in a&&"y"in a&&"z"in a)return b(a);if("h"in a&&"s"in a&&"v"in a){d=(a.h+360)%360/60;c=a.v/100*
255;a=a.s/100*c;var g=a*(1-Math.abs(d%2-1));switch(Math.floor(d)){case 0:d={r:a,g:g,b:0};break;case 1:d={r:g,g:a,b:0};break;case 2:d={r:0,g:a,b:g};break;case 3:d={r:0,g:g,b:a};break;case 4:d={r:g,g:0,b:a};break;case 5:case 6:d={r:a,g:0,b:g};break;default:d={r:0,g:0,b:0}}d.r=Math.round(d.r+c-a);d.g=Math.round(d.g+c-a);d.b=Math.round(d.b+c-a);return d}}Object.defineProperty(e,"__esModule",{value:!0});var d=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],f=[[3.2406,-1.5372,-.4986],[-.9689,
1.8758,.0415],[.0557,-.204,1.057]];e.toRGB=a;e.toHSV=function(b){if("h"in b&&"s"in b&&"v"in b)return b;var c=a(b);b=c.r;var d=c.g,c=c.b,g=Math.max(b,d,c),f=g-Math.min(b,d,c),n;0===f?n=0:g===b?n=(d-c)/f%6:g===d?n=(c-b)/f+2:g===c&&(n=(b-d)/f+4);0>n&&(n+=6);return{h:60*n,s:100*(0===f?0:f/g),v:100/255*g}};e.toLAB=function(b){return"l"in b&&"a"in b&&"b"in b?b:p(l(a(b)))};e.toLCH=function(b){if(!("l"in b&&"c"in b&&"h"in b)){var c=p(l(a(b)));b=c.l;var d=c.a,g=c.b,c=Math.sqrt(d*d+g*g),d=Math.atan2(g,d),d=
0<d?d:d+2*Math.PI;b={l:b,c:c,h:d}}return b};e.toXYZ=function(b){return"x"in b&&"y"in b&&"z"in b?b:l(a(b))};e.darken=function(a,c){a=p(l(a));a.l*=1-c;return b(k(a))}})},"esri/renderers/RasterStretchRenderer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/paramHelper ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators ./support/stretchRendererUtils ../tasks/support/colorRamps".split(" "),function(D,e,z,l,b,
p,k,a,d,f){return function(b){function c(a){a=b.call(this,a)||this;a.colorRamp=null;a.computeGamma=!1;a.dynamicRangeAdjustment=!1;a.gamma=[];a.maxPercent=null;a.minPercent=null;a.numberOfStandardDeviations=null;a.outputMax=null;a.outputMin=null;a.sigmoidStrengthLevel=null;a.statistics=[];a.histograms=null;a.useGamma=!1;a.stretchType="none";a.type="raster-stretch";return a}z(c,b);g=c;c.prototype.readColorRamp=function(a){if(a)return f.fromJSON(a)};c.prototype.writeStatistics=function(a,b,c){null==
a||0===a.length?a=null:a[0]instanceof Array||(a=a.map(function(a){return[a.min,a.max,a.avg,a.stddev]}));b[c]=a};c.prototype.readStretchType=function(a,b){a=b.stretchType;"number"===typeof a&&(a=d.stretchTypeFunctionEnum[a]);return d.stretchTypeJSONDict.read(a)};c.prototype.clone=function(){return new g({stretchType:this.stretchType,outputMin:this.outputMin,outputMax:this.outputMax,useGamma:this.useGamma,computeGamma:this.computeGamma,statistics:k.clone(this.statistics),gamma:k.clone(this.gamma),sigmoidStrengthLevel:this.sigmoidStrengthLevel,
numberOfStandardDeviations:this.numberOfStandardDeviations,minPercent:this.minPercent,maxPercent:this.maxPercent,colorRamp:k.clone(this.colorRamp),histograms:k.clone(this.histograms),dynamicRangeAdjustment:this.dynamicRangeAdjustment})};var g;l([a.property({types:f.types,json:{write:!0}})],c.prototype,"colorRamp",void 0);l([a.reader("colorRamp")],c.prototype,"readColorRamp",null);l([a.property({type:Boolean,json:{write:!0}})],c.prototype,"computeGamma",void 0);l([a.property({type:Boolean,json:{write:{target:"dra"},
read:{source:"dra"}}})],c.prototype,"dynamicRangeAdjustment",void 0);l([a.property({type:[Number],json:{write:{allowNull:!0}}})],c.prototype,"gamma",void 0);l([a.property({type:Number,json:{write:{allowNull:!0}}})],c.prototype,"maxPercent",void 0);l([a.property({type:Number,json:{write:{allowNull:!0}}})],c.prototype,"minPercent",void 0);l([a.property({type:Number,json:{write:{allowNull:!0}}})],c.prototype,"numberOfStandardDeviations",void 0);l([a.property({type:Number,json:{read:{source:"max"},write:{target:"max",
allowNull:!0}}})],c.prototype,"outputMax",void 0);l([a.property({type:Number,json:{read:{source:"min"},write:{target:"min",allowNull:!0}}})],c.prototype,"outputMin",void 0);l([a.property({type:Number,json:{write:{allowNull:!0}}})],c.prototype,"sigmoidStrengthLevel",void 0);l([a.property({json:{write:{allowNull:!0}}})],c.prototype,"statistics",void 0);l([a.property()],c.prototype,"histograms",void 0);l([a.writer("statistics")],c.prototype,"writeStatistics",null);l([a.property({type:Boolean,json:{write:!0}})],
c.prototype,"useGamma",void 0);l([a.property({type:d.stretchTypeJSONDict.apiValues,json:{type:d.stretchTypeJSONDict.jsonValues,write:d.stretchTypeJSONDict.write}})],c.prototype,"stretchType",void 0);l([a.reader("stretchType",["stretchType"])],c.prototype,"readStretchType",null);l([a.enumeration.serializable()({rasterStretch:"raster-stretch"})],c.prototype,"type",void 0);return c=g=l([a.subclass("esri.renderers.RasterStretchRenderer")],c)}(a.declared(p.JSONSupport))})},"esri/renderers/support/stretchRendererUtils":function(){define(["require",
"exports","../../core/jsonMap"],function(D,e,z){Object.defineProperty(e,"__esModule",{value:!0});e.stretchTypeJSONDict=new z.default({none:"none",standardDeviation:"standard-deviation",histogramEqualization:"histogram-equalization",minMax:"min-max",percentClip:"percent-clip",sigmoid:"sigmoid"});e.stretchTypeFunctionEnum={0:"none",3:"standardDeviation",4:"histogramEqualization",5:"minMax",6:"percentClip",9:"sigmoid"}})},"esri/layers/support/DimensionalDefinition":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType".split(" "),
function(D,e,z,l,b,p,k,a){return function(b){function d(a){a=b.call(this,a)||this;a.variableName=null;a.dimensionName=null;a.values=[];a.isSlice=!1;return a}z(d,b);g=d;d.prototype.clone=function(){return new g({variableName:this.variableName,dimensionName:this.dimensionName,values:p.clone(this.values),isSlice:this.isSlice})};var g;l([k.property({type:String,json:{write:!0}})],d.prototype,"variableName",void 0);l([k.property({type:String,json:{write:!0}})],d.prototype,"dimensionName",void 0);l([k.property({type:a.types.array(a.types.oneOf([a.types.native(Number),
a.types.array(a.types.native(Number))])),json:{write:!0}})],d.prototype,"values",void 0);l([k.property({type:Boolean,json:{write:!0}})],d.prototype,"isSlice",void 0);return d=g=l([k.subclass("esri.layers.support.DimensionalDefinition")],d)}(k.declared(b.JSONSupport))})},"esri/layers/support/imageryRendererUtils":function(){define("require exports ../../rasterRenderers ../../core/arrayUtils ../../core/lang ./RasterFunction ../../renderers/support/colorRampUtils ../../renderers/support/stretchRendererUtils".split(" "),
function(D,e,z,l,b,p,k,a){function d(a){var b=a.Raster;return b&&"esri.layers.support.RasterFunction"===b.declaredClass?d(b.functionArguments):a}function f(a,b){var d=[],m=[],f=[],n=[],h=b.pixelType,r=(b=b.rasterAttributeTable)&&b.features,q=c(b);if(r&&Array.isArray(r)&&a.classBreakInfos)return a.classBreakInfos.forEach(function(b,c){var d=b.symbol.color,m;d.a&&r.forEach(function(g){m=g.attributes[a.field];(m>=b.minValue&&m<b.maxValue||c===a.classBreakInfos.length-1&&m>=b.minValue)&&n.push([g.attributes[q],
d.r,d.g,d.b])})}),h=h?g(n,h):n,b=new p,b.functionName="Colormap",b.functionArguments={},b.functionArguments.Colormap=h,b.variableName="Raster",b;a.classBreakInfos.forEach(function(a,b){var c=a.symbol&&a.symbol.color;c.a?(0===b?d.push(a.minValue,a.maxValue+1E-6):d.push(a.minValue+1E-6,a.maxValue+1E-6),m.push(b),n.push([b,c.r,c.g,c.b])):f.push(a.minValue,a.maxValue)});h=h?g(n,h):n;b=new p;b.functionName="Remap";b.functionArguments={InputRanges:d,OutputValues:m,NoDataRanges:f};b.variableName="Raster";
var v=new p;v.functionName="Colormap";v.functionArguments={Colormap:h,Raster:b};return v}function g(a,b){(b=y[String(b).toLowerCase()])&&a.push([Math.floor(b[0]-1),0,0,0],[Math.ceil(b[1]+1),0,0,0]);return a}function c(a){if(a)return(a=(a=a.fields)&&l.find(a,function(a){return a&&a.name&&"value"===a.name.toLowerCase()}))&&a.name}function C(a,b){var d=[],m=b.pixelType,f=(b=b.rasterAttributeTable)&&b.features,h=c(b),n=!1;a.uniqueValueInfos&&a.uniqueValueInfos.forEach(function(b){var c=b.symbol.color;
c.a&&(a.field!==h&&f?f&&f.forEach(function(q){String(q.attributes[a.field])===String(b.value)&&d.push([q.attributes[h],c.r,c.g,c.b])}):isNaN(b.value)?n=!0:d.push([b.value,c.r,c.g,c.b]))});if(n)return null;m=m&&0<d.length?g(d,m):d;b=new p;b.functionName="Colormap";b.functionArguments={};b.functionArguments.Colormap=m;b.variableName="Raster";return b}Object.defineProperty(e,"__esModule",{value:!0});var y={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767]},h={type:"multipart",
colorRamps:[{fromColor:[0,0,255],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]}]};e.isSupportedRendererType=function(a){a=a.type;return"raster-stretch"===a||"unique-value"===a||"class-breaks"===a};e.combineRenderingRules=function(a,c){if(!a||!c)return b.clone(a||c);a=b.clone(a);"none"!==c.functionName.toLowerCase()&&(d(a.functionArguments).Raster=c);return a};e.convertRendererToRenderingRule=function(b,c){c=c||{};switch(b.type){case "raster-stretch":var d=
new p;d.functionName="Stretch";var m=n[a.stretchTypeJSONDict.toJSON(b.stretchType)],h={StretchType:m,Statistics:b.statistics,DRA:b.dynamicRangeAdjustment,UseGamma:b.useGamma,Gamma:b.gamma,ComputeGamma:b.computeGamma};null!=b.outputMin&&(h.Min=b.outputMin);null!=b.outputMax&&(h.Max=b.outputMax);m===n.standardDeviation?(h.NumberOfStandardDeviations=b.numberOfStandardDeviations,d.outputPixelType="u8"):m===n.percentClip?(h.MinPercent=b.minPercent,h.MaxPercent=b.maxPercent,d.outputPixelType="u8"):m===
n.minMax?d.outputPixelType="u8":m===n.sigmoid&&(h.SigmoidStrengthLevel=b.sigmoidStrengthLevel);d.functionArguments=h;d.variableName="Raster";if(b.colorRamp){var m=b.colorRamp,h=new p,v=k.getColorRampName(m);h.functionArguments=v?{colorRamp:v}:!c.convertColorRampToColormap||"algorithmic"!==m.type&&"multipart"!==m.type?{colorRamp:b.colorRamp.toJSON()}:{Colormap:k.convertColorRampToColormap(m,256)};h.variableName="Raster";h.functionName="Colormap";h.functionArguments.Raster=d;b=h}else b=d;return b;case "class-breaks":return f(b,
c);case "unique-value":return C(b,c);case "raster-colormap":return(b=b.extractColormap())&&0!==b.length?(b=(c=c.pixelType)?g(b,c):b,c=new p,c.functionName="Colormap",c.functionArguments={},c.functionArguments.Colormap=b,b=c):b=void 0,b}};e.createDefaultRenderer=function(a,b){if(a){var c=a.attributeTable,d=a.dataType,m=a.bandCount,g=a.pixelType,f=a.colormap,r=a.statistics,q=a.histograms;b&&0<b.length&&(r=r?b.map(function(a){return r[a]}):null,q=q?b.map(function(a){return q[a]}):null);var n;if(1===
m&&f&&0<f.length)n=z.RasterColormapRenderer.createFromColormap(f);else if(1===m&&c){var v=c.fields.filter(function(a){return"red"===a.name.toLowerCase()})[0],k=c.fields.filter(function(a){return"green"===a.name.toLowerCase()})[0],y=c.fields.filter(function(a){return"blue"===a.name.toLowerCase()})[0];a=c.fields.filter(function(a){return"value"===a.name})[0];var l=c.fields.filter(function(a){return"classname"===a.name.toLowerCase()})[0];l||(l=c.fields.filter(function(a){return"string"===a.type})[0])||
(l=a);v&&k&&y&&l&&(n=z.UniqueValueRenderer.fromJSON({field1:l.name,uniqueValueInfos:c.features.map(function(a){return{value:a.attributes[l.name],label:a.attributes[l.name],symbol:{color:[a.attributes[v.name],a.attributes[k.name],a.attributes[y.name],255],type:"esriSFS",style:"esriSFSSolid"}}})}))}n||(c=void 0,n=!1,m=b=a=void 0,"u8"===g&&"processed"===d?(c="min-max",r=r||[{min:0,max:255},{min:0,max:255},{min:0,max:255}]):"u8"===g||"elevation"===d?(c="min-max",n=r?!1:!0):"scientific"===d?(c="min-max",
n=r?!1:!0,a=h):q&&0<q.length?(c="percent-clip",m=b=.25):r?c="min-max":(c="percent-clip",n=!0),n=z.RasterStretchRenderer.fromJSON({stretchType:c,dra:n,colorRamp:a,min:0,max:255,statistics:n?null:r,histograms:n?null:q,maxPercent:b,minPercent:m}));return n}};e.getDefaultBandCombination=function(a){var b=a.bandCount;if(1===b)return null;if(2===b)return[0];a=a.keyProperties&&a.keyProperties.BandProperties;var c,d,g,f,h;if(a&&a.length===b){for(var n=0;n<a.length;n++)a[n].BandName&&"red"===a[n].BandName.toLowerCase()&&
(d=n),a[n].BandName&&"green"===a[n].BandName.toLowerCase()&&(g=n),a[n].BandName&&"blue"===a[n].BandName.toLowerCase()&&(f=n),a[n].BandName&&"nearinfrared"===a[n].BandName.toLowerCase()&&(h=n);void 0!==d&&void 0!==g&&void 0!==f?c=[d,g,f]:void 0!==d&&void 0!==g&&void 0!==h&&(c=[h,d,g])}!c&&3<b&&(c=[0,1,2]);return c};var n={none:0,standardDeviation:3,histogramEqualization:4,minMax:5,percentClip:6,sigmoid:9}})},"esri/layers/support/RasterFunction":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/lang ../../core/SetUtils ../../core/accessorSupport/decorators".split(" "),
function(D,e,z,l,b,p,k,a){var d=k.createSetFromValues(["Raster","Raster2","DEM","FillRaster"]),f=k.createSetFromValues(["Rasters"]),g=function(a){return a&&a.rasterFunction?y.fromJSON(a):a},c=function(a){return a&&a instanceof y?a.toJSON():a},C;(function(a){a[a.MOSAIC=0]="MOSAIC";a[a.GROUP=1]="GROUP";a[a.ITEM=2]="ITEM"})(C||(C={}));var y=function(b){function n(a){a=b.call(this,a)||this;a.functionArguments=null;a.functionName=null;a.outputPixelType="unknown";a.variableName=null;a.description=null;
a.functionDefinition=null;a.thumbnail=null;return a}z(n,b);h=n;n.prototype.readFunctionArguments=function(a,b){a=b.arguments||b.rasterFunctionArguments;if(null==a)a=null;else{b={};for(var c=0,m=Object.keys(a);c<m.length;c++){var n=m[c];d.has(n)?b[n]=g(a[n]):f.has(n)&&Array.isArray(a[n])?b[n]=a[n].map(g):b[n]=a[n]}a=b}return a};n.prototype.writeFunctionArguments=function(a,b,g){for(var m={},n=0,h=Object.keys(a);n<h.length;n++){var r=h[n];d.has(r)?m[r]=c(a[r]):f.has(r)&&Array.isArray(a[r])?m[r]=a[r].map(c):
m[r]=c(a[r])}this.functionDefinition?b.arguments=m:b[g]=m};n.prototype.readFunctionName=function(a,b){a=b.rasterFunctionInfos;var c=b.name;return c?c:a&&a.length&&"None"!==a[0].name?a[0].name:b.rasterFunction};n.prototype.writeFunctionName=function(a,b,c){this.functionDefinition?b.name=a:b[c]=a};n.prototype.readFunctionType=function(a){return C[a]};n.prototype.writeFunctionType=function(a,b,c){b[c]=C[a]};n.prototype.clone=function(){return new h({functionName:this.functionName,functionArguments:p.clone(this.functionArguments),
outputPixelType:this.outputPixelType,variableName:this.variableName,name:this.functionName,description:this.description,functionType:this.functionType,functionDefinition:this.functionDefinition,thumbnail:this.thumbnail})};var h;l([a.property({json:{type:Object,write:{target:"rasterFunctionArguments"}}})],n.prototype,"functionArguments",void 0);l([a.reader("functionArguments",["rasterFunctionArguments","arguments"])],n.prototype,"readFunctionArguments",null);l([a.writer("functionArguments")],n.prototype,
"writeFunctionArguments",null);l([a.property({json:{type:String,write:{target:"rasterFunction"}}})],n.prototype,"functionName",void 0);l([a.reader("functionName",["rasterFunction","rasterFunctionInfos","name"])],n.prototype,"readFunctionName",null);l([a.writer("functionName")],n.prototype,"writeFunctionName",null);l([a.enumeration.serializable()({C128:"c128",C64:"c64",F32:"f32",F64:"f64",S16:"s16",S32:"s32",S8:"s8",U1:"u1",U16:"u16",U2:"u2",U32:"u32",U4:"u4",U8:"u8",UNKNOWN:"unknown"},{ignoreUnknown:!1}),
a.property({json:{default:"unknown"}})],n.prototype,"outputPixelType",void 0);l([a.property({type:String,json:{read:!0,write:!0}})],n.prototype,"variableName",void 0);l([a.property({type:String,json:{read:!0,write:!0,origins:{"web-document":{read:!1,write:!1}}}})],n.prototype,"description",void 0);l([a.property({json:{origins:{"web-document":{read:!1,write:!1}}}})],n.prototype,"functionType",void 0);l([a.reader("functionType")],n.prototype,"readFunctionType",null);l([a.writer("functionType")],n.prototype,
"writeFunctionType",null);l([a.property({type:Object,json:{read:{source:"function"},write:{target:"function"},origins:{"web-document":{read:!1,write:!1}}}})],n.prototype,"functionDefinition",void 0);l([a.property({type:String,json:{read:!0,write:!0,origins:{"web-document":{read:!1,write:!1}}}})],n.prototype,"thumbnail",void 0);return n=h=l([a.subclass("esri.layers.support.RasterFunction")],n)}(a.declared(b.JSONSupport));return y})},"esri/layers/support/RasterJobHandler":function(){define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/tsSupport/assignHelper ../../core/Error ../../core/promiseUtils ../../core/workers ./PixelBlock".split(" "),
function(D,e,z,l,b,p,k,a,d){return function(){function f(){this._workerThread=null;this._destroyed=!1}f.prototype.initialize=function(){return l(this,void 0,void 0,function(){var b;return z(this,function(c){switch(c.label){case 0:return[4,a.open("RasterWorker")];case 1:return b=c.sent(),this._destroyed?b.close():this._workerThread=b,[2]}})})};f.prototype.destroy=function(){this._destroyed=!0;this._workerThread&&(this._workerThread.close(),this._workerThread=null)};f.prototype.decode=function(a,b){return l(this,
void 0,void 0,function(){var c;return z(this,function(g){switch(g.label){case 0:if(!this._workerThread)throw new p("raster-jobhandler:no-connection","no available worker connection");return[4,this._workerThread.invoke("decode",a,b)];case 1:return c=g.sent(),[2,c?new d(c):null]}})})};f.prototype.symbolize=function(a,b){return l(this,void 0,void 0,function(){var c;return z(this,function(g){switch(g.label){case 0:if(!this._workerThread)throw new p("raster-jobhandler:no-connection","no available worker connection");
return[4,this._workerThread.invoke("symbolize",a.toJSON(),b)];case 1:return c=g.sent(),[2,c?new d(c):null]}})})};f.prototype.updateSymbolizer=function(a,b){return l(this,void 0,void 0,function(){var c;return z(this,function(d){switch(d.label){case 0:if(!this._workerThread)throw new p("raster-jobhandler:no-connection","no available worker connection");c=a&&a.renderer&&"raster-stretch"===a.renderer.type&&a.renderer.histograms;return[4,k.all(this._workerThread.broadcast("updateSymbolizer",{symbolizerJSON:a.toJSON(),
histograms:c},b))];case 1:return d.sent(),[2]}})})};f.prototype.stretch=function(a,b){return l(this,void 0,void 0,function(){var c,g;return z(this,function(f){switch(f.label){case 0:if(!this._workerThread)throw new p("raster-jobhandler:no-connection","no available worker connection");if(!a||!a.pixelBlock)return[2,null];c={srcPixelBlock:a.pixelBlock.toJSON(),stretchParams:a.stretchParams};return[4,this._workerThread.invoke("stretch",c,b)];case 1:return g=f.sent(),[2,g?new d(g):null]}})})};f.prototype.mosaicAndTransform=
function(a,c){return l(this,void 0,void 0,function(){var g,f;return z(this,function(h){switch(h.label){case 0:if(!this._workerThread)throw new p("raster-jobhandler:no-connection","no available worker connection");if(!(a&&a.srcPixelBlocks&&0<a.srcPixelBlocks.length))return[2,null];g=b({},a,{srcPixelBlocks:a.srcPixelBlocks.map(function(a){return a?a.toJSON():null})});return[4,this._workerThread.invoke("mosaicAndTransform",g,c)];case 1:return f=h.sent(),[2,f?new d(f):null]}})})};return f}()})},"esri/layers/support/PixelBlock":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/compilerUtils ../../core/Error ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators".split(" "),
function(D,e,z,l,b,p,k,a,d,f){var g=d.getLogger("esri.layers.support.PixelBlock");return function(c){function d(a){a=c.call(this,a)||this;a.width=null;a.height=null;a.pixelType="f32";a.validPixelCount=null;a.mask=null;a.maskIsAlpha=!1;a.pixels=null;a.statistics=null;return a}z(d,c);k=d;d.createEmptyBand=function(a,b){return new (k.getPixelArrayConstructor(a))(b)};d.getPixelArrayConstructor=function(a){var c;switch(a){case "u1":case "u2":case "u4":case "u8":c=Uint8Array;break;case "u16":c=Uint16Array;
break;case "u32":c=Uint32Array;break;case "s8":c=Int8Array;break;case "s16":c=Int16Array;break;case "s32":c=Int32Array;break;case "u32":c=Uint32Array;break;case "f32":c=Float32Array;break;case "f64":c=Float64Array;break;case "c64":case "c128":case "unknown":c=Float32Array;break;default:b.neverReached(a)}return c};d.prototype.castPixelType=function(a){if(!a)return"f32";a=a.toLowerCase();-1<["u1","u2","u4"].indexOf(a)?a="u8":-1==="unknown u8 s8 u16 s16 u32 s32 f32 f64".split(" ").indexOf(a)&&(a="f32");
return a};d.prototype.getPlaneCount=function(){return this.pixels&&this.pixels.length};d.prototype.addData=function(a){if(!a.pixels||a.pixels.length!==this.width*this.height)throw new p("pixelblock:invalid-or-missing-pixels","add data requires valid pixels array that has same length defined by pixel block width * height");this.pixels||(this.pixels=[]);this.statistics||(this.statistics=[]);this.pixels.push(a.pixels);this.statistics.push(a.statistics||{minValue:null,maxValue:null})};d.prototype.getAsRGBA=
function(){var a=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case "s8":case "s16":case "u16":case "s32":case "u32":case "f32":case "f64":this._fillFromNon8Bit(a);break;default:this._fillFrom8Bit(a)}return new Uint8ClampedArray(a)};d.prototype.getAsRGBAFloat=function(){var a=new Float32Array(this.width*this.height*4);this._fillFrom32Bit(a);return a};d.prototype.updateStatistics=function(){var a=this;this.statistics=this.pixels.map(function(b){return a._calculateBandStatistics(b,
a.mask)});var b=this.mask,c=0;if(b)for(var d=0;d<b.length;d++)b[d]&&c++;else c=this.width*this.height;this.validPixelCount=c};d.prototype.clamp=function(a){if(a&&"f64"!==a&&"f32"!==a){var b;switch(a){case "u8":b=[0,255];break;case "u16":b=[0,65535];break;case "u32":b=[0,4294967295];break;case "s8":b=[-128,127];break;case "s16":b=[-32768,32767];break;case "s32":b=[-2147483648,2147483647];break;default:b=[-3.4*1E39,3.4*1E39]}var c=b[0];b=b[1];for(var d=this.pixels,g=this.width*this.height,f=d.length,
h,x,B,r=[],q=0;q<f;q++){B=k.createEmptyBand(a,g);h=d[q];for(var A=0;A<g;A++)x=h[A],B[A]=x>b?b:x<c?c:x;r.push(B)}this.pixels=r;this.pixelType=a}};d.prototype.clone=function(){var b=new k({width:this.width,height:this.height,pixelType:this.pixelType,maskIsAlpha:this.maskIsAlpha,validPixelCount:this.validPixelCount});this.mask&&(b.mask=this.mask instanceof Uint8Array?new Uint8Array(this.mask):this.mask.slice(0));var c,d=k.getPixelArrayConstructor(this.pixelType);if(this.pixels&&0<this.pixels.length){b.pixels=
[];var g=this.pixels[0].slice;for(c=0;c<this.pixels.length;c++)b.pixels[c]=g?this.pixels[c].slice(0,this.pixels[c].length):new d(this.pixels[c])}if(this.statistics)for(b.statistics=[],c=0;c<this.statistics.length;c++)b.statistics[c]=a.clone(this.statistics[c]);return b};d.prototype._fillFrom8Bit=function(a){var b=this.mask,c=this.maskIsAlpha,d=this.pixels;if(a&&d&&d.length){var f,h,k;f=h=k=d[0];3<=d.length?(h=d[1],k=d[2]):2===d.length&&(h=d[1]);a=new Uint32Array(a);d=this.width*this.height;if(f.length!==
d)g.error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");else if(b&&b.length===d)if(c)for(c=0;c<d;c++)b[c]&&(a[c]=b[c]<<24|k[c]<<16|h[c]<<8|f[c]);else for(c=0;c<d;c++)b[c]&&(a[c]=-16777216|k[c]<<16|h[c]<<8|f[c]);else for(c=0;c<d;c++)a[c]=-16777216|k[c]<<16|h[c]<<8|f[c]}else g.error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")};d.prototype._fillFromNon8Bit=function(a){var b=this.pixels,c=this.mask,d=this.statistics;if(a&&b&&b.length){var f=this.pixelType,
h=1,k=0,h=1;d&&0<d.length?(k=d.map(function(a){return a.minValue}).reduce(function(a,b){return Math.min(a,b)}),h=d.map(function(a){return a.maxValue-a.minValue}).reduce(function(a,b){return Math.max(a,b)}),h=255/h):(h=255,"s8"===f?(k=-128,h=127):"u16"===f?h=65535:"s16"===f?(k=-32768,h=32767):"u32"===f?h=4294967295:"s32"===f?(k=-2147483648,h=2147483647):"f32"===f?(k=-3.4*1E39,h=3.4*1E39):"f64"===f&&(k=-Number.MAX_VALUE,h=Number.MAX_VALUE),h=255/(h-k));a=new Uint32Array(a);var f=this.width*this.height,
x,B,d=x=B=b[0];if(d.length!==f)return g.error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");if(2<=b.length)if(x=b[1],3<=b.length&&(B=b[2]),c&&c.length===f)for(b=0;b<f;b++)c[b]&&(a[b]=-16777216|(B[b]-k)*h<<16|(x[b]-k)*h<<8|(d[b]-k)*h);else for(b=0;b<f;b++)a[b]=-16777216|(B[b]-k)*h<<16|(x[b]-k)*h<<8|(d[b]-k)*h;else if(c&&c.length===f)for(b=0;b<f;b++)x=(d[b]-k)*h,c[b]&&(a[b]=-16777216|x<<16|x<<8|x);else for(b=0;b<f;b++)x=(d[b]-k)*h,a[b]=-16777216|x<<16|x<<8|x}else g.error("getAsRGBA()",
"Unable to convert to RGBA. The input pixel block is empty.")};d.prototype._fillFrom32Bit=function(a){var b=this.pixels,c=this.mask;if(!a||!b||!b.length)return g.error("getAsRGBAFloat()","Unable to convert to RGBA. The input pixel block is empty.");var d,f,h;d=f=h=b[0];3<=b.length?(f=b[1],h=b[2]):2===b.length&&(f=b[1]);var k=this.width*this.height;if(d.length!==k)return g.error("getAsRGBAFloat()","Unable to convert to RGBA. The pixelblock is invalid.");var x=0;if(c&&c.length===k)for(b=0;b<k;b++)a[x++]=
d[b],a[x++]=f[b],a[x++]=h[b],a[x++]=c[b]&1;else for(b=0;b<k;b++)a[x++]=d[b],a[x++]=f[b],a[x++]=h[b],a[x++]=1};d.prototype._calculateBandStatistics=function(a,b){var c=Infinity,d=-Infinity,f=a.length,g,h=0;if(b)for(g=0;g<f;g++)b[g]&&(h=a[g],c=h<c?h:c,d=h>d?h:d);else for(g=0;g<f;g++)h=a[g],c=h<c?h:c,d=h>d?h:d;return{minValue:c,maxValue:d}};var k;l([f.property({json:{write:!0}})],d.prototype,"width",void 0);l([f.property({json:{write:!0}})],d.prototype,"height",void 0);l([f.property({json:{write:!0}})],
d.prototype,"pixelType",void 0);l([f.cast("pixelType")],d.prototype,"castPixelType",null);l([f.property({json:{write:!0}})],d.prototype,"validPixelCount",void 0);l([f.property({json:{write:!0}})],d.prototype,"mask",void 0);l([f.property({json:{write:!0}})],d.prototype,"maskIsAlpha",void 0);l([f.property({json:{write:!0}})],d.prototype,"pixels",void 0);l([f.property({json:{write:!0}})],d.prototype,"statistics",void 0);return d=k=l([f.subclass("esri.layers.support.PixelBlock")],d)}(f.declared(k.JSONSupport))})},
"esri/layers/support/TileInfo":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../geometry ../../core/jsonMap ../../core/JSONSupport ../../core/unitUtils ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../geometry/support/aaBoundingRect ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ./LOD".split(" "),function(D,e,z,l,b,p,k,a,d,f,
g,c,C,y,h){var n=new k.default({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});return function(a){function m(b){b=a.call(this,b)||this;b.dpi=96;b.format=null;b.origin=null;b.minScale=0;b.maxScale=0;b.size=null;b.spatialReference=null;return b}l(m,a);k=m;m.create=function(a){void 0===a&&(a={size:256,spatialReference:p.SpatialReference.WebMercator});
var b=a.resolutionFactor||1,c=a.scales,g=a.size||256;a=a.spatialReference||p.SpatialReference.WebMercator;if(!C.isValid(a)){b=[];if(c)for(var f=0;f<c.length;f++){var q=c[f];b.push({level:f,scale:q,resolution:q})}else for(var m=5E-4,f=23;0<=f;f--)b.unshift({level:f,scale:m,resolution:m}),m*=2;return new k({dpi:96,lods:b,origin:new p.Point(0,0,a),size:[g,g],spatialReference:a})}var h=(f=C.getInfo(a))?new p.Point(f.origin[0],f.origin[1],a):new p.Point(0,0,a),n=1/(39.37*d.getMetersPerUnitForSR(a)*96),
t=[];if(c)for(f=0;f<c.length;f++)q=c[f],m=q*n,t.push({level:f,scale:q,resolution:m});else for(q=C.isGeographic(a)?512/g*5.916575275917094E8:256/g*5.91657527591555E8,c=Math.ceil(24/b),t.push({level:0,scale:q,resolution:q*n}),f=1;f<c;f++)q/=Math.pow(2,b),m=q*n,t.push({level:f,scale:q,resolution:m});return new k({dpi:96,lods:t,origin:h,size:[g,g],spatialReference:a})};Object.defineProperty(m.prototype,"isWrappable",{get:function(){var a=this.spatialReference,b=this.origin;if(a&&b){var c=C.getInfo(a);
return a.isWrappable&&Math.abs(c.origin[0]-b.x)<=c.dx}return!1},enumerable:!0,configurable:!0});m.prototype.readOrigin=function(a,b){return p.Point.fromJSON(z({spatialReference:b.spatialReference},a))};Object.defineProperty(m.prototype,"lods",{set:function(a){var b=this,c=0,d=0,f=[];this._levelToLOD={};a&&(c=-Infinity,d=Infinity,a.forEach(function(a){f.push(a.scale);c=a.scale>c?a.scale:c;d=a.scale<d?a.scale:d;b._levelToLOD[a.level]=a}));this._set("scales",f);this._set("minScale",c);this._set("maxScale",
d);this._set("lods",a);this._initializeUpsampleLevels()},enumerable:!0,configurable:!0});m.prototype.readSize=function(a,b){return[b.cols,b.rows]};m.prototype.writeSize=function(a,b){b.cols=a[0];b.rows=a[0]};m.prototype.zoomToScale=function(a){var b=this.scales;if(0>=a)return b[0];if(a>=b.length)return b[b.length-1];var c=Math.round(a);return b[c]+(c-a)*(b[Math.round(a-.5)]-b[c])};m.prototype.scaleToZoom=function(a){for(var b=this.scales,c=b.length-1,d=0;d<c;d++){var f=b[d],q=b[d+1];if(f<=a)break;
if(q===a)return d+1;if(f>a&&q<a)return d+1-(a-q)/(f-q)}return d};m.prototype.snapScale=function(a,b){void 0===b&&(b=.95);a=this.scaleToZoom(a);return a%Math.floor(a)>=b?this.zoomToScale(Math.ceil(a)):this.zoomToScale(Math.floor(a))};m.prototype.tileAt=function(a,b,d,f){var g=this.lodAt(a);if(!g)return null;var q;if("number"===typeof b)q=b,b=d;else{if(C.equals(b.spatialReference,this.spatialReference))q=b.x,b=b.y;else{f=y.project(b,this.spatialReference);if(!f)return null;q=f.x;b=f.y}f=d}d=g.resolution*
this.size[0];g=g.resolution*this.size[1];f||(f={id:null,level:0,row:0,col:0,extent:c.create()});f.level=a;f.row=Math.floor((this.origin.y-b)/g+.001);f.col=Math.floor((q-this.origin.x)/d+.001);this.updateTileInfo(f);return f};m.prototype.updateTileInfo=function(a){var b=this.lodAt(a.level);if(b){var d=b.resolution*this.size[0],b=b.resolution*this.size[1];a.id=a.level+"/"+a.row+"/"+a.col;a.extent||(a.extent=c.create());a.extent[0]=this.origin.x+a.col*d;a.extent[1]=this.origin.y-(a.row+1)*b;a.extent[2]=
a.extent[0]+d;a.extent[3]=a.extent[1]+b}};m.prototype.upsampleTile=function(a){var b=this._upsampleLevels[a.level];if(!b||-1===b.parentLevel)return!1;a.level=b.parentLevel;a.row=Math.floor(a.row/b.factor+.001);a.col=Math.floor(a.col/b.factor+.001);this.updateTileInfo(a);return!0};m.prototype.getTileBounds=function(a,b){var c=this.lodAt(b.level).resolution,d=c*this.size[0],c=c*this.size[1];a[0]=this.origin.x+b.col*d;a[1]=this.origin.y-(b.row+1)*c;a[2]=a[0]+d;a[3]=a[1]+c;return a};m.prototype.lodAt=
function(a){return this._levelToLOD&&this._levelToLOD[a]||null};m.prototype.clone=function(){return k.fromJSON(this.write({}))};m.prototype._initializeUpsampleLevels=function(){var a=this.lods;this._upsampleLevels=[];for(var b=null,c=0;c<a.length;c++){var d=a[c];this._upsampleLevels[d.level]={parentLevel:b?b.level:-1,factor:b?b.resolution/d.resolution:0};b=d}};var k;b([f.property({type:Number,json:{write:!0}})],m.prototype,"compressionQuality",void 0);b([f.property({type:Number,json:{write:!0}})],
m.prototype,"dpi",void 0);b([f.property({type:String,json:{read:n.read,write:n.write,origins:{"web-scene":{read:!1,write:!1}}}})],m.prototype,"format",void 0);b([f.property({readOnly:!0,dependsOn:["spatialReference","origin"]})],m.prototype,"isWrappable",null);b([f.property({type:p.Point,json:{write:!0}})],m.prototype,"origin",void 0);b([f.reader("origin")],m.prototype,"readOrigin",null);b([f.property({type:[h],value:null,json:{write:!0}})],m.prototype,"lods",null);b([f.property({readOnly:!0})],m.prototype,
"minScale",void 0);b([f.property({readOnly:!0})],m.prototype,"maxScale",void 0);b([f.property({readOnly:!0})],m.prototype,"scales",void 0);b([f.property({cast:function(a){return Array.isArray(a)?a:"number"===typeof a?[a,a]:[256,256]}})],m.prototype,"size",void 0);b([f.reader("size",["rows","cols"])],m.prototype,"readSize",null);b([f.writer("size",{cols:{type:g.Integer},rows:{type:g.Integer}})],m.prototype,"writeSize",null);b([f.property({type:p.SpatialReference,json:{write:!0}})],m.prototype,"spatialReference",
void 0);return m=k=b([f.subclass("esri.layers.support.TileInfo")],m)}(f.declared(a.JSONSupport))})},"esri/layers/support/LOD":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType".split(" "),function(D,e,z,l,b,p,k){return function(a){function b(b){b=a.call(this,b)||this;b.level=0;b.levelValue=null;b.resolution=0;b.scale=0;return b}z(b,a);f=
b;b.prototype.clone=function(){return new f({level:this.level,levelValue:this.levelValue,resolution:this.resolution,scale:this.scale})};var f;l([p.property({type:k.Integer,json:{write:!0}})],b.prototype,"level",void 0);l([p.property({type:String,json:{write:!0}})],b.prototype,"levelValue",void 0);l([p.property({type:Number,json:{write:!0}})],b.prototype,"resolution",void 0);l([p.property({type:Number,json:{write:!0}})],b.prototype,"scale",void 0);return b=f=l([p.subclass("esri.layers.support.LOD")],
b)}(p.declared(b.JSONSupport))})},"esri/layers/support/rasterDatasets/RasterFactory":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper @dojo/framework/shim/Set ../../../core/Error ./CloudRaster ./ImageServerRaster ./MRFRaster ./TIFFRaster".split(" "),function(D,e,z,l,b,p,k,a,d,f){var g=new Map;g.set("CRF",{desc:"Cloud Raster Format",constructor:k});g.set("MRF",{desc:"Meta Raster Format",constructor:d});g.set("TIFF",{desc:"GeoTIFF",constructor:f});
g.set("RasterTileServer",{desc:"Raster Tile Server",constructor:a});return function(){function a(){}Object.defineProperty(a,"supportedFormats",{get:function(){for(var a=g.keys(),c=new b.default,d=a.next();!d.done;)c.add(d.value),d=a.next();return c},enumerable:!0,configurable:!0});a.open=function(a){return l(this,void 0,void 0,function(){var b,c,d,f,m,k,l,u,x,B;return z(this,function(h){switch(h.label){case 0:b=a.url;c=a.ioConfig;d=a.datasetFormat;null==d&&b.lastIndexOf(".")&&(d=b.slice(b.lastIndexOf(".")+
1).toUpperCase());"OVR"===d||"TIF"===d?d="TIFF":-1<b.toLowerCase().indexOf("/imageserver")&&(d="RasterTileServer");f={resolution:null,bandIds:null,sampling:null};m={url:b,datasetFormat:d,ioConfig:c||f};if(!this.supportedFormats.has(d))return[3,2];k=g.get(d).constructor;l=new k(m);return[4,l.open({signal:a.signal})];case 1:return h.sent(),[2,l];case 2:if(d)throw new p("rasterfactory:open","not a supported format "+d);u=Array.from(g.keys());x=0;B=function(){d=u[x++];if(!d)return null;k=g.get(d).constructor;
l=new k(m);return l.open({signal:a.signal}).then(function(){return l}).catch(function(){return B()})};return[2,B()]}})})};a.register=function(a,b,c){g.has(a.toUpperCase())||g.set(a.toUpperCase(),{desc:b,constructor:c})};return a}()})},"@dojo/framework/shim/Set":function(){(function(D){"object"===typeof module&&"object"===typeof module.exports?(D=D(require,exports),void 0!==D&&(module.exports=D)):"function"===typeof define&&define.amd&&define("require exports tslib ./global ./iterator ../has/has ./Symbol".split(" "),
D)})(function(D,e){Object.defineProperty(e,"__esModule",{value:!0});var z=D("tslib"),l=D("./global"),b=D("./iterator"),p=D("../has/has");D("./Symbol");e.Set=l.default.Set;p.default("es6-set")||(e.Set=(k=function(){function a(a){this._setData=[];this[Symbol.toStringTag]="Set";if(a)if(b.isArrayLike(a))for(var d=0;d<a.length;d++)this.add(a[d]);else try{for(var d=z.__values(a),g=d.next();!g.done;g=d.next())this.add(g.value)}catch(y){c={error:y}}finally{try{g&&!g.done&&(k=d.return)&&k.call(d)}finally{if(c)throw c.error;
}}var c,k}a.prototype.add=function(a){if(this.has(a))return this;this._setData.push(a);return this};a.prototype.clear=function(){this._setData.length=0};a.prototype.delete=function(a){a=this._setData.indexOf(a);if(-1===a)return!1;this._setData.splice(a,1);return!0};a.prototype.entries=function(){return new b.ShimIterator(this._setData.map(function(a){return[a,a]}))};a.prototype.forEach=function(a,b){for(var d=this.values(),c=d.next();!c.done;)a.call(b,c.value,c.value,this),c=d.next()};a.prototype.has=
function(a){return-1<this._setData.indexOf(a)};a.prototype.keys=function(){return new b.ShimIterator(this._setData)};Object.defineProperty(a.prototype,"size",{get:function(){return this._setData.length},enumerable:!0,configurable:!0});a.prototype.values=function(){return new b.ShimIterator(this._setData)};a.prototype[Symbol.iterator]=function(){return new b.ShimIterator(this._setData)};return a}(),k[Symbol.species]=k,k));e.default=e.Set;var k})},"esri/layers/support/rasterDatasets/CloudRaster":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/declareExtendsHelper ../../../geometry ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators ../RasterInfo ../RasterStorageInfo ../TileInfo ./BaseRaster ./DBFParser ../../../tasks/support/FeatureSet".split(" "),
function(D,e,z,l,b,p,k,a,d,f,g,c,C,y,h,n,v){var m=new Map;m.set("int16","esriFieldTypeSmallInteger");m.set("int32","esriFieldTypeInteger");m.set("int64","esriFieldTypeInteger");m.set("float32","esriFieldTypeSingle");m.set("float64","esriFieldTypeDouble");m.set("text","esriFieldTypeString");return function(h){function t(){var a=null!==h&&h.apply(this,arguments)||this;a.storageInfo=null;return a}p(t,h);t.prototype.open=function(c){return b(this,void 0,void 0,function(){var b,f,g,q,m,h;return z(this,
function(k){switch(k.label){case 0:return[4,this.init()];case 1:return k.sent(),b=c?d.unwrap(c.signal):null,[4,this.request({url:this.url+"/conf.json",responseType:"json"},b)];case 2:f=k.sent();if(!this._validateHeader(f))throw new a("cloudraster:open","Invalid or unsupported conf.json.");this.datasetName=this.url.slice(this.url.lastIndexOf("/")+1);g=this._parseHeader(f);q=g.storageInfo;m=g.rasterInfo;return"thematic"!==m.dataType?[3,4]:[4,this._fetchAuxiliaryInformation()];case 3:h=k.sent(),m.attributeTable=
h,k.label=4;case 4:return this._set("storageInfo",q),this._set("rasterInfo",m),this.ioConfig.retryCount=this.ioConfig.retryCount||0,[2]}})})};t.prototype.fetchRawTile=function(a,c,d,f){void 0===f&&(f={});return b(this,void 0,void 0,function(){var b,g,m,h,k,r,n;return z(this,function(q){switch(q.label){case 0:b=this.rasterInfo.storageInfo.maximumPyramidLevel-a;if(0>b)return[2,null];g=this._buildCacheFilePath(b,c,d,f.multidimensionalDefinition);m=this._getIndexRecordFromBundle(c,d);return[4,this.request({url:g,
range:{from:0,to:this.storageInfo.headerSize-1},responseType:"array-buffer"},f.signal)];case 1:h=q.sent();if(!h)return[2,null];k=new Uint8Array(h);r=this._getTileEndAndContentType(k,m);return 0===r.recordSize?[2,null]:[4,this.request({url:g,range:{from:r.position,to:r.position+r.recordSize},responseType:"array-buffer"},f.signal)];case 2:return(n=q.sent())?[2,this.decodePixelBlock(n,{width:this.rasterInfo.storageInfo.tileInfo.size[0],height:this.rasterInfo.storageInfo.tileInfo.size[1],planes:null,
pixelType:null})]:[2,null]}})})};t.prototype._validateHeader=function(a){var b="origin extent geodataXform LODInfos blockWidth blockHeight bandCount pixelType pixelSizeX pixelSizeY format packetSize".split(" ");return a&&"RasterInfo"===a.type&&!b.some(function(b){return!a[b]})};t.prototype._parseHeader=function(a){var b="u1 u2 u4 u8 s8 u16 s16 u32 s32 f32 f64".split(" ")[a.pixelType],d=a.bandCount,f=a.histograms,q=a.colormap,g=a.blockWidth,m=a.blockHeight,h=a.firstPyramidLevel,n=a.maximumPyramidLevel,
l=a.statistics&&a.statistics.map(function(a){return{min:a.min,max:a.max,avg:a.mean,stddev:a.standardDeviation,median:a.median,mode:a.mode}}),v=new k.SpatialReference(a.extent.spatialReference||a.geodataXform.spatialReference),t=new k.Extent({xmin:a.extent.xmin,ymin:a.extent.ymin,xmax:a.extent.xmax,ymax:a.extent.ymax,spatialReference:v}),w=new k.Point({x:a.pixelSizeX,y:a.pixelSizeY,spatialReference:v}),p=a.properties,u=a.format.toLowerCase().replace("cache/",""),e=new k.Point(a.origin.x,a.origin.y,
v),z,M,R,T;if(q&&q.colors)for(z=[],M=0;M<q.colors.length;M++)R=q.colors[M],T=q.values?q.values[M]:M,z.push([T,R&255,R<<16>>>24,R<<8>>>24,R>>>24]);q=a.LODInfos;R=[];for(M=0;M<q.levels.length;M++)R.push({level:q.levels[M],resolution:q.resolutions[M],scale:96/.0254*q.resolutions[M]});q=new y({dpi:96,lods:R,format:u,origin:e,size:[g,m],spatialReference:v});u={recordSize:8,packetSize:a.packetSize,headerSize:a.packetSize*a.packetSize*8+64};R=Math.round((t.xmax-t.xmin)/w.x);T=Math.round((t.ymax-t.ymin)/
w.y);var Q=[{maxCol:Math.ceil(R/g)-1,maxRow:Math.ceil(T/m)-1,minCol:0,minRow:0}],I=2;if(0<n)for(M=0;M<n;M++)Q.push({maxCol:Math.ceil(R/I/g)-1,maxRow:Math.ceil(T/I/m)-1,minCol:0,minRow:0}),I*=2;a=new c({width:R,height:T,pixelType:b,bandCount:d,extent:t,spatialReference:v,pixelSize:w,keyProperties:p,statistics:l,histograms:f,multidimensionalInfo:a.mdInfo,colormap:z,storageInfo:new C({blockWidth:g,blockHeight:m,pyramidBlockWidth:g,pyramidBlockHeight:m,origin:e,tileInfo:q,firstPyramidLevel:h,maximumPyramidLevel:n,
blockBoundary:Q})});return{storageInfo:u,rasterInfo:a}};t.prototype._fetchAuxiliaryInformation=function(a){return b(this,void 0,void 0,function(){var b,c,d,q,g,h,k,l;return z(this,function(r){switch(r.label){case 0:return b=this.request({url:this.url+"/conf.vat.json",responseType:"json"},a).then(function(a){return a}).catch(function(){return null}),c=this.request({url:this.url+"/conf.vat.dbf",responseType:"array-buffer"},a).then(function(a){return a}).catch(function(){return null}),[4,f.all([b,c])];
case 1:return d=r.sent(),d[0]&&(g=d[0].fields,h=d[0].values,g&&h&&(g=g.map(function(a){return{type:"OID"===a.name?"esriFieldTypeOID":m.get(a.type),name:a.name,alias:a.alias||a.name}}),k=h.map(function(a){return{attributes:a}}),g&&h&&(q={fields:g,features:k}))),!q&&d[1]&&(l=n.parse(d[1]),q=l.recordSet),[2,v.fromJSON(q)]}})})};t.prototype._buildCacheFilePath=function(a,b,c,d){var q=this.storageInfo.packetSize;c=Math.floor(c/q)*q;b="R"+this._toHexString4(Math.floor(b/q)*q)+"C"+this._toHexString4(c);
var q="L",q=10<=a?q+a.toString():q+("0"+a.toString()),f=d&&d[0];if(!f)return this.url+"/_alllayers/"+q+"/"+b+".bundle";a=this.rasterInfo.multidimensionalInfo.variables.filter(function(a){return a.name===f.variableName})[0].dimensions[0].values.indexOf(f.values[0]).toString(16);d=4-a.length;for(c=0;c<d;c++)a="0"+a;return this.url+"/_alllayers/"+f.variableName+"/"+("S"+a)+"/"+q+"/"+b+".bundle"};t.prototype._getIndexRecordFromBundle=function(a,b){var c=this.storageInfo.packetSize;a=a%c*c+b%c;if(0>a)throw"Invalid level / row / col";
return a*this.storageInfo.recordSize+64};t.prototype._getTileEndAndContentType=function(a,b){a=a.subarray(b,b+8);b=0;var c;for(c=0;5>c;c++)b|=(a[c]&255)<<8*c;var d=b&0xffffffffff;b=0;for(c=5;8>c;c++)b|=(a[c]&255)<<8*(c-5);return{position:d,recordSize:b&0xffffffffff}};t.prototype._toHexString4=function(a){a=a.toString(16);if(4!==a.length)for(var b=4-a.length;0<b--;)a="0"+a;return a};l([g.property({readOnly:!0})],t.prototype,"storageInfo",void 0);l([g.property({type:String,json:{write:!0}})],t.prototype,
"datasetFormat",void 0);return t=l([g.subclass("esri.layers.support.rasterDatasets.CloudRaster")],t)}(g.declared(h))})},"esri/layers/support/RasterInfo":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ../../geometry/Extent ../../tasks/support/FeatureSet".split(" "),function(D,e,z,l,b,p,k,a,d){return function(f){function g(a){a=f.call(this,
a)||this;a.attributeTable=null;a.bandCount=null;a.colormap=null;a.extent=null;a.format=void 0;a.height=null;a.width=null;a.histograms=null;a.keyProperties=null;a.multidimensionalInfo=null;a.noDataValue=null;a.pixelSize=null;a.pixelType=null;a.spatialReference=null;a.statistics=null;a.storageInfo=null;return a}l(g,f);Object.defineProperty(g.prototype,"dataType",{get:function(){var a=this.keyProperties&&this.keyProperties.DataType;return a?a.toLowerCase():"generic"},enumerable:!0,configurable:!0});
b([k.property({type:d,json:{write:!0}})],g.prototype,"attributeTable",void 0);b([k.property({json:{write:!0}})],g.prototype,"bandCount",void 0);b([k.property({json:{write:!0}})],g.prototype,"colormap",void 0);b([k.property({type:String,readOnly:!0})],g.prototype,"dataType",null);b([k.property({type:a,json:{write:!0}})],g.prototype,"extent",void 0);b([k.property({json:{write:!0}})],g.prototype,"format",void 0);b([k.property({json:{write:!0}})],g.prototype,"height",void 0);b([k.property({json:{write:!0}})],
g.prototype,"width",void 0);b([k.property({json:{write:!0}})],g.prototype,"histograms",void 0);b([k.property({json:{write:!0}})],g.prototype,"keyProperties",void 0);b([k.property({json:{write:!0}})],g.prototype,"multidimensionalInfo",void 0);b([k.property()],g.prototype,"noDataValue",void 0);b([k.property({json:{write:!0}})],g.prototype,"pixelSize",void 0);b([k.property({json:{write:!0}})],g.prototype,"pixelType",void 0);b([k.property({json:{write:!0}})],g.prototype,"spatialReference",void 0);b([k.property({json:{write:!0}})],
g.prototype,"statistics",void 0);b([k.property({json:{write:!0}})],g.prototype,"storageInfo",void 0);return g=b([k.subclass("esri.layers.support.RasterInfo")],g)}(k.declared(p.JSONSupport))})},"esri/layers/support/RasterStorageInfo":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ../../geometry/Point".split(" "),function(D,e,z,l,b,p,k,a){return function(d){function f(){var a=
null!==d&&d.apply(this,arguments)||this;a.blockWidth=void 0;a.blockHeight=void 0;a.compression=null;a.origin=null;a.firstPyramidLevel=null;a.maximumPyramidLevel=null;a.pyramidScalingFactor=2;a.pyramidBlockWidth=null;a.pyramidBlockHeight=null;a.tileInfo=null;a.blockBoundary=null;return a}l(f,d);b([k.property({type:Number,json:{write:!0}})],f.prototype,"blockWidth",void 0);b([k.property({type:Number,json:{write:!0}})],f.prototype,"blockHeight",void 0);b([k.property({type:String,json:{write:!0}})],f.prototype,
"compression",void 0);b([k.property({type:a,json:{write:!0}})],f.prototype,"origin",void 0);b([k.property({type:Number,json:{write:!0}})],f.prototype,"firstPyramidLevel",void 0);b([k.property({type:Number,json:{write:!0}})],f.prototype,"maximumPyramidLevel",void 0);b([k.property()],f.prototype,"pyramidScalingFactor",void 0);b([k.property({type:Number,json:{write:!0}})],f.prototype,"pyramidBlockWidth",void 0);b([k.property({type:Number,json:{write:!0}})],f.prototype,"pyramidBlockHeight",void 0);b([k.property({json:{write:!0}})],
f.prototype,"tileInfo",void 0);b([k.property()],f.prototype,"blockBoundary",void 0);return f=b([k.subclass("esri.layers.support.RasterStorageInfo")],f)}(k.declared(p.JSONSupport))})},"esri/layers/support/rasterDatasets/BaseRaster":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/assignHelper ../../../geometry ../../../request ../../../core/Error ../../../core/JSONSupport ../../../core/maybe ../../../core/Promise ../../../core/promiseUtils ../../../core/urlUtils ../../../core/accessorSupport/decorators ../commonProperties ../TileInfo ./RawBlockCache ../rasterFormats/RasterCodec ../rasterFunctions/pixelUtils ../rasterFunctions/rasterProjectionHelper".split(" "),
function(D,e,z,l,b,p,k,a,d,f,g,c,C,y,h,n,v,m,w,t,u,x){return function(g){function r(){var a=null!==g&&g.apply(this,arguments)||this;a.rasterJobHandler=null;a.datasetName=null;a.datasetFormat=null;a.rasterInfo=null;a.ioConfig={bandIds:null,sampling:"closest"};return a}z(r,g);r.prototype.init=function(){return p(this,void 0,void 0,function(){var a;return b(this,function(b){switch(b.label){case 0:return a=x.load(),this.addResolvingPromise(a),[4,this.when()];case 1:return b.sent(),[2]}})})};r.prototype.normalizeCtorArgs=
function(a){a&&a.ioConfig&&(a=k({},a,{ioConfig:k({resolution:null,bandIds:null,sampling:"closest",tileInfo:m.create()},a.ioConfig)}));return a};Object.defineProperty(r.prototype,"url",{set:function(a){a=h.urlToObject(a);this._set("url",a.path)},enumerable:!0,configurable:!0});r.prototype.open=function(a){return p(this,void 0,void 0,function(){return b(this,function(a){throw new f("BaseRaster:open-not-implemented","open() is not implemented");})})};r.prototype.fetchTile=function(c,d,f,g){void 0===
g&&(g={});return p(this,void 0,void 0,function(){var q,m,h,k;return b(this,function(b){q=g.tileInfo;m=q.lodAt(c);h=new a.Point({x:m.resolution,y:m.resolution,spatialReference:q.spatialReference});k=this._getTileExtent(h,d,f,q);return[2,this.fetchPixels(k,q.size[0],q.size[1],g)]})})};r.prototype.identify=function(a,c){void 0===c&&(c={});return p(this,void 0,void 0,function(){var d,f,q,g,m,h,k,n,r,B,l,v,A,y,t;return b(this,function(b){switch(b.label){case 0:d=this.rasterInfo;f=d.spatialReference;q=
d.extent;g=c.datumTransformation;m=x.projectPoint(a,f,g);if(!q.intersects(m))return[2,{location:m,value:null}];h=0;if(!c.srcResolution)return[3,1];k=x.snapPyramid(c.srcResolution,this.rasterInfo,this.ioConfig.sampling);h=k.pyramidLevel;return[3,3];case 1:return[4,this.computeBestPyramidLevelForLocation(a,c)];case 2:h=b.sent();if(null==h)return[2,{location:m,value:null}];b.label=3;case 3:n=this.identifyPixelLocation(m,h,null);if(null===n)return[2,{location:m,value:null}];r=n.row;B=n.col;l=n.rowOffset;
v=n.colOffset;return[4,this.fetchRawTile(h,r,B,c)];case 4:A=b.sent();if(!(A.pixels&&0<A.pixels.length))return[2,{location:m,value:null}];y=l*this.rasterInfo.storageInfo.blockHeight+v;t=!A.mask||A.mask[y]?A.pixels.map(function(a){return a[y]}):null;return[2,{location:m,value:t,pyramidLevel:h}]}})})};r.prototype.fetchPixels=function(c,d,f,g){void 0===g&&(g={});return p(this,void 0,void 0,function(){var q,m,h,k,n,r,B,l,v,A,y,t,w,E,p,e,F,C,z,D,ba,Z,ca,da;return b(this,function(b){switch(b.label){case 0:q=
c.clone().normalize();c=q[0];m=this.rasterInfo.spatialReference;h=!c.spatialReference.equals(m);k=g.datumTransformation;n=new a.Point({x:(c.xmax-c.xmin)/d,y:(c.ymax-c.ymin)/f,spatialReference:c.spatialReference});r=g.srcResolution||(h?x.projectResolution(n,m,c,k):n);if(!r)return[2,null];B=x.snapPyramid(r,this.rasterInfo,this.ioConfig.sampling);l=B.pyramidLevel;v=B.pyramidResolution;if(A=B.excessiveReading)return[2,null];y=this.rasterInfo.storageInfo;t=h?x.projectExtent(c,m,k):c;w={x:Math.floor((t.xmin-
y.origin.x)/v.x+.1),y:Math.floor((y.origin.y-t.ymax)/v.y+.1)};E=Math.ceil((t.xmax-t.xmin)/v.x-.1);p=Math.ceil((t.ymax-t.ymin)/v.y-.1);return 8<E/d||8<p/f?[2,null]:[4,this.fetchRawPixels(l,w,{width:E,height:p},g)];case 1:e=b.sent();if(!e)return[2,null];F=0<l?y.pyramidBlockWidth:y.blockWidth;C=0<l?y.pyramidBlockHeight:y.blockHeight;if(z=!h&&1===e.pixelBlocks.length&&F===d&&C===f&&r.x===n.x&&r.y===n.y)return[2,{extent:c,srcExtent:t,pixelBlock:e.pixelBlocks[0],transformGrid:null}];D=x.getProjectionOffsetGrid(c,
e.extent,n,k);Z=!g.requestRawData;ca={rows:D.spacing[0],cols:D.spacing[1]};return this.rasterJobHandler?[4,this.rasterJobHandler.mosaicAndTransform({srcPixelBlocks:e.pixelBlocks,srcMosaicSize:e.mosaicSize,destDimension:Z?{width:d,height:f}:null,coefs:Z?D.coefficients:null,sampleSpacing:Z?ca:null},g)]:[3,3];case 2:return ba=b.sent(),[3,4];case 3:da=u.mosaic(e.pixelBlocks,e.mosaicSize),ba=Z?u.approximateTransform(da,{width:d,height:f},D.coefficients,ca):da,b.label=4;case 4:return[2,{srcExtent:t,pixelBlock:ba,
transformGrid:D,extent:c}]}})})};r.prototype.fetchRawPixels=function(d,f,g,m){return p(this,void 0,void 0,function(){var q,h,k,n,r,B,l,v,A,t,x,p,E,e,F,C,u,z,D,Y,ba,Z,ca,da,ga,ha,ea,fa,ia;return b(this,function(b){switch(b.label){case 0:q=this.rasterInfo.storageInfo;h=q.origin;k=q.blockBoundary;n=0<d?this.rasterInfo.storageInfo.pyramidBlockWidth:this.rasterInfo.storageInfo.blockWidth;r=0<d?this.rasterInfo.storageInfo.pyramidBlockHeight:this.rasterInfo.storageInfo.blockHeight;B=Math.floor(f.x/n);l=
Math.floor(f.y/r);v=Math.floor((f.x+g.width-1)/n);A=Math.floor((f.y+g.height-1)/r);t=this.rasterInfo;x=t.pixelSize;p=t.spatialReference;E=k[d];if(!E)return[2,null];e=E.minRow;F=E.minCol;C=E.maxCol;u=E.maxRow;if(A<e||v<F||l>u||B>C)return[2,null];z=[];D=this.url;Y=m.registryId;for(ca=l;ca<=A;ca++)for(da=B;da<=v;da++)ca>=e&&da>=F&&u>=ca&&C>=da?(ba=d+"/"+ca+"/"+da,Z=w.getBlock(D,Y,ba),c.isSome(Z)||(Z=this.fetchRawTile(d,ca,da,m),w.putBlock(D,Y,ba,Z)),z.push(Z)):z.push(null);return 0===z.length?[2,null]:
[4,y.all(z)];case 1:return ga=b.sent(),ha={height:(A-l+1)*n,width:(v-B+1)*r},ea=x.x*Math.pow(2,d),fa=x.y*Math.pow(2,d),ia=new a.Extent({xmin:h.x+B*n*ea,xmax:h.x+(v+1)*n*ea,ymin:h.y-(A+1)*r*fa,ymax:h.y-l*r*fa,spatialReference:p}),[2,{extent:ia,pixelBlocks:ga,mosaicSize:ha}]}})})};r.prototype.fetchRawTile=function(a,c,d,g){return p(this,void 0,void 0,function(){return b(this,function(a){throw new f("BaseRaster:read-not-implemented","fetchRawTile() is not implemented");})})};r.prototype.decodePixelBlock=
function(a,b){return this.rasterJobHandler?this.rasterJobHandler.decode({data:a,options:b}):t.decode(a,b)};r.prototype.request=function(a,c){return p(this,void 0,void 0,function(){var f,g,q,m,h,n,r;return b(this,function(b){switch(b.label){case 0:f=this.ioConfig.customFetchParameters,g=a.url,q=a.range,m=a.query,h=a.responseType,null==a.retryCount&&this.ioConfig.retryCount&&(a.retryCount=this.ioConfig.retryCount),n=q?{Range:"bytes\x3d"+q.from+"-"+q.to}:null,b.label=1;case 1:return b.trys.push([1,3,
,4]),[4,d(g,{query:k({},m,f),headers:n,responseType:h,signal:c})];case 2:return r=b.sent().data,[2,r];case 3:return b.sent(),0<a.retryCount?(a.retryCount--,[2,this.request(a,c)]):[2,null];case 4:return[2]}})})};r.prototype.getSliceIndex=function(a){var b=this.rasterInfo.multidimensionalInfo;if(!b||0===a.length)return null;for(var c=0,d=a[0].variableName,f=function(f){f=b.variables[f];var g=f.dimensions;if(f.name!==d)return c+=g.map(function(a){return a.values.length}).reduce(function(a,b){return a+
b}),"break";var q=g.map(function(a){return a.values.length}),m=g.length;f=function(b){var d=a.filter(function(a){return a.dimensionName===g[b].name})[0];if(null==d)return{value:null};d=Array.isArray(d.values[0])?d.values[0][0]:d.values[0];d=g[b].values.indexOf(d);if(-1===d)return{value:null};q.shift();c=b===m-1?c+d:c+d*q.reduce(function(a,b){return a+b})};for(var h=0;h<m;h++){var k=f(h);if("object"===typeof k)return k}},g=0;g<b.variables.length;g++){var q=f(g);if("object"===typeof q)return q.value;
if("break"===q)break}return c};r.prototype.computeBestPyramidLevelForLocation=function(a,c){void 0===c&&(c={});return p(this,void 0,void 0,function(){return b(this,function(a){return[2,0]})})};r.prototype.identifyPixelLocation=function(a,b,c){var d=this.rasterInfo,f=d.pixelSize,g=d.extent,q=this.rasterInfo.storageInfo,m=q.blockWidth,h=q.blockHeight,k=q.maximumPyramidLevel,n=q.pyramidScalingFactor,r=q.origin,q=q.blockBoundary;a=x.projectPoint(a,d.spatialReference,c);if(!g.intersects(a)||0>b||b>k)return null;
g=Math.pow(n,b);n=q[b];k=Math.max(n.minRow,Math.min(n.maxRow,(r.y-a.y)/(g*f.y)/h));f=Math.max(n.minCol,Math.min(n.maxCol,(a.x-r.x)/(g*f.x)/m));return{pyramidLevel:b,row:Math.floor(k),col:Math.floor(f),rowOffset:Math.min(h-1,Math.floor((k-Math.floor(k))*h)),colOffset:Math.min(m-1,Math.floor((f-Math.floor(f))*m)),srcLocation:a}};r.prototype._getTileExtent=function(b,c,d,f){var g=f.origin,q=f.size[0],m=f.size[1];d=g.x+d*q*b.x;c=g.y-c*m*b.y;return new a.Extent({xmin:d,xmax:d+q*b.x,ymin:c-m*b.y,ymax:c,
spatialReference:f.spatialReference})};l([n.property(v.url)],r.prototype,"url",null);l([n.property({type:String,json:{write:!0}})],r.prototype,"datasetName",void 0);l([n.property({type:String,json:{write:!0}})],r.prototype,"datasetFormat",void 0);l([n.property()],r.prototype,"rasterInfo",void 0);l([n.property()],r.prototype,"ioConfig",void 0);return r=l([n.subclass("esri.layers.support.rasterDatasets.BaseRaster")],r)}(n.declared(C.EsriPromiseMixin(g.JSONSupport)))})},"esri/layers/support/rasterDatasets/RawBlockCache":function(){define(["require",
"exports","../../../geometry","../rasterFunctions/rasterProjectionHelper"],function(D,e,z,l){function b(b,a){if(!p.has(b))return null;b=p.get(b);return null==b[a]?null:b[a]}Object.defineProperty(e,"__esModule",{value:!0});var p=new Map;e.register=function(b,a){a={extent:null,rasterInfo:a,cache:new Map};if(p.has(b))return b=p.get(b),b.push(a),b.length-1;p.set(b,[a]);return 0};e.unregister=function(b,a){p.has(b)&&(p.get(b)[a]=null)};e.deleteRaster=function(b){p.delete(b)};e.getBlock=function(b,a,d){if(!p.has(b))return null;
var f=p.get(b);if(null==f[a]){for(var g=0;g<f.length;g++)if(f[g].cache.has(d))return f[g].cache.get(d);return null}b=f[a].cache;if(b.has(d))return b.get(d);for(g=0;g<f.length;g++)if(g!==a&&f[g]&&f[g].cache.has(d))return a=f[g].cache.get(d),b.set(d,a),a;return null};e.putBlock=function(b,a,d,f){if(!p.has(b))return null;b=p.get(b);if(null==b[a])return null;b[a].cache.set(d,f)};e.update=function(k,a,d,f,g,c,p){void 0===p&&(p=null);k=b(k,a);a=k.extent;var y=k.cache,h=k.rasterInfo;d=d.clone().normalize()[0];
if(!a||a.xmin!==d.xmin||a.xmax!==d.xmax||a.ymin!==d.ymin||a.ymax!==d.ymax){var n=h.spatialReference;a=l.projectExtent(d,n,p);f=new z.Point({x:f,y:f,spatialReference:d.spatialReference});if(null===g&&(g=l.projectResolution(f,n,d,p),!g))return;p=l.snapPyramid(g,h,c||"closest");g=p.pyramidLevel;c=p.pyramidResolution;if(!p.excessiveReading){n=Math.floor((a.xmin-h.storageInfo.origin.x)/c.x);p=Math.floor((h.storageInfo.origin.y-a.ymax)/c.y);var v=0<g?h.storageInfo.pyramidBlockWidth:h.storageInfo.blockWidth,
m=0<g?h.storageInfo.pyramidBlockHeight:h.storageInfo.blockHeight,h=Math.floor(n/v);f=Math.floor(p/m);n=Math.floor((n+Math.ceil((a.xmax-a.xmin)/c.x-.1)-1)/v);a=Math.floor((p+Math.ceil((a.ymax-a.ymin)/c.y-.1)-1)/m);var w=new Set;for(c=f-1;c<=a+1;c++)for(p=h-1;p<=n+1;p++)w.add(g+"/"+c+"/"+p);y.forEach(function(a,b){w.has(b)||y.delete(b)});k.extent={xmin:d.xmin,ymin:d.ymin,xmax:d.xmax,ymax:d.ymax}}}}})},"esri/layers/support/rasterFunctions/rasterProjectionHelper":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/assignHelper ../../../geometry ../../../core/Error ../../../geometry/projection ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils".split(" "),
function(D,e,z,l,b,p,k,a,d,f,g,c){Object.defineProperty(e,"__esModule",{value:!0});var C=function(a,b){var c=(a.isWGS84||a.isWebMercator)&&(b.isWGS84||b.isWebMercator);return!(a.equals(b)||c)};e.defaultGridSpacing=32;e.load=function(){return p(this,void 0,void 0,function(){return b(this,function(a){switch(a.label){case 0:return f.isLoaded()||!f.isSupported()?[2,null]:[4,f.load()];case 1:return a.sent(),[2]}})})};e.projectResolution=function(b,g,n,k){void 0===k&&(k=null);if(b.spatialReference.equals(g))return b;
var m=C(b.spatialReference,g);if(m&&!f.isLoaded())throw new d("rasterprojectionhelper-projectResolution","projection engine is not loaded");n=n.center;b=new a.Extent({xmin:n.x-b.x/2,xmax:n.x+b.x/2,ymin:n.y-b.y/2,ymax:n.y+b.y/2,spatialReference:b.spatialReference});k=m?f.project(b,g,k):c.project(b,g);return null==k?null:new a.Point(k.xmax-k.xmin,k.ymax-k.ymin,g)};e.projectPoint=function(a,b,g){void 0===g&&(g=null);if(a.spatialReference.equals(b))return a;var h=C(a.spatialReference,b);if(h&&!f.isLoaded())throw new d("rasterprojectionhelper-projectResolution",
"projection engine is not loaded");return h?f.project(a,b,g):c.project(a,b)};e.projectExtent=function(a,b,g){void 0===g&&(g=null);if(a.spatialReference.equals(b))return a;var h=C(a.spatialReference,b);if(h&&!f.isLoaded())throw new d("rasterprojectionhelper-projectExtent","projection engine is not loaded");return h?f.project(a,b,g):c.project(a,b)};e.getProjectionOffsetGrid=function(b,h,k,l,m,p){void 0===l&&(l=null);void 0===m&&(m=!1);void 0===p&&(p=[e.defaultGridSpacing,e.defaultGridSpacing]);var n=
h.spatialReference.equals(b.spatialReference),v=C(b.spatialReference,h.spatialReference);if(v&&!f.isLoaded())throw new d("rasterprojectionhelper-projectResolution","projection engine is not loaded");if(!(b&&h&&k))return null;var x=b.xmin,B=b.ymin,r=b.xmax,q=b.ymax,A=b.spatialReference,y=h.spatialReference,w=g.getInfo(A),H=w&&w.valid[0],G=w&&w.valid[1],P=p[0]*k.x,S=p[1]*k.y,r=Math.ceil((r-x)/P-.1)+1,B=Math.ceil((q-B)/S-.1)+1,N;k=[];var J;b=!1;for(var z=0;z<r;z++){for(var X=[],L=0;L<B;L++)N=new a.Point({x:x+
P*z,y:q-S*L,spatialReference:A}),N=n?N:v?f.project(N,y,l):c.project(N,y),X.push(N),0<z&&m&&N&&J[L]&&w&&N.x<J[L].x&&(N.x+=G-H),N?(k.push((N.x-h.xmin)/(h.xmax-h.xmin)),k.push((h.ymax-N.y)/(h.ymax-h.ymin))):(k.push(NaN),k.push(NaN),b=!0);J=X}h=[Math.abs((k[0]+k[4]+k[4*r]+k[4*r+4])/4-k[2*B+2]),Math.abs((k[1]+k[5]+k[4*B+1]+k[4*B+5])/4-k[2*B+3])];l=new Float32Array((r-1)*(B-1)*12);m=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]);n=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(z=0;z<r-1;z++){for(L=0;L<B-1;L++){H=
z*B*2+2*L;v=k[H];x=k[H+1];q=k[H+2];J=k[H+3];H+=2*B;A=k[H];y=k[H+1];w=k[H+2];H=k[H+3];G=0;P=12*(L*(r-1)+z);for(S=0;3>S;S++)l[P++]=m[G++]*v+m[G++]*q+m[G++]*w;for(S=G=0;3>S;S++)l[P++]=m[G++]*x+m[G++]*J+m[G++]*H;for(S=G=0;3>S;S++)l[P++]=n[G++]*v+n[G++]*A+n[G++]*w;for(S=G=0;3>S;S++)l[P++]=n[G++]*x+n[G++]*y+n[G++]*H}if(b)for(L=0;L<l.length;L++)isNaN(l[L])&&(l[L]=-1)}return{offsets:k,error:h,coefficients:l,spacing:p,size:[r-1,B-1]}};e.snapPyramid=function(b,c,d){var f=Math.log(b.x/c.pixelSize.x)/Math.LN2,
g=Math.log(b.y/c.pixelSize.y)/Math.LN2;b=c.storageInfo.maximumPyramidLevel||0;d="down"===d?Math.floor(Math.min(f,g)):"up"===d?Math.ceil(Math.max(f,g)):Math.round((f+g)/2);f=!1;0>d?d=0:d>b&&(f=d>b+3,d=b);b=Math.pow(2,d);c=new a.Point({x:b*c.pixelSize.x,y:b*c.pixelSize.y,spatialReference:c.spatialReference});return{pyramidLevel:d,pyramidResolution:c,excessiveReading:f}}})},"esri/geometry/projection":function(){define("require exports ../core/promiseUtils ./pe ./SpatialReference ./support/GeographicTransformation".split(" "),
function(D,e,z,l,b,p){function k(c,f,k,h,n){void 0===h&&(h=null);void 0===n&&(n=!1);if(null===h){var l=p.cacheKey(f,k);void 0!==g[l]?h=g[l]:(h=a(f,k,null),null===h&&(h=new p),g[l]=h)}return d._project(c,f,k instanceof b||!1===n?k:new b(k),h,n)}function a(a,b,f){void 0===f&&(f=null);a=d._getTransformation(a,b,f);return null!==a?p.fromGE(a):null}Object.defineProperty(e,"__esModule",{value:!0});var d=null;e.isLoaded=function(){return!!d&&l.isLoaded()};e.isSupported=function(){return l.isSupported()};
var f=null;e.load=function(){return f?f:f=z.create(function(a,b){var c=l.load();D(["./geometryEngine"],function(f){d=f;c.then(function(){d._enableProjection(l);a()},function(a){b(a)})})})};e.project=function(a,b,d){void 0===d&&(d=null);return a instanceof Array?0===a.length?[]:k(a,a[0].spatialReference,b,d):k([a],a.spatialReference,b,d)[0]};var g={};e.projectMany=k;e.getTransformation=a;e.getTransformations=function(a,b,f){void 0===f&&(f=null);a=d._getTransformationBySuitability(a,b,f);if(null!==
a){b=[];for(f=0;f<a.length;f++)b.push(p.fromGE(a[f]));return b}return[]}})},"esri/geometry/pe":function(){define(["require","exports","../core/tsSupport/extendsHelper","../core/has","../core/promiseUtils"],function(D,e,z,l,b){function p(a){function b(a,b,c){a[b]=c(a[b])}e._pe=a;c.init();C.init();y.init();h.init();n.init();e.PeGCSExtent=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}z(b,a);b.prototype.destroy=function(){e._pe.destroy(this)};return b}(e._pe.PeGCSExtent);for(var d=
0,g=[e._pe.PeDatum,e._pe.PeGeogcs,e._pe.PeGeogtran,e._pe.PeObject,e._pe.PeParameter,e._pe.PePrimem,e._pe.PeProjcs,e._pe.PeSpheroid,e._pe.PeUnit];d<g.length;d++)a=g[d],b(a.prototype,"getName",function(a){return function(){return a.call(this,Array(c.PE_NAME_MAX))}});d=0;for(g=[e._pe.PeGeogtran,e._pe.PeProjcs];d<g.length;d++)a=g[d],b(a.prototype,"getParameters",function(a){return function(){for(var b=Array(c.PE_PARM_MAX),d=a.call(this),f=0;f<b.length;f++){var g=e._pe.getValue(d,"*");b[f]=g?e._pe.wrapPointer(g,
e._pe.PeParameter):null;d+=Int32Array.BYTES_PER_ELEMENT}return b}});b(e._pe.PeHorizon.prototype,"getCoord",function(a){return function(){var b=this.getSize();if(!b)return null;var c=[],d=a.call(this);f(c,b,d);return c}});b(e._pe.PeGTlistExtendedEntry.prototype,"getEntries",function(a){var b=e._pe._pe_getPeGTlistExtendedGTsSize();return function(){var c=null,d=a.call(this);if(!e._pe.compare(d,e._pe.NULL)){var c=[d],f=this.getSteps();if(1<f)for(var d=e._pe.getPointer(d),g=1;g<f;g++)c.push(e._pe.wrapPointer(d+
b*g,e._pe.PeGTlistExtendedGTs))}return c}});var k=e._pe._pe_getPeHorizonSize();a=function(a){return function(){var b=this._cache;b||(this._cache=b=new Map);if(b.has(a))return b.get(a);var c=null,d=a.call(this);if(!e._pe.compare(d,e._pe.NULL)){var c=[d],f=d.getNump();if(1<f)for(var d=e._pe.getPointer(d),g=1;g<f;g++)c.push(e._pe.wrapPointer(d+k*g,e._pe.PeHorizon))}b.set(a,c);return c}};b(e._pe.PeProjcs.prototype,"horizonGcsGenerate",a);b(e._pe.PeProjcs.prototype,"horizonPcsGenerate",a);e._pe.PeObject.prototype.toString=
function(a){void 0===a&&(a=c.PE_STR_OPTS_NONE);e._pe.ensureCache.prepare();var b=e._pe.getPointer(this),d=e._pe.ensureInt8(Array(c.PE_BUFFER_MAX));return e._pe.UTF8ToString(e._pe._pe_object_to_string_ext(b,a,d))}}function k(a){if(a){var b=e._pe.getClass(a);b&&(b=e._pe.getCache(b))&&(a=e._pe.getPointer(a))&&delete b[a]}}function a(a,b){var c=[];b=Array(b);for(var d=0;d<a;d++)c.push(e._pe.ensureInt8(b));return c}function d(a){var b;Array.isArray(a[0])?(b=[],a.forEach(function(a){b.push(a[0],a[1])})):
b=a;return b}function f(a,b,c,d){void 0===d&&(d=!1);if(d)for(d=0;d<2*b;d++)a[d]=e._pe.getValue(c+d*Float64Array.BYTES_PER_ELEMENT,"double");else{var f=0===a.length;for(d=0;d<b;d++)f&&(a[d]=Array(2)),a[d][0]=e._pe.getValue(c,"double"),a[d][1]=e._pe.getValue(c+Float64Array.BYTES_PER_ELEMENT,"double"),c+=2*Float64Array.BYTES_PER_ELEMENT}}Object.defineProperty(e,"__esModule",{value:!0});var g;e._pe=null;e.isLoaded=function(){return!!e._pe};e.isSupported=function(){return!!l("esri-wasm")};e.load=function(){return g?
g:g=b.create(function(a,b){D(["./support/pe-wasm"],function(c){c({locateFile:function(a){return D.toUrl("./support/"+a)},onAbort:function(a){b(Error(a))}}).then(function(b){p(b);a()})})})};(function(a){function b(a,b,c){e._pe.ensureCache.prepare();var g=d(c),q=c===g,g=e._pe.ensureFloat64(g);(a=e._pe._pe_geog_to_proj(e._pe.getPointer(a),b,g))&&f(c,b,g,q);return a}function g(a,b,c){return k(a,b,c,0)}function k(a,b,c,g){e._pe.ensureCache.prepare();var q=d(c),m=c===q,q=e._pe.ensureFloat64(q);(a=e._pe._pe_proj_to_geog_center(e._pe.getPointer(a),
b,q,g))&&f(c,b,q,m);return a}a.geogToProj=b;a.projGeog=function(a,d,f,m){switch(m){case c.PE_TRANSFORM_P_TO_G:return g(a,d,f);case c.PE_TRANSFORM_G_TO_P:return b(a,d,f)}return 0};a.projToGeog=g;a.projToGeogCenter=k})(e.PeCSTransformations||(e.PeCSTransformations={}));var c;(function(a){a.init=function(){a.PE_BUFFER_MAX=e._pe.PeDefs.prototype.PE_BUFFER_MAX;a.PE_NAME_MAX=e._pe.PeDefs.prototype.PE_NAME_MAX;a.PE_MGRS_MAX=e._pe.PeDefs.prototype.PE_MGRS_MAX;a.PE_USNG_MAX=e._pe.PeDefs.prototype.PE_USNG_MAX;
a.PE_DD_MAX=e._pe.PeDefs.prototype.PE_DD_MAX;a.PE_DDM_MAX=e._pe.PeDefs.prototype.PE_DDM_MAX;a.PE_DMS_MAX=e._pe.PeDefs.prototype.PE_DMS_MAX;a.PE_UTM_MAX=e._pe.PeDefs.prototype.PE_UTM_MAX;a.PE_PARM_MAX=e._pe.PeDefs.prototype.PE_PARM_MAX;a.PE_TYPE_NONE=e._pe.PeDefs.prototype.PE_TYPE_NONE;a.PE_TYPE_GEOGCS=e._pe.PeDefs.prototype.PE_TYPE_GEOGCS;a.PE_TYPE_PROJCS=e._pe.PeDefs.prototype.PE_TYPE_PROJCS;a.PE_TYPE_GEOGTRAN=e._pe.PeDefs.prototype.PE_TYPE_GEOGTRAN;a.PE_TYPE_COORDSYS=e._pe.PeDefs.prototype.PE_TYPE_COORDSYS;
a.PE_TYPE_UNIT=e._pe.PeDefs.prototype.PE_TYPE_UNIT;a.PE_STR_OPTS_NONE=e._pe.PeDefs.prototype.PE_STR_OPTS_NONE;a.PE_STR_AUTH_NONE=e._pe.PeDefs.prototype.PE_STR_AUTH_NONE;a.PE_STR_AUTH_TOP=e._pe.PeDefs.prototype.PE_STR_AUTH_TOP;a.PE_STR_NAME_CANON=e._pe.PeDefs.prototype.PE_STR_NAME_CANON;a.PE_PARM_X0=e._pe.PeDefs.prototype.PE_PARM_X0;a.PE_PARM_ND=e._pe.PeDefs.prototype.PE_PARM_ND;a.PE_TRANSFORM_1_TO_2=e._pe.PeDefs.prototype.PE_TRANSFORM_1_TO_2;a.PE_TRANSFORM_2_TO_1=e._pe.PeDefs.prototype.PE_TRANSFORM_2_TO_1;
a.PE_TRANSFORM_P_TO_G=e._pe.PeDefs.prototype.PE_TRANSFORM_P_TO_G;a.PE_TRANSFORM_G_TO_P=e._pe.PeDefs.prototype.PE_TRANSFORM_G_TO_P;a.PE_HORIZON_RECT=e._pe.PeDefs.prototype.PE_HORIZON_RECT;a.PE_HORIZON_POLY=e._pe.PeDefs.prototype.PE_HORIZON_POLY;a.PE_HORIZON_LINE=e._pe.PeDefs.prototype.PE_HORIZON_LINE;a.PE_HORIZON_DELTA=e._pe.PeDefs.prototype.PE_HORIZON_DELTA}})(c=e.PeDefs||(e.PeDefs={}));(function(a){function b(a,b){var c=null,g=f[a];g||(g={},f[a]=g);g.hasOwnProperty(String(b))?c=g[b]:(a=e._pe.PeFactory.prototype.factoryByType(a,
b),e._pe.compare(a,e._pe.NULL)||(c=a,g[b]=c));return c=d(c)}function d(a){if(a){var b=a.getType();switch(b){case c.PE_TYPE_GEOGCS:a=e._pe.castObject(a,e._pe.PeGeogcs);break;case c.PE_TYPE_PROJCS:a=e._pe.castObject(a,e._pe.PeProjcs);break;case c.PE_TYPE_GEOGTRAN:a=e._pe.castObject(a,e._pe.PeGeogtran);break;default:b&c.PE_TYPE_UNIT&&(a=e._pe.castObject(a,e._pe.PeUnit))}}return a}var f={},g={};a.initialize=function(){e._pe.PeFactory.prototype.initialize(null)};a.coordsys=function(a){return b(c.PE_TYPE_COORDSYS,
a)};a.factoryByType=b;a.fromString=function(a,b){var c=null,f=g[a];f||(f={},g[a]=f);f.hasOwnProperty(b)?c=f[b]:(a=e._pe.PeFactory.prototype.fromString(a,b),e._pe.compare(a,e._pe.NULL)||(c=a,f[b]=c));return c=d(c)};a.geogcs=function(a){return b(c.PE_TYPE_GEOGCS,a)};a.geogtran=function(a){return b(c.PE_TYPE_GEOGTRAN,a)};a.getCode=function(a){return e._pe.PeFactory.prototype.getCode(a)};a.projcs=function(a){return b(c.PE_TYPE_PROJCS,a)};a.unit=function(a){return b(c.PE_TYPE_UNIT,a)}})(e.PeFactory||(e.PeFactory=
{}));e.PeGCSExtent=null;var C;(function(a){var b;a.init=function(){a.PE_GTLIST_OPTS_COMMON=e._pe.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON;b=e._pe._pe_getPeGTlistExtendedEntrySize()};a.getGTlist=function(a,c,d,f,g,m){var q=null,k=new e._pe.PeInteger(m);try{var h=e._pe.PeGTlistExtended.prototype.getGTlist(a,c,d,f,g,k);if(m=k.val)if(q=[h],1<m){var n=e._pe.getPointer(h);for(a=1;a<m;a++)q.push(e._pe.wrapPointer(n+b*a,e._pe.PeGTlistExtendedEntry))}}finally{e._pe.destroy(k)}return q}})(C=e.PeGTlistExtended||
(e.PeGTlistExtended={}));(function(a){a.destroy=function(a){if(a&&a.length){for(var b=0;b<a.length;b++){var c=a[b];k(c);c.getEntries().forEach(function(a){k(a);a=a.getGeogtran();k(a);a.getParameters().forEach(k);[a.getGeogcs1(),a.getGeogcs2()].forEach(function(a){k(a);var b=a.getDatum();k(b);k(b.getSpheroid());k(a.getPrimem());k(a.getUnit())})})}e._pe.PeGTlistExtendedEntry.prototype.Delete(a[0])}}})(e.PeGTlistExtendedEntry||(e.PeGTlistExtendedEntry={}));(function(a){a.geogToGeog=function(a,b,c,g,
k){e._pe.ensureCache.prepare();var m=d(c),h=c===m,m=e._pe.ensureFloat64(m),q=0;g&&(q=e._pe.ensureFloat64(g));(a=e._pe._pe_geog_to_geog(e._pe.getPointer(a),b,m,q,k))&&f(c,b,m,h);return a}})(e.PeGTTransformations||(e.PeGTTransformations={}));(function(b){function g(b,f,g,m,k,q){e._pe.ensureCache.prepare();var h,n;switch(b){case "dd":h=e._pe._pe_geog_to_dd;n=c.PE_DD_MAX;break;case "ddm":h=e._pe._pe_geog_to_ddm;n=c.PE_DDM_MAX;break;case "dms":h=e._pe._pe_geog_to_dms,n=c.PE_DMS_MAX}b=0;f&&(b=e._pe.getPointer(f));
f=d(m);f=e._pe.ensureFloat64(f);n=a(g,n);m=e._pe.ensureInt32(n);if(k=h(b,g,f,k,m))for(h=0;h<g;h++)q[h]=e._pe.UTF8ToString(n[h]);return k}function k(a,b,c,d,g){e._pe.ensureCache.prepare();var q;switch(a){case "dd":q=e._pe._pe_dd_to_geog;break;case "ddm":q=e._pe._pe_ddm_to_geog;break;case "dms":q=e._pe._pe_dms_to_geog}a=0;b&&(a=e._pe.getPointer(b));b=d.map(function(a){return e._pe.ensureString(a)});d=e._pe.ensureInt32(b);b=e._pe.ensureFloat64(Array(2*c));(q=q(a,c,d,b))&&f(g,c,b);return q}b.geog_to_dms=
function(a,b,c,d,f){return g("dms",a,b,c,d,f)};b.dms_to_geog=function(a,b,c,d){return k("dms",a,b,c,d)};b.geog_to_ddm=function(a,b,c,d,f){return g("ddm",a,b,c,d,f)};b.ddm_to_geog=function(a,b,c,d){return k("ddm",a,b,c,d)};b.geog_to_dd=function(a,b,c,d,f){return g("dd",a,b,c,d,f)};b.dd_to_geog=function(a,b,c,d){return k("dd",a,b,c,d)}})(e.PeNotationDms||(e.PeNotationDms={}));var y;(function(b){b.init=function(){b.PE_MGRS_STYLE_NEW=e._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW;b.PE_MGRS_STYLE_OLD=
e._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD;b.PE_MGRS_STYLE_AUTO=e._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO;b.PE_MGRS_180_ZONE_1_PLUS=e._pe.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS;b.PE_MGRS_ADD_SPACES=e._pe.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES};b.geog_to_mgrs_extended=function(b,f,g,k,h,n,r){e._pe.ensureCache.prepare();var q=0;b&&(q=e._pe.getPointer(b));b=d(g);g=e._pe.ensureFloat64(b);b=a(f,c.PE_MGRS_MAX);var m=e._pe.ensureInt32(b);if(k=e._pe._pe_geog_to_mgrs_extended(q,
f,g,k,h,n,m))for(h=0;h<f;h++)r[h]=e._pe.UTF8ToString(b[h]);return k};b.mgrs_to_geog_extended=function(a,b,c,d,g){e._pe.ensureCache.prepare();var m=0;a&&(m=e._pe.getPointer(a));a=c.map(function(a){return e._pe.ensureString(a)});c=e._pe.ensureInt32(a);a=e._pe.ensureFloat64(Array(2*b));(d=e._pe._pe_mgrs_to_geog_extended(m,b,c,d,a))&&f(g,b,a);return d}})(y=e.PeNotationMgrs||(e.PeNotationMgrs={}));(function(b){b.geog_to_usng=function(b,f,g,k,h,n,r){e._pe.ensureCache.prepare();var q=0;b&&(q=e._pe.getPointer(b));
b=d(g);g=e._pe.ensureFloat64(b);b=a(f,c.PE_MGRS_MAX);var m=e._pe.ensureInt32(b);if(k=e._pe._pe_geog_to_usng(q,f,g,k,h,n,m))for(h=0;h<f;h++)r[h]=e._pe.UTF8ToString(b[h]);return k};b.usng_to_geog=function(a,b,c,d){e._pe.ensureCache.prepare();var g=0;a&&(g=e._pe.getPointer(a));a=c.map(function(a){return e._pe.ensureString(a)});c=e._pe.ensureInt32(a);a=e._pe.ensureFloat64(Array(2*b));(g=e._pe._pe_usng_to_geog(g,b,c,a))&&f(d,b,a);return g}})(e.PeNotationUsng||(e.PeNotationUsng={}));var h;(function(b){b.init=
function(){b.PE_UTM_OPTS_NONE=e._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NONE;b.PE_UTM_OPTS_ADD_SPACES=e._pe.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES;b.PE_UTM_OPTS_NS=e._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NS};b.geog_to_utm=function(b,f,g,k,h){e._pe.ensureCache.prepare();var m=0;b&&(m=e._pe.getPointer(b));b=d(g);g=e._pe.ensureFloat64(b);b=a(f,c.PE_UTM_MAX);var n=e._pe.ensureInt32(b);if(k=e._pe._pe_geog_to_utm(m,f,g,k,n))for(m=0;m<f;m++)h[m]=e._pe.UTF8ToString(b[m]);return k};b.utm_to_geog=
function(a,b,c,d,g){e._pe.ensureCache.prepare();var k=0;a&&(k=e._pe.getPointer(a));a=c.map(function(a){return e._pe.ensureString(a)});c=e._pe.ensureInt32(a);a=e._pe.ensureFloat64(Array(2*b));(d=e._pe._pe_utm_to_geog(k,b,c,d,a))&&f(g,b,a);return d}})(h=e.PeNotationUtm||(e.PeNotationUtm={}));var n;(function(a){var b=new Map;a.init=function(){a.PE_PCSINFO_OPTION_NONE=e._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE;a.PE_PCSINFO_OPTION_DOMAIN=e._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN;a.PE_POLE_OUTSIDE_BOUNDARY=
e._pe.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY;a.PE_POLE_POINT=e._pe.PePCSInfo.prototype.PE_POLE_POINT};a.generate=function(c,d){void 0===d&&(d=a.PE_PCSINFO_OPTION_DOMAIN);var f,g;b.has(c)&&(g=b.get(c),g[d]&&(f=g[d]));f||(f=e._pe.PePCSInfo.prototype.generate(c,d),g||(g=[],b.set(c,g)),g[d]=f);return f}})(n=e.PePCSInfo||(e.PePCSInfo={}));(function(a){a.version_string=function(){return e._pe.PeVersion.prototype.version_string()}})(e.PeVersion||(e.PeVersion={}));e._init=p})},"esri/geometry/support/GeographicTransformation":function(){define(["require",
"exports","./GeographicTransformationStep"],function(D,e,z){return function(){function l(b){this.steps=[];this._cached_projection={};this._chain="";this._gtlistentry=null;if(b&&b.steps){var l=0;for(b=b.steps;l<b.length;l++){var k=b[l];k instanceof z?this.steps.push(k):this.steps.push(new z({wkid:k.wkid,wkt:k.wkt,isInverse:k.isInverse}))}}}l.cacheKey=function(b,l){return[void 0!==b.wkid&&null!==b.wkid?b.wkid.toString():"-1",void 0!==b.wkt&&null!==b.wkt?b.wkt.toString():"",void 0!==l.wkid&&null!==l.wkid?
l.wkid.toString():"-1",void 0!==l.wkt&&null!==l.wkt?l.wkt.toString():""].join()};l.fromGE=function(b){var p=new l,k="",a=0;for(b=b.steps;a<b.length;a++){var d=z.fromGE(b[a]);p.steps.push(d);k+=d.uid.toString()+","}p._cached_projection={};p._gtlistentry=null;p._chain=k;return p};l.prototype.getInverse=function(){var b=new l;b.steps=[];for(var p=this.steps.length-1;0<=p;p--)b.steps.push(this.steps[p].getInverse());return b};l.prototype.getGTListEntry=function(){for(var b="",l=0,k=this.steps;l<k.length;l++)b+=
k[l].uid.toString()+",";b!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=b);return this._gtlistentry};l.prototype.assignCachedGe=function(b,p,k){this._cached_projection[l.cacheKey(b,p)]=k};l.prototype.getCachedGeTransformation=function(b,p){for(var k="",a=0,d=this.steps;a<d.length;a++)k+=d[a].uid.toString()+",";k!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=k);b=this._cached_projection[l.cacheKey(b,p)];return void 0===b?null:b};return l}()})},
"esri/geometry/support/GeographicTransformationStep":function(){define(["require","exports"],function(D,e){var z=0;return function(){function l(b){void 0===b&&(b=null);this.uid=z++;b?(this._wkt=void 0!==b.wkt?b.wkt:null,this._wkid=void 0!==b.wkid?b.wkid:-1,this._isInverse=void 0!==b.isInverse?!0===b.isInverse:!1):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}l.fromGE=function(b){var p=new l;p._wkt=b.wkt;p._wkid=b.wkid;p._isInverse=b.isInverse;return p};Object.defineProperty(l.prototype,"wkt",
{get:function(){return this._wkt},set:function(b){this._wkt=b;this.uid=z++},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"wkid",{get:function(){return this._wkid},set:function(b){this._wkid=b;this.uid=z++},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"isInverse",{get:function(){return this._isInverse},set:function(b){this._isInverse=b;this.uid=z++},enumerable:!0,configurable:!0});l.prototype.getInverse=function(){var b=new l;b._wkt=this.wkt;b._wkid=this._wkid;
b._isInverse=!this.isInverse;return b};return l}()})},"esri/layers/support/rasterFormats/RasterCodec":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/assignHelper ../../../core/Error ../PixelBlock ./ImageCanvasDecoder ./JpgPlus ./Lerc2Codec ./LercCodec ./Png ./Raw ./TiffDecoder".split(" "),function(D,e,z,l,b,p,k,a,d,f,g,c,C,y){function h(a,b){if(!r)throw new p("rasterCoded:decode","lerc decoder is not supported on big endian platform");
var c=b.width,d=b.height,f=b.pixelType,q=B(f),h=q.pixelTypeCtor;b=null==b.noDataValue?q.noDataValue:b.noDataValue;for(var q=0,m,n=0,l,A=a.byteLength-10;n<A;){var e=g.decode(a,{inputOffset:n,encodedMaskData:m,returnMask:0===q?!0:!1,returnEncodedMask:0===q?!0:!1,returnFileInfo:!0,pixelType:h,noDataValue:b});if(c&&d&&(e.width!==c||e.height!==d))throw new p("rasterCoded:decode","lerc decoded result has width or height different from specified in options");n=e.fileInfo.eofOffset;0===q&&(m=e.encodedMaskData,
l=new k({width:e.width,height:e.height,pixels:[],pixelType:f,mask:e.maskData,statistics:[]}));q++;l.addData({pixels:e.pixelData,statistics:{minValue:e.minValue,maxValue:e.maxValue,noDataValue:e.noDataValue}});10<A-n&&(e=String.fromCharCode.apply(null,new Uint8Array(a,n,10)),n=-1<n+e.indexOf("CntZ")?e.indexOf("CntZ"):0)}return l}function n(a,b){if(!r)throw new p("rasterCoded:decode","lerc decoder is not supported on big endian platform");var c=0,d=0,g=0,q,h,m,n=a.byteLength-10,l=[],e=b.width;for(b=
b.height;d<n;){h=f.decode(a,{inputOffset:d,maskData:q,returnFileInfo:!0});if(e&&b&&(h.width!==e||h.height!==b))throw new p("rasterCoded:decode","lerc2 decoded result has width or height different from what's specified in options");d=h.fileInfo.eofOffset;0===c&&(g=h.fileInfo.numValidPixel,q=h.maskData,m=new k({width:h.width,height:h.height,pixels:[],pixelType:h.fileInfo.pixelType,mask:h.maskData,statistics:[]}));h.fileInfo.mask&&0<h.fileInfo.mask.numBytes&&l.push(h.maskData);c++;m.addData({pixels:h.pixelData,
statistics:{minValue:h.minValue,maxValue:h.maxValue}});10<n-d&&(h=String.fromCharCode.apply(null,new Uint8Array(a,d,10)),d+=-1<h.indexOf("Lerc")?h.indexOf("Lerc"):0)}d=c=a=0;if(1<l.length){d=m.width*m.height;q=new Uint8Array(d);q.set(l[0]);for(a=1;a<l.length;a++)for(g=l[a],c=0;c<d;c++)q[c]&=g[c];for(c=g=0;c<d;c++)g+=q[c];m.mask=q}m.validPixelCount=g;return m}function v(a){a=y.decode(a);a=new k({width:a.width,height:a.height,pixels:a.pixels,pixelType:a.pixelType.toLowerCase(),mask:a.mask,statistics:null});
a.updateStatistics();return a}function m(a){a=d.decode(a);a=new k({width:a.width,height:a.height,pixels:a.pixels,pixelType:"U8",mask:a.mask,statistics:null});a.updateStatistics();return a}function w(a,b){a=new Uint8Array(a);var d=new c(a);a=b.width;var f=b.height;b=a*f;for(var d=d.decode(),g=0,h=0,h=new Uint8Array(b),g=0;g<b;g++)h[g]=d[4*g+3];f=new k({width:a,height:f,pixels:[],pixelType:"U8",mask:h,statistics:[]});for(g=0;3>g;g++){a=new Uint8Array(b);for(h=0;h<b;h++)a[h]=d[4*h+g];f.addData({pixels:a})}f.updateStatistics();
return f}function t(c,d,f){return l(this,void 0,void 0,function(){var g,h,q,m;return z(this,function(n){switch(n.label){case 0:return g=new a,h=b({applyJpegMask:!1},d),[4,g.decode(c,h,f)];case 1:return q=n.sent(),m=new k(q),m.updateStatistics(),[2,m]}})})}function u(a){if(null==a)throw new p("rasterCodec:decode","parameter encodeddata is required.");a=new Uint8Array(a,0,10);var b="";255===a[0]&&216===a[1]?b="jpg":137===a[0]&&80===a[1]&&78===a[2]&&71===a[3]?b="png":67===a[0]&&110===a[1]&&116===a[2]&&
90===a[3]&&73===a[4]&&109===a[5]&&97===a[6]&&103===a[7]&&101===a[8]&&32===a[9]?b="lerc":76===a[0]&&101===a[1]&&114===a[2]&&99===a[3]&&50===a[4]&&32===a[5]?b="lerc2":73===a[0]&&73===a[1]&&42===a[2]&&0===a[3]||77===a[0]&&77===a[1]&&0===a[2]&&42===a[3]?b="tiff":-1<String.fromCharCode.apply(null,a).toLowerCase().indexOf("error")&&(b="error");return b}function x(a){var b=null;switch(a){case "lerc":b=h;break;case "lerc2":b=n;break;case "jpg":b=m;break;case "png":b=w;break;case "bsq":case "bip":b=function(b,
c){var d=B(c.pixelType).pixelTypeCtor,f=C.decode;b=f(b,{width:c.width,height:c.height,pixelType:d,format:a});c=new k({width:c.width,height:c.height,pixels:b.pixels,pixelType:c.pixelType,mask:b.mask,statistics:null});c.updateStatistics();return c};break;case "tiff":b=v;break;case "error":b=function(){throw new p("rasterCodec:decode","input data contains error");};break;default:b=function(){throw new p("rasterCodec:decode","unsupported raster format");}}return b}function B(a){var b=null,c=null;switch(a?
a.toLowerCase():"f32"){case "u1":case "u2":case "u4":case "u8":c=Math.pow(2,8)-1;b=Uint8Array;break;case "u16":c=c||Math.pow(2,16)-1;b=Uint16Array;break;case "u32":c=c||Math.pow(2,32)-1;b=Uint32Array;break;case "s8":c=c||0-Math.pow(2,7);b=Int8Array;break;case "s16":c=c||0-Math.pow(2,15);b=Int16Array;break;case "s32":c=c||0-Math.pow(2,31);b=Int32Array;break;default:b=Float32Array}return{pixelTypeCtor:b,noDataValue:c}}var r=function(){var a=new ArrayBuffer(4),b=new Uint8Array(a);(new Uint32Array(a))[0]=
1;return 1===b[0]}();return function(){function a(){}a.getFormat=function(a){a=u(a);"lerc2"===a?a="lerc":"error"===a&&(a="");return a};a.decode=function(a,c,d){return l(this,void 0,void 0,function(){var f,g,h;return z(this,function(m){switch(m.label){case 0:if(null==a)throw new p("rasterCodec:decode","missing encodeddata parameter.");if(null==c||null==c.width||null==c.height)throw new p("rasterCodec:decode","requires width and height in options parameter.");f=c.format&&c.format.toLowerCase();if("tiff"===
f&&c.customOptions)return m=y.decodeTileOrStrip(a,c.customOptions),m=new k({width:m.width,height:m.height,pixels:m.pixels,pixelType:m.pixelType.toLowerCase(),mask:m.mask,statistics:null}),m.updateStatistics(),[2,m];if(!f||"bsq"!==f&&"bip"!==f)f=u(a);return!c.useCanvas||"jpg"!==f&&"png"!==f?[3,2]:[4,t(a,c,d)];case 1:return h=m.sent(),[3,3];case 2:g=x(f);c.isPoint&&(c=b({},c),c.width++,c.height++);h=g(a,c);if(c.isPoint){var q=h,n=void 0;void 0===n&&(n=1);if(q){var l=q.pixels,r=q.width,e=q.mask;if(l&&
0!==l.length){var B=l.length,A=r-1,C=q.height-1,w=[],v,F,E,H,G,z,P=k.getPixelArrayConstructor(q.pixelType);if(0===n){for(n=0;n<B;n++){H=l[n];G=new P(A*C);for(v=0;v<C;v++)for(E=v*r,F=0;F<A;F++)G[v*A+F]=H[E+F];w.push(G)}if(e)for(z=new Uint8Array(A*C),v=0;v<C;v++)for(E=v*r,F=0;F<A;F++)z[v*A+F]=e[E+F]}else{for(n=0;n<B;n++){H=l[n];G=new P(A*C);for(v=0;v<C;v++)for(E=v*r,F=0;F<A;F++)G[v*A+F]=(H[E+F]+H[E+F+1]+H[E+r+F]+H[E+r+F+1])/4;w.push(G)}if(e)for(z=new Uint8Array(A*C),v=0;v<C;v++)for(E=v*r,F=0;F<A;F++)z[v*
A+F]=Math.min.apply(null,[e[E+F],e[E+F+1],e[E+r+F],e[E+r+F+1]])}q.width=A;q.height=C;q.mask=z;q.pixels=w}}}m.label=3;case 3:return[2,h]}})})};return a}()})},"esri/layers/support/rasterFormats/ImageCanvasDecoder":function(){define("require exports ../../../core/Error ../../../core/promiseUtils ../../../core/promiseUtils ./Zlib".split(" "),function(D,e,z,l,b,p){return function(){function k(a){a&&(this.canvas=a.canvas,this.ctx=a.ctx||a.canvas&&a.canvas.getContext("2d"))}k.getFormat=function(a){if(!a||
10>a.byteLength)return"";a=new Uint8Array(a,0,10);var b="";255===a[0]&&216===a[1]?b="jpeg":137===a[0]&&80===a[1]&&78===a[2]&&71===a[3]&&(b="png");return b};k.prototype.decode=function(a,d,f){var g=this;if(!a||10>a.byteLength)throw new z("imagecanvasdecoder: decode","required a valid encoded data as input.");var c=k.getFormat(a);if(""===c)throw new z("imagecanvasdecoder: decode","encoded data format is not a supported format (jpeg or png).");var e=d.width,p=d.height,h=d.applyJpegMask;if(h&&(!e||!p))throw new z("imagecanvasdecoder: decode",
"image width and height are needed to apply jpeg mask directly to canvas");return l.create(function(n,y){var m=null;"jpeg"===c&&h&&(m=k.getMask(a,d));var v=new Blob([new Uint8Array(a)],{type:"image/"+c}),C=URL.createObjectURL(v),u=new Image,x;u.src=C;u.onload=function(){URL.revokeObjectURL(C);if(l.isAborted(f))y(b.createAbortError());else{e=u.width;p=u.height;if(g.canvas){if(g.canvas.width!==e||g.canvas.height!==p)g.canvas.width=e,g.canvas.height=p;g.ctx.clearRect(0,0,e,p)}else g.canvas=document.createElement("canvas"),
g.canvas.width=e,g.canvas.height=p,g.ctx=g.canvas.getContext("2d");g.ctx.drawImage(u,0,0);var a=g.ctx.getImageData(0,0,e,p);x=a.data;var c;if(d.renderOnCanvas){if(m)for(c=0;c<m.length;c++)x[4*c+3]=m[c]?255:0;g.ctx.putImageData(a,0,0);n(null)}else{var a=e*p,h=new Uint8Array(a),k=new Uint8Array(a),v=new Uint8Array(a);if(m)for(c=0;c<a;c++)h[c]=x[4*c],k[c]=x[4*c+1],v[c]=x[4*c+2];else for(m=new Uint8Array(a),c=0;c<a;c++)h[c]=x[4*c],k[c]=x[4*c+1],v[c]=x[4*c+2],m[c]=x[4*c+3];n({width:e,height:p,pixels:[h,
k,v],mask:m,pixelType:"u8"})}}};u.onerror=function(){URL.revokeObjectURL(C);y("cannot load image")}})};k.getMask=function(a,b){var d=null;try{var g=new Uint8Array(a);a=0;var c=g.length-2;for(a=Math.ceil(g.length/2);a<c&&(255!==g[a]||217!==g[a+1]);a++);a+=2;if(a<g.length-1)for(var k=(new p(g.subarray(a))).getBytes(),d=new Uint8Array(b.width*b.height),g=b=0;g<k.length;g++)for(c=7;0<=c;c--)d[b++]=k[g]>>c&1}catch(y){}return d};return k}()})},"esri/layers/support/rasterFormats/Zlib":function(){define([],
function(){var D=function(){function e(){this.bufferLength=this.pos=0;this.eof=!1;this.buffer=null}e.prototype={ensureBuffer:function(e){var l=this.buffer,b=l?l.byteLength:0;if(e<b)return l;for(var p=512;p<e;)p<<=1;e=new Uint8Array(p);for(p=0;p<b;++p)e[p]=l[p];return this.buffer=e},getByte:function(){for(var e=this.pos;this.bufferLength<=e;){if(this.eof)return null;this.readBlock()}return this.buffer[this.pos++]},getBytes:function(e){var l=this.pos;if(e){this.ensureBuffer(l+e);for(e=l+e;!this.eof&&
this.bufferLength<e;)this.readBlock();var b=this.bufferLength;e>b&&(e=b)}else{for(;!this.eof;)this.readBlock();e=this.bufferLength}this.pos=e;return this.buffer.subarray(l,e)},lookChar:function(){for(var e=this.pos;this.bufferLength<=e;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos])},getChar:function(){for(var e=this.pos;this.bufferLength<=e;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos++])},makeSubStream:function(e,
l,b){for(var p=e+l;this.bufferLength<=p&&!this.eof;)this.readBlock();return new Stream(this.buffer,e,l,b)},skip:function(e){e||(e=1);this.pos+=e},reset:function(){this.pos=0}};return e}();return function(){function e(a){throw Error(a);}function z(a){var b=0,d=a[b++],c=a[b++];-1!=d&&-1!=c||e("Invalid header in flate stream");8!=(d&15)&&e("Unknown compression method in flate stream");0!=((d<<8)+c)%31&&e("Bad FCHECK in flate stream");c&32&&e("FDICT bit set in flate stream");this.bytes=a;this.bytesPos=
b;this.codeBuf=this.codeSize=0;D.call(this)}if(!self||!self.Uint32Array)return null;var l=new Uint32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),b=new Uint32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]),p=new Uint32Array([1,2,3,4,65541,65543,131081,131085,196625,196633,262177,262193,327745,327777,393345,393409,459009,459137,524801,525057,590849,591361,657409,658433,
724993,727041,794625,798721,868353,876545]),k=[new Uint32Array([459008,524368,524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,459020,524392,524328,59E4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,589992,524292,524420,524356,590056,459014,524380,524316,589976,459030,524412,524348,590040,459022,524396,524332,590008,524300,524428,524364,
590072,459009,524370,524306,524570,459025,524402,524338,590020,459017,524386,524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,589980,459031,524414,524350,590044,459023,524398,524334,590012,524302,524430,524366,590076,459008,524369,524305,524569,459024,524401,524337,
590018,459016,524385,524321,589986,524289,524417,524353,590050,459012,524377,524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,590010,524301,524429,524365,590074,459009,524371,524307,524571,459025,524403,524339,590022,459017,524387,524323,589990,524291,524419,524355,
590054,459013,524379,524315,589974,459029,524411,524347,590038,459021,524395,524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,524568,459024,524400,524336,590017,459016,524384,524320,589985,524288,524416,524352,590049,459012,524376,524312,589969,459028,524408,524344,
590033,459020,524392,524328,590001,524296,524424,524360,590065,459010,524372,524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,589989,524290,524418,524354,590053,459013,524378,524314,589973,459029,524410,524346,590037,459021,524394,524330,590005,524298,524426,524362,
590069,459011,524374,524310,524574,459027,524406,524342,590029,459019,524390,524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,589971,459028,524409,524345,590035,459020,524393,524329,590003,524297,524425,524361,590067,459010,524373,524309,524573,459026,524405,524341,
590027,459018,524389,524325,589995,524293,524421,524357,590059,459014,524381,524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,590007,524299,524427,524363,590071,459011,524375,524311,524575,459027,524407,524343,590031,459019,524391,524327,589999,524295,524423,524359,
590063,459015,524383,524319,589983,459031,524415,524351,590047,459023,524399,524335,590015,524303,524431,524367,590079]),9],a=[new Uint32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5];z.prototype=Object.create(D.prototype);z.prototype.getBits=function(a){for(var b=this.codeSize,d=this.codeBuf,c=this.bytes,k=this.bytesPos,
l;b<a;)"undefined"==typeof(l=c[k++])&&e("Bad encoding in flate stream"),d|=l<<b,b+=8;this.codeBuf=d>>a;this.codeSize=b-=a;this.bytesPos=k;return d&(1<<a)-1};z.prototype.getCode=function(a){var b=a[0],d=a[1];a=this.codeSize;for(var c=this.codeBuf,k=this.bytes,l=this.bytesPos;a<d;){var h;"undefined"==typeof(h=k[l++])&&e("Bad encoding in flate stream");c|=h<<a;a+=8}d=b[c&(1<<d)-1];b=d>>16;d&=65535;(0==a||a<b||0==b)&&e("Bad encoding in flate stream");this.codeBuf=c>>b;this.codeSize=a-b;this.bytesPos=
l;return d};z.prototype.generateHuffmanTable=function(a){for(var b=a.length,d=0,c=0;c<b;++c)a[c]>d&&(d=a[c]);for(var k=1<<d,l=new Uint32Array(k),h=1,n=0,e=2;h<=d;++h,n<<=1,e<<=1)for(var m=0;m<b;++m)if(a[m]==h){for(var p=0,t=n,c=0;c<h;++c)p=p<<1|t&1,t>>=1;for(c=p;c<k;c+=e)l[c]=h<<16|m;++n}return[l,d]};z.prototype.readBlock=function(){function d(a,b,c,d,f){for(a=a.getBits(c)+d;0<a--;)b[n++]=f}var f=this.getBits(3);f&1&&(this.eof=!0);f>>=1;if(0==f){var g=this.bytes,c=this.bytesPos,C;"undefined"==typeof(C=
g[c++])&&e("Bad block header in flate stream");var y=C;"undefined"==typeof(C=g[c++])&&e("Bad block header in flate stream");y|=C<<8;"undefined"==typeof(C=g[c++])&&e("Bad block header in flate stream");f=C;"undefined"==typeof(C=g[c++])&&e("Bad block header in flate stream");(f|C<<8)!=(~y&65535)&&e("Bad uncompressed block length in flate stream");this.codeSize=this.codeBuf=0;C=this.bufferLength;f=this.ensureBuffer(C+y);this.bufferLength=y=C+y;for(var h=C;h<y;++h){if("undefined"==typeof(C=g[c++])){this.eof=
!0;break}f[h]=C}this.bytesPos=c}else{if(1==f)c=k,C=a;else if(2==f){f=this.getBits(5)+257;C=this.getBits(5)+1;for(var g=this.getBits(4)+4,c=Array(l.length),n=0;n<g;)c[l[n++]]=this.getBits(3);c=this.generateHuffmanTable(c);n=g=0;C=f+C;for(y=Array(C);n<C;)h=this.getCode(c),16==h?d(this,y,2,3,g):17==h?d(this,y,3,3,g=0):18==h?d(this,y,7,11,g=0):y[n++]=g=h;c=this.generateHuffmanTable(y.slice(0,f));C=this.generateHuffmanTable(y.slice(f,C))}else e("Unknown block type in flate stream");y=(f=this.buffer)?f.length:
0;for(h=this.bufferLength;;){var v=this.getCode(c);if(256>v)h+1>=y&&(f=this.ensureBuffer(h+1),y=f.length),f[h++]=v;else{if(256==v){this.bufferLength=h;break}var v=v-257,v=b[v],m=v>>16;0<m&&(m=this.getBits(m));g=(v&65535)+m;v=this.getCode(C);v=p[v];m=v>>16;0<m&&(m=this.getBits(m));v=(v&65535)+m;h+g>=y&&(f=this.ensureBuffer(h+g),y=f.length);for(m=0;m<g;++m,++h)f[h]=f[h-v]}}}};return z}()})},"esri/layers/support/rasterFormats/JpgPlus":function(){define(["require","exports","./Jpg","./Zlib"],function(D,
e,z,l){return function(){function b(){}b.decode=function(b){var k=new Uint8Array(b),a=new z;a.parse(k);b=a.width;var d=a.height,f=a.numComponents,g=a.eof,a=a.getData(b,d,!0),c,e=b*d,p=0,h=0,n=0;if(g<k.length-1)for(k=(new l(k.subarray(g))).getBytes(),c=new Uint8Array(e),p=g=0;p<k.length;p++)for(n=7;0<=n;n--)c[g++]=k[p]>>n&1;k=null;if(1===f)k=[a,a,a];else{k=[];for(p=0;3>p;p++)f=new Uint8Array(e),k.push(f);for(h=n=0;h<e;h++)for(p=0;3>p;p++)k[p][h]=a[n++]}return{width:b,height:d,pixels:k,mask:c}};return b}()})},
"esri/layers/support/rasterFormats/Jpg":function(){define([],function(){var D=function(){function e(e){this.message="JPEG error: "+e}e.prototype=Error();e.prototype.name="JpegError";return e.constructor=e}();return function(){function e(){this.decodeTransform=null;this.colorTransform=-1}function z(a,b){for(var d=0,g=[],c,k,l=16;0<l&&!a[l-1];)l--;g.push({children:[],index:0});var h=g[0],n;for(c=0;c<l;c++){for(k=0;k<a[c];k++){h=g.pop();for(h.children[h.index]=b[d];0<h.index;)h=g.pop();h.index++;for(g.push(h);g.length<=
c;)g.push(n={children:[],index:0}),h.children[h.index]=n.children,h=n;d++}c+1<l&&(g.push(n={children:[],index:0}),h.children[h.index]=n.children,h=n)}return g[0].children}function l(a,b,f,g,c,l,e,h,n){function d(){if(0<H)return H--,F>>H&1;F=a[b++];if(255===F){var c=a[b++];if(c)throw new D("unexpected marker "+(F<<8|c).toString(16));}H=7;return F>>>7}function m(a){for(;;){a=a[d()];if("number"===typeof a)return a;if("object"!==typeof a)throw new D("invalid huffman sequence");}}function y(a){for(var b=
0;0<a;)b=b<<1|d(),a--;return b}function t(a){if(1===a)return 1===d()?1:-1;var b=y(a);return b>=1<<a-1?b:b+(-1<<a)+1}function C(a,b){var c=m(a.huffmanTableDC),c=0===c?0:t(c);a.blockData[b]=a.pred+=c;for(c=1;64>c;){var d=m(a.huffmanTableAC),f=d&15,d=d>>4;if(0===f){if(15>d)break;c+=16}else c+=d,a.blockData[b+k[c]]=t(f),c++}}function x(a,b){var c=m(a.huffmanTableDC),c=0===c?0:t(c)<<n;a.blockData[b]=a.pred+=c}function B(a,b){a.blockData[b]|=d()<<n}function r(a,b){if(0<G)G--;else for(var c=l;c<=e;){var d=
m(a.huffmanTableAC),f=d&15,d=d>>4;if(0===f){if(15>d){G=y(d)+(1<<d)-1;break}c+=16}else c+=d,a.blockData[b+k[c]]=t(f)*(1<<n),c++}}function q(a,b){for(var c=l,f=0,g;c<=e;){g=k[c];switch(P){case 0:f=m(a.huffmanTableAC);g=f&15;f>>=4;if(0===g)15>f?(G=y(f)+(1<<f),P=4):(f=16,P=1);else{if(1!==g)throw new D("invalid ACn encoding");S=t(g);P=f?2:3}continue;case 1:case 2:a.blockData[b+g]?a.blockData[b+g]+=d()<<n:(f--,0===f&&(P=2===P?3:0));break;case 3:a.blockData[b+g]?a.blockData[b+g]+=d()<<n:(a.blockData[b+g]=
S<<n,P=0);break;case 4:a.blockData[b+g]&&(a.blockData[b+g]+=d()<<n)}c++}4===P&&(G--,0===G&&(P=0))}var A=f.mcusPerLine,E=b,F=0,H=0,G=0,P=0,S,N=g.length,J,z,X,L,M;h=f.progressive?0===l?0===h?x:B:0===h?r:q:C;var R=0;f=1===N?g[0].blocksPerLine*g[0].blocksPerColumn:A*f.mcusPerColumn;for(var T,Q;R<f;){var I=c?Math.min(f-R,c):f;for(z=0;z<N;z++)g[z].pred=0;G=0;if(1===N)for(J=g[0],M=0;M<I;M++)h(J,64*((J.blocksPerLine+1)*(R/J.blocksPerLine|0)+R%J.blocksPerLine)),R++;else for(M=0;M<I;M++){for(z=0;z<N;z++)for(J=
g[z],T=J.h,Q=J.v,X=0;X<Q;X++)for(L=0;L<T;L++)h(J,64*((J.blocksPerLine+1)*((R/A|0)*J.v+X)+(R%A*J.h+L)));R++}H=0;(J=p(a,b))&&J.invalid&&(console.log("decodeScan - unexpected MCU data, next marker is: "+J.invalid),b=J.offset);J=J&&J.marker;if(!J||65280>=J)throw new D("marker was not found");if(65488<=J&&65495>=J)b+=2;else break}(J=p(a,b))&&J.invalid&&(console.log("decodeScan - unexpected Scan data, next marker is: "+J.invalid),b=J.offset);return b-E}function b(a,b){a=b.blocksPerLine;for(var d=b.blocksPerColumn,
g=new Int16Array(64),c=0;c<d;c++)for(var k=0;k<a;k++){var l=64*((b.blocksPerLine+1)*c+k),h=g,n=b.quantizationTable,e=b.blockData,m=void 0,p=void 0,t=void 0,u=void 0,x=void 0,B=void 0,r=void 0,q=void 0,A=void 0,E=q=void 0,F=r=p=B=void 0,H=void 0,A=void 0;if(!n)throw new D("missing required Quantization Table.");for(var G=0;64>G;G+=8)A=e[l+G],q=e[l+G+1],E=e[l+G+2],B=e[l+G+3],p=e[l+G+4],r=e[l+G+5],F=e[l+G+6],H=e[l+G+7],A*=n[G],0===(q|E|B|p|r|F|H)?(A=5793*A+512>>10,h[G]=A,h[G+1]=A,h[G+2]=A,h[G+3]=A,h[G+
4]=A,h[G+5]=A,h[G+6]=A,h[G+7]=A):(q*=n[G+1],E*=n[G+2],B*=n[G+3],p*=n[G+4],r*=n[G+5],F*=n[G+6],H*=n[G+7],m=5793*A+128>>8,p=5793*p+128>>8,t=E,u=F,x=2896*(q-H)+128>>8,q=2896*(q+H)+128>>8,B<<=4,r<<=4,m=m+p+1>>1,p=m-p,A=3784*t+1567*u+128>>8,t=1567*t-3784*u+128>>8,u=A,x=x+r+1>>1,r=x-r,q=q+B+1>>1,B=q-B,m=m+u+1>>1,u=m-u,p=p+t+1>>1,t=p-t,A=2276*x+3406*q+2048>>12,x=3406*x-2276*q+2048>>12,q=A,A=799*B+4017*r+2048>>12,B=4017*B-799*r+2048>>12,r=A,h[G]=m+q,h[G+7]=m-q,h[G+1]=p+r,h[G+6]=p-r,h[G+2]=t+B,h[G+5]=t-B,
h[G+3]=u+x,h[G+4]=u-x);for(n=0;8>n;++n)A=h[n],q=h[n+8],E=h[n+16],B=h[n+24],p=h[n+32],r=h[n+40],F=h[n+48],H=h[n+56],0===(q|E|B|p|r|F|H)?(A=5793*A+8192>>14,A=-2040>A?0:2024<=A?255:A+2056>>4,e[l+n]=A,e[l+n+8]=A,e[l+n+16]=A,e[l+n+24]=A,e[l+n+32]=A,e[l+n+40]=A,e[l+n+48]=A,e[l+n+56]=A):(m=5793*A+2048>>12,p=5793*p+2048>>12,t=E,u=F,x=2896*(q-H)+2048>>12,q=2896*(q+H)+2048>>12,m=(m+p+1>>1)+4112,p=m-p,A=3784*t+1567*u+2048>>12,t=1567*t-3784*u+2048>>12,u=A,x=x+r+1>>1,r=x-r,q=q+B+1>>1,B=q-B,m=m+u+1>>1,u=m-u,p=
p+t+1>>1,t=p-t,A=2276*x+3406*q+2048>>12,x=3406*x-2276*q+2048>>12,q=A,A=799*B+4017*r+2048>>12,B=4017*B-799*r+2048>>12,r=A,A=m+q,H=m-q,q=p+r,F=p-r,E=t+B,r=t-B,B=u+x,p=u-x,A=16>A?0:4080<=A?255:A>>4,q=16>q?0:4080<=q?255:q>>4,E=16>E?0:4080<=E?255:E>>4,B=16>B?0:4080<=B?255:B>>4,p=16>p?0:4080<=p?255:p>>4,r=16>r?0:4080<=r?255:r>>4,F=16>F?0:4080<=F?255:F>>4,H=16>H?0:4080<=H?255:H>>4,e[l+n]=A,e[l+n+8]=q,e[l+n+16]=E,e[l+n+24]=B,e[l+n+32]=p,e[l+n+40]=r,e[l+n+48]=F,e[l+n+56]=H)}return b.blockData}function p(a,
b,f){var d=a.length-1;f=f<b?f:b;if(b>=d)return null;var c=a[b]<<8|a[b+1];if(65472<=c&&65534>=c)return{invalid:null,marker:c,offset:b};for(b=a[f]<<8|a[f+1];!(65472<=b&&65534>=b);){if(++f>=d)return null;b=a[f]<<8|a[f+1]}return{invalid:c.toString(16),marker:b,offset:f}}if(!self||!self.Uint8ClampedArray)return null;var k=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,
54,47,55,62,63]);e.prototype={parse:function(a){function d(){var b=a[c]<<8|a[c+1];c+=2;return b}function f(){var b=d(),b=c+b-2,f=p(a,b,c);f&&f.invalid&&(console.log("readDataBlock - incorrect length, next marker is: "+f.invalid),b=f.offset);b=a.subarray(c,b);c+=b.length;return b}function g(a){for(var b=Math.ceil(a.samplesPerLine/8/a.maxH),c=Math.ceil(a.scanLines/8/a.maxV),d=0;d<a.components.length;d++){E=a.components[d];var f=Math.ceil(Math.ceil(a.samplesPerLine/8)*E.h/a.maxH),g=Math.ceil(Math.ceil(a.scanLines/
8)*E.v/a.maxV);E.blockData=new Int16Array(64*c*E.v*(b*E.h+1));E.blocksPerLine=f;E.blocksPerColumn=g}a.mcusPerLine=b;a.mcusPerColumn=c}var c=0,e=null,y=null,h,n,v=[],m=[],w=[],t=d();if(65496!==t)throw new D("SOI not found");for(t=d();65497!==t;){var u,x;switch(t){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:u=f();65504===t&&74===u[0]&&70===u[1]&&73===u[2]&&70===
u[3]&&0===u[4]&&(e={version:{major:u[5],minor:u[6]},densityUnits:u[7],xDensity:u[8]<<8|u[9],yDensity:u[10]<<8|u[11],thumbWidth:u[12],thumbHeight:u[13],thumbData:u.subarray(14,14+3*u[12]*u[13])});65518===t&&65===u[0]&&100===u[1]&&111===u[2]&&98===u[3]&&101===u[4]&&(y={version:u[5]<<8|u[6],flags0:u[7]<<8|u[8],flags1:u[9]<<8|u[10],transformCode:u[11]});break;case 65499:for(var t=d()+c-2,B;c<t;){var r=a[c++],q=new Uint16Array(64);if(0===r>>4)for(u=0;64>u;u++)B=k[u],q[B]=a[c++];else if(1===r>>4)for(u=
0;64>u;u++)B=k[u],q[B]=d();else throw new D("DQT - invalid table spec");v[r&15]=q}break;case 65472:case 65473:case 65474:if(h)throw new D("Only single frame JPEGs supported");d();h={};h.extended=65473===t;h.progressive=65474===t;h.precision=a[c++];h.scanLines=d();h.samplesPerLine=d();h.components=[];h.componentIds={};u=a[c++];for(t=q=r=0;t<u;t++){B=a[c];x=a[c+1]>>4;var A=a[c+1]&15;r<x&&(r=x);q<A&&(q=A);x=h.components.push({h:x,v:A,quantizationId:a[c+2],quantizationTable:null});h.componentIds[B]=x-
1;c+=3}h.maxH=r;h.maxV=q;g(h);break;case 65476:B=d();for(t=2;t<B;){r=a[c++];q=new Uint8Array(16);for(u=x=0;16>u;u++,c++)x+=q[u]=a[c];A=new Uint8Array(x);for(u=0;u<x;u++,c++)A[u]=a[c];t+=17+x;(0===r>>4?w:m)[r&15]=z(q,A)}break;case 65501:d();n=d();break;case 65498:d();B=a[c++];u=[];for(var E,t=0;t<B;t++)r=h.componentIds[a[c++]],E=h.components[r],r=a[c++],E.huffmanTableDC=w[r>>4],E.huffmanTableAC=m[r&15],u.push(E);t=a[c++];B=a[c++];r=a[c++];t=l(a,c,h,u,n,t,B,r>>4,r&15);c+=t;break;case 65535:255!==a[c]&&
c--;break;default:if(255===a[c-3]&&192<=a[c-2]&&254>=a[c-2])c-=3;else throw new D("unknown marker "+t.toString(16));}t=d()}this.width=h.samplesPerLine;this.height=h.scanLines;this.jfif=e;this.eof=c;this.adobe=y;this.components=[];for(t=0;t<h.components.length;t++){E=h.components[t];if(e=v[E.quantizationId])E.quantizationTable=e;this.components.push({output:b(h,E),scaleX:E.h/h.maxH,scaleY:E.v/h.maxV,blocksPerLine:E.blocksPerLine,blocksPerColumn:E.blocksPerColumn})}this.numComponents=this.components.length},
_getLinearizedBlockData:function(a,b){var d=this.width/a,g=this.height/b,c,k,l,h,n,e,m=0,p,t=this.components.length,u=a*b*t,x=new Uint8ClampedArray(u),B=new Uint32Array(a);for(e=0;e<t;e++){c=this.components[e];k=c.scaleX*d;l=c.scaleY*g;m=e;p=c.output;h=c.blocksPerLine+1<<3;for(n=0;n<a;n++)c=0|n*k,B[n]=(c&4294967288)<<3|c&7;for(k=0;k<b;k++)for(c=0|k*l,c=h*(c&4294967288)|(c&7)<<3,n=0;n<a;n++)x[m]=p[c+B[n]],m+=t}if(b=this.decodeTransform)for(e=0;e<u;)for(a=c=0;c<t;c++,e++,a+=2)x[e]=(x[e]*b[a]>>8)+b[a+
1];return x},_isColorConversionNeeded:function(){return this.adobe?!!this.adobe.transformCode:3===this.numComponents?0===this.colorTransform?!1:!0:1===this.colorTransform?!0:!1},_convertYccToRgb:function(a){for(var b,f,g,c=0,k=a.length;c<k;c+=3)b=a[c],f=a[c+1],g=a[c+2],a[c]=b-179.456+1.402*g,a[c+1]=b+135.459-.344*f-.714*g,a[c+2]=b-226.816+1.772*f;return a},_convertYcckToRgb:function(a){for(var b,f,g,c,k=0,l=0,h=a.length;l<h;l+=4)b=a[l],f=a[l+1],g=a[l+2],c=a[l+3],a[k++]=-122.67195406894+f*(-6.60635669420364E-5*
f+4.37130475926232E-4*g-5.4080610064599E-5*b+4.8449797120281E-4*c-.154362151871126)+g*(-9.57964378445773E-4*g+8.17076911346625E-4*b-.00477271405408747*c+1.53380253221734)+b*(9.61250184130688E-4*b-.00266257332283933*c+.48357088451265)+c*(-3.36197177618394E-4*c+.484791561490776),a[k++]=107.268039397724+f*(2.19927104525741E-5*f-6.40992018297945E-4*g+6.59397001245577E-4*b+4.26105652938837E-4*c-.176491792462875)+g*(-7.78269941513683E-4*g+.00130872261408275*b+7.70482631801132E-4*c-.151051492775562)+b*(.00126935368114843*
b-.00265090189010898*c+.25802910206845)+c*(-3.18913117588328E-4*c-.213742400323665),a[k++]=-20.810012546947+f*(-5.70115196973677E-4*f-2.63409051004589E-5*g+.0020741088115012*b-.00288260236853442*c+.814272968359295)+g*(-1.53496057440975E-5*g-1.32689043961446E-4*b+5.60833691242812E-4*c-.195152027534049)+b*(.00174418132927582*b-.00255243321439347*c+.116935020465145)+c*(-3.43531996510555E-4*c+.24165260232407);return a},_convertYcckToCmyk:function(a){for(var b,f,g,c=0,k=a.length;c<k;c+=4)b=a[c],f=a[c+
1],g=a[c+2],a[c]=434.456-b-1.402*g,a[c+1]=119.541-b+.344*f+.714*g,a[c+2]=481.816-b-1.772*f;return a},_convertCmykToRgb:function(a){for(var b,f,g,c,k=0,l=1/255,h=0,n=a.length;h<n;h+=4)b=a[h]*l,f=a[h+1]*l,g=a[h+2]*l,c=a[h+3]*l,a[k++]=255+b*(-4.387332384609988*b+54.48615194189176*f+18.82290502165302*g+212.25662451639585*c-285.2331026137004)+f*(1.7149763477362134*f-5.6096736904047315*g-17.873870861415444*c-5.497006427196366)+g*(-2.5217340131683033*g-21.248923337353073*c+17.5119270841813)-c*(21.86122147463605*
c+189.48180835922747),a[k++]=255+b*(8.841041422036149*b+60.118027045597366*f+6.871425592049007*g+31.159100130055922*c-79.2970844816548)+f*(-15.310361306967817*f+17.575251261109482*g+131.35250912493976*c-190.9453302588951)+g*(4.444339102852739*g+9.8632861493405*c-24.86741582555878)-c*(20.737325471181034*c+187.80453709719578),a[k++]=255+b*(.8842522430003296*b+8.078677503112928*f+30.89978309703729*g-.23883238689178934*c-14.183576799673286)+f*(10.49593273432072*f+63.02378494754052*g+50.606957656360734*
c-112.23884253719248)+g*(.03296041114873217*g+115.60384449646641*c-193.58209356861505)-c*(22.33816807309886*c+180.12613974708367);return a},getData:function(a,b,f){if(4<this.numComponents)throw new D("Unsupported color mode");a=this._getLinearizedBlockData(a,b);if(1===this.numComponents&&f){f=a.length;b=new Uint8ClampedArray(3*f);for(var d=0,c=0;c<f;c++){var k=a[c];b[d++]=k;b[d++]=k;b[d++]=k}return b}if(3===this.numComponents&&this._isColorConversionNeeded())return this._convertYccToRgb(a);if(4===
this.numComponents){if(this._isColorConversionNeeded())return f?this._convertYcckToRgb(a):this._convertYcckToCmyk(a);if(f)return this._convertCmykToRgb(a)}return a}};return e}()})},"esri/layers/support/rasterFormats/Lerc2Codec":function(){define([],function(){var D={unstuff:function(l,b,e,k,a,d,f,g){var c=(1<<e)-1,p=0,y,h=0,n,v;l[l.length-1]<<=8*(4*l.length-Math.ceil(e*k/8));if(a)for(y=0;y<k;y++)0===h&&(v=l[p++],h=32),h>=e?(n=v>>>h-e&c,h-=e):(h=e-h,n=(v&c)<<h&c,v=l[p++],h=32-h,n+=v>>>h),b[y]=a[n];
else for(a=Math.ceil((g-d)/f),y=0;y<k;y++)0===h&&(v=l[p++],h=32),h>=e?(n=v>>>h-e&c,h-=e):(h=e-h,n=(v&c)<<h&c,v=l[p++],h=32-h,n+=v>>>h),b[y]=n<a?d+n*f:g},unstuffLUT:function(l,b,e,k,a,d){var f=(1<<b)-1,g=0,c=0,p=0,y=p=0,h,n=[];l[l.length-1]<<=8*(4*l.length-Math.ceil(b*e/8));for(var v=Math.ceil((d-k)/a),c=0;c<e;c++)0===p&&(h=l[g++],p=32),p>=b?(y=h>>>p-b&f,p-=b):(p=b-p,y=(h&f)<<p&f,h=l[g++],p=32-p,y+=h>>>p),n[c]=y<v?k+y*a:d;n.unshift(k);return n},unstuff2:function(l,b,e,k,a,d,f,g){var c=(1<<e)-1,p=0,
y,h=0,n=0,v,m,w;if(a)for(y=0;y<k;y++)0===h&&(m=l[p++],h=32,n=0),h>=e?(v=m>>>n&c,h-=e,n+=e):(w=e-h,v=m>>>n&c,m=l[p++],h=32-w,v|=(m&(1<<w)-1)<<e-w,n=w),b[y]=a[v];else for(a=Math.ceil((g-d)/f),y=0;y<k;y++)0===h&&(m=l[p++],h=32,n=0),h>=e?(v=m>>>n&c,h-=e,n+=e):(w=e-h,v=m>>>n&c,m=l[p++],h=32-w,v|=(m&(1<<w)-1)<<e-w,n=w),b[y]=v<a?d+v*f:g;return b},unstuffLUT2:function(l,b,e,k,a,d){for(var f=(1<<b)-1,g=0,c=0,p=0,y=0,h=0,n=0,v,m=[],w=Math.ceil((d-k)/a),c=0;c<e;c++)0===y&&(v=l[g++],y=32,n=0),y>=b?(h=v>>>n&f,
y-=b,n+=b):(p=b-y,h=v>>>n&f,v=l[g++],y=32-p,h|=(v&(1<<p)-1)<<b-p,n=p),m[c]=h<w?k+h*a:d;m.unshift(k);return m},originalUnstuff:function(l,b,e,k){var a=(1<<e)-1,d=0,f,g=0,c,p;l[l.length-1]<<=8*(4*l.length-Math.ceil(e*k/8));for(f=0;f<k;f++)0===g&&(p=l[d++],g=32),g>=e?(c=p>>>g-e&a,g-=e):(g=e-g,c=(p&a)<<g&a,p=l[d++],g=32-g,c+=p>>>g),b[f]=c;return b},originalUnstuff2:function(l,b,e,k){var a=(1<<e)-1,d=0,f,g=0,c=0,p,y,h;for(f=0;f<k;f++)0===g&&(y=l[d++],g=32,c=0),g>=e?(p=y>>>c&a,g-=e,c+=e):(h=e-g,p=y>>>c&
a,y=l[d++],g=32-h,p|=(y&(1<<h)-1)<<e-h,c=h),b[f]=p;return b}},e={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(l){for(var b=65535,e=65535,k=l.length,a=Math.floor(k/2),d=0;a;){var f=359<=a?359:a,a=a-f;do b+=l[d++]<<8,e+=b+=l[d++];while(--f);b=(b&65535)+(b>>>16);e=(e&65535)+(e>>>16)}k&1&&(e+=b+=l[d]<<8);return((e&65535)+(e>>>16)<<16|(b&65535)+(b>>>16))>>>0},readHeaderInfo:function(l,b){var e=b.ptr,k=new Uint8Array(l,e,6),a={};a.fileIdentifierString=String.fromCharCode.apply(null,k);if(0!==
a.fileIdentifierString.lastIndexOf("Lerc2",0))throw"Unexpected file identifier string (expect Lerc2 ): "+a.fileIdentifierString;var e=e+6,k=new DataView(l,e,8),d=k.getInt32(0,!0);a.fileVersion=d;e+=4;3<=d&&(a.checksum=k.getUint32(4,!0),e+=4);k=new DataView(l,e,12);a.height=k.getUint32(0,!0);a.width=k.getUint32(4,!0);e+=8;4<=d?(a.numDims=k.getUint32(8,!0),e+=4):a.numDims=1;k=new DataView(l,e,40);a.numValidPixel=k.getUint32(0,!0);a.microBlockSize=k.getInt32(4,!0);a.blobSize=k.getInt32(8,!0);a.imageType=
k.getInt32(12,!0);a.maxZError=k.getFloat64(16,!0);a.zMin=k.getFloat64(24,!0);a.zMax=k.getFloat64(32,!0);e+=40;b.headerInfo=a;b.ptr=e;if(3<=d&&(l=this.computeChecksumFletcher32(new Uint8Array(l,e-(4<=d?52:48),a.blobSize-14)),l!==a.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(l,b){var e=b.headerInfo,k=this.getDataTypeArray(e.imageType),a=e.numDims*this.getDataTypeSize(e.imageType),d=this.readSubArray(l,b.ptr,k,a);l=this.readSubArray(l,b.ptr+a,k,a);b.ptr+=2*a;a=!0;for(b=0;b<
e.numDims;b++)if(d[b]!==l[b]){a=!1;break}e.minValues=d;e.maxValues=l;return a},readSubArray:function(l,b,e,k){if(e===Uint8Array)l=new Uint8Array(l,b,k);else{var a=new ArrayBuffer(k);(new Uint8Array(a)).set(new Uint8Array(l,b,k));l=new e(a)}return l},readMask:function(l,b){var e=b.ptr,k=b.headerInfo,a=k.width*k.height,d=k.numValidPixel,f=new DataView(l,e,4),k={};k.numBytes=f.getUint32(0,!0);e+=4;if((0===d||a===d)&&0!==k.numBytes)throw"invalid mask";if(0===d)d=new Uint8Array(Math.ceil(a/8)),k.bitset=
d,f=new Uint8Array(a),b.pixels.resultMask=f,e+=k.numBytes;else if(0<k.numBytes){d=new Uint8Array(Math.ceil(a/8));f=new DataView(l,e,k.numBytes);l=f.getInt16(0,!0);var g=2,c=0,C=0;do{if(0<l)for(;l--;)d[c++]=f.getUint8(g++);else for(C=f.getUint8(g++),l=-l;l--;)d[c++]=C;l=f.getInt16(g,!0);g+=2}while(g<k.numBytes);if(-32768!==l||c<d.length)throw"Unexpected end of mask RLE encoding";f=new Uint8Array(a);for(g=g=l=0;g<a;g++)g&7?(l=d[g>>3],l<<=g&7):l=d[g>>3],l&128&&(f[g]=1);b.pixels.resultMask=f;k.bitset=
d;e+=k.numBytes}b.ptr=e;b.mask=k;return!0},readDataOneSweep:function(l,b,p){var k=b.ptr,a=b.headerInfo,d=a.numDims,f=a.width*a.height,a=a.numValidPixel*e.getDataTypeSize(a.imageType)*d,g=b.pixels.resultMask;if(p===Uint8Array)l=new Uint8Array(l,k,a);else{var c=new ArrayBuffer(a);(new Uint8Array(c)).set(new Uint8Array(l,k,a));l=new p(c)}if(l.length===f*d)b.pixels.resultPixels=l;else{b.pixels.resultPixels=new p(f*d);var C=c=p=0,y=0;if(1<d)for(C=0;C<d;C++)for(y=C*f,c=0;c<f;c++)g[c]&&(b.pixels.resultPixels[y+
c]=l[p++]);else for(c=0;c<f;c++)g[c]&&(b.pixels.resultPixels[c]=l[p++])}b.ptr=k+a;return!0},readHuffmanTree:function(l,b){var p=this.HUFFMAN_LUT_BITS_MAX,k=new DataView(l,b.ptr,16);b.ptr+=16;if(2>k.getInt32(0,!0))throw"unsupported Huffman version";var a=k.getInt32(4,!0),d=k.getInt32(8,!0),k=k.getInt32(12,!0);if(d>=k)return!1;var f=new Uint32Array(k-d);e.decodeBits(l,b,f);var g=[],c,C,y;for(c=d;c<k;c++)C=c-(c<a?0:a),g[C]={first:f[c-d],second:null};c=l.byteLength-b.ptr;f=new ArrayBuffer(4*Math.ceil(c/
4));(new Uint8Array(f)).set(new Uint8Array(l,b.ptr,c));l=new Uint32Array(f);b=0;var h,f=0;h=l[0];for(c=d;c<k;c++)C=c-(c<a?0:a),y=g[C].first,0<y&&(g[C].second=h<<b>>>32-y,32-b>=y?(b+=y,32===b&&(b=0,f++,h=l[f])):(b+=y-32,f++,h=l[f],g[C].second|=h>>>32-b));var n=h=0,v=new z;for(c=0;c<g.length;c++)void 0!==g[c]&&(h=Math.max(h,g[c].first));var n=h>=p?p:h,p=[],m,w;for(c=d;c<k;c++)if(C=c-(c<a?0:a),y=g[C].first,0<y)if(d=[y,C],y<=n)for(C=g[C].second<<n-y,m=1<<n-y,y=0;y<m;y++)p[C|y]=d;else for(C=g[C].second,
m=v,--y;0<=y;y--)(w=C>>>y&1)?(m.right||(m.right=new z),m=m.right):(m.left||(m.left=new z),m=m.left),0!==y||m.val||(m.val=d[1]);return{decodeLut:p,numBitsLUTQick:n,numBitsLUT:h,tree:v,stuffedData:l,srcPtr:f,bitPos:b}},readHuffman:function(e,b,p){var k=b.headerInfo,a=k.numDims,d=b.headerInfo.height,f=b.headerInfo.width,g=f*d,c=this.readHuffmanTree(e,b);e=c.decodeLut;var l=c.tree,y=c.stuffedData,h=c.srcPtr,n=c.bitPos,v=c.numBitsLUTQick,c=c.numBitsLUT,m=0===b.headerInfo.imageType?128:0,w,t,u=b.pixels.resultMask,
x,B,r,q,A,E,F=0;0<n&&(h++,n=0);var H=y[h],G=1===b.encodeMode,P=new p(g*a),z=P,N;for(N=0;N<k.numDims;N++){1<a&&(z=new p(P.buffer,g*N,g),F=0);if(b.headerInfo.numValidPixel===f*d)for(r=A=0;r<d;r++)for(q=0;q<f;q++,A++){t=0;w=x=H<<n>>>32-v;32-n<v&&(w=x|=y[h+1]>>>64-n-v);if(e[w])t=e[w][1],n+=e[w][0];else for(w=x=H<<n>>>32-c,32-n<c&&(w=x|=y[h+1]>>>64-n-c),w=l,E=0;E<c;E++)if(w=(B=x>>>c-E-1&1)?w.right:w.left,!w.left&&!w.right){t=w.val;n=n+E+1;break}32<=n&&(n-=32,h++,H=y[h]);t-=m;G?(t=0<q?t+F:0<r?t+z[A-f]:
t+F,t&=255,F=z[A]=t):z[A]=t}else for(r=A=0;r<d;r++)for(q=0;q<f;q++,A++)if(u[A]){t=0;w=x=H<<n>>>32-v;32-n<v&&(w=x|=y[h+1]>>>64-n-v);if(e[w])t=e[w][1],n+=e[w][0];else for(w=x=H<<n>>>32-c,32-n<c&&(w=x|=y[h+1]>>>64-n-c),w=l,E=0;E<c;E++)if(w=(B=x>>>c-E-1&1)?w.right:w.left,!w.left&&!w.right){t=w.val;n=n+E+1;break}32<=n&&(n-=32,h++,H=y[h]);t-=m;G?(t=0<q&&u[A-1]?t+F:0<r&&u[A-f]?t+z[A-f]:t+F,t&=255,F=z[A]=t):z[A]=t}b.ptr=b.ptr+4*(h+1)+(0<n?4:0)}b.pixels.resultPixels=P},decodeBits:function(e,b,p,k,a){var d=
b.headerInfo,f=d.fileVersion,g=0,c=new DataView(e,b.ptr,5<=e.byteLength-b.ptr?5:e.byteLength-b.ptr),l=c.getUint8(0);g++;var y=l>>6,h=0===y?4:3-y,n=0<(l&32)?!0:!1,y=l&31,l=0;if(1===h)l=c.getUint8(g),g++;else if(2===h)l=c.getUint16(g,!0),g+=2;else if(4===h)l=c.getUint32(g,!0),g+=4;else throw"Invalid valid pixel count type";var h=2*d.maxZError,v,m;a=1<d.numDims?d.maxValues[a]:d.zMax;if(n){b.counter.lut++;n=c.getUint8(g);g++;d=Math.ceil((n-1)*y/8);v=Math.ceil(d/4);v=new ArrayBuffer(4*v);m=new Uint8Array(v);
b.ptr+=g;m.set(new Uint8Array(e,b.ptr,d));g=new Uint32Array(v);b.ptr+=d;for(c=0;n-1>>>c;)c++;d=Math.ceil(l*c/8);v=Math.ceil(d/4);v=new ArrayBuffer(4*v);m=new Uint8Array(v);m.set(new Uint8Array(e,b.ptr,d));e=new Uint32Array(v);b.ptr+=d;b=3<=f?D.unstuffLUT2(g,y,n-1,k,h,a):D.unstuffLUT(g,y,n-1,k,h,a);3<=f?D.unstuff2(e,p,c,l,b):D.unstuff(e,p,c,l,b)}else b.counter.bitstuffer++,c=y,b.ptr+=g,0<c&&(d=Math.ceil(l*c/8),v=Math.ceil(d/4),v=new ArrayBuffer(4*v),m=new Uint8Array(v),m.set(new Uint8Array(e,b.ptr,
d)),e=new Uint32Array(v),b.ptr+=d,3<=f?null==k?D.originalUnstuff2(e,p,c,l):D.unstuff2(e,p,c,l,!1,k,h,a):null==k?D.originalUnstuff(e,p,c,l):D.unstuff(e,p,c,l,!1,k,h,a))},readTiles:function(l,b,p){var k=b.headerInfo,a=k.width,d=k.height,f=k.microBlockSize,g=k.imageType,c=e.getDataTypeSize(g),C=Math.ceil(a/f),y=Math.ceil(d/f);b.pixels.numBlocksY=y;b.pixels.numBlocksX=C;for(var h=b.pixels.ptr=0,n=0,v=0,m=0,w=0,t=0,u=0,x=0,B=0,r=0,q=0,A=0,E=0,u=E=u=0,F,H=new p(f*f),G=d%f||f,z=a%f||f,S=k.numDims,N,J=b.pixels.resultMask,
V=b.pixels.resultPixels,X=5<=k.fileVersion?14:15,L=k.zMax,v=0;v<y;v++)for(w=v!==y-1?f:G,m=0;m<C;m++)for(t=m!==C-1?f:z,q=v*a*f+m*f,A=a-t,N=0;N<S;N++){1<S?(E=V,q=v*a*f+m*f,V=new p(b.pixels.resultPixels.buffer,a*d*N*c,a*d),L=k.maxValues[N]):E=null;u=l.byteLength-b.ptr;h=new DataView(l,b.ptr,Math.min(10,u));n={};u=0;x=h.getUint8(0);u++;F=5<=k.fileVersion?x&4:0;B=x>>6&255;r=x>>2&X;if(r!==(m*f>>3&X))throw"integrity issue";if(F&&0===N)throw"integrity issue";x&=3;if(3<x)throw b.ptr+=u,"Invalid block encoding ("+
x+")";if(2===x){if(F)if(J)for(h=0;h<w;h++)for(n=0;n<t;n++)J[q]&&(V[q]=E[q]),q++;else for(h=0;h<w;h++)for(n=0;n<t;n++)V[q]=E[q],q++;b.counter.constant++;b.ptr+=u}else if(0===x){if(F)throw"integrity issue";b.counter.uncompressed++;b.ptr+=u;E=w*t*c;u=l.byteLength-b.ptr;E=E<u?E:u;u=new ArrayBuffer(0===E%c?E:E+c-E%c);F=new Uint8Array(u);F.set(new Uint8Array(l,b.ptr,E));u=new p(u);E=0;if(J)for(h=0;h<w;h++){for(n=0;n<t;n++)J[q]&&(V[q]=u[E++]),q++;q+=A}else for(h=0;h<w;h++){for(n=0;n<t;n++)V[q++]=u[E++];
q+=A}b.ptr+=E*c}else if(B=e.getDataTypeUsed(F&&6>g?4:g,B),r=e.getOnePixel(n,u,B,h),u+=e.getDataTypeSize(B),3===x)if(b.ptr+=u,b.counter.constantoffset++,J)for(h=0;h<w;h++){for(n=0;n<t;n++)J[q]&&(V[q]=F?Math.min(L,E[q]+r):r),q++;q+=A}else for(h=0;h<w;h++){for(n=0;n<t;n++)V[q]=F?Math.min(L,E[q]+r):r,q++;q+=A}else if(b.ptr+=u,e.decodeBits(l,b,H,r,N),u=0,F)if(J)for(h=0;h<w;h++){for(n=0;n<t;n++)J[q]&&(V[q]=H[u++]+E[q]),q++;q+=A}else for(h=0;h<w;h++){for(n=0;n<t;n++)V[q]=H[u++]+E[q],q++;q+=A}else if(J)for(h=
0;h<w;h++){for(n=0;n<t;n++)J[q]&&(V[q]=H[u++]),q++;q+=A}else for(h=0;h<w;h++){for(n=0;n<t;n++)V[q++]=H[u++];q+=A}}},formatFileInfo:function(l){return{fileIdentifierString:l.headerInfo.fileIdentifierString,fileVersion:l.headerInfo.fileVersion,imageType:l.headerInfo.imageType,height:l.headerInfo.height,width:l.headerInfo.width,numValidPixel:l.headerInfo.numValidPixel,microBlockSize:l.headerInfo.microBlockSize,blobSize:l.headerInfo.blobSize,maxZError:l.headerInfo.maxZError,pixelType:e.getPixelType(l.headerInfo.imageType),
eofOffset:l.eofOffset,mask:l.mask?{numBytes:l.mask.numBytes}:null,pixels:{numBlocksX:l.pixels.numBlocksX,numBlocksY:l.pixels.numBlocksY,maxValue:l.headerInfo.zMax,minValue:l.headerInfo.zMin,noDataValue:l.noDataValue}}},constructConstantSurface:function(e){var b=e.headerInfo.zMax,l=e.headerInfo.numDims,k=e.headerInfo.height*e.headerInfo.width,a=0,d=0,f=0,g=e.pixels.resultMask,c=e.pixels.resultPixels;if(g)if(1<l)for(a=0;a<l;a++)for(f=a*k,b=e.headerInfo.maxValues[a],d=0;d<k;d++)g[d]&&(c[f+d]=b);else for(d=
0;d<k;d++)g[d]&&(c[d]=b);else if(1<l)for(a=0;a<l;a++)for(f=a*k,b=e.headerInfo.maxValues[a],d=0;d<k;d++)c[f+d]=b;else for(d=0;d<k;d++)c[d]=b},getDataTypeArray:function(e){switch(e){case 0:e=Int8Array;break;case 1:e=Uint8Array;break;case 2:e=Int16Array;break;case 3:e=Uint16Array;break;case 4:e=Int32Array;break;case 5:e=Uint32Array;break;case 6:e=Float32Array;break;case 7:e=Float64Array;break;default:e=Float32Array}return e},getPixelType:function(e){switch(e){case 0:e="S8";break;case 1:e="U8";break;
case 2:e="S16";break;case 3:e="U16";break;case 4:e="S32";break;case 5:e="U32";break;case 6:e="F32";break;case 7:e="F64";break;default:e="F32"}return e},isValidPixelValue:function(e,b){if(null==b)return!1;switch(e){case 0:e=-128<=b&&127>=b;break;case 1:e=0<=b&&255>=b;break;case 2:e=-32768<=b&&32767>=b;break;case 3:e=0<=b&&65536>=b;break;case 4:e=-2147483648<=b&&2147483647>=b;break;case 5:e=0<=b&&4294967296>=b;break;case 6:e=-3.4027999387901484E38<=b&&3.4027999387901484E38>=b;break;case 7:e=4.9E-324<=
b&&1.7976931348623157E308>=b;break;default:e=!1}return e},getDataTypeSize:function(e){var b=0;switch(e){case 0:case 1:b=1;break;case 2:case 3:b=2;break;case 4:case 5:case 6:b=4;break;case 7:b=8;break;default:b=e}return b},getDataTypeUsed:function(e,b){var l=e;switch(e){case 2:case 4:l=e-b;break;case 3:case 5:l=e-2*b;break;case 6:l=0===b?e:1===b?2:1;break;case 7:l=0===b?e:e-2*b+1;break;default:l=e}return l},getOnePixel:function(e,b,p,k){e=0;switch(p){case 0:e=k.getInt8(b);break;case 1:e=k.getUint8(b);
break;case 2:e=k.getInt16(b,!0);break;case 3:e=k.getUint16(b,!0);break;case 4:e=k.getInt32(b,!0);break;case 5:e=k.getUInt32(b,!0);break;case 6:e=k.getFloat32(b,!0);break;case 7:e=k.getFloat64(b,!0);break;default:throw"the decoder does not understand this pixel type";}return e}},z=function(e,b,p){this.val=e;this.left=b;this.right=p};return{decode:function(l,b){b=b||{};var p=b.noDataValue,k=0,a={};a.ptr=b.inputOffset||0;a.pixels={};if(e.readHeaderInfo(l,a)){var k=a.headerInfo,d=k.fileVersion,f=e.getDataTypeArray(k.imageType);
if(5<d)throw"unsupported lerc version 2."+d;e.readMask(l,a);k.numValidPixel===k.width*k.height||a.pixels.resultMask||(a.pixels.resultMask=b.maskData);var g=k.width*k.height;a.pixels.resultPixels=new f(g*k.numDims);a.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0};if(0!==k.numValidPixel)if(k.zMax===k.zMin)e.constructConstantSurface(a);else if(4<=d&&e.checkMinMaxRanges(l,a))e.constructConstantSurface(a);else{var c=new DataView(l,a.ptr,2),C=c.getUint8(0);a.ptr++;if(C)e.readDataOneSweep(l,
a,f);else if(1<d&&1>=k.imageType&&1E-5>Math.abs(k.maxZError-.5)){c=c.getUint8(1);a.ptr++;a.encodeMode=c;if(2<c||4>d&&1<c)throw"Invalid Huffman flag "+c;c?e.readHuffman(l,a,f):e.readTiles(l,a,f)}else e.readTiles(l,a,f)}a.eofOffset=a.ptr;b.inputOffset?(l=a.headerInfo.blobSize+b.inputOffset-a.ptr,1<=Math.abs(l)&&(a.eofOffset=b.inputOffset+a.headerInfo.blobSize)):(l=a.headerInfo.blobSize-a.ptr,1<=Math.abs(l)&&(a.eofOffset=a.headerInfo.blobSize));l={width:k.width,height:k.height,pixelData:a.pixels.resultPixels,
minValue:k.zMin,maxValue:k.zMax,validPixelCount:k.numValidPixel,dimCount:k.numDims,dimStats:{minValues:k.minValues,maxValues:k.maxValues},maskData:a.pixels.resultMask};if(a.pixels.resultMask&&e.isValidPixelValue(k.imageType,p)){d=a.pixels.resultMask;for(k=0;k<g;k++)d[k]||(l.pixelData[k]=p);l.noDataValue=p}a.noDataValue=p;b.returnFileInfo&&(l.fileInfo=e.formatFileInfo(a));return l}},getBandCount:function(l){for(var b=0,p=0,k={ptr:0,pixels:{}};p<l.byteLength-58;)e.readHeaderInfo(l,k),p+=k.headerInfo.blobSize,
b++,k.ptr=p;return b}}})},"esri/layers/support/rasterFormats/LercCodec":function(){define(["../../../core/mathUtils"],function(D){var e={};e.defaultNoDataValue=D.clampFloat32(-Infinity);e.decode=function(l,b){var p;b=b||{};var k=b.inputOffset||0,a=b.encodedMaskData||null===b.encodedMaskData,d={},f=new Uint8Array(l,k,10);d.fileIdentifierString=String.fromCharCode.apply(null,f);if("CntZImage"!=d.fileIdentifierString.trim())throw"Unexpected file identifier string: "+d.fileIdentifierString;k+=10;f=new DataView(l,
k,24);d.fileVersion=f.getInt32(0,!0);d.imageType=f.getInt32(4,!0);d.height=f.getUint32(8,!0);d.width=f.getUint32(12,!0);d.maxZError=f.getFloat64(16,!0);k+=24;if(!a)if(f=new DataView(l,k,16),d.mask={},d.mask.numBlocksY=f.getUint32(0,!0),d.mask.numBlocksX=f.getUint32(4,!0),d.mask.numBytes=f.getUint32(8,!0),d.mask.maxValue=f.getFloat32(12,!0),k+=16,0<d.mask.numBytes){var a=new Uint8Array(Math.ceil(d.width*d.height/8)),f=new DataView(l,k,d.mask.numBytes),g=f.getInt16(0,!0),c=2,C=0;do{if(0<g)for(;g--;)a[C++]=
f.getUint8(c++);else for(var y=f.getUint8(c++),g=-g;g--;)a[C++]=y;g=f.getInt16(c,!0);c+=2}while(c<d.mask.numBytes);if(-32768!==g||C<a.length)throw"Unexpected end of mask RLE encoding";d.mask.bitset=a;k+=d.mask.numBytes}else 0===(d.mask.numBytes|d.mask.numBlocksY|d.mask.maxValue)&&(a=new Uint8Array(Math.ceil(d.width*d.height/8)),d.mask.bitset=a);f=new DataView(l,k,16);d.pixels={};d.pixels.numBlocksY=f.getUint32(0,!0);d.pixels.numBlocksX=f.getUint32(4,!0);d.pixels.numBytes=f.getUint32(8,!0);d.pixels.maxValue=
f.getFloat32(12,!0);k+=16;a=d.pixels.numBlocksX;f=d.pixels.numBlocksY;a+=0<d.width%a?1:0;g=f+(0<d.height%f?1:0);d.pixels.blocks=Array(a*g);c=1E9;for(y=C=0;y<g;y++)for(var h=0;h<a;h++){var n=0,f=new DataView(l,k,Math.min(10,l.byteLength-k)),v={};d.pixels.blocks[C++]=v;var m=f.getUint8(0);n++;v.encoding=m&63;if(3<v.encoding)throw"Invalid block encoding ("+v.encoding+")";if(2===v.encoding)k++,c=Math.min(c,0);else{if(0!==m&&2!==m){m>>=6;v.offsetType=m;if(2===m)v.offset=f.getInt8(1),n++;else if(1===m)v.offset=
f.getInt16(1,!0),n+=2;else if(0===m)v.offset=f.getFloat32(1,!0),n+=4;else throw"Invalid block offset type";c=Math.min(v.offset,c);if(1===v.encoding)if(m=f.getUint8(n),n++,v.bitsPerPixel=m&63,m>>=6,v.numValidPixelsType=m,2===m)v.numValidPixels=f.getUint8(n),n++;else if(1===m)v.numValidPixels=f.getUint16(n,!0),n+=2;else if(0===m)v.numValidPixels=f.getUint32(n,!0),n+=4;else throw"Invalid valid pixel count type";}k+=n;if(3!=v.encoding)if(0===v.encoding){f=(d.pixels.numBytes-1)/4;if(f!==Math.floor(f))throw"uncompressed block has invalid length";
n=new ArrayBuffer(4*f);m=new Uint8Array(n);m.set(new Uint8Array(l,k,4*f));n=new Float32Array(n);for(m=0;m<n.length;m++)c=Math.min(c,n[m]);v.rawData=n;k+=4*f}else 1===v.encoding&&(f=Math.ceil(v.numValidPixels*v.bitsPerPixel/8),n=new ArrayBuffer(4*Math.ceil(f/4)),m=new Uint8Array(n),m.set(new Uint8Array(l,k,f)),v.stuffedData=new Uint32Array(n),k+=f)}}d.pixels.minValue=c;d.eofOffset=k;l=null!=b.noDataValue?D.clampFloat32(b.noDataValue):e.defaultNoDataValue;var a=b.encodedMaskData,v=b.returnMask,f=0,
g=d.pixels.numBlocksX,c=d.pixels.numBlocksY,C=Math.floor(d.width/g),y=Math.floor(d.height/c),h=2*d.maxZError,a=a||(d.mask?d.mask.bitset:null),w,k=new (b.pixelType||Float32Array)(d.width*d.height);v&&a&&(w=new Uint8Array(d.width*d.height));for(var v=new Float32Array(C*y),t,u,n=0;n<=c;n++)if(m=n!==c?y:d.height%c,0!==m)for(var x=0;x<=g;x++){var B=x!==g?C:d.width%g;if(0!==B){var r=n*d.width*y+x*C,q=d.width-B,A=d.pixels.blocks[f],E,F;if(2>A.encoding){if(0===A.encoding)E=A.rawData;else{E=A.stuffedData;
F=A.bitsPerPixel;t=A.numValidPixels;u=A.offset;var H=h,G=v,P=d.pixels.maxValue,S=(1<<F)-1,N=0,J=void 0,V=0,X=void 0,L=void 0,M=Math.ceil((P-u)/H);E[E.length-1]<<=8*(4*E.length-Math.ceil(F*t/8));for(J=0;J<t;J++)0===V&&(L=E[N++],V=32),V>=F?(X=L>>>V-F&S,V-=F):(V=F-V,X=(L&S)<<V&S,L=E[N++],V=32-V,X+=L>>>V),G[J]=X<M?u+X*H:P;E=v}F=0}else p=2===A.encoding?0:A.offset;var R;if(a)for(u=0;u<m;u++){r&7&&(R=a[r>>3],R<<=r&7);for(t=0;t<B;t++)r&7||(R=a[r>>3]),R&128?(w&&(w[r]=1),k[r++]=2>A.encoding?E[F++]:p):(w&&(w[r]=
0),k[r++]=l),R<<=1;r+=q}else if(2>A.encoding)for(u=0;u<m;u++){for(t=0;t<B;t++)k[r++]=E[F++];r+=q}else for(u=0;u<m;u++)if(k.fill)k.fill(p,r,r+B),r+=B+q;else{for(t=0;t<B;t++)k[r++]=p;r+=q}if(1===A.encoding&&F!==A.numValidPixels)throw"Block and Mask do not match";f++}}p=w;w={width:d.width,height:d.height,pixelData:k,minValue:d.pixels.minValue,maxValue:d.pixels.maxValue,noDataValue:l};p&&(w.maskData=p);b.returnEncodedMask&&d.mask&&(w.encodedMaskData=d.mask.bitset?d.mask.bitset:null);if(b.returnFileInfo&&
(w.fileInfo=z(d),b.computeUsedBitDepths)){b=w.fileInfo;p=d.pixels.numBlocksX*d.pixels.numBlocksY;R={};for(E=0;E<p;E++)F=d.pixels.blocks[E],0===F.encoding?R.float32=!0:1===F.encoding?R[F.bitsPerPixel]=!0:R[0]=!0;d=Object.keys(R);b.bitDepths=d}return w};var z=function(e){return{fileIdentifierString:e.fileIdentifierString,fileVersion:e.fileVersion,imageType:e.imageType,height:e.height,width:e.width,maxZError:e.maxZError,eofOffset:e.eofOffset,mask:e.mask?{numBlocksX:e.mask.numBlocksX,numBlocksY:e.mask.numBlocksY,
numBytes:e.mask.numBytes,maxValue:e.mask.maxValue}:null,pixels:{numBlocksX:e.pixels.numBlocksX,numBlocksY:e.pixels.numBlocksY,numBytes:e.pixels.numBytes,maxValue:e.pixels.maxValue,minValue:e.pixels.minValue,noDataValue:this.noDataValue}}};return e})},"esri/layers/support/rasterFormats/Png":function(){define(["./Zlib"],function(D){return function(e){function z(b){var a,d,f,g;this.data=b;this.pos=8;this.palette=[];this.imgData=[];this.transparency={};this.animation=null;this.text={};for(f=null;;){a=
this.readUInt32();g=b=void 0;g=[];for(b=0;4>b;++b)g.push(String.fromCharCode(this.data[this.pos++]));b=g.join("");switch(b){case "IHDR":this.width=this.readUInt32();this.height=this.readUInt32();this.bits=this.data[this.pos++];this.colorType=this.data[this.pos++];this.compressionMethod=this.data[this.pos++];this.filterMethod=this.data[this.pos++];this.interlaceMethod=this.data[this.pos++];break;case "acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||Infinity,frames:[]};
break;case "PLTE":this.palette=this.read(a);break;case "fcTL":f&&this.animation.frames.push(f);this.pos+=4;f={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()};b=this.readUInt16();a=this.readUInt16()||100;f.delay=1E3*b/a;f.disposeOp=this.data[this.pos++];f.blendOp=this.data[this.pos++];f.data=[];break;case "IDAT":case "fdAT":"fdAT"===b&&(this.pos+=4,a-=4);b=(null!=f?f.data:void 0)||this.imgData;for(g=0;0<=a?g<a:g>a;0<=a?++g:--g)b.push(this.data[this.pos++]);
break;case "tRNS":this.transparency={};switch(this.colorType){case 3:this.transparency.indexed=this.read(a);a=255-this.transparency.indexed.length;if(0<a)for(b=0;0<=a?b<a:b>a;0<=a?++b:--b)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(a)[0];break;case 2:this.transparency.rgb=this.read(a)}break;case "tEXt":g=this.read(a);a=g.indexOf(0);b=String.fromCharCode.apply(String,g.slice(0,a));this.text[b]=String.fromCharCode.apply(String,g.slice(a+1));break;case "IEND":f&&
this.animation.frames.push(f);a:{switch(this.colorType){case 0:case 3:case 4:f=1;break a;case 2:case 6:f=3;break a}f=void 0}this.colors=f;this.hasAlphaChannel=4===(d=this.colorType)||6===d;d=this.colors+(this.hasAlphaChannel?1:0);this.pixelBitlength=this.bits*d;a:{switch(this.colors){case 1:d="DeviceGray";break a;case 3:d="DeviceRGB";break a}d=void 0}this.colorSpace=d;this.imgData=new Uint8Array(this.imgData);return;default:this.pos+=a}this.pos+=4;if(this.pos>this.data.length)throw Error("Incomplete or corrupt PNG file");
}}var l,b,p;z.load=function(b,a,d){var f;"function"===typeof a&&(d=a);f=new XMLHttpRequest;f.open("GET",b,!0);f.responseType="arraybuffer";f.onload=function(){var b;b=new Uint8Array(f.response||f.mozResponseArrayBuffer);b=new z(b);"function"===typeof(null!=a?a.getContext:void 0)&&b.render(a);return"function"===typeof d?d(b):void 0};return f.send(null)};z.prototype.read=function(b){var a,d;d=[];for(a=0;0<=b?a<b:a>b;0<=b?++a:--a)d.push(this.data[this.pos++]);return d};z.prototype.readUInt32=function(){var b,
a,d,f;b=this.data[this.pos++]<<24;a=this.data[this.pos++]<<16;d=this.data[this.pos++]<<8;f=this.data[this.pos++];return b|a|d|f};z.prototype.readUInt16=function(){var b,a;b=this.data[this.pos++]<<8;a=this.data[this.pos++];return b|a};z.prototype.decodePixels=function(b){var a,d,f,g,c,e,k,h,n,l,m,p,t,u,x;null==b&&(b=this.imgData);if(0===b.length)return new Uint8Array(0);b=new D(b);b=b.getBytes();h=this.pixelBitlength/8;p=h*this.width;n=new Uint8Array(p*this.height);e=b.length;for(d=l=m=0;l<e;){switch(b[l++]){case 0:for(g=
a=0;a<p;g=a+=1)n[d++]=b[l++];break;case 1:for(g=t=0;t<p;g=t+=1)a=b[l++],c=g<h?0:n[d-h],n[d++]=(a+c)%256;break;case 2:for(g=c=0;c<p;g=c+=1)a=b[l++],f=(g-g%h)/h,t=m&&n[(m-1)*p+f*h+g%h],n[d++]=(t+a)%256;break;case 3:for(g=x=0;x<p;g=x+=1)a=b[l++],f=(g-g%h)/h,c=g<h?0:n[d-h],t=m&&n[(m-1)*p+f*h+g%h],n[d++]=(a+Math.floor((c+t)/2))%256;break;case 4:for(g=x=0;x<p;g=x+=1)a=b[l++],f=(g-g%h)/h,c=g<h?0:n[d-h],0===m?t=u=0:(t=n[(m-1)*p+f*h+g%h],u=f&&n[(m-1)*p+(f-1)*h+g%h]),k=c+t-u,g=Math.abs(k-c),f=Math.abs(k-t),
k=Math.abs(k-u),c=g<=f&&g<=k?c:f<=k?t:u,n[d++]=(a+c)%256;break;default:throw Error("Invalid filter algorithm: "+b[l-1]);}m++}return n};z.prototype.decodePalette=function(){var b,a,d,f,g,c,e,l,h;d=this.palette;c=this.transparency.indexed||[];g=new Uint8Array((c.length||0)+d.length);a=e=b=f=0;for(l=d.length;e<l;a=e+=3)g[f++]=d[a],g[f++]=d[a+1],g[f++]=d[a+2],g[f++]=null!=(h=c[b++])?h:255;return g};z.prototype.copyToImageData=function(b,a){var d,f,g,c,e,k,h;f=this.colors;h=null;d=this.hasAlphaChannel;
this.palette.length&&(h=null!=(g=this._decodedPalette)?g:this._decodedPalette=this.decodePalette(),f=4,d=!0);b=b.data||b;k=b.length;c=h||a;g=e=0;if(1===f)for(;g<k;)f=h?4*a[g/4]:e,e=c[f++],b[g++]=e,b[g++]=e,b[g++]=e,b[g++]=d?c[f++]:this.transparency.grayscale&&this.transparency.grayscale===e?0:255,e=f;else for(;g<k;)f=h?4*a[g/4]:e,b[g++]=c[f++],b[g++]=c[f++],b[g++]=c[f++],b[g++]=d?c[f++]:this.transparency.rgb&&this.transparency.rgb[1]===c[f-3]&&this.transparency.rgb[3]===c[f-2]&&this.transparency.rgb[5]===
c[f-1]?0:255,e=f};z.prototype.decode=function(){var b;b=new Uint8Array(this.width*this.height*4);this.copyToImageData(b,this.decodePixels());return b};p=(b=e.document&&e.document.createElement("canvas"))&&b.getContext("2d");l=function(e){p.width=e.width;p.height=e.height;p.clearRect(0,0,e.width,e.height);p.putImageData(e,0,0);e=new Image;e.src=b.toDataURL();return e};z.prototype.decodeFrames=function(b){var a,d,f,g,c,e,k;if(this.animation){e=this.animation.frames;k=[];a=g=0;for(c=e.length;g<c;a=++g)a=
e[a],d=b.createImageData(a.width,a.height),f=this.decodePixels(new Uint8Array(a.data)),this.copyToImageData(d,f),a.imageData=d,k.push(a.image=l(d));return k}};z.prototype.renderFrame=function(b,a){var d,f;f=this.animation.frames;d=f[a];f=f[a-1];0===a&&b.clearRect(0,0,this.width,this.height);1===(null!=f?f.disposeOp:void 0)?b.clearRect(f.xOffset,f.yOffset,f.width,f.height):2===(null!=f?f.disposeOp:void 0)&&b.putImageData(f.imageData,f.xOffset,f.yOffset);0===d.blendOp&&b.clearRect(d.xOffset,d.yOffset,
d.width,d.height);return b.drawImage(d.image,d.xOffset,d.yOffset)};z.prototype.animate=function(b){var a,d,f,g,c,e,k=this;d=0;e=this.animation;g=e.numFrames;f=e.frames;c=e.numPlays;return(a=function(){var e,n;e=d++%g;n=f[e];k.renderFrame(b,e);if(1<g&&d/g<c)return k.animation._timeout=setTimeout(a,n.delay)})()};z.prototype.stopAnimation=function(){var b;return clearTimeout(null!=(b=this.animation)?b._timeout:void 0)};z.prototype.render=function(b){var a;b._png&&b._png.stopAnimation();b._png=this;b.width=
this.width;b.height=this.height;b=b.getContext("2d");if(this.animation)return this.decodeFrames(b),this.animate(b);a=b.createImageData(this.width,this.height);this.copyToImageData(a,this.decodePixels());return b.putImageData(a,0,0)};return z}(this)})},"esri/layers/support/rasterFormats/Raw":function(){define(["require","exports"],function(D,e){var z=function(e){var b=1;switch(e){case Uint8Array:case Int8Array:b=1;break;case Uint16Array:case Int16Array:b=2;break;case Uint32Array:case Int32Array:case Float32Array:b=
4;break;case Float64Array:b=8}return b};return function(){function e(){}e.decode=function(b,e){var k=e.pixelType,a=[],d=e.width*e.height,f=Math.floor(b.byteLength/(e.width*e.height*z(e.pixelType))),g=e.bandIds,c=e.format;e=g&&g.length||Math.floor(b.byteLength/(e.width*e.height*z(e.pixelType)));var l=b.byteLength-b.byteLength%(d*z(k)),p=new k(b,0,d*f),h,n,v,m;if("bip"===c)for(c=0;c<e;c++){v=new k(d);m=g?g[c]:c;for(h=0;h<d;h++)v[h]=p[h*f+m];a.push(v)}else if("bsq"===c)for(c=0;c<e;c++)m=g?g[c]:c,a.push(p.subarray(m*
d,(m+1)*d));if(l<b.byteLength-1)if(b=b.slice(l),8*b.byteLength<d)n=null;else{b=new Uint8Array(b,0,Math.ceil(d/8));k=new Uint8Array(d);for(n=e=n=g=f=0;n<b.length-1;n++)for(g=b[n],e=7;0<=e;e--)k[f++]=g>>e&1;for(e=7;f<d-1;)g=b[b.length-1],k[f++]=g>>e&1,e--;n=k}return{pixels:a,mask:n}};return e}()})},"esri/layers/support/rasterFormats/TiffDecoder":function(){define("require exports ../../../core/tsSupport/assignHelper ../rasterDatasets/byteStreamUtils ./Jpg ./TiffTags ./Zlib".split(" "),function(D,e,
z,l,b,p,k){function a(a,b){var c="unknown";3===a?c="f32":1===a?1===b?c="u1":2===b?c="u2":4===b?c="u4":8>=b?c="u8":16>=b?c="u16":32>=b&&(c="u32"):2===a&&(8>=b?c="s8":16>=b?c="s16":32>=b&&(c="s32"));return c}function d(a){var b=null;switch(a?a.toLowerCase():"f32"){case "u1":case "u2":case "u4":case "u8":b=Uint8Array;break;case "u16":b=Uint16Array;break;case "u32":b=Uint32Array;break;case "s8":b=Int8Array;break;case "s16":b=Int16Array;break;case "s32":b=Int32Array;break;default:b=Float32Array}return b}
function f(a,b){return{x:b[0]*a.x+b[1]*a.y+b[2],y:b[3]*a.x+b[4]*a.y+b[5]}}function g(a,b){return(a=a.get(b))&&a.values}function c(a,b){return(a=a.get(b))&&a.values[0]}function C(a,b,c,d,f,g){void 0===d&&(d=0);void 0===f&&(f=p.TIFF_TAGS);void 0===g&&(g=4);var e=(new DataView(a,c,2)).getUint16(0,b),h=4+2*g,m=2+e*h;if(c+m>a.byteLength)return{success:!1,ifd:null,nextIFD:null,requiredBufferSize:m};var k=c+m+4<=a.byteLength?(new DataView(a,c+m,4)).getUint32(0,b):null;c+=2;for(var q=new Map,n,l,r,B,A,t,
F=0;F<e;F++){n=new DataView(a,c+h*F,h);l=n.getUint16(0,b);B=n.getUint16(2,b);r=p.getTagName(l,f);if(2===g)A=n.getUint16(4,b),t=n.getUint16(6,b);else if(4===g)A=n.getUint32(4,b),t=n.getUint32(8,b);else if(8===g)if(t=A=0,b)for(var E=0;8>E;E++)A+=n.getUint8(4+E)*Math.pow(2,8*E),t+=n.getUint8(12+E)*Math.pow(2,8*E);else for(E=0;8>E;E++)A+=n.getUint8(4+E)*Math.pow(2,8*(7-E)),t+=n.getUint8(12+E)*Math.pow(2,8*(7-E));n={id:l,type:B,valueCount:A,valueOffset:t,values:null};y(a,b,n,d);q.set(r,n)}return{success:!0,
ifd:q,nextIFD:k,requiredBufferSize:m}}function y(a,b,c,d,f){void 0===d&&(d=0);if(c.values)return!0;var g=c.type,e=c.valueCount,h=c.valueOffset,m=[],k=w[g],q=8*k,n=e*k,l=e*w[g]*8;if(32<l&&n>(f?a.byteLength:a?a.byteLength-h+d:0))return c.offlineOffsetSize=[h,n],c.values=null,!1;if(32>=l)if(b||(h>>>=32-l),1===e)m=[h];else for(a=0;a<e;a++)m.push(h<<q*a>>>32-q);else for(h-=d,f&&(h=0),q=h;q<h+n;q+=k){switch(g){case 1:e=(new DataView(a,q,1)).getUint8(0);break;case 2:e=(new DataView(a,q,1)).getUint8(0);break;
case 3:e=(new DataView(a,q,2)).getUint16(0,b);break;case 4:e=(new DataView(a,q,4)).getUint32(0,b);break;case 5:e=(new DataView(a,q,4)).getUint32(0,b)/(new DataView(a,q+4,4)).getUint32(0,b);break;case 6:e=(new DataView(a,q,1)).getInt8(0);break;case 7:e=(new DataView(a,q,1)).getUint8(0);break;case 8:e=(new DataView(a,q,2)).getInt16(0,b);break;case 9:e=(new DataView(a,q,4)).getInt32(0,b);break;case 10:e=(new DataView(a,q,4)).getInt32(0,b)/(new DataView(a,q+4,4)).getInt32(0,b);break;case 11:e=(new DataView(a,
q,4)).getFloat32(0,b);break;case 12:e=(new DataView(a,q,8)).getFloat64(0,b);break;default:e=null}m.push(e)}if(2===g){g="";h=m;m=[];for(a=0;a<h.length;a++)0===h[a]&&""!==g?(m.push(g),g=""):g+=String.fromCharCode(h[a]);""===g&&0!==m.length||m.push(g)}c.values=m;return!0}function h(b){var d=b[0],e=c(d,"TILEWIDTH"),h=c(d,"TILELENGTH"),m=c(d,"IMAGEWIDTH"),k=c(d,"IMAGELENGTH"),n=c(d,"BITSPERSAMPLE"),l=c(d,"SAMPLESPERPIXEL"),p=c(d,"SAMPLEFORMAT")||1,t=a(p,n),B=g(d,"PLANARCONFIGURATION")?2===g(d,"PLANARCONFIGURATION")[0]:
!1,v=g(d,"GDAL_NODATA"),w;null!=v&&("string"===typeof v[0]?(w=v.map(function(a){return parseFloat(a)}),w.some(function(a){return isNaN(a)})&&(w=null)):"number"===typeof v[0]&&(w=v));var y=c(d,"COMPRESSION")||1;switch(y){case 1:v="NONE";break;case 2:case 3:case 4:case 32771:v="CCITT";break;case 5:v="LZW";break;case 6:case 7:v="JPEG";break;case 32773:v="PACKBITS";break;case 8:case 32946:v="DEFLATE";break;case 34712:v="JPEG2000";break;default:v=String(y)}var u=!0,C="";1!==y&&6!==y&&8!==y&&32946!==y&&
(u=!1,C+="unsupported tag compression "+y);3<p&&(u=!1,C+="unsupported tag sampleFormat "+p);0!==n%8&&(u=!1,C+="unsupported tag bitsPerSample "+n);var n=c(d,"GEOASCIIPARAMS"),z;n&&(z=(z=n.split("|").filter(function(a){return-1<a.indexOf("ESRI PE String \x3d ")})[0])?z.replace("ESRI PE String \x3d ",""):"",z=0===z.indexOf("PROJCS")||0===z.indexOf("GEOGCS")?{wkid:null,wkt:z}:null);var n=g(d,"GEOTIEPOINTS"),p=g(d,"GEOPIXELSCALE"),y=g(d,"GEOTRANSMATRIX"),D=d.has("GEOKEYDIRECTORY")?d.get("GEOKEYDIRECTORY").data:
null,d=!1;if(D){var d=2===c(D,"GTRasterTypeGeoKey"),Q=c(D,"GTModelTypeGeoKey");2===Q?(D=c(D,"GeographicTypeGeoKey"),1024<D&&32766>D&&(z={wkid:D})):1===Q&&(D=c(D,"ProjectedCSTypeGeoKey"),1024<D&&32766>D&&(z={wkid:D}))}var I,W;p&&n&&6<=n.length?(I=[p[0],0,n[3]-n[0]*p[0],0,-Math.abs(p[1]),n[4]-n[1]*p[1]],d&&(I[2]-=.5*I[0]+.5*I[1],I[5]-=.5*I[3]+.5*I[4])):y&&16===y.length&&(I=[y[0],y[1],y[3],y[4],y[5],y[7]]);if(I){W=[{x:0,y:k},{x:0,y:0},{x:m,y:k},{x:m,y:0}];d=void 0;p=n=Number.POSITIVE_INFINITY;D=y=Number.NEGATIVE_INFINITY;
for(Q=0;Q<W.length;Q++)d=f(W[Q],I),n=d.x>n?n:d.x,y=d.x<y?y:d.x,p=d.y>p?p:d.y,D=d.y<D?D:d.y;W={xmin:n,xmax:y,ymin:p,ymax:D,spatialReference:z}}I=b.filter(function(a){return 1===c(a,"NEWSUBFILETYPE")});var K,O,U,aa;0<I.length&&(K=Math.round(Math.log(m/c(I[0],"IMAGEWIDTH"))/Math.LN2),O=Math.round(Math.log(m/c(I[I.length-1],"IMAGEWIDTH"))/Math.LN2),U=c(I[I.length-1],"TILEWIDTH"),aa=c(I[I.length-1],"TILEHEIGHT"));U=0<O?U||e:null;aa=0<O?aa||h:null;var Y;e&&(Y=[{maxCol:Math.ceil(m/e)-1,maxRow:Math.ceil(k/
h)-1,minRow:0,minCol:0}],I.forEach(function(a){Y.push({maxCol:Math.ceil(c(a,"IMAGEWIDTH")/c(a,"TILEWIDTH"))-1,maxRow:Math.ceil(c(a,"IMAGELENGTH")/c(a,"TILELENGTH"))-1,minRow:0,minCol:0})}));b=c(b[0],"GDAL_METADATA");b=x(b);return{width:m,height:k,tileWidth:e,tileHeight:h,planes:l,isBSQ:B,pixelType:t,compression:v,noData:w,isSupported:u,message:C,extent:W,firstPyramidLevel:K,maximumPyramidLevel:O,pyramidBlockWidth:U,pyramidBlockHeight:aa,tileBoundary:Y,metadata:b}}function n(a){var b=new DataView(a,
0,8),c=b.getUint16(0,!1),d=null;if(18761===c)d=!0;else if(19789===c)d=!1;else throw"unexpected endianess byte";if(42!==b.getUint16(2,d))throw"unexpected tiff identifier";c=b.getUint32(4,d);b=[];do if(c=v(a,d,c),c.success)b.push(c.ifd),c=c.nextIFD;else break;while(0<c);a=h(b);return z({},a,{littleEndian:d,ifds:b})}function v(a,b,c,d,f,g){void 0===d&&(d=0);void 0===f&&(f=p.TIFF_TAGS);void 0===g&&(g=4);c=C(a,b,c,d,f,g);var e,h=c.ifd;h&&(p.ifdTags.forEach(function(c,f){h.has(f)&&(e=h.get(f),e.data=C(a,
b,e.valueOffset-d,d,c).ifd)}),h.has("GEOKEYDIRECTORY")&&(e=h.get("GEOKEYDIRECTORY"),(f=e.values)&&4<f.length&&(f=f[0]+"."+f[1]+"."+f[2],e.data=C(a,b,e.valueOffset+6-d,d,p.GEO_KEYS,2).ifd,e.data&&e.data.set("GEOTIFFVersion",{id:0,type:2,valueCount:1,valueOffset:null,values:[f]}))),h.has("XMP")&&(e=h.get("XMP"),f=e.values,"number"===typeof f[0]&&7===e.type&&(e.values=[l.bytesToUTF8(new Uint8Array(f))])));return c}Object.defineProperty(e,"__esModule",{value:!0});var m=function(){var a=new ArrayBuffer(4),
b=new Uint8Array(a);(new Uint32Array(a))[0]=1;return 1===b[0]}(),w=[0,1,1,2,4,8,1,1,2,4,8,4,8],t=function(f,g,e,h,n){g=m===g;var q=c(e,"BITSPERSAMPLE"),l=c(e,"SAMPLEFORMAT")||1,q=a(l,q),l=c(e,"COMPRESSION")[0]||1;e=d(q);var p,r;1===l?(p=f.slice(h,h+n),r=new Uint8Array(p)):8===l||32946===l?(r=new Uint8Array(f,h,n),r=new k(r),f=r.getBytes(),p=new ArrayBuffer(f.length),r=new Uint8Array(p),r.set(f)):6===l&&(r=new Uint8Array(f,h,n),p=new b,p.parse(r),f=p.getData(p.width,p.height,!0),p=new ArrayBuffer(f.length),
r=new Uint8Array(p),r.set(f));if("u8"!==q&&"s8"!==q&&!g)switch(p=new ArrayBuffer(r.length),g=new Uint8Array(p),q){case "u16":case "s16":for(q=0;q<r.length;q+=2)g[q]=r[q+1],g[q+1]=r[q];break;case "u32":case "s32":case "f32":for(q=0;q<r.length;q+=4)g[q]=r[q+3],g[q+1]=r[q+2],g[q+2]=r[q+1],g[q+3]=r[q]}return new e(p)},u=function(a,b,c){if(!(a&&0<a.length&&b&&c))return null;for(var d,f,g,e=a[0].length,h=a.length,m=new Uint8Array(e),k=0;k<h;k++)if(d=a[k],f=b[k],g=c[k],0===k)for(var n=0;n<e;n++)m[n]=d[n]<
f||d[n]>g?0:1;else for(n=0;n<e;n++)m[n]&&(m[n]=d[n]<f||d[n]>g?0:1);return m},x=function(a){if(!a)return null;var b=a.match(/<Item(.*?)Item>/gi);if(!b||0===b.length)return null;a=new Map;for(var c,d,f,g,e=0;e<b.length;e++)c=b[e],d=c.slice(6,c.indexOf("\x3e")),f=c.indexOf("sample\x3d"),-1<f&&(g=c.slice(f+8,c.indexOf('"',f+8))),f=c.indexOf("name\x3d"),-1<f&&(d=c.slice(f+6,c.indexOf('"',f+6))),d&&(c=c.slice(c.indexOf("\x3e")+1,c.indexOf("\x3c/Item\x3e")).trim(),null!=g?a.has(d)?a.get(d)[g]=c:a.set(d,
[c]):a.set(d,c)),g=null;b=a.get("STATISTICS_MINIMUM");d=a.get("STATISTICS_MAXIMUM");c=a.get("STATISTICS_MEAN");f=a.get("STATISTICS_STDDEV");g=null;if(b&&d)for(g=[],e=0;e<b.length;e++)g.push({min:parseFloat(b[e]),max:parseFloat(d[e]),avg:c&&parseFloat(c[e]),stddev:f&&parseFloat(f[e])});d=a.get("BandName");c=a.get("WavelengthMin");f=a.get("WavelengthMax");b=null;if(d)for(b=[],e=0;e<d.length;e++)b.push({BandName:d[e],WavelengthMin:c&&parseFloat(c[e]),WavelengthMax:f&&parseFloat(f[e])});e=a.get("DataType");
return{statistics:g,bandProperties:b,dataType:e,rawMetadata:a}};e.parseFieldValues=y;e.getImageInfo=h;e.parseHeader=n;e.parseSignature=function(a){var b=new DataView(a,0,8),c=b.getUint16(0,!1);a=null;if(18761===c)a=!0;else if(19789===c)a=!1;else throw"unexpected endianess byte";if(42!==b.getUint16(2,a))throw"unexpected tiff identifier";b=b.getUint32(4,a);return{littleEndian:a,firstIFD:b}};e.parseIFD=v;e.decodeTileOrStrip=function(a,b){var f=b.headerInfo,g=b.ifd,e=t(a,f.littleEndian,g,b.offset||0,
b.size||a.byteLength);a=f.pixelType;for(var h=f.isBSQ,m=f.planes,n=d(a),k=e.length/m,l,p=[],r=0;r<m;r++){l=new n(k);if(h)l=e.slice(k*r,k*(r+1));else for(var v=0;v<k;v++)l[v]=e[v*m+r];p.push(l)}var e=c(g,"TILEWIDTH"),g=c(g,"TILELENGTH"),h=f.noData?f.noData[0]:null,f=(m=f.metadata?f.metadata.statistics:null)?m.map(function(a){return a.min}):null,m=m?m.map(function(a){return a.max}):null,y;if(null!=h)if(y=new Uint8Array(k),1E24<Math.abs(h))for(b=0;b<k;b++)y[b]=1E-6>Math.abs((p[0][b]-h)/h)?0:1;else for(b=
0;b<k;b++)y[b]=p[0][b]===h?0:1;else f&&m&&b.applyMinMaxConstraint&&(y=u(p,f,m));return{pixelType:a,width:e,height:g,pixels:p,mask:y,noDataValue:h}};e.decode=function(a,c){c=c||n(a);var f=c.ifds,e=c.noData;if(0===f.length)throw"no valid image file directory";f=f[0];e=e?e[0]:null;if(c.tileWidth){var h=g(f,"TILEOFFSETS");if(void 0===h)f=null;else{for(var l=g(f,"TILEBYTECOUNTS"),p=c.tileWidth,r=c.tileHeight,v=c.width,y=c.height,w=c.pixelType,x=c.isBSQ,u=c.planes,B=v*y,C=g(f,"BITSPERSAMPLE")[0],z=d(w),
D=[],T=0;T<u;T++)D.push(new z(B));var Q,I,W,K,O,U,aa,Y,B=Math.ceil(v/p);if(0===C%8)for(C=0;C<h.length;C++)for(Q=Math.floor(C/B)*r,K=C%B*p,T=Q*v+K,z=t(a,c.littleEndian,f,h[C],l[C]),U=0,O=T,K=Math.min(p,v-K),aa=Math.min(r,y-Q),Q=0;Q<u;Q++)if(Y=D[Q],x)for(I=0;I<aa;I++)for(O=T+I*v,U=p*r*Q+I*p,W=0;W<K;W++,O++,U++)Y[O]=z[U];else for(I=0;I<aa;I++)for(O=T+I*v,U=I*p*u+Q,W=0;W<K;W++,O++,U+=u)Y[O]=z[U];f={width:v,height:y,pixelType:w,pixels:D}}}else if(r=c,D=m===r.littleEndian,B=g(f,"STRIPOFFSETS"),void 0===
B)f=null;else{c=r.width;h=r.height;l=r.pixelType;r=r.planes;v=c*h;C=g(f,"BITSPERSAMPLE")[0];y=d(l);w=new y(v*r);z=g(f,"STRIPBYTECOUNTS");T=g(f,"ROWSPERSTRIP")[0];O=g(f,"COMPRESSION")?g(f,"COMPRESSION")[0]:1;K=T;if(0===C%8)for(f=0;f<B.length;f++){U=f*T*c*r;K=(f+1)*T>h?h-f*T:T;if("u8"===l||"s8"===l||D)8===O||32946===O?(x=new Uint8Array(a,B[f],z[f]),x=new k(x),Q=x.getBytes(),u=new ArrayBuffer(Q.length),x=new Uint8Array(u),x.set(Q),x.length!==K*c*r*C/8&&console.log("strip byte counts is different than expected")):
6===O?(x=new Uint8Array(a,B[f],z[f]),u=new b,u.parse(x),K=u.getData(u.width,u.height,!0),u=new ArrayBuffer(K.length),x=new Uint8Array(u),x.set(K)):1===O&&(z[f]!==K*c*r*C/8&&console.log("strip byte counts is different than expected"),u=a.slice(B[f],B[f]+z[f]));else switch(6===O||8===O||32946===O?(x=new Uint8Array(a,B[f],z[f]),x=new k(x),x=x.getBytes(),u=new ArrayBuffer(x.length),p=new Uint8Array(u),x.length!==K*c*r*C/8&&console.log("strip byte counts is different than expected")):1===O&&(z[f]!==K*
c*r*C/8&&console.log("strip byte counts is different than expected"),u=new ArrayBuffer(z[f]),x=new Uint8Array(a,B[f],z[f]),p=new Uint8Array(u)),l){case "u16":case "s16":for(K=0;K<x.length;K+=2)p[K]=x[K+1],p[K+1]=x[K];break;case "u32":case "s32":case "f32":for(K=0;K<x.length;K+=4)p[K]=x[K+3],p[K+1]=x[K+2],p[K+2]=x[K+1],p[K+3]=x[K]}K=new y(u);w.set(K,U)}x=[];if(1===r)x.push(w);else for(f=0;f<r;f++){p=new y(v);for(a=0;a<v;a++)p[a]=w[a*r+f];x.push(p)}f={width:c,height:h,pixelType:l,pixels:x}}if(null!==
e){f.mask=new Uint8Array(f.width*f.height);if(1E24<Math.abs(e))for(a=0;a<f.width*f.height;a++)f.mask[a]=1E-6>Math.abs((f.pixels[0][a]-e)/e)?0:1;else for(a=0;a<f.width*f.height;a++)f.mask[a]=f.pixels[0][a]===e?0:1;f.noDataValue=e}return f}})},"esri/layers/support/rasterDatasets/byteStreamUtils":function(){define(["require","exports"],function(D,e){Object.defineProperty(e,"__esModule",{value:!0});e.bytesToUTF8=function(e,l){for(var b=0,p="",k=0,a=0,d=e.length;b<d;)if(a=e[b++],k=a>>4,8>k?k=1:15===k?
(k=4,a=(a&7)<<18|(e[b++]&63)<<12|(e[b++]&63)<<6|e[b++]&63):14===k?(k=3,a=(a&15)<<12|(e[b++]&63)<<6|e[b++]&63):(k=2,a=(a&31)<<6|e[b++]&63),0!==a||l)p+=String.fromCharCode(a);return p}})},"esri/layers/support/rasterFormats/TiffTags":function(){define(["require","exports"],function(D,e){var z=function(){var b=[];b[254]="NEWSUBFILETYPE";b[255]="SUBFILETYPE";b[256]="IMAGEWIDTH";b[257]="IMAGELENGTH";b[258]="BITSPERSAMPLE";b[259]="COMPRESSION";b[262]="PHOTOMETRICINTERPRETATION";b[263]="THRESHHOLDING";b[264]=
"CELLWIDTH";b[265]="CELLLENGTH";b[266]="FILLORDER";b[269]="DOCUMENTNAME";b[270]="IMAGEDESCRIPTION";b[271]="MAKE";b[272]="MODEL";b[273]="STRIPOFFSETS";b[274]="ORIENTATION";b[277]="SAMPLESPERPIXEL";b[278]="ROWSPERSTRIP";b[279]="STRIPBYTECOUNTS";b[280]="MINSAMPLEVALUE";b[281]="MAXSAMPLEVALUE";b[282]="XRESOLUTION";b[283]="YRESOLUTION";b[284]="PLANARCONFIGURATION";b[285]="PAGENAME";b[286]="XPOSITION";b[287]="YPOSITION";b[288]="FREEOFFSETS";b[289]="FREEBYTECOUNTS";b[290]="GRAYRESPONSEUNIT";b[291]="GRAYRESPONSECURVE";
b[292]="T4OPTIONS";b[293]="T6OPTIONS";b[296]="RESOLUTIONUNIT";b[297]="PAGENUMBER";b[300]="COLORRESPONSEUNIT";b[301]="TRANSFERFUNCTION";b[305]="SOFTWARE";b[306]="DATETIME";b[315]="ARTIST";b[316]="HOSTCOMPUTER";b[317]="PREDICTOR";b[318]="WHITEPOINT";b[319]="PRIMARYCHROMATICITIES";b[320]="COLORMAP";b[321]="HALFTONEHINTS";b[322]="TILEWIDTH";b[323]="TILELENGTH";b[324]="TILEOFFSETS";b[325]="TILEBYTECOUNTS";b[326]="BADFAXLINES";b[327]="CLEANFAXDATA";b[328]="CONSECUTIVEBADFAXLINES";b[330]="SUBIFD";b[332]=
"INKSET";b[333]="INKNAMES";b[334]="NUMBEROFINKS";b[336]="DOTRANGE";b[337]="TARGETPRINTER";b[338]="EXTRASAMPLES";b[339]="SAMPLEFORMAT";b[340]="SMINSAMPLEVALUE";b[341]="SMAXSAMPLEVALUE";b[342]="TRANSFERRANGE";b[347]="JPEGTABLES";b[512]="JPEGPROC";b[513]="JPEGIFOFFSET";b[514]="JPEGIFBYTECOUNT";b[515]="JPEGRESTARTINTERVAL";b[517]="JPEGLOSSLESSPREDICTORS";b[518]="JPEGPOINTTRANSFORM";b[519]="JPEGQTABLES";b[520]="JPEGDCTABLES";b[521]="JPEGACTABLES";b[529]="YCBCRCOEFFICIENTS";b[530]="YCBCRSUBSAMPLING";b[531]=
"YCBCRPOSITIONING";b[532]="REFERENCEBLACKWHITE";b[700]="XMP";b[33550]="GEOPIXELSCALE";b[33922]="GEOTIEPOINTS";b[33432]="COPYRIGHT";b[42112]="GDAL_METADATA";b[42113]="GDAL_NODATA";b[50844]="RPCCOEFFICIENT";b[34264]="GEOTRANSMATRIX";b[34735]="GEOKEYDIRECTORY";b[34736]="GEODOUBLEPARAMS";b[34737]="GEOASCIIPARAMS";b[34665]="EXIFIFD";b[34853]="GPSIFD";b[40965]="INTEROPERABILITYIFD";return b}();D=function(){var b=[].concat(z);b[36864]="ExifVersion";b[40960]="FlashpixVersion";b[40961]="ColorSpace";b[42240]=
"Gamma";b[37121]="ComponentsConfiguration";b[37122]="CompressedBitsPerPixel";b[40962]="PixelXDimension";b[40963]="PixelYDimension";b[37500]="MakerNote";b[37510]="UserComment";b[40964]="RelatedSoundFile";b[36867]="DateTimeOriginal";b[36868]="DateTimeDigitized";b[36880]="OffsetTime";b[36881]="OffsetTimeOriginal";b[36882]="OffsetTimeDigitized";b[37520]="SubSecTime";b[37521]="SubSecTimeOriginal";b[37522]="SubSecTimeDigitized";b[37888]="Temperature";b[37889]="Humidity";b[37890]="Pressure";b[37891]="WaterDepth";
b[37892]="Acceleration";b[37893]="CameraElevationAngle";b[42016]="ImageUniqueID";b[42032]="CameraOwnerName";b[42033]="BodySerialNumber";b[42034]="LensSpecification";b[42035]="LensMake";b[42036]="LensModel";b[42037]="LensSerialNumber";b[33434]="ExposureTime";b[33437]="FNumber";b[34850]="ExposureProgram";b[34852]="SpectralSensitivity";b[34855]="PhotographicSensitivity";b[34856]="OECF";b[34864]="SensitivityType";b[34865]="StandardOutputSensitivity";b[34866]="RecommendedExposureIndex";b[34867]="ISOSpeed";
b[34868]="ISOSpeedLatitudeyyy";b[34869]="ISOSpeedLatitudezzz";b[37377]="ShutterSpeedValue";b[37378]="ApertureValue";b[37379]="BrightnessValue";b[37380]="ExposureBiasValue";b[37381]="MaxApertureValue";b[37382]="SubjectDistance";b[37383]="MeteringMode";b[37384]="LightSource";b[37385]="Flash";b[37386]="FocalLength";b[37396]="SubjectArea";b[41483]="FlashEnergy";b[41484]="SpatialFrequencyResponse";b[41486]="FocalPlaneXResolution";b[41487]="FocalPlaneYResolution";b[41488]="FocalPlaneResolutionUnit";b[41492]=
"SubjectLocation";b[41493]="ExposureIndex";b[41495]="SensingMethod";b[41728]="FileSource";b[41729]="SceneType";b[41730]="CFAPattern";b[41985]="CustomRendered";b[41986]="ExposureMode";b[41987]="WhiteBalance";b[41988]="DigitalZoomRatio";b[41989]="FocalLengthIn35mmFilm";b[41990]="SceneCaptureType";b[41991]="GainControl";b[41992]="Contrast";b[41993]="Saturation";b[41994]="Sharpness";b[41995]="DeviceSettingDescription";b[41996]="SubjectDistanceRange";return b}();e=function(){var b=[];b[1024]="GTModelTypeGeoKey";
b[1025]="GTRasterTypeGeoKey";b[1026]="GTCitationGeoKey";b[2048]="GeographicTypeGeoKey";b[2049]="GeogCitationGeoKey";b[2050]="GeogGeodeticDatumGeoKey";b[2051]="GeogPrimeMeridianGeoKey";b[2052]="GeogLinearUnitsGeoKey";b[2053]="GeogLinearUnitSizeGeoKey";b[2054]="GeogAngularUnitsGeoKey";b[2055]="GeogAngularUnitSizeGeoKey";b[2056]="GeogEllipsoidGeoKey";b[2057]="GeogSemiMajorAxisGeoKey";b[2058]="GeogSemiMinorAxisGeoKey";b[2059]="GeogInvFlatteningGeoKey";b[2061]="GeogPrimeMeridianLongGeoKey";b[2060]="GeogAzimuthUnitsGeoKey";
b[3072]="ProjectedCSTypeGeoKey";b[3073]="PCSCitationGeoKey";b[3074]="ProjectionGeoKey";b[3075]="ProjCoordTransGeoKey";b[3076]="ProjLinearUnitsGeoKey";b[3077]="ProjLinearUnitSizeGeoKey";b[3078]="ProjStdParallel1GeoKey";b[3079]="ProjStdParallel2GeoKey";b[3080]="ProjNatOriginLongGeoKey";b[3081]="ProjNatOriginLatGeoKey";b[3082]="ProjFalseEastingGeoKey";b[3083]="ProjFalseNorthingGeoKey";b[3084]="ProjFalseOriginLongGeoKey";b[3085]="ProjFalseOriginLatGeoKey";b[3086]="ProjFalseOriginEastingGeoKey";b[3087]=
"ProjFalseOriginNorthingGeoKey";b[3088]="ProjCenterLongGeoKey";b[3090]="ProjCenterEastingGeoKey";b[3091]="ProjCenterNorthingGeoKey";b[3092]="ProjScaleAtNatOriginGeoKey";b[3093]="ProjScaleAtCenterGeoKey";b[3094]="ProjAzimuthAngleGeoKey";b[3095]="ProjStraightVertPoleLongGeoKey";b[4096]="VerticalCSTypeGeoKey";b[4097]="VerticalCitationGeoKey";b[4098]="VerticalDatumGeoKey";b[4099]="VerticalUnitsGeoKey";return b}();var l=new Map;l.set("EXIFIFD",D);l.set("GPSIFD","GPSVersionID GPSLatitudeRef GPSLatitude GPSLongitudeRef GPSLongitude GPSAltitudeRef GPSAltitude GPSTimeStamp GPSSatellites GPSStatus GPSMeasureMode GPSDOP GPSSpeedRef GPSSpeed GPSTrackRef GPSTrack GPSImgDirectionRef GPSImgDirection GPSMapDatum GPSDestLatitudeRef GPSDestLatitude GPSDestLongitudeRef GPSDestLongitude GPSDestBearingRef GPSDestBearing GPSDestDistanceRef GPSDestDistance GPSProcessingMethod GPSAreaInformation GPSDateStamp GPSDifferential GPSHPositioningError".split(" "));
return{TIFF_TAGS:z,ifdTags:l,GEO_KEYS:e,getTagName:function(b,e){e=(e||z)[b];void 0===e&&(e="unknown"+String(b));return e}}})},"esri/layers/support/rasterFunctions/pixelUtils":function(){define(["require","exports","../PixelBlock"],function(D,e,z){function l(a,b){a=Math.min(Math.max(a,-100),100);b=Math.min(Math.max(b,-100),100);var d,g,c=new Uint8Array(256);for(d=0;256>d;d++)0<a&&100>a?g=(200*d-25500+510*b)/(2*(100-a))+128:0>=a&&-100<a?g=(200*d-25500+510*b)*(100+a)/2E4+128:100===a?(g=200*d-25500+
256*(100-a)+510*b,g=0<g?255:0):-100===a&&(g=128),c[d]=255<g?255:0>g?0:g;return c}function b(a,b,f,g,c,e,k,h){return{xmin:c<=f*a?0:c<f*a+a?c-f*a:a,ymin:e<=g*b?0:e<g*b+b?e-g*b:b,xmax:c+k<=f*a?0:c+k<f*a+a?c+k-f*a:a,ymax:e+h<=g*b?0:e+h<g*b+b?e+h-g*b:b}}function p(a,d,f,g){var c=a.filter(function(a){return k(a)})[0];if(null==c)return null;var e=g?g.width:d.width;g=g?g.height:d.height;var l=c.width,h=c.height,n=d.width/l;d=d.height/h;var p=f?f.x:0;f=f?f.y:0;var m=c.pixelType,w=z.getPixelArrayConstructor(m),
t=c.pixels.length,c=[],u,x,B,r,q,A,E,F,H,G;for(q=0;q<t;q++){x=new w(e*g);for(A=0;A<d;A++)for(E=0;E<n;E++)if(B=a[A*n+E])for(u=B.pixels[q],G=b(l,h,E,A,p,f,e,g),F=G.ymin;F<G.ymax;F++)for(B=(A*h+F-f)*e+(E*l-p),r=F*l,H=G.xmin;H<G.xmax;H++)x[B+H]=u[r+H];c.push(x)}var P;if(a.some(function(a){return null==a||a.mask&&0<a.mask.length}))for(P=new Uint8Array(e*g),A=0;A<d;A++)for(E=0;E<n;E++)if(w=(B=a[A*n+E])?B.mask:null,G=b(l,h,E,A,p,f,e,g),w)for(F=G.ymin;F<G.ymax;F++)for(B=(A*h+F-f)*e+(E*l-p),r=F*l,H=G.xmin;H<
G.xmax;H++)P[B+H]=w[r+H];else if(B)for(F=G.ymin;F<G.ymax;F++)for(B=(A*h+F-f)*e+(E*l-p),r=F*l,H=G.xmin;H<G.xmax;H++)P[B+H]=1;else for(F=G.ymin;F<G.ymax;F++)for(B=(A*h+F-f)*e+(E*l-p),r=F*l,H=G.xmin;H<G.xmax;H++)P[B+H]=0;a=new z({width:e,height:g,pixels:c,pixelType:m,mask:P});a.updateStatistics();return a}Object.defineProperty(e,"__esModule",{value:!0});var k=function(a){return a&&"esri.layers.support.PixelBlock"===a.declaredClass&&a.pixels&&0<a.pixels.length};e.extractBands=function(a,b){if(!b||!k(a))return a;
var d=a.pixels.length;return b&&b.some(function(a){return a>=d})||1===d&&1===b.length&&0===b[0]||d===b.length&&!b.some(function(a,b){return a!==b})?a:new z({pixelType:a.pixelType,width:a.width,height:a.height,mask:a.mask,validPixelCount:a.validPixelCount,maskIsAlpha:a.maskIsAlpha,pixels:b.map(function(b){return a.pixels[b]}),statistics:a.statistics&&b.map(function(b){return a.statistics[b]})})};e.createColormapLUT=function(a){if(a){var b=a.colormap;if(b&&0!==b.length){var b=b.sort(function(a,b){return a[0]-
b[0]}),f=0;0>b[0][0]&&(f=b[0][0]);var g=Math.max(256,b[b.length-1][0]-f+1),c=new Uint8Array(4*g),e=[],k=0,h=0,n=5===b[0].length;if(65536<g)return b.forEach(function(a){e[a[0]-f]=n?a.slice(1):a.slice(1).concat([255])}),{indexed2DColormap:e,offset:f,alphaSpecified:n};if(a.fillUnspecified)for(a=b[h],k=a[0]-f;k<g;k++)c[4*k]=a[1],c[4*k+1]=a[2],c[4*k+2]=a[3],c[4*k+3]=n?a[4]:255,k===a[0]-f&&(a=h===b.length-1?a:b[++h]);else for(k=0;k<b.length;k++)a=b[k],h=4*(a[0]-f),c[h]=a[1],c[h+1]=a[2],c[h+2]=a[3],c[h+
3]=n?a[4]:255;return{indexedColormap:c,offset:f,alphaSpecified:n}}}};e.colorize=function(a,b){if(!k(a)||!b&&(b.indexedColormap||b.indexed2DColormap))return a;var d=a.clone(),g=d.pixels,c=d.mask,e=d.width*d.height;if(1!==g.length)return a;var l=b.indexedColormap;a=b.indexed2DColormap;var h=b.offset;b=b.alphaSpecified;var n=l.length-1,p=0,g=g[0],m=new Uint8Array(g.length),w=new Uint8Array(g.length),t=new Uint8Array(g.length),u=0;if(l)if(c)for(p=0;p<e;p++)c[p]&&(u=4*(g[p]-h),u<h||u>n?c[p]=0:(m[p]=l[u],
w[p]=l[u+1],t[p]=l[u+2],c[p]=l[u+3]));else{c=new Uint8Array(e);for(p=0;p<e;p++)u=4*(g[p]-h),u<h||u>n?c[p]=0:(m[p]=l[u],w[p]=l[u+1],t[p]=l[u+2],c[p]=l[u+3]);d.mask=c}else if(c)for(p=0;p<e;p++)c[p]&&(l=a[g[p]],m[p]=l[0],w[p]=l[1],t[p]=l[2],c[p]=l[3]);else{c=new Uint8Array(e);for(p=0;p<e;p++)l=a[g[p]],m[p]=l[0],w[p]=l[1],t[p]=l[2],c[p]=l[3];d.mask=c}d.pixels=[m,w,t];d.statistics=null;d.pixelType="u8";d.maskIsAlpha=b;return d};e.estimateStatisticsHistograms=function(a){if(!k(a))return null;a.statistics||
a.updateStatistics();var b=a.pixels,f=a.mask,g=a.pixelType,c=a.statistics;a=a.width*a.height;var e=b.length,l,h,n,p,m,w=[],t=[],u,x,B;for(p=0;p<e;p++){u=new Uint32Array(256);B=b[p];if("u8"===g)if(l=-.5,h=255.5,f)for(m=0;m<a;m++)f[m]&&u[B[m]]++;else for(m=0;m<a;m++)u[B[m]]++;else{l=c[p].minValue;h=c[p].maxValue;n=(h-l)/256;x=new Uint32Array(257);if(f)for(m=0;m<a;m++)f[m]&&x[Math.floor((B[m]-l)/n)]++;else for(m=0;m<a;m++)x[Math.floor((B[m]-l)/n)]++;for(m=0;255>m;m++)u[m]=x[m];u[255]=x[255]+x[256]}w.push({min:l,
max:h,size:256,counts:u});for(m=B=x=n=0;256>m;m++)n+=u[m],x+=m*u[m];x/=n;for(m=0;256>m;m++)B+=u[m]*Math.pow(m-x,2);u=Math.sqrt(B/(n-1));n=(h-l)/256;m=(x+.5)*n+l;u*=n;t.push({min:l,max:h,avg:m,stddev:u})}return{statistics:t,histograms:w}};e.createStretchLUT=function(a){var b=a.minCutOff,f=a.maxCutOff,g=a.gamma,c=a.pixelType,e=a.outMin||0,k=a.outMax||255;if(-1===["u8","u16","s8","s16"].indexOf(c))return null;var h=b.length,n,p=0;"s8"===c?p=-127:"s16"===c&&(p=-32767);var m=256;-1<["u16","s16"].indexOf(c)&&
(m=65536);for(var w=[],t=k-e,c=0;c<h;c++)w[c]=f[c]-b[c];n=g&&g.length>=h;var u=[];if(n)for(c=0;c<h;c++)u[c]=1<g[c]?2<g[c]?6.5+Math.pow(g[c]-2,2.5):6.5+100*Math.pow(2-g[c],4):1;var x,B=[],r,q,A;if(n)for(c=0;c<h;c++){A=[];for(n=0;n<m;n++)r=n+p,x=(r-b[c])/w[c],q=1,1<g[c]&&(q-=Math.pow(1/t,x*u[c])),A[n]=r<f[c]&&r>b[c]?Math.floor(q*t*Math.pow(x,1/g[c]))+e:r>=f[c]?k:e;B[c]=A}else for(c=0;c<h;c++){A=[];for(n=0;n<m;n++)r=n+p,A[n]=r<=b[c]?e:r>=f[c]?k:Math.floor((r-b[c])/w[c]*t)+e;B[c]=A}if(null!=a.contrastOffset)for(a=
l(a.contrastOffset,a.brightnessOffset),c=0;c<h;c++)for(A=B[c],n=0;n<m;n++)A[n]=a[A[n]];return{lut:B,offset:p}};e.createContrastBrightnessLUT=l;e.stretch=function(a,b){if(!k(a))return null;a=a.clone();var d=a.pixels,g=a.mask,c=b.minCutOff,e=b.maxCutOff,l=b.gamma,h=b.outMin||0;b=b.outMax||255;var n=a.width*a.height,p=d.length,m,w,t,u,x,B=b-h,r=[];for(m=0;m<p;m++)r[m]=e[m]-c[m];w=l&&l.length>=p;var q=[];if(w)for(m=0;m<p;m++)q[m]=1<l[m]?2<l[m]?6.5+Math.pow(l[m]-2,2.5):6.5+100*Math.pow(2-l[m],4):1;if(w)if(null!=
g)for(w=0;w<n;w++){if(g[w])for(m=0;m<p;m++)t=d[m][w],x=(t-c[m])/r[m],u=1,1<l[m]&&(u-=Math.pow(1/B,x*q[m])),d[m][w]=t<e[m]&&t>c[m]?Math.floor(u*B*Math.pow(x,1/l[m]))+h:t>=e[m]?b:h}else for(w=0;w<n;w++)for(m=0;m<p;m++)t=d[m][w],x=(t-c[m])/r[m],u=1,1<l[m]&&(u-=Math.pow(1/B,x*q[m])),d[m][w]=t<e[m]&&t>c[m]?Math.floor(u*B*Math.pow(x,1/l[m]))+h:t>=e[m]?b:h;else if(null!=g)for(w=0;w<n;w++){if(g[w])for(m=0;m<p;m++)t=d[m][w],d[m][w]=t<e[m]&&t>c[m]?Math.floor((t-c[m])/r[m]*B)+h:t>=e[m]?b:h}else for(w=0;w<n;w++)for(m=
0;m<p;m++)t=d[m][w],d[m][w]=t<e[m]&&t>c[m]?Math.floor((t-c[m])/r[m]*B)+h:t>=e[m]?b:h;a.pixelType="u8";a.updateStatistics();return a};e.lookupPixels=function(a,b){if(!k(a))return null;var d=a.pixels,g=a.mask,c=a.width*a.height,e=d.length,l=b.lut;b=b.offset;var h,n;l&&1===l[0].length&&(l=d.map(function(){return l}));var p=[],m,w,t;if(b)if(null==g)for(h=0;h<e;h++){m=d[h];w=l[h];t=new Uint8Array(c);for(n=0;n<c;n++)t[n]=w[m[n]-b];p.push(t)}else for(h=0;h<e;h++){m=d[h];w=l[h];t=new Uint8Array(c);for(n=
0;n<c;n++)g[n]&&(t[n]=w[m[n]-b]);p.push(t)}else if(null==g)for(h=0;h<e;h++){m=d[h];w=l[h];t=new Uint8Array(c);for(n=0;n<c;n++)t[n]=w[m[n]];p.push(t)}else for(h=0;h<e;h++){m=d[h];w=l[h];t=new Uint8Array(c);for(n=0;n<c;n++)g[n]&&(t[n]=w[m[n]]);p.push(t)}a=new z({width:a.width,height:a.height,pixels:p,mask:g,pixelType:"u8"});a.updateStatistics();return a};e.remapColor=function(a,b){if(!k(a))return null;a=a.clone();var d=a.width*a.height,e=b.length,c=Math.floor(e/2),l=b[Math.floor(c)],p=a.pixels[0],h,
n,v,m,w,t,u=!1,x=new Uint8Array(d),B=new Uint8Array(d),r=new Uint8Array(d),q=a.mask,A=4===b[0].mappedColor.length;q||(q=new Uint8Array(d),q.fill(A?255:1),a.mask=q);for(w=0;w<d;w++)if(q[w]){h=p[w];u=!1;t=c;n=l;v=0;for(m=e-1;1<m-v;){if(h===n.value){u=!0;break}h>n.value?v=t:m=t;t=Math.floor((v+m)/2);n=b[Math.floor(t)]}u||(h===b[v].value?(n=b[v],u=!0):h===b[m].value?(n=b[m],u=!0):h<b[v].value?(u=!1,n=null):h>b[v].value&&(h<b[m].value?(n=b[v],u=!0):m===e-1?(u=!1,n=null):(n=b[m],u=!0)));u?(x[w]=n.mappedColor[0],
B[w]=n.mappedColor[1],r[w]=n.mappedColor[2],q[w]=n.mappedColor[3]):x[w]=B[w]=r[w]=q[w]=0}a.pixels=[x,B,r];a.mask=q;a.pixelType="u8";a.maskIsAlpha=A;return a};e.getClipBounds=b;e.mosaicPixelData=function(a,b){if(!a||0===a.length)return null;var d=a.filter(function(a){return a.pixelBlock})[0];if(!d)return null;var e=(d.extent.xmax-d.extent.xmin)/d.pixelBlock.width,c=(d.extent.ymax-d.extent.ymin)/d.pixelBlock.height,k=.01*Math.min(e,c),l=a.sort(function(a,b){return Math.abs(a.extent.ymax-b.extent.ymax)>
k?b.extent.ymax-a.extent.ymax:Math.abs(a.extent.xmin-b.extent.xmin)>k?a.extent.xmin-b.extent.xmin:0}),h=Math.min.apply(null,l.map(function(a){return a.extent.xmin})),n=Math.min.apply(null,l.map(function(a){return a.extent.ymin})),v=Math.max.apply(null,l.map(function(a){return a.extent.xmax})),m=Math.max.apply(null,l.map(function(a){return a.extent.ymax}));a={x:Math.round((b.xmin-h)/e),y:Math.round((m-b.ymax)/c)};h={width:Math.round((v-h)/e),height:Math.round((m-n)/c)};e={width:Math.round((b.xmax-
b.xmin)/e),height:Math.round((b.ymax-b.ymin)/c)};if(Math.round(h.width/d.pixelBlock.width)*Math.round(h.height/d.pixelBlock.height)!==l.length||0>a.x||0>a.y||h.width<e.width||h.height<e.height)return null;d=l.map(function(a){return a.pixelBlock});d=p(d,h,a,e);return{extent:b,pixelBlock:d}};e.mosaic=p;e.setValidBoundary=function(a,b,f){if(!k(a))return null;var d=a.width,c=a.height,e=b.x;b=b.y;var l=f.width+e;f=f.height+b;if(0>e||0>b||l>d||f>c||0===e&&0===b&&l===d&&f===c)return a;a.mask||(a.mask=new Uint8Array(d*
c));for(var h=a.mask,n=0;n<c;n++)for(var p=n*d,m=0;m<d;m++)h[p+m]=n<b||n>=f||m<e||m>=l?0:1;a.updateStatistics();return a};e.clip=function(a,b,f){if(!k(a))return null;var d=b.x,c=b.y,e=b.x+f.width;b=b.x+f.height;if(b===a.height&&e===a.width)return a;for(var l=a.pixels,h=a.mask,n=a.width,p=n*a.height,m=l.length,w=[],t=0;t<m;t++){for(var u=l[t],x=z.createEmptyBand(a.pixelType,p),B=0,r=c;r<=b;r++)for(var q=r*n,A=d;A<=e;A++)x[B++]=u[q+A];w.push(x)}var E;if(h)for(E=new Uint8Array(f.width*f.height),B=0,
r=c;r<=b;r++)for(q=r*n,A=d;A<=e;A++)E[B++]=h[q+A];a=new z({width:f.width,height:f.height,pixels:w,mask:E});a.updateStatistics();return a};e.approximateTransform=function(a,b,f,e){if(!k(a))return null;var c=a.pixels,d=a.mask,g=a.pixelType,h=a.width,n=a.height;a=z.getPixelArrayConstructor(g);var l=c.length,m=b.width,p=b.height;b=e.cols;var t=e.rows,u=Math.ceil(m/b),x=Math.ceil(p/t),B=!1;for(e=0;e<f.length;e+=3)-1===f[e]&&-1===f[e+1]&&-1===f[e+2]&&(B=!0);var r,q,A,E,F,H,G,P=new Float32Array(m*p),S=new Float32Array(m*
p),N=0,J,D;for(e=0;e<x;e++)for(var X=0;X<u;X++){r=12*(e*u+X);q=f[r];A=f[r+1];E=f[r+2];F=f[r+3];H=f[r+4];G=f[r+5];for(var L=0;L<t;L++){N=(e*t+L)*m+X*b;D=(L+.5)/t;for(var M=0;M<L;M++)J=(M+.5)/b,P[N+M]=Math.round((q*J+A*D+E)*h-.5),S[N+M]=Math.round((F*J+H*D+G)*n-.5)}r+=6;q=f[r];A=f[r+1];E=f[r+2];F=f[r+3];H=f[r+4];G=f[r+5];for(L=0;L<t;L++)for(N=(e*t+L)*m+X*b,D=(L+.5)/t,M=L;M<b;M++)J=(M+.5)/b,P[N+M]=Math.round((q*J+A*D+E)*h-.5),S[N+M]=Math.round((F*J+H*D+G)*n-.5)}f=function(a,b){for(var c=0;c<p;c++){r=
c*m;for(var d=0;d<m;d++)a[r]=B&&(0>P[r]||0>S[r])?0:b[P[r]+S[r]*h],r++}};n=[];for(e=0;e<l;e++)b=new a(m*p),f(b,c[e]),n.push(b);c=new z({width:m,height:p,pixelType:g,pixels:n});if(d)c.mask=new Uint8Array(m*p),f(c.mask,d);else if(B)for(c.mask=new Uint8Array(m*p),e=0;e<m*p;e++)c.mask[e]=0>P[e]||0>S[e]?0:1;c.updateStatistics();return c}})},"esri/layers/support/rasterDatasets/DBFParser":function(){define(["require","exports","./byteStreamUtils"],function(D,e,z){function l(b){var e=b.fields;b=b.records;
var k=e.some(function(a){return"oid"===a.name.toLowerCase()})?"OBJECTID":"OID",e=[{name:k,type:"esriFieldTypeOID",alias:"OID"}].concat(e.map(function(a){return{name:a.name,type:"esriFieldType"+a.typeName,alias:a.name}})),a=e.map(function(a){return a.name}),d=[],f=0,g=0;b.forEach(function(b){var c={};c[k]=f++;for(g=1;g<a.length;g++)c[a[g]]=b[g-1];d.push({attributes:c})});return{displayFieldName:"",fields:e,features:d}}return function(){function b(){}Object.defineProperty(b,"supportedVersions",{get:function(){return[5]},
enumerable:!0,configurable:!0});b.parse=function(b){var e=new DataView(b),a=e.getUint8(0)&3;if(3!==a)return{header:{version:a},recordSet:null};var d=e.getUint32(4,!0),f=e.getUint16(8,!0),g=e.getUint16(10,!0),f={version:a,recordCount:d,headerByteCount:f,recordByteCount:g},c=32,p=[],y=[];if(3===a){for(;13!==e.getUint8(c);)a=String.fromCharCode(e.getUint8(c+11)).trim(),p.push({name:z.bytesToUTF8(new Uint8Array(b,c,11)),type:a,typeName:"String Date Double Boolean String Integer".split(" ")["CDFLMN".split("").indexOf(a)],
length:e.getUint8(c+16)}),c+=32;c+=1;if(0<p.length)for(a=function(){var a=[];32===e.getUint8(c)?(c+=1,p.forEach(function(d){if("C"===d.type)a.push(z.bytesToUTF8(new Uint8Array(b,c,d.length)).trim());else if("N"===d.type)a.push(parseInt(String.fromCharCode.apply(null,new Uint8Array(b,c,d.length)).trim(),10));else if("F"===d.type)a.push(parseFloat(String.fromCharCode.apply(null,new Uint8Array(b,c,d.length)).trim()));else if("D"===d.type){var e=String.fromCharCode.apply(null,new Uint8Array(b,c,d.length)).trim();
a.push(new Date(parseInt(e.substring(0,4),10),parseInt(e.substring(4,6),10)-1,parseInt(e.substring(6,8),10)))}c+=d.length}),y.push(a)):c+=g};y.length<d&&b.byteLength-c>g;)a()}d=l({fields:p,records:y});return{header:f,fields:p,records:y,recordSet:d}};return b}()})},"esri/layers/support/rasterDatasets/ImageServerRaster":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/assignHelper ../../../geometry ../../../request ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../core/urlUtils ../../../core/accessorSupport/decorators ../RasterInfo ../RasterStorageInfo ../TileInfo ../TilemapCache ./BaseRaster ../rasterFunctions/pixelUtils ../../../tasks/support/FeatureSet".split(" "),
function(D,e,z,l,b,p,k,a,d,f,g,c,C,y,h,n,v,m,w,t,u){return function(e){function k(){var a=null!==e&&e.apply(this,arguments)||this;a._levelOffset=0;a._slices=null;a._tilemapCache=null;a.sourceJSON=null;return a}p(k,e);k.prototype.open=function(a){return b(this,void 0,void 0,function(){var b,c,e,h,k,l,p,r,t,x,u,w,B,y,D,T,Q,I,W,K,O,U,aa,Y,ba;return z(this,function(q){switch(q.label){case 0:return[4,this.init()];case 1:q.sent();b=a&&a.signal;if(!this.sourceJSON)return[3,2];e={data:this.sourceJSON};return[3,
4];case 2:return[4,d(this.url,{responseType:"json",query:{f:"json"},signal:b})];case 3:e=q.sent(),q.label=4;case 4:c=e;c.ssl&&(this.url=this.url.replace(/^http:/i,"https:"));this.sourceJSON=h=c.data;k="jpg jpeg png png8 png24 png32 mixed".split(" ");this.tileType=h.cacheType;null===this.tileType&&(-1<k.indexOf(h.tileInfo.format.toLowerCase())?this.tileType="Map":"lerc"===h.tileInfo.format.toLowerCase()?this.tileType="Elevation":this.tileType="Raster");if(!h||!h.tileInfo)throw new f("imageserverraster:open",
"cannot initialize tiled image service");this.datasetName=h.name;return[4,this._fetchRasterInfo({signal:b})];case 5:l=q.sent();if(g.isSome(l)){p=v.fromJSON(h.tileInfo);r=l.extent;t=l.pixelSize;x=.5/l.width*t.x;w=u=void 0;B=p.lodAt(Math.max.apply(null,p.lods.map(function(a){return a.level})));0!==h.maxScale&&("Raster"===this.tileType?(u=p.lods.filter(function(a){return a.resolution===t.x})[0])||(u=p.lods.filter(function(a){return a.resolution>t.x}).sort(function(a,b){return a.resolution>b.resolution?
1:-1})[0]):(u=p.lods.filter(function(a){return Math.abs(a.scale-h.maxScale)<x})[0])||(u=p.lods.filter(function(a){return a.scale>h.maxScale}).sort(function(a,b){return a.scale>b.scale?1:-1})[0]),t.x=t.y=u.resolution,l.width=Math.ceil((r.xmax-r.xmin)/t.x-.1),l.height=Math.ceil((r.ymax-r.ymin)/t.y-.1));u||(u=B);y=p.lodAt(Math.min.apply(null,p.lods.map(function(a){return a.level})));0!==h.minScale&&"Raster"!==this.tileType&&(w=p.lods.filter(function(a){return Math.abs(a.scale-h.minScale)<x})[0],this._levelOffset=
w.level-y.level);w||(w=y);D=Math.max(t.x,t.y);if(Math.abs(t.x-t.y)>x||!p.lods.some(function(a){return Math.abs(a.resolution-D)<x}))t.x=t.y=u.resolution,l.width=Math.ceil((r.xmax-r.xmin)/t.x-.1),l.height=Math.ceil((r.ymax-r.ymin)/t.y-.1);T=u.level-w.level;Q=p.size;I=Q[0];W=Q[1];K=p.origin;O=t.x;U=t.y;aa=[{minCol:Math.floor((r.xmin-K.x+.1*O)/I/O),maxCol:Math.floor((r.xmax-K.x-.1*O)/I/O),minRow:Math.floor((K.y-r.ymax+.1*U)/W/U),maxRow:Math.floor((K.y-r.ymin-.1*U)/W/U)}];if(0<T)for(Y=0;Y<T;Y++)O*=2,U*=
2,aa.push({minCol:Math.floor((r.xmin-K.x+.1*O)/I/O),maxCol:Math.floor((r.xmax-K.x-.1*O)/I/O),minRow:Math.floor((K.y-r.ymax+.1*U)/W/O),maxRow:Math.floor((K.y-r.ymin-.1*U)/W/O)});l.storageInfo=new n({blockWidth:p.size[0],blockHeight:p.size[1],pyramidBlockWidth:p.size[0],pyramidBlockHeight:p.size[1],compression:p.format,origin:p.origin,firstPyramidLevel:1,maximumPyramidLevel:T,tileInfo:p,blockBoundary:aa});this._set("rasterInfo",l)}else throw new f("image-server-raster:open","cannot initialize image service");
-1<h.capabilities.toLowerCase().indexOf("tilemap")&&(ba={tileInfo:l.storageInfo.tileInfo,parsedUrl:C.urlToObject(this.url),url:this.url,tileServers:[],type:"tile"},this._tilemapCache=new m.TilemapCache({layer:ba}));return[2]}})})};k.prototype.fetchRawTile=function(a,c,d,e){void 0===e&&(e={});return b(this,void 0,void 0,function(){var b,f,g,h,m,k,l,n,p,q,r,x,u,A,w,E,B,v,y,C,D,ba;return z(this,function(F){switch(F.label){case 0:return b=this.rasterInfo,f=b.storageInfo,g=b.extent,h=b.pixelSize,m=f.maximumPyramidLevel-
a+this._levelOffset,k=this.url+"/tile/"+m+"/"+c+"/"+d,l=this._slices?{sliceId:e.sliceId||0}:null,[4,this.request({url:k,query:l,responseType:"array-buffer"},e.signal)];case 1:return(n=F.sent())?[4,this.decodePixelBlock(n,{width:f.tileInfo.size[0],height:f.tileInfo.size[1],planes:null,pixelType:null,isPoint:"Elevation"===this.tileType})]:[2,null];case 2:p=F.sent();q=f.blockBoundary[a];if("jpg"!==f.compression||d>q.minCol&&d<q.maxCol&&c>q.minRow&&c<q.maxRow)return[2,p];r=f.origin;x=f.blockWidth;u=f.blockHeight;
A=Math.pow(2,a);w=Math.round((g.xmin-r.x)/(h.x*A))%x;E=Math.round((g.xmax-r.x)/(h.x*A))%x;B=Math.round((r.y-g.ymax)/(h.x*A))%u;v=Math.round((r.y-g.ymin)/(h.x*A))%u;y=d===q.minCol?w:0;C=c===q.minRow?B:0;D=d===q.maxCol?E:x;ba=c===q.maxRow?v:u;t.setValidBoundary(p,{x:y,y:C},{width:D-y,height:ba-C});return[2,p]}})})};k.prototype.getSliceIndex=function(a){for(var b=0;b<this._slices.length;b++){var c=this._slices[b].multidimensionalDefinition;if(c.length===a.length&&!c.some(function(b){var c=a.filter(function(a){return b.variableName===
a.variableName&&a.dimensionName===b.dimensionName})[0];if(!c)return null;var d=Array.isArray(b.values[0])?b.values[0][0]:b.values[0],c=Array.isArray(c.values[0])?c.values[0][0]:c.values[0];return d!==c}))return b}return null};k.prototype.computeBestPyramidLevelForLocation=function(a,c){void 0===c&&(c={});return b(this,void 0,void 0,function(){var b,d,e,f,g,h;return z(this,function(m){switch(m.label){case 0:if(!this._tilemapCache)return[2,0];b=this.identifyPixelLocation(a,0,c.datumTransformation);
if(null===b)return[2,null];d=0;e=this.rasterInfo.storageInfo.maximumPyramidLevel;f=e-d+this._levelOffset;g=b.srcLocation;m.label=1;case 1:if(!(0<=f))return[3,6];m.label=2;case 2:return m.trys.push([2,4,,5]),[4,this._tilemapCache.fetchAvailability(f,b.row,b.col,c)];case 3:return h=m.sent(),"available"===h?[3,6]:[3,5];case 4:return m.sent(),[3,5];case 5:return f--,d++,b=this.identifyPixelLocation(g,d,c.datumTransformation),null===b?[2,null]:[3,1];case 6:return-1===f||null==b?[2,null]:[2,d]}})})};k.prototype._fetchRasterInfo=
function(e){return b(this,void 0,void 0,function(){var b,f,g,m,k,l,n,p,r,t,x,w,B=this;return z(this,function(q){b=this.sourceJSON;f=Math.ceil((b.extent.xmax-b.extent.xmin)/b.pixelSizeX-.1);g=Math.ceil((b.extent.ymax-b.extent.ymin)/b.pixelSizeY-.1);m=a.SpatialReference.fromJSON(b.spatialReference||b.extent.spatialReference);if("Map"===this.tileType)return[2,new h({width:f,height:g,bandCount:3,extent:a.Extent.fromJSON(b.extent),spatialReference:m,pixelSize:new a.Point({x:b.pixelSizeX,y:b.pixelSizeY,
spatialReference:m}),pixelType:"u8",statistics:null})];k=e.slice;l=e.signal;n=b.hasRasterAttributeTable?d(this.url+"/rasterAttributeTable",{query:{slice:k,f:"json"},signal:l}).then(function(a){return u.fromJSON(a.data)}).catch(function(){return null}):!1;p=b.hasColormap?d(this.url+"/colormap",{query:{slice:k,f:"json"},signal:l}).then(function(a){return a.data&&a.data.colormap}):!1;r=b.hasHistograms?d(this.url+"/histograms",{query:{slice:k,f:"json"},signal:l}).then(function(a){return a.data&&a.data.histograms}):
!1;t=d(this.url+"/keyProperties",{query:{f:"json"},signal:l}).then(function(a){return a.data}).catch(function(){});x=b.hasMultidimensions?d(this.url+"/multidimensionalInfo",{query:{f:"json"},signal:l}).then(function(a){return a.data&&a.data.multidimensionalInfo}):!1;w=b.hasMultidimensions?d(this.url+"/slices",{query:{f:"json"},signal:l}).then(function(a){return a.data&&a.data.slices}).catch(function(){}):!1;return[2,c.all([n,p,r,t,x,w]).then(function(c){var d=null;if(b.minValues&&b.minValues.length===
b.bandCount)for(var d=[],e=0;e<b.minValues.length;e++)d.push({min:b.minValues[e],max:b.maxValues[e],avg:b.meanValues[e],stddev:b.stdvValues[e]});B._slices=c[5]||null;return new h({width:f,height:g,bandCount:b.bandCount,extent:a.Extent.fromJSON(b.extent),spatialReference:m,pixelSize:new a.Point({x:b.pixelSizeX,y:b.pixelSizeY,spatialReference:m}),pixelType:b.pixelType.toLowerCase(),statistics:d,attributeTable:c[0]||null,colormap:c[1]||null,histograms:c[2]||null,keyProperties:c[3]||null,multidimensionalInfo:c[4]||
null})})]})})};l([y.property({type:String,json:{write:!0}})],k.prototype,"datasetFormat",void 0);l([y.property()],k.prototype,"sourceJSON",void 0);l([y.property()],k.prototype,"tileType",void 0);return k=l([y.subclass("esri.layers.support.rasterDatasets.ImageServerRaster")],k)}(y.declared(w))})},"esri/layers/support/TilemapCache":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../request ../../core/Accessor ../../core/Error ../../core/Handles ../../core/Logger ../../core/LRUCache ../../core/PooledArray ../../core/promiseUtils ../../core/scheduling ../../core/urlUtils ../../core/watchUtils ../../core/accessorSupport/decorators ./Tilemap".split(" "),
function(D,e,z,l,b,p,k,a,d,f,g,c,C,y,h,n,v,m,w,t){Object.defineProperty(e,"__esModule",{value:!0});e.TILEMAP_SIZE_EXP=5;var u=c.getLogger("esri.layers.support.TilemapCache");D=function(c){function d(b){b=c.call(this,b)||this;b._handles=new g;b._pendingTilemapRequests={};b._availableLevels={};b.levels=5;b.cacheByteSize=2097152;b.request=a;b._prefetchingEnabled=!0;return b}l(d,c);r=d;d.prototype.initialize=function(){var a=this;this._tilemapCache=new C(this.cacheByteSize);this._handles.add([this.watch(["layer.parsedUrl",
"layer.tileServers?"],function(){return a._initializeTilemapDefinition()}),m.init(this,"layer.tileInfo.lods",function(b){return a._initializeAvailableLevels(b)},!0)]);this._initializeTilemapDefinition()};d.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null)};d.prototype.castLevels=function(a){return 2>=a?(u.error("Minimum levels for Tilemap is 3, but got ",a),3):a};Object.defineProperty(d.prototype,"size",{get:function(){return 1<<this.levels},enumerable:!0,configurable:!0});
d.prototype.fetchTilemap=function(a,b,c,d){var e=this;if(!this._availableLevels[a])return h.reject(new f("tilemap-cache:level-unavailable","Level "+a+" is unavailable in the service"));var g=this._tmpTilemapDefinition;if(a=this._tilemapFromCache(a,b,c,g))return h.resolve(a);var m=d&&d.signal;d=z({},d,{signal:null});return h.create(function(a,b){h.onAbort(m,function(){return b(h.createAbortError())});var c=t.tilemapDefinitionId(g),f=e._pendingTilemapRequests[c];if(!f){var f=t.Tilemap.fromDefinition(g,
d).then(function(a){e._tilemapCache.put(c,a,a.byteSize);return a}),k=function(){return delete e._pendingTilemapRequests[c]};e._pendingTilemapRequests[c]=f;f.then(k,k)}f.then(a,b)})};d.prototype.getAvailability=function(a,b,c){return this._availableLevels[a]?(a=this._tilemapFromCache(a,b,c,this._tmpTilemapDefinition))?a.getAvailability(b,c):"unknown":"unavailable"};d.prototype.getAvailabilityUpsample=function(a,b,c,d){d.level=a;d.row=b;d.col=c;a=this.layer.tileInfo;for(a.updateTileInfo(d);;)if(b=this.getAvailability(d.level,
d.row,d.col),"unavailable"===b){if(!a.upsampleTile(d))return"unavailable"}else return b};d.prototype.fetchAvailability=function(a,b,c,d){return this._availableLevels[a]?this.fetchTilemap(a,b,c,d).catch(function(a){return a}).then(function(d){if(d instanceof t.Tilemap)return d=d.getAvailability(b,c),"unavailable"===d?h.reject(new f("tile-map:tile-unavailable","Tile is not available",{level:a,row:b,col:c})):d;if(h.isAbortError(d))throw d;return"unknown"}):h.reject(new f("tilemap-cache:level-unavailable",
"Level "+a+" is unavailable in the service"))};d.prototype.fetchAvailabilityUpsample=function(a,b,c,d,e){var f=this;d.level=a;d.row=b;d.col=c;var g=this.layer.tileInfo;g.updateTileInfo(d);var m=this.fetchAvailability(a,b,c,e).catch(function(a){if(h.isAbortError(a))throw a;if(g.upsampleTile(d))return f.fetchAvailabilityUpsample(d.level,d.row,d.col,d);throw a;});this._fetchAvailabilityUpsamplePrefetch(d.id,a,b,c,e,m);return m};d.prototype._fetchAvailabilityUpsamplePrefetch=function(a,b,c,d,e,f){return k(this,
void 0,void 0,function(){var g,m,k,l,q,t,x,u,w,A;return p(this,function(p){switch(p.label){case 0:if(!this._prefetchingEnabled)return[2];g="prefetch-"+a;if(this._handles.has(g))return[2];m=h.createAbortController();f.then(function(){return m.abort()},function(){return m.abort()});k=!1;l={remove:function(){k||(k=!0,m.abort())}};this._handles.add(l,g);p.label=1;case 1:return p.trys.push([1,3,,4]),[4,n.waitTicks(10,m.signal)];case 2:return p.sent(),[3,4];case 3:return p.sent(),[3,4];case 4:k||(k=!0,
this._handles.remove(g));if(h.isAborted(m))return[2];q={id:a,level:b,row:c,col:d};t=z({},e,{signal:m.signal});x=this.layer.tileInfo;u=function(a){var b=w.fetchAvailability(q.level,q.row,q.col,t);r._prefetches.push(b);a=function(){r._prefetches.removeUnordered(b)};b.then(a,a)};w=this;for(A=0;r._prefetches.length<r._maxPrefetch&&x.upsampleTile(q);++A)u(A);return[2]}})})};d.prototype._initializeTilemapDefinition=function(){if(this.layer.parsedUrl){var a=this.layer.parsedUrl,b=a.query;this._tilemapCache.clear();
this._tmpTilemapDefinition={service:{url:a.path,query:b?v.objectToQuery(b):null,tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}};d.prototype._tilemapFromCache=function(a,b,c,d){a=this._getTilemapDefinition(a,b,c,d);a=t.tilemapDefinitionId(a);return this._tilemapCache.get(a)};d.prototype._getTilemapDefinition=function(a,b,c,d){d.level=a;a=a>e.TILEMAP_SIZE_EXP;d.row=a?b-b%this.size:b;d.col=a?c-c%this.size:c;return d};
d.prototype._initializeAvailableLevels=function(a){var b=this;this._availableLevels={};a&&a.forEach(function(a){return b._availableLevels[a.level]=!0})};Object.defineProperty(d.prototype,"test",{get:function(){var a=this;return{get prefetchingEnabled(){return a._prefetchingEnabled},set prefetchingEnabled(b){a._prefetchingEnabled=b},hasTilemap:function(b,c,d){return!!a._tilemapFromCache(b,c,d,a._tmpTilemapDefinition)}}},enumerable:!0,configurable:!0});var r;d._maxPrefetch=4;d._prefetches=new y({initialSize:r._maxPrefetch});
b([w.property({constructOnly:!0,type:Number})],d.prototype,"levels",void 0);b([w.cast("levels")],d.prototype,"castLevels",null);b([w.property({readOnly:!0,dependsOn:["levels"],type:Number})],d.prototype,"size",null);b([w.property({constructOnly:!0,type:Number})],d.prototype,"cacheByteSize",void 0);b([w.property({constructOnly:!0})],d.prototype,"layer",void 0);b([w.property({constructOnly:!0})],d.prototype,"request",void 0);return d=r=b([w.subclass("esri.layers.support.TilemapCache")],d)}(w.declared(d));
e.TilemapCache=D})},"esri/layers/support/Tilemap":function(){define("require exports ../../core/tsSupport/assignHelper ../../request ../../core/arrayUtils ../../core/Error ../../core/lang".split(" "),function(D,e,z,l,b,p,k){function a(a){var b;"vector-tile"===a.service.type?b=a.service.url+"/tilemap/"+a.level+"/"+a.row+"/"+a.col+"/"+a.width+"/"+a.height:(b=a.service.tileServers,b=(b&&b.length?b[a.row%b.length]:a.service.url)+"/tilemap/"+a.level+"/"+a.row+"/"+a.col+"/"+a.width+"/"+a.height);(a=a.service.query)&&
(b=b+"?"+a);return b}Object.defineProperty(e,"__esModule",{value:!0});D=function(){function d(){this.location={left:0,top:0,width:0,height:0};this._allAvailability="unknown";this.byteSize=40}d.prototype.getAvailability=function(a,b){if("unknown"!==this._allAvailability)return this._allAvailability;a=(a-this.location.top)*this.location.width+(b-this.location.left);b=a>>3;var c=this._tileAvailabilityBitSet;return 0>b||b>c.length?"unknown":c[b]&1<<a%8?"available":"unavailable"};d.prototype._updateFromData=
function(a){for(var b=!0,c=!0,d=new Uint8Array(Math.ceil(this.location.width*this.location.height/8)),e=0,f=0;f<a.length;f++){var k=f%8;a[f]?(c=!1,d[e]|=1<<k):b=!1;7===k&&++e}c?this._allAvailability="unavailable":b?this._allAvailability="available":(this._allAvailability="unknown",this._tileAvailabilityBitSet=d,this.byteSize+=d.length)};d.fromDefinition=function(e,g){var c=e.service.request||l,f=e.row,k=e.col,h=e.width,n=e.height,v={query:{f:"json"}};g=g?z({},v,g):v;return c(a(e),g).then(function(a){return a.data}).catch(function(a){if(a&&
a.details&&422===a.details.httpStatus)return{location:{top:f,left:k,width:h,height:n},valid:!0,data:b.constant(h*n,0)};throw a;}).then(function(a){if(a.location&&(a.location.top!==f||a.location.left!==k||a.location.width!==h||a.location.height!==n))throw new p("tilemap:location-mismatch","Tilemap response for different location than requested",{response:a,definition:{top:f,left:k,width:h,height:n}});return d.fromJSON(a)})};d.fromJSON=function(a){d.validateJSON(a);var b=new d;b.location=Object.freeze(k.clone(a.location));
b._updateFromData(a.data);return Object.freeze(b)};d.validateJSON=function(a){if(!a||!a.location)throw new p("tilemap:missing-location","Location missing from tilemap response");if(!1===a.valid)throw new p("tilemap:invalid","Tilemap response was marked as invalid");if(!a.data)throw new p("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(a.data))throw new p("tilemap:data-mismatch","Data must be an array of numbers");if(a.data.length!==a.location.width*a.location.height)throw new p("tilemap:data-mismatch",
"Number of data items does not match width/height of tilemap");};return d}();e.Tilemap=D;e.tilemapDefinitionId=function(a){return a.level+"/"+a.row+"/"+a.col+"/"+a.width+"/"+a.height};e.tilemapDefinitionUrl=a;e.default=D})},"esri/layers/support/rasterDatasets/MRFRaster":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/declareExtendsHelper ../../../geometry ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators ../PixelBlock ../RasterInfo ../RasterStorageInfo ./BaseRaster ./xmlUtilities".split(" "),
function(D,e,z,l,b,p,k,a,d,f,g,c,C,y,h,n){var v=function(){var a=new ArrayBuffer(4),b=new Uint8Array(a);(new Uint32Array(a))[0]=1;return 1===b[0]}(),m=new Map;m.set("Int8","s8");m.set("UInt8","u8");m.set("Int16","s16");m.set("UInt16","u16");m.set("Int32","s32");m.set("UInt32","u32");m.set("Float32","f32");m.set("Float64","f32");m.set("Double64","f32");var w=new Map;w.set("lerc",".lrc");w.set("none",".til");w.set("deflate",".pzp");w.set("jpeg",".jzp");return function(e){function h(){var a=null!==e&&
e.apply(this,arguments)||this;a._files=null;a._storageIndex=null;return a}p(h,e);h.prototype.open=function(a){return b(this,void 0,void 0,function(){var b,c,e,f,g,h,m,k,l,n,p,t,x,u,w,v,y,C,D,I,W;return z(this,function(q){switch(q.label){case 0:return[4,this.init()];case 1:return q.sent(),this.datasetName=this.url.slice(this.url.lastIndexOf("/")+1),b=a?d.unwrap(a.signal):null,[4,this.request({url:this.url,responseType:"xml"},b)];case 2:return c=q.sent(),e=this._parseHeader(c),f=e.rasterInfo,g=e.files,
this._set("rasterInfo",f),this._files=g,[4,this.request({url:g.index,responseType:"array-buffer"},b)];case 3:h=q.sent();this._storageIndex=this._parseIndex(h);m=0;k=-1;p=this.rasterInfo.storageInfo;t=p.blockWidth;x=p.blockHeight;u=p.compression;w=this.rasterInfo.storageInfo.pyramidScalingFactor;v=this.rasterInfo;y=v.width;C=v.height;D=v.bandCount;I=[];for(W="none"===u?1:D;m<this._storageIndex.length;)k++,l=Math.ceil(y/t/Math.pow(w,k)),n=Math.ceil(C/x/Math.pow(w,k)),m+=l*n*W*4,I.push({maxRow:n,maxCol:l,
minCol:0,minRow:0});this.rasterInfo.storageInfo.blockBoundary=I;0<k&&(this.rasterInfo.storageInfo.firstPyramidLevel=1,this.rasterInfo.storageInfo.maximumPyramidLevel=k);return[2]}})})};h.prototype.fetchRawTile=function(a,d,e,g){void 0===g&&(g={});return b(this,void 0,void 0,function(){var b,h,m,k,l,n,p,q,r,t,x,u,w,v,B,y,C,D,K,O,U,aa,Y,ba,Z,ca;return z(this,function(A){switch(A.label){case 0:b=this.rasterInfo.storageInfo;h=b.blockWidth;m=b.blockHeight;k=b.blockBoundary;l=b.compression;n=k[a];if(!n||
n.maxRow<d||n.maxCol<e||n.minRow>d||n.minCol>e)return[2,null];p=this.rasterInfo;q=p.bandCount;r=p.pixelType;t=this._getTileLocation(a,d,e);x=t.ranges;u=t.actualTileWidth;w=t.actualTileHeight;if(!x||0===x.length)return[2,null];if(0===x[0].from&&0===x[0].to)return v=new Uint8Array(h*m),[2,new c({width:h,height:m,pixels:null,mask:v,validPixelCount:0})];B=this.ioConfig.bandIds;y="none"===l?1:q;C=[];for(D=D=0;D<y;D++)(!B||-1<B.indexOf[D])&&C.push(this.request({url:this._files.data,range:{from:x[D].from,
to:x[D].to},responseType:"array-buffer"},g.signal));return[4,f.all(C)];case 1:K=A.sent();O=K.map(function(a){return a.byteLength}).reduce(function(a,b){return a+b});U=new Uint8Array(O);for(D=aa=0;D<y;D++)U.set(new Uint8Array(K[D]),aa),aa+=K[D].byteLength;Y="lerc"===this.rasterInfo.storageInfo.compression?"lerc":"bip";return[4,this.decodePixelBlock(U.buffer,{width:h,height:m,format:Y,pixelType:r})];case 2:ba=A.sent();ca=Z=0;if(u!==h||w!==m)if(v=ba.mask)for(D=0;D<m;D++)for(ca=D*h,Z=D<w?u:0;Z<h;Z++)v[ca+
Z]=0;else for(v=new Uint8Array(h*m),ba.mask=v,D=0;D<w;D++)for(ca=D*h,Z=0;Z<u;Z++)v[ca+Z]=1;return[2,ba]}})})};h.prototype._parseIndex=function(a){if(0<a.byteLength%16)throw"invalid array buffer must be multiples of 16";var b,c,d,e,f;if(v){b=new Uint8Array(a);d=new ArrayBuffer(a.byteLength);c=new Uint8Array(d);for(e=0;e<a.byteLength/4;e++)for(f=0;4>f;f++)c[4*e+f]=b[4*e+3-f];a=new Uint32Array(d)}else a=new Uint32Array(a);return a};h.prototype._getTileLocation=function(a,b,c){var d=this.rasterInfo.storageInfo,
e=d.blockWidth,f=d.blockHeight,g=d.pyramidScalingFactor,h=this.rasterInfo,m=h.width,k=h.height,h=h.bandCount,d="none"===d.compression?1:h,l,n,p=0,r=0;for(n=0;n<a;n++)r=Math.pow(g,n),h=Math.ceil(m/e/r),l=Math.ceil(k/f/r),p+=h*l;r=Math.pow(g,a);h=Math.ceil(m/e/r);l=Math.ceil(k/f/r);p=4*(p+(b*h+c))*d;a=this._storageIndex.subarray(p,p+4*d);n=g=0;for(var p=[],t=0;t<d;t++)g=a[4*t+0]*Math.pow(2,32)+a[4*t+1],n=g+a[4*t+2]*Math.pow(2,32)+a[4*t+3],p.push({from:g,to:n});return{ranges:p,actualTileWidth:c<h-1?
e:Math.ceil(m/r)-e*(h-1),actualTileHeight:b<l-1?f:Math.ceil(k/r)-f*(l-1)}};h.prototype._parseHeader=function(b){var c=n.getElement(b,"MRF_META/Raster");if(!c)throw new a("mrf:open","not a valid MRF format");var d=n.getElement(c,"Size"),e=parseInt(d.getAttribute("x"),10),f=parseInt(d.getAttribute("y"),10),g=parseInt(d.getAttribute("c"),10),d=(n.getElementValue(c,"Compression")||"none").toLowerCase(),h=["none","lerc"];if(!d||-1===h.indexOf(d))throw new a("mrf:open","currently does not support compression "+
d);var l=n.getElementValue(c,"DataType")||"UInt8",h=m.get(l);if(null==h)throw new a("mrf:open","currently does not support pixel type "+l);var p=n.getElement(c,"PageSize"),l=parseInt(p.getAttribute("x"),10),p=parseInt(p.getAttribute("y"),10),c=n.getElement(c,"DataValues"),t;c&&(c=c.getAttribute("NoData"),null!=c&&(t=c.trim().split(" ").map(function(a){return parseFloat(a)})));if(n.getElement(b,"MRF_META/CachedSource"))throw new a("mrf:open","currently does not support MRF referencing other data files");
var u=n.getElement(b,"MRF_META/GeoTags"),x=n.getElement(u,"BoundingBox");if(null==x)throw new a("mrf:open","missing node MRF_META/GeoTags/BoundingBox");var c=parseFloat(x.getAttribute("minx")),v=parseFloat(x.getAttribute("miny")),z=parseFloat(x.getAttribute("maxx")),D=parseFloat(x.getAttribute("maxy")),L=n.getElementValue(u,"Projection"),u=n.getElementValue(b,"datafile"),x=n.getElementValue(b,"IndexFile"),M;"LOCAL_CS[]"!==L&&(M=new k.SpatialReference({wkt:L}));L=new k.Extent(c,v,z,D);L.spatialReference=
M;b=n.getElement(b,"MRF_META/Rsets");b=parseInt(b&&b.getAttribute("scale")||"2",10);b=new y({origin:new k.Point({x:L.xmin,y:L.ymax,spatialReference:M}),blockWidth:l,blockHeight:p,pyramidBlockWidth:l,pyramidBlockHeight:p,compression:d,pyramidScalingFactor:b});l=new k.Point({x:(z-c)/e,y:(D-v)/f,spatialReference:M});e=new C({width:e,height:f,extent:L,spatialReference:M,bandCount:g,pixelType:h,pixelSize:l,noDataValue:t,storageInfo:b});f={mrf:this.url,index:x||this.url.replace(".mrf",".idx"),data:u||this.url.replace(".mrf",
w.get(d))};return{rasterInfo:e,files:f}};l([g.property()],h.prototype,"_files",void 0);l([g.property()],h.prototype,"_storageIndex",void 0);l([g.property({type:String,json:{write:!0}})],h.prototype,"datasetFormat",void 0);return h=l([g.subclass("esri.layers.support.rasterIO.MRFRaster")],h)}(g.declared(h))})},"esri/layers/support/rasterDatasets/xmlUtilities":function(){define(["require","exports"],function(D,e){function z(b,e){if(!b||!e)return[];var k=e;-1<e.indexOf("/")?(k=e.slice(0,e.indexOf("/")),
e=e.slice(e.indexOf("/")+1)):e="";b=e?l(b,k).getElementsByTagNameNS("*",e):b.getElementsByTagNameNS("*",k);if(!b||0===b.length)return[];e=[];for(k=0;k<b.length;k++)e.push(b[k]||b.item[k]);return e}function l(b,e){if(!b||!e)return null;var k=e;-1<e.indexOf("/")?(k=e.slice(0,e.indexOf("/")),e=e.slice(e.indexOf("/")+1)):e="";b=z(b,k);return 0<b.length?e?l(b[0],e):b[0]:null}Object.defineProperty(e,"__esModule",{value:!0});e.getElements=z;e.getElement=l;e.getElementValue=function(b,e){if(b=l(b,e))if(b=
b.textContent||b.nodeValue||b.innerText)return b.trim();return null};e.getElementValues=function(b,e){b=z(b,e);e=[];for(var k,a=0;a<b.length;a++)if(k=b[a].textContent||b[a].nodeValue||b[a].innerText)k=k.trim(),""!==k&&e.push(k);return e}})},"esri/layers/support/rasterDatasets/TIFFRaster":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/assignHelper ../../../geometry ../../../core/Error ../../../core/maybe ../../../core/accessorSupport/decorators ../RasterInfo ../RasterStorageInfo ./BaseRaster ../rasterFormats/TiffDecoder ../rasterFormats/TiffTags".split(" "),
function(D,e,z,l,b,p,k,a,d,f,g,c,C,y,h,n){var v=function(a,b){return(a=a.get(b))&&a.values},m=function(a,b){return(a=a.get(b))&&a.values[0]};return function(e){function t(){var a=null!==e&&e.apply(this,arguments)||this;a._files=null;a._headerInfo=null;a._bufferSize=1048576;return a}p(t,e);t.prototype.open=function(e){return b(this,void 0,void 0,function(){var b,g,m,l,n,p,t,u,w,v,y,D,J,V,X,L,M,R,T,Q,I,W,K,O,U,aa,Y;return z(this,function(q){switch(q.label){case 0:return[4,this.init()];case 1:return q.sent(),
b=e?f.unwrap(e.signal):null,[4,this.request({url:this.url,range:{from:0,to:this._bufferSize},responseType:"array-buffer"},b)];case 2:g=q.sent();if(!g)throw new d("tiffraster:open","failed to open url "+this.url);this.datasetName=this.url.slice(this.url.lastIndexOf("/")+1);m=h.parseSignature(g);l=m.littleEndian;n=m.firstIFD;p=[];return[4,this.readIFDs(p,g,l,n,0,4,b)];case 3:q.sent();t=h.getImageInfo(p);u=t.width;w=t.height;v=t.tileWidth;y=t.tileHeight;D=t.planes;J=t.pixelType;V=t.compression;X=t.firstPyramidLevel;
L=t.maximumPyramidLevel;M=t.pyramidBlockWidth;R=t.pyramidBlockHeight;T=t.tileBoundary;Q=t.metadata;I=a.Extent.fromJSON(t.extent);W=I.spatialReference;K=I?new a.Point({x:I.xmin,y:I.ymax,spatialReference:W}):new a.Point({x:0,y:0});O=new C({blockWidth:v,blockHeight:y,pyramidBlockWidth:M,pyramidBlockHeight:R,compression:V,origin:K,firstPyramidLevel:X,maximumPyramidLevel:L,blockBoundary:T});U=new a.Point({x:(I.xmax-I.xmin)/u,y:(I.ymax-I.ymin)/w,spatialReference:W});aa=Q?{BandProperties:Q.bandProperties,
DataType:Q.dataType}:null;Y=new c({width:u,height:w,bandCount:D,pixelType:J,compression:V,pixelSize:U,storageInfo:O,spatialReference:W,keyProperties:aa,extent:I,statistics:Q?Q.statistics:null});this._set("rasterInfo",Y);this._headerInfo=k({littleEndian:l,ifds:p},t);if(!this._headerInfo.isSupported)throw new d("tiffraster:open","this tiff is not supported: "+this._headerInfo.message);return[2]}})})};t.prototype.fetchRawTile=function(a,c,d,e){void 0===e&&(e={});return b(this,void 0,void 0,function(){var b,
f,g,h,m,k,l,n,p,t,r,u,x,w,v;return z(this,function(q){switch(q.label){case 0:if(!this._headerInfo&&this._headerInfo.isSupported)return[2,null];b=this.rasterInfo.storageInfo.blockBoundary;f=0<a?this.rasterInfo.storageInfo.pyramidBlockWidth:this.rasterInfo.storageInfo.blockWidth;g=0<a?this.rasterInfo.storageInfo.pyramidBlockHeight:this.rasterInfo.storageInfo.blockHeight;h=b[a];if(!h||h.maxRow<c||h.maxCol<d||h.minRow>c||h.minCol>d)return[2,null];m=this.getTileLocation(a,c,d);if(!m)return[2,null];k=m.range;
l=m.actualTileWidth;n=m.actualTileHeight;p=m.ifd;return[4,this.request({url:this.url,range:k,responseType:"array-buffer"},e.signal)];case 1:return t=q.sent(),[4,this.decodePixelBlock(t,{format:"tiff",customOptions:{headerInfo:this._headerInfo,ifd:p,offset:0,size:0},width:f,height:g,planes:null,pixelType:null})];case 2:r=q.sent();if(l!==f||n!==g)if(v=r.mask)for(u=0;u<g;u++)for(w=u*f,x=u<n?l:0;x<f;x++)v[w+x]=0;else for(v=new Uint8Array(f*g),r.mask=v,u=0;u<n;u++)for(w=u*f,x=0;x<l;x++)v[w+x]=1;return[2,
r]}})})};t.prototype.readIFDs=function(a,c,d,e,f,g,h){void 0===g&&(g=4);return b(this,void 0,void 0,function(){var b;return z(this,function(m){switch(m.label){case 0:return e?e>=c.byteLength||0>e?[4,this.request({url:this.url,range:{from:e+f,to:e+f+this._bufferSize},responseType:"array-buffer"},h)]:[3,2]:[2,null];case 1:c=m.sent(),f=e+f,e=0,m.label=2;case 2:return[4,this.readIFD(c,d,e,f,n.TIFF_TAGS,g,h)];case 3:return b=m.sent(),a.push(b.ifd),b.nextIFD?[4,this.readIFDs(a,c,d,b.nextIFD-f,f,g,h)]:[2,
null];case 4:return m.sent(),[2]}})})};t.prototype.readIFD=function(a,c,d,e,f,g,m){void 0===f&&(f=n.TIFF_TAGS);void 0===g&&(g=4);return b(this,void 0,void 0,function(){var b,k,l,p,q,t,r,u,x;return z(this,function(w){switch(w.label){case 0:if(!a)return[2,null];b=h.parseIFD(a,c,d,e,f,g);if(!b.success)return[3,5];k=[];b.ifd.forEach(function(a){a.values||k.push(a)});if(!(0<k.length))return[3,2];l=k.map(function(a){return a.offlineOffsetSize});p=Math.min.apply(null,l.map(function(a){return a[0]}));q=Math.min.apply(null,
l.map(function(a){return a[0]+a[1]}));return q-p<=this._bufferSize?[4,this.request({url:this.url,range:{from:p,to:p+this._bufferSize},responseType:"array-buffer"},m)]:[3,2];case 1:a=w.sent(),e=p,k.forEach(function(b){return h.parseFieldValues(a,c,b,e)}),w.label=2;case 2:if(!b.ifd.has("GEOKEYDIRECTORY"))return[3,4];t=b.ifd.get("GEOKEYDIRECTORY");r=t.values;if(!(r&&4<r.length))return[3,4];u=r[0]+"."+r[1]+"."+r[2];return[4,this.readIFD(a,c,t.valueOffset+6-e,e,n.GEO_KEYS,2,m)];case 3:x=w.sent(),t.data=
x.ifd,t.data&&t.data.set("GEOTIFFVersion",{id:0,type:2,valueCount:1,valueOffset:null,values:[u]}),w.label=4;case 4:return[2,b];case 5:return b.requiredBufferSize&&b.requiredBufferSize!==a.byteLength?[4,this.request({url:this.url,range:{from:e,to:e+b.requiredBufferSize+4},responseType:"array-buffer"},m)]:[3,7];case 6:return a=w.sent(),a.byteLength<b.requiredBufferSize?[2,null]:[2,this.readIFD(a,c,0,e,n.TIFF_TAGS,4,m)];case 7:return[2]}})})};t.prototype.getTileLocation=function(a,b,c){var d=this.rasterInfo.storageInfo,
e=d.firstPyramidLevel,f=d.blockBoundary,g=0===a?0:a-(e-1);a=this._headerInfo.ifds[g];if(!a)return null;d=v(a,"TILEOFFSETS");if(void 0===d)return null;var e=v(a,"TILEBYTECOUNTS"),g=f[g],h=g.minRow,k=g.minCol,f=g.maxRow,g=g.maxCol;if(b>f||c>g||b<h||c<k)return null;var h=m(a,"IMAGEWIDTH"),k=m(a,"IMAGELENGTH"),l=m(a,"TILEWIDTH"),n=m(a,"TILELENGTH"),p=b*(g+1)+c,d=d[p],e=e[p];return null==d||null==e?null:{range:{from:d,to:d+e-1},ifd:a,actualTileWidth:c===g?h%l:l,actualTileHeight:b===f?k%n:n}};l([g.property()],
t.prototype,"_files",void 0);l([g.property()],t.prototype,"_headerInfo",void 0);l([g.property()],t.prototype,"_bufferSize",void 0);l([g.property({type:String,json:{write:!0}})],t.prototype,"datasetFormat",void 0);return t=l([g.subclass("esri.layers.support.rasterDatasets.TIFFRaster")],t)}(g.declared(y))})},"esri/renderers/support/RasterSymbolizer":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../rasterRenderers ../../core/JSONSupport ../../core/Logger ../../core/accessorSupport/decorators ../../layers/support/RasterInfo ../../layers/support/rasterFunctions/pixelUtils ../support/colorRampUtils".split(" "),
function(D,e,z,l,b,p,k,a,d,f,g,c,C,y){var h=f.getLogger("esri.renderers.support.RasterSymbolizer");return function(d){function e(a){return d.call(this,a)||this}l(e,d);e.prototype.readRenderer=function(b,c,d){return a.read(b,d)};e.prototype.bind=function(){this.lookup={};if(!this.renderer)return!1;var a;switch(this.renderer.type){case "unique-value":a=this._updateUVRenderer(this.renderer);break;case "raster-colormap":a=this._updateColormapRenderer(this.renderer);break;case "raster-stretch":a=this._updateStretchRenderer(this.renderer);
break;case "class-breaks":a=this._updateClassBreaksRenderer(this.renderer)}return a};e.prototype.symbolize=function(a){if(!this.isValidPixelBlock(a))return a;try{3<a.pixels.length&&(a=C.extractBands(a,[0,1,2]));var b=void 0;switch(this.renderer.type){case "unique-value":case "raster-colormap":b=this._symbolize_colormap(a);break;case "class-breaks":b=this._symbolize_classBreaks(a);break;case "raster-stretch":b=this._symbolize_stretch(a)}return b}catch(t){return h.error("symbolize",t.message),a}};e.prototype.simpleStretch=
function(a,b){if(!this.isValidPixelBlock(a))return a;try{return 3<a.pixels.length&&(a=C.extractBands(a,[0,1,2])),C.stretch(a,b)}catch(t){return h.error("symbolize",t.message),a}};e.prototype.generateWebGLParameters=function(a){if(-1<["unique-value","raster-colormap","class-breaks"].indexOf(this.renderer.type)){var b=this.lookup.lut;return{colormap:b.indexedColormap,colormapOffset:b.colormapOffset,type:"lut"}}var c=this.renderer,d=b=null,e=this.lookup&&this.lookup.colorRampLut;c.colorRamp&&e&&(b=e.indexedColormap,
d=e.offset);var e=c.gamma,f=c.useGamma,g=this.getStretchCutoff(c,a),c=g.minCutOff,h=g.maxCutOff,k=g.outMin,g=g.outMax;a&&a.pixels&&2===a.pixels.length&&(a=a.clone(),a.statistics=[a.statistics[0]],a.pixels=[a.pixels[0]]);a=Math.min(3,a&&a.getPlaneCount()||this.rasterInfo.bandCount);var m=new Float32Array(a),l=null==b?255:1,n;for(n=0;n<a;n++)m[n]=(g-k)/(h[n]-c[n])/l;var p=new Float32Array(a);if(f)for(n=0;n<a;n++)p[n]=1<e[n]?2<e[n]?6.5+Math.pow(e[n]-2,2.5):6.5+100*Math.pow(2-e[n],4):1;return{bandCount:a,
outMin:k/l,outMax:g/l,minCutOff:c,maxCutOff:h,factor:m,useGamma:f,gamma:f?e:[1,1,1],gammaCorrection:f?p:[1,1,1],colormap:b,colormapOffset:d,type:"stretch"}};e.prototype._isLUTChanged=function(a){if(!this.lookup)return!0;if("raster-stretch"===this.renderer.type){var b=this.renderer.colorRamp;if(a)return JSON.stringify(b.toJSON())!==JSON.stringify(this.lookup.rendererJson.colorRamp);a=z({},this.renderer.toJSON());b=z({},this.lookup.rendererJson);a.colorRamp=null;b.colorRamp=null}return JSON.stringify(this.renderer.toJSON())!==
JSON.stringify(this.lookup.rendererJson)};e.prototype._symbolize_colormap=function(a){return this._isLUTChanged()&&!this.bind()?a:C.colorize(a,this.lookup.lut)};e.prototype._symbolize_classBreaks=function(a){var b=-1<["u8","u16","s8","s16"].indexOf(this.rasterInfo.pixelType);return this._isLUTChanged()&&!this.bind()?a:b?C.colorize(a,this.lookup.lut):C.remapColor(a,this.lookup.lut)};e.prototype._symbolize_stretch=function(a){var b=this.rasterInfo.pixelType,c=this.renderer,d=-1<["u8","u16","s8","s16"].indexOf(b),
e=c.gamma,f=c.useGamma;if(d){if(c.dynamicRangeAdjustment)d=this.getStretchCutoff(c,a),b=C.createStretchLUT(z({pixelType:b},d,{gamma:f?e:null}));else{if(this._isLUTChanged()&&(e=this.bind(),!e))return a;b=this.lookup?this.lookup.lut:null}if(!b)return a;b=C.lookupPixels(a,b)}else d=this.getStretchCutoff(c,a),b=C.stretch(a,z({},d,{gamma:f?e:null}));if(c.colorRamp){if(this._isLUTChanged(!0)&&(e=this.bind(),!e))return a;b=C.colorize(b,this.lookup.colorRampLut)}return b};e.prototype._updateUVRenderer=function(a){var b=
this.rasterInfo,c=b.bandCount,d=b.attributeTable,e=b.statistics,b=-1<["u8","s8"].indexOf(b.pixelType)&&e&&null!=e[0].min&&null!=e[0].max;if(1!==c||!d&&!b)return!1;var f=a.field;if(!f)return!1;var g=[];if(d){var h=d.fields.filter(function(a){return"value"===a.name.toLowerCase()})[0];if(!h)return!1;d.features.forEach(function(b){var c=a.uniqueValueInfos.filter(function(a){return String(a.value)===String(b.attributes[f])})[0];(c=c&&c.symbol&&c.symbol.color)&&g.push([b.attributes[h.name],c.r,c.g,c.b,
1<c.a?c.a:Math.round(255*c.a)])})}else{if("Value"!==f.toLowerCase())return!1;a.uniqueValueInfos.forEach(function(a){var b=a&&a.symbol&&a.symbol.color;b&&g.push([parseInt(a.value,10),b.r,b.g,b.b,1<b.a?b.a:Math.round(255*b.a)])})}if(0===g.length)return!1;c=C.createColormapLUT({colormap:g});this.lookup={rendererJson:a.toJSON(),lut:c};return this.canRenderInWebGL=!0};e.prototype._updateColormapRenderer=function(a){var b=a.extractColormap();if(!b||0===b.length)return!1;b=C.createColormapLUT({colormap:b});
this.lookup={rendererJson:a.toJSON(),lut:b};return this.canRenderInWebGL=!0};e.prototype._updateClassBreaksRenderer=function(a){var b=-1<["u8","u16","s8","s16"].indexOf(this.rasterInfo.pixelType),c=a.classBreakInfos;if(!c||0===c.length)return!1;var d=c.sort(function(a,b){return a.minValue-b.minValue}),c=d[d.length-1];if(!b)return b=d.map(function(a){return{value:a.minValue,mappedColor:[a.symbol.color.r,a.symbol.color.g,a.symbol.color.b,1<a.symbol.color.a?a.symbol.color.a:Math.round(255*a.symbol.color.a)]}}),
b.push({value:c.maxValue,mappedColor:[c.symbol.color.g,c.symbol.color.b,1<c.symbol.color.a?c.symbol.color.a:Math.round(255*c.symbol.color.a)]}),this.lookup={rendererJson:a.toJSON(),lut:b},this.canRenderInWebGL=!1,!0;var e=[],f,g=0;d.forEach(function(a){f=Math.ceil(a.minValue);g=Math.floor(a.maxValue);for(var b=f;b<g;b++)e.push([b,a.symbol.color.r,a.symbol.color.g,a.symbol.color.b,1<a.symbol.color.a?a.symbol.color.a:Math.round(255*a.symbol.color.a)])});e.push([c.maxValue,c.symbol.color.r,c.symbol.color.g,
c.symbol.color.b,1<c.symbol.color.a?c.symbol.color.a:Math.round(255*c.symbol.color.a)]);b=C.createColormapLUT({colormap:e,fillUnspecified:!1});this.lookup={rendererJson:a.toJSON(),lut:b};return this.canRenderInWebGL=!0};e.prototype._updateStretchRenderer=function(a){if(!(a.statistics||this.rasterInfo.statistics||a.dynamicRangeAdjustment))return!1;var b=a.histograms||this.rasterInfo.histograms;if(!a.dynamicRangeAdjustment&&"percent-clip"===a.stretchType&&!b)return!1;var c=a.gamma,d=a.useGamma,b=a.colorRamp,
e=this.rasterInfo.pixelType;if(!a.dynamicRangeAdjustment&&-1<["u8","u16","s8","s16"].indexOf(e)){var f=this.getStretchCutoff(a),c=C.createStretchLUT(z({pixelType:e},f,{gamma:d?c:null}));this.lookup={rendererJson:a.toJSON(),lut:c}}b&&(b=y.convertColorRampToColormap(b,256),this.lookup.colorRampLut=C.createColormapLUT({colormap:b}),this.lookup.rendererJson=a.toJSON());return this.canRenderInWebGL=!0};e.prototype.getStretchCutoff=function(a,b){var c,d,e=a.stretchType;a.dynamicRangeAdjustment?"min-max"===
e&&b.statistics?c=b.statistics.map(function(a){return[a.minValue,a.maxValue,0,0]}):(d=C.estimateStatisticsHistograms(b),c=d.statistics,d=d.histograms):(c=a.statistics&&0<a.statistics.length?a.statistics:this.rasterInfo.statistics,d=a.histograms||this.rasterInfo.histograms);b=c||d?(c||d).length:this.rasterInfo.bandCount;var f=[],g=[],h,k,l,n,m,p;c[0]instanceof Array||(c=c.map(function(a){return[a.min,a.max,a.avg,a.stddev]}));switch(e){case "min-max":for(e=0;e<b;e++)f[e]=c[e][0],g[e]=c[e][1];break;
case "standard-deviation":for(e=0;e<b;e++)f[e]=c[e][2]-a.numberOfStandardDeviations*c[e][3],g[e]=c[e][2]+a.numberOfStandardDeviations*c[e][3],f[e]<c[e][0]&&(f[e]=c[e][0]),g[e]>c[e][1]&&(g[e]=c[e][1]);break;case "percent-clip":for(e=0;e<b;e++){c=d[e];n=new Uint32Array(c.size);l=c.counts;k=0;h=(c.max-c.min)/c.size;m=-.5===c.min&&1===h?.5:0;for(p=0;p<c.size;p++)k+=l[p],n[p]=k;l=a.minPercent*k/100;for(p=0;p<c.size;p++)if(n[p]>l){f[e]=c.min+h*(p+m);break}l=(1-a.maxPercent/100)*k;for(p=c.size-2;0<=p;p--)if(n[p]<
l){g[e]=c.min+h*(p+2-m);break}}break;default:for(e=0;e<b;e++)f[e]=c[e][0],g[e]=c[e][1]}return{minCutOff:f,maxCutOff:g,outMax:a.outputMax||255,outMin:a.outputMin||0}};e.prototype.isValidPixelBlock=function(a){return!!(a&&a.pixels&&0<a.pixels.length&&0!==a.validPixelCount)};b([g.property({types:a.rasterRendererTypes,json:{write:!0}})],e.prototype,"renderer",void 0);b([g.reader("renderer")],e.prototype,"readRenderer",null);b([g.property({type:c,json:{write:!0}})],e.prototype,"rasterInfo",void 0);b([g.property({json:{write:!0}})],
e.prototype,"lookup",void 0);b([g.property({})],e.prototype,"canRenderInWebGL",void 0);return e=b([g.subclass("esri.renderers.support.RasterSymbolizer")],e)}(g.declared(d.JSONSupport))})},"*noref":1}});
define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/generatorHelper ../core/tsSupport/awaiterHelper ../geometry ../PopupTemplate ../rasterRenderers ../core/Error ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/accessorSupport/decorators ../core/accessorSupport/ensureType ./Layer ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./support/commonProperties ./support/DimensionalDefinition ./support/Field ./support/imageryRendererUtils ./support/RasterJobHandler ./support/TileInfo ./support/rasterDatasets/RasterFactory ../renderers/support/RasterSymbolizer ../support/popupUtils".split(" "),function(D,
e,z,l,b,p,k,a,d,f,g,c,C,y,h,n,v,m,w,t,u,x,B,r,q,A,E,F,H,G){return function(e){function m(a,b){a=e.call(this,a)||this;a._rasterJobHandler={instance:null,refCount:0,connectionPromise:null};a._symbolizer=null;a.bandIds=null;a.fullExtent=null;a.interpolation="nearest";a.isReference=null;a.listMode="show";a.raster=null;a.rasterInfo=null;a.spatialReference=null;a.tileInfo=null;a.title=null;a.type="imagery-tile";a.url=null;a.operationalLayerType="ArcGISTiledImageServiceLayer";a.popupEnabled=!0;a.popupTemplate=
null;return a}l(m,e);m.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?z({url:a},b):a};m.prototype.load=function(a){var b=this,d=c.isSome(a)?a.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"]},a).then(function(){return b._openRaster(d)},function(){return b._openRaster(d)}));return y.resolve(this)};Object.defineProperty(m.prototype,"multidimensionalDefinition",{set:function(a){this.raster&&(this._sliceId=this.raster.getSliceIndex(a));this._set("multidimensionalDefinition",
a)},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"defaultPopupTemplate",{get:function(){return this.createPopupTemplate()},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"fields",{get:function(){return[new r({name:"Raster.PixelValue",alias:"Pixel Value",domain:null,editable:!1,length:50,type:"string"})]},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"renderer",{set:function(a){this._set("renderer",a);this.updateRenderer()},enumerable:!0,
configurable:!0});m.prototype.readRenderer=function(a,b,c){a=f.read(b&&b.layerDefinition&&b.layerDefinition.drawingInfo&&b.layerDefinition.drawingInfo.renderer,c)||void 0;if(null!=a)return a};m.prototype.createPopupTemplate=function(a){return G.createPopupTemplate(this,a)};m.prototype.updateRenderer=function(){return k(this,void 0,void 0,function(){var a;return p(this,function(b){switch(b.label){case 0:if(!this.loaded||JSON.stringify(this._cachedRendererJson)===JSON.stringify(this.renderer))return[2];
a=this._rasterJobHandler.instance;if(!a)return[2];this._symbolizer.renderer=this.renderer;this._symbolizer.bind();return[4,a.updateSymbolizer(this._symbolizer)];case 1:return b.sent(),this._cachedRendererJson=this.renderer.toJSON(),[2]}})})};m.prototype.applyRenderer=function(a,b){return k(this,void 0,void 0,function(){var c,d,e;return p(this,function(f){switch(f.label){case 0:if(!(a&&a.pixels&&0<a.pixels.length))return[2,null];c=b&&this.renderer&&"raster-stretch"===this.renderer.type;this.updateRenderer();
return(e=this._rasterJobHandler.instance)?c?[4,e.stretch({pixelBlock:a,stretchParams:b})]:[3,2]:[3,5];case 1:return d=f.sent(),[3,4];case 2:return[4,e.symbolize(a)];case 3:d=f.sent(),f.label=4;case 4:return[3,6];case 5:d=c?this._symbolizer.simpleStretch(a,b):this._symbolizer.symbolize(a),f.label=6;case 6:return[2,d]}})})};m.prototype.fetchTile=function(a,b,c,d){void 0===d&&(d={});return k(this,void 0,void 0,function(){var e;return p(this,function(f){switch(f.label){case 0:return[4,this._initJobHandler()];
case 1:return f.sent(),this.multidimensionalDefinition&&(e=this._sliceId,d=z({multidimensionalDefinition:this.multidimensionalDefinition,sliceId:e},d)),[2,this.raster.fetchTile(a,b,c,d)]}})})};m.prototype.fetchPixels=function(a,b,c,d){return k(this,void 0,void 0,function(){var e;return p(this,function(f){switch(f.label){case 0:return[4,this._initJobHandler()];case 1:return f.sent(),this.multidimensionalDefinition&&(e=this._sliceId,d=z({multidimensionalDefinition:this.multidimensionalDefinition,sliceId:e},
d)),[2,this.raster.fetchPixels(a,b,c,d)]}})})};m.prototype.identify=function(a,b){void 0===b&&(b={});return this.raster.identify(a,b)};m.prototype.increaseRasterJobHandlerUsage=function(){this._rasterJobHandler.refCount++};m.prototype.decreaseRasterJobHandlerUsage=function(){this._rasterJobHandler.refCount--;0>=this._rasterJobHandler.refCount&&this._shutdownJobHandler()};m.prototype._initJobHandler=function(){var a=this;if(null!=this._rasterJobHandler.connectionPromise)return this._rasterJobHandler.connectionPromise;
var b=new A;this._rasterJobHandler.connectionPromise=b.initialize().then(function(){a._rasterJobHandler.instance=b;a.raster.rasterJobHandler=b;a.renderer&&a.updateRenderer()}).catch(function(){return null});return this._rasterJobHandler.connectionPromise};m.prototype._shutdownJobHandler=function(){this._rasterJobHandler.instance&&this._rasterJobHandler.instance.destroy();this._rasterJobHandler.instance=null;this._rasterJobHandler.connectionPromise=null;this._rasterJobHandler.refCount=0;this.raster.rasterJobHandler=
null};m.prototype._openRaster=function(a){return k(this,void 0,void 0,function(){var b,c,d,e,f,h,k,l,m,n,q;return p(this,function(p){switch(p.label){case 0:return[4,F.open(this.raster||{url:this.url,signal:a})];case 1:b=p.sent();this.url||(this.url=b.url);this.raster=b;c=b.rasterInfo;if(!c)throw new g("tile-imagery-layer:load","cannot load resources on "+this.url);d=c.spatialReference;e=c.pixelSize;f=c.storageInfo;h=f.tileInfo;if(!h){k=[];l=f.maximumPyramidLevel||0;m=Math.max(e.x,e.y);n=1/.0254*96*
m;for(q=0;q<=l;q++)k.push({level:l-q,resolution:m,scale:n}),m*=2,n*=2;h=new E({origin:f.origin,size:[f.blockWidth,f.blockHeight],spatialReference:d,lods:k});f.tileInfo=h}null==this.title&&(this.title=this.raster.datasetName);c.multidimensionalInfo&&(this._configDefaultSlice(),this._sliceId=this.raster.getSliceIndex(this.multidimensionalDefinition));this._configDefaultRenderer();return[2,b]}})})};m.prototype._configDefaultSlice=function(){var a=this.raster.rasterInfo.multidimensionalInfo.variables[0],
b=[];a.dimensions.forEach(function(c){b.push(new B({variableName:a.name,dimensionName:c.name,values:c.values[0],isSlice:!0}))});this.multidimensionalDefinition=b};m.prototype._configDefaultRenderer=function(){var a=this.raster.rasterInfo,b=a.pixelType;this.bandIds||(this.bandIds=q.getDefaultBandCombination(a));this.renderer||(this.renderer=q.createDefaultRenderer(a,this.bandIds));"u8"===b&&this.renderer&&"stretchType"in this.renderer&&"min-max"===this.renderer.stretchType&&this.renderer.dynamicRangeAdjustment&&
(this.renderer.dynamicRangeAdjustment=!1,this.renderer.statistics=this.renderer.statistics||[[0,255],[0,255],[0,255]]);this._symbolizer?(this._symbolizer.renderer=this.renderer,this._symbolizer.rasterInfo=a):this._symbolizer=new H({renderer:this.renderer,rasterInfo:a});this._symbolizer.bind()||(this._symbolizer=null)};b([h.property()],m.prototype,"_cachedRendererJson",void 0);b([h.property()],m.prototype,"_sliceId",void 0);b([h.property()],m.prototype,"_rasterJobHandler",void 0);b([h.property()],
m.prototype,"_symbolizer",void 0);b([h.property({type:[n.Integer],json:{write:!0}})],m.prototype,"bandIds",void 0);b([h.property({type:a.Extent}),h.aliasOf("rasterInfo.extent")],m.prototype,"fullExtent",void 0);b([h.property({type:String,json:{write:!0}})],m.prototype,"interpolation",void 0);b([h.property({type:Boolean,json:{read:!1}})],m.prototype,"isReference",void 0);b([h.property({type:["show","hide"]})],m.prototype,"listMode",void 0);b([h.property({type:[B]})],m.prototype,"multidimensionalDefinition",
null);b([h.property()],m.prototype,"raster",void 0);b([h.property({readOnly:!0}),h.aliasOf("raster.rasterInfo")],m.prototype,"rasterInfo",void 0);b([h.property({type:a.SpatialReference}),h.aliasOf("rasterInfo.spatialReference")],m.prototype,"spatialReference",void 0);b([h.property({type:E,dependsOn:["rasterInfo"]}),h.aliasOf("rasterInfo.storageInfo.tileInfo")],m.prototype,"tileInfo",void 0);b([h.property()],m.prototype,"title",void 0);b([h.property({readOnly:!0,json:{read:!1}})],m.prototype,"type",
void 0);b([h.property(x.url)],m.prototype,"url",void 0);b([h.property({type:["ArcGISTiledImageServiceLayer"]})],m.prototype,"operationalLayerType",void 0);b([h.property(x.popupEnabled)],m.prototype,"popupEnabled",void 0);b([h.property({type:d,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],m.prototype,"popupTemplate",void 0);b([h.property({readOnly:!0,dependsOn:["title"]})],m.prototype,"defaultPopupTemplate",null);b([h.property({readOnly:!0,type:[r]})],m.prototype,"fields",null);b([h.property({types:f.rasterRendererTypes,
json:{read:{source:"layerDefinition.drawingInfo.renderer"},write:{target:"layerDefinition.drawingInfo.renderer"}}})],m.prototype,"renderer",null);b([h.reader("renderer")],m.prototype,"readRenderer",null);return m=b([h.subclass("esri.layers.TileImageryLayer")],m)}(h.declared(u.ScaleRangeLayer(t.RefreshableLayer(m.OperationalLayer(w.PortalLayer(C.MultiOriginJSONMixin(v)))))))});