// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.15/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/valuesHelper ../../../../core/Error ../../OptimizedFeature ../../OptimizedGeometry".split(" "),function(K,r,x,L,y,z,D,E){function F(b){var a=[];b.forEach(function(b){return a.push(b)});return a}function C(b){var a,d,c,g;return x(this,function(e){switch(e.label){case 0:a=b.type;switch(a){case "Feature":return[3,1];case "FeatureCollection":return[3,3]}return[3,7];case 1:return[4,
b];case 2:return e.sent(),[3,7];case 3:d=0,c=b.features,e.label=4;case 4:return d<c.length?(g=c[d])?[4,g]:[3,6]:[3,7];case 5:e.sent(),e.label=6;case 6:return d++,[3,4];case 7:return[2]}})}function G(b){var a,d,c,g,e,h,k,f,m,q;return x(this,function(l){switch(l.label){case 0:if(!b)return[2,null];a=b.type;switch(a){case "Point":return[3,1];case "LineString":return[3,3];case "MultiPoint":return[3,3];case "MultiLineString":return[3,5];case "Polygon":return[3,5];case "MultiPolygon":return[3,10]}return[3,
17];case 1:return[4,b.coordinates];case 2:return l.sent(),[3,17];case 3:return[5,y(b.coordinates)];case 4:return l.sent(),[3,17];case 5:d=0,c=b.coordinates,l.label=6;case 6:if(!(d<c.length))return[3,9];g=c[d];return[5,y(g)];case 7:l.sent(),l.label=8;case 8:return d++,[3,6];case 9:return[3,17];case 10:e=0,h=b.coordinates,l.label=11;case 11:if(!(e<h.length))return[3,16];k=h[e];f=0;m=k;l.label=12;case 12:if(!(f<m.length))return[3,15];q=m[f];return[5,y(q)];case 13:l.sent(),l.label=14;case 14:return f++,
[3,12];case 15:return e++,[3,11];case 16:return[3,17];case 17:return[2]}})}function H(b,a){var d,c,g,e,h,k,f,m,q,l;void 0===a&&(a={});return x(this,function(n){switch(n.label){case 0:d=a.geometryType,c=a.objectIdFieldName,n.label=1;case 1:g=b.next();e=g.value;if(h=g.done)return[2];k=e.geometry;f=e.properties;m=e.id;if(k&&A[k.type]!==d)return[3,1];q=f||{};c&&null!=m&&(q[c]=m);l=new D.default(k?I(new E.default,k,a):null,q);return[4,l];case 2:return n.sent(),[3,1];case 3:return[2]}})}function J(b){for(;;){var a=
b.next();if(a.done)return!1;if(2<a.value.length)return!0}}function u(b){for(var a=0,d=0;d<b.length;d++)var c=b[d],g=b[(d+1)%b.length],a=a+(c[0]*g[1]-g[0]*c[1]);return 0>=a}function v(b){var a=b[0],d=b[b.length-1];a[0]===d[0]&&a[1]===d[1]&&a[2]===d[2]||b.push(a);return b}function I(b,a,d){switch(a.type){case "LineString":return n(b,a.coordinates,d),b;case "MultiLineString":var c=0;for(a=a.coordinates;c<a.length;c++)n(b,a[c],d);return b;case "MultiPoint":return n(b,a.coordinates,d),b;case "MultiPolygon":c=
0;for(a=a.coordinates;c<a.length;c++){var g=a[c],e=b,h=d,k=v(g[0]);u(k)?n(e,k,h):w(e,k,h);for(e=1;e<g.length;e++){var h=b,k=d,f=v(g[e]);u(f)?w(h,f,k):n(h,f,k)}}return b;case "Point":return B(b,a.coordinates,d),b;case "Polygon":c=a.coordinates;a=v(c[0]);u(a)?n(b,a,d):w(b,a,d);for(a=1;a<c.length;a++)g=b,e=d,h=v(c[a]),u(h)?w(g,h,e):n(g,h,e);return b}}function n(b,a,d){for(var c=0;c<a.length;c++)B(b,a[c],d);b.lengths.push(a.length)}function w(b,a,d){for(var c=a.length-1;0<=c;c--)B(b,a[c],d);b.lengths.push(a.length)}
function B(b,a,d){var c=a[2];b.coords.push(a[0],a[1]);d.hasZ&&b.coords.push(c||0)}Object.defineProperty(r,"__esModule",{value:!0});var A={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};r.validateGeoJSON=function(b){if(!b)throw new z("geojson-layer:empty","GeoJSON data is empty");if("Feature"!==b.type&&"FeatureCollection"!==b.type)throw new z("geojson-layer:unsupported-geojson-object",
"missing or not supported GeoJSON object type",{data:b});if(b.crs){var a=b.crs;if("link"===a.type||!["crs84","4326"].some(function(b){return-1!==a.properties.name.toLowerCase().indexOf(b)}))throw new z("geojson-layer:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:a});}};r.inferLayerProperties=function(b,a){void 0===a&&(a={});var d=C(b),c=[],g=new Set,e=new Set,h=!1,k=Number.NEGATIVE_INFINITY,f=null,n=!1,q=void 0;b=a.geometryType;var l=void 0===b?null:b,r=!1;for(b=function(){var a=d.next(),
b=a.value;if(a.done){var p=f&&1===f.length&&f[0]||null;if(p)for(b=0;b<c.length;b++)a=c[b],a.name===p&&(a.type="esriFieldTypeOID");return{value:{fields:c,geometryType:l,hasZ:h,maxObjectId:Math.max(0,k),objectIdFieldName:p,objectIdFieldType:q,unknownFields:F(e)}}}var a=b.geometry,m=b.properties,t=b.id;if(a&&(l||(l=A[a.type]),A[a.type]!==l))return"continue";h||(b=G(a),h=J(b));!n&&(n=null!=t)&&(q=typeof t,"number"===q&&(f=Object.keys(m).filter(function(a){return m[a]===t})));n&&"number"===q&&null!=t&&
(k=Math.max(k,t),1<f.length?f=f.filter(function(a){return m[a]===t}):1===f.length&&(f=m[f[0]]===t?f:[]));if(!r&&m){b=!0;for(p in m)if(!g.has(p))if(a=m[p],null==a)b=!1,e.add(p);else{a:switch(typeof a){case "string":a="esriFieldTypeString";break a;case "number":a="esriFieldTypeDouble";break a;default:a="unknown"}"unknown"===a?e.add(p):(e.delete(p),g.add(p),c.push({name:p,alias:p,type:a}))}r=b}};;)if(a=b(),"object"===typeof a)return a.value};r.createOptimizedFeatures=function(b,a){a:for(b=H(C(b),a),
a=[];;){var d=b.next(),c=d.value;if(d.done)break a;a.push(c)}return a}});