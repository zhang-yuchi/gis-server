// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.15/esri/copyright.txt for details.
//>>built
require({cache:{"esri/core/accessorSupport/originUtils":function(){define(["require","exports","../MultiOriginJSONSupport"],function(q,c,m){Object.defineProperty(c,"__esModule",{value:!0});c.updateOrigins=function(e){e&&e.writtenProperties&&e.writtenProperties.forEach(function(e){var c=e.target;e.newOrigin&&e.oldOrigin!==e.newOrigin&&m.isMultiOriginJSONMixin(c)&&c.updateOrigin(e.propName,e.newOrigin)})}})},"esri/support/webSceneUtils":function(){define(["require","exports","../core/Error"],function(q,
c,m){Object.defineProperty(c,"__esModule",{value:!0});c.createCopyError=function(){return new m("webscene:failed-to-copy-embedded-resources","Copying of embedded resources is currently not supported")};c.isCopyError=function(e){return e&&"webscene:failed-to-copy-embedded-resources"===e.name};c.createSchemaValidationError=function(e){return new m("webscene:schema-validation","Failed to save webscene due to schema validation errors. See 'details.errors' for more detailed information",{errors:e})};c.isSchemaValidationError=
function(e){return e&&"webscene:schema-validation"===e.name}})},"esri/views/3d/support/projectionUtils":function(){define("require exports ../../../core/mathUtils ../../../core/maybe ../../../core/unitUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../layers/graphics/dehydratedFeatures ./earthUtils ../webgl-engine/lib/BufferVectorMath".split(" "),
function(q,c,m,e,n,h,k,g,p,a,b,d,f,l){function P(a,b,f,d){2===a.length?(u[0]=a[0],u[1]=a[1],u[2]=0,a=u):a===f&&(k.vec3.copy(u,a),a=u);return r(a,b,0,f,d,0,1)}function r(a,b,f,d,l,z,r){void 0===r&&(r=1);b=O(b,l,Y);if(e.isNone(b))return!1;if(b===D){if(a===d&&f===z)return!0;for(b=f+3*r;f<b;f++,z++)d[z]=a[f];return!0}for(r=f+3*r;f<r;f+=3,z+=3)b(a,f,d,z);return!0}function R(a,b){if(b.spatialReference===a)return b.spatialReferenceId;b.spatialReference=a;"metersPerUnit"in b&&(b.metersPerUnit=n.getMetersPerUnitForSR(a,
1));return a.wkt===c.SphericalECEFSpatialReference.wkt?b.spatialReferenceId=1:a.isWGS84?b.spatialReferenceId=2:a.isWebMercator?b.spatialReferenceId=3:a.wkt===c.WGS84ECEFSpatialReference.wkt?b.spatialReferenceId=4:4490===a.wkid?b.spatialReferenceId=5:b.spatialReferenceId=0}function D(a,b,f,d){f[d++]=a[b++];f[d++]=a[b++];f[d]=a[b]}function V(a,b,d,l){d[l++]=T*(a[b++]/f.earthRadius);d[l++]=T*(Math.PI/2-2*Math.atan(Math.exp(-1*a[b++]/f.earthRadius)));d[l]=a[b]}function X(a,b,d,l){var J=.4999999*Math.PI,
J=m.clamp(S*a[b+1],-J,J),J=Math.sin(J);d[l++]=S*a[b]*f.earthRadius;d[l++]=f.halfEarthRadius*Math.log((1+J)/(1-J));d[l]=a[b+2]}function Z(a,b,f){b=R(b,F);b=N[b][6];if(e.isNone(b))return!1;b(a,0,u,0);f!==u&&(f[0]=u[0],f[1]=u[1],2<f.length&&(f[2]=u[2]));return!0}function E(a,b){u[0]=a.x;u[1]=a.y;u[2]=a.hasZ?a.z:0;return Z(u,a.spatialReference,b)}function C(a,b,d,l){var J=f.earthRadius+a[b+2],z=S*a[b+1];a=S*a[b];b=Math.cos(z);d[l++]=Math.cos(a)*b*J;d[l++]=Math.sin(a)*b*J;d[l]=Math.sin(z)*J}function t(a,
b,d,z){var J=l.Vec3Compact.length(a,b),e=m.asinClamped(a[b+2]/(0===J?1:J));a=Math.atan2(a[b+1],a[b]);d[z++]=T*a;d[z++]=T*e;d[z]=J-f.earthRadius}function A(a,b,f,d){var l=aa,J=S*a[b],z=S*a[b+1];a=a[b+2];b=Math.sin(z);var z=Math.cos(z),e=l.a/Math.sqrt(1-l.e2*b*b);f[d++]=(e+a)*z*Math.cos(J);f[d++]=(e+a)*z*Math.sin(J);f[d++]=(e*(1-l.e2)+a)*b}function v(a,b,f,d){var l=aa,z=a[b],e=a[b+1];a=a[b+2];var J,r,Q,c,P,da;b=Math.abs(a);J=z*z+e*e;r=Math.sqrt(J);Q=J+a*a;c=Math.sqrt(Q);z=Math.atan2(e,z);P=a*a/Q;Q=
J/Q;e=l.a2/c;J=l.a3-l.a4/c;.3<Q?(P=b/c*(1+Q*(l.a1+e+P*J)/c),c=Math.asin(P),e=P*P,Q=Math.sqrt(1-e)):(Q=r/c*(1-P*(l.a5-e-Q*J)/c),c=Math.acos(Q),e=1-Q*Q,P=Math.sqrt(e));da=1-l.e2*e;e=l.a/Math.sqrt(da);l=l.a6*e;e=r-e*Q;J=b-l*P;b=Q*e+P*J;r=Q*J-P*e;l=r/(l/da+b);c+=l;0>a&&(c=-c);f[d++]=T*z;f[d++]=T*c;f[d]=b+r*l/2}function O(a,b,f){void 0===f&&(f=w());return B(a,b,f).projector}function B(a,b,f){if(f.source.spatialReference===a&&f.dest.spatialReference===b)return f;var d=R(a,f.source),l=R(b,f.dest);0===d&&
0===l?a.equals(b)?f.projector=D:f.projector=null:f.projector=N[d][l];return f}function w(){return{source:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},projector:D}}Object.defineProperty(c,"__esModule",{value:!0});var x,y,G,K,H,M,I,L;c.SphericalECEFSpatialReference=new a({wkt:'GEOCCS["Spherical geocentric",\n  DATUM["Not specified",\n    SPHEROID["Sphere",\' + earthUtils.earthRadius + \',0]],\n  PRIMEM["Greenwich",0.0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",EAST],\n  AXIS["Geocentric Z",NORTH]\n]'});
c.WGS84ECEFSpatialReference=new a({wkt:'GEOCCS["WGS 84",\n  DATUM["WGS_1984",\n    SPHEROID["WGS 84",6378137,298.257223563,\n      AUTHORITY["EPSG","7030"]],\n    AUTHORITY["EPSG","6326"]],\n  PRIMEM["Greenwich",0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0,\n    AUTHORITY["EPSG","9001"]],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",OTHER],\n  AXIS["Geocentric Z",NORTH],\n  AUTHORITY["EPSG","4978"]\n]'});c.canProject=function(a,b){return!!O(a,b,Y)};c.vectorToVector=P;c.pointToPoint=
function(a,b,f,d){void 0===f&&(f=b.spatialReference);void 0===d&&(d=0);u[0]=a.x;u[1]=a.y;var l=a.z;u[2]=void 0!==l?l:d;if(!r(u,a.spatialReference,0,u,f,0,1))return!1;b.x=u[0];b.y=u[1];b.spatialReference=f;void 0!==l?(b.z=u[2],b.hasZ=!0):(b.z=void 0,b.hasZ=!1);return!0};c.pointToVector=function(a,b,f,d){void 0===d&&(d=0);u[0]=a.x;u[1]=a.y;var l=a.z;u[2]=void 0!==l?l:d;return r(u,a.spatialReference,0,b,f,0,1)};c.vectorToPoint=function(a,b,f,l){f instanceof p?l=l||f.spatialReference:d.isPoint(f)?(f.hasZ=
!0,l=l||f.spatialReference):(l=f,f=new p({spatialReference:l}));return r(a,b,0,u,l,0,1)?(f.x=u[0],f.y=u[1],f.z=u[2],f.spatialReference=l,f):null};c.xyzToVector=function(a,b,f,d,l,e){u[0]=a;u[1]=b;u[2]=f;return r(u,d,0,l,e,0,1)};c.bufferToBuffer=r;c.localLinearScaleFactors=function(a,b,d,l){var e=R(b,F),z=R(l,U);if(e===z&&0!==e||b.equals(l))return d[0]=1,d[1]=1,d[2]=1,!0;if(1===e){b=k.vec3.length(a);a=b/Math.sqrt(a[0]*a[0]+a[1]*a[1]);b/=f.earthRadius;if(3===z)return d[0]=a*b,d[1]=a*b,d[2]=1,!0;if(2===
z||5===z)return z=180/(f.earthRadius*Math.PI),d[0]=z*a*b,d[1]=z*b,d[2]=1,!0}return!1};c.computeLinearTransformation=function(a,b,f,d){var l=R(a,F),r=R(d,U);if(l===r&&1!==r&&(0!==l||a.equals(d)))return h.mat4.identity(f),h.mat4.translate(f,f,b),!0;if(1===r){a=N[l][6];r=N[6][r];if(e.isNone(a)||e.isNone(r))return!1;a(b,0,W,0);r(W,0,z,0);a=S*W[0];r=S*W[1];b=Math.sin(a);a=Math.cos(a);d=Math.sin(r);r=Math.cos(r);f[0]=-b;f[4]=-d*a;f[8]=r*a;f[12]=z[0];f[1]=a;f[5]=-d*b;f[9]=r*b;f[13]=z[1];f[2]=0;f[6]=r;f[10]=
d;f[14]=z[2];f[3]=0;f[7]=0;f[11]=0;f[15]=1;return!0}if(3===r&&(2===l||1===l)){a=N[l][6];if(e.isNone(a))return!1;a(b,0,W,0);b=S*W[1];X(W,0,z,0);h.mat4.identity(f);h.mat4.translate(f,f,z);b=1/Math.cos(b);h.mat4.scale(f,f,[b,b,1]);return!0}return!1};c.transformDirection=function(a,b,f,d,l){k.vec3.copy(ca,a);k.vec3.add(ba,a,b);P(ca,f,ca,l);P(ba,f,ba,l);k.vec3.subtract(d,ba,ca);k.vec3.normalize(d,d)};c.mbsToMbs=function(a,b,d,l){b=B(b,l,ea);if(b.projector===D)return d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=
a[3],!0;if(e.isNone(b.projector))return!1;l=b.source;var z=b.dest;if(3===z.spatialReferenceId){b=N[l.spatialReferenceId][2];if(e.isNone(b))return!1;b(a,0,W,0);b=Math.abs(S*W[1])+Math.asin(a[3]/(f.earthRadius+a[2]));X(W,0,d,0);d[3]=b>.9999*Math.PI?Number.MAX_VALUE:1/Math.cos(b)*a[3];return!0}b.projector(a,0,d,0);d[3]=a[3]*l.metersPerUnit/z.metersPerUnit;return!0};c.extentToBoundingBox=function(a,b,f){if(null==a)return!1;var d;u[0]=null!=a.xmin?a.xmin:0;u[1]=null!=a.ymin?a.ymin:0;u[2]=null!=a.zmin?
a.zmin:0;d=r(u,a.spatialReference,0,b,f,0,1);u[0]=null!=a.xmax?a.xmax:0;u[1]=null!=a.ymax?a.ymax:0;u[2]=null!=a.zmax?a.zmax:0;d=d&&r(u,a.spatialReference,0,b,f,3,1);null==a.xmin&&(b[0]=-Infinity);null==a.ymin&&(b[1]=-Infinity);null==a.zmin&&(b[2]=-Infinity);null==a.xmax&&(b[3]=Infinity);null==a.ymax&&(b[4]=Infinity);null==a.zmax&&(b[5]=Infinity);return d};c.extentToBoundingRect=function(a,b,f){if(null==a)return!1;var d;u[0]=null!=a.xmin?a.xmin:0;u[1]=null!=a.ymin?a.ymin:0;u[2]=null!=a.zmin?a.zmin:
0;d=r(u,a.spatialReference,0,u,f,0,1);b[0]=u[0];b[1]=u[1];u[0]=null!=a.xmax?a.xmax:0;u[1]=null!=a.ymax?a.ymax:0;u[2]=null!=a.zmax?a.zmax:0;d=d&&r(u,a.spatialReference,0,u,f,0,1);b[2]=u[0];b[3]=u[1];null==a.xmin&&(b[0]=-Infinity);null==a.ymin&&(b[1]=-Infinity);null==a.xmax&&(b[2]=Infinity);null==a.ymax&&(b[3]=Infinity);return d};c.boundingRectToBoundingRect=function(a,f,d,l){if(null==a)return!1;if(f.equals(l))return b.set(d,a),!0;u[0]=a[0];u[1]=a[1];u[2]=0;if(!r(u,f,0,u,l,0,1))return!1;d[0]=u[0];d[1]=
u[1];u[0]=a[2];u[1]=a[3];u[2]=0;if(!r(u,f,0,u,l,0,1))return!1;d[2]=u[0];d[3]=u[1];return!0};(function(a){a.x2lon=function(a){return a/f.earthRadius};a.y2lat=function(a){return Math.PI/2-2*Math.atan(Math.exp(-1*a/f.earthRadius))};a.lon2x=function(a){return a*f.earthRadius};a.lat2y=function(a){a=Math.sin(a);return f.earthRadius/2*Math.log((1+a)/(1-a))}})(c.webMercator||(c.webMercator={}));c.canProjectToWGS84ComparableLonLat=function(a){a=R(a,F);return!!N[a][6]};c.vectorToWGS84ComparableLonLat=Z;c.pointToWGS84ComparableLonLat=
E;c.pointToWGS84ComparableLonLatPoint=function(a,b){var f=R(b.spatialReference,U);return e.isNone(N[6][f])?!1:E(a,u)?(b.x=u[0],b.y=u[1],b.z=u[2],!0):!1};c.wgs84ComparableLonLatToECEF=function(a,b,d,l){void 0===l&&(l=0);l=f.earthRadius+l;var z=Math.cos(d);a[0]=Math.cos(b)*z*l;a[1]=Math.sin(b)*z*l;a[2]=Math.sin(d)*l};var N=(x={},x[2]=(y={},y[5]=null,y[6]=D,y[1]=C,y[0]=null,y[3]=X,y[2]=D,y[4]=A,y),x[5]=(G={},G[5]=D,G[6]=D,G[1]=C,G[0]=null,G[3]=null,G[2]=null,G[4]=A,G),x[3]=(K={},K[5]=null,K[6]=V,K[1]=
function(a,b,f,d){V(a,b,f,d);C(f,d,f,d)},K[0]=null,K[3]=D,K[2]=V,K[4]=function(a,b,f,d){V(a,b,f,d);A(f,d,f,d)},K),x[4]=(H={},H[5]=v,H[6]=v,H[1]=function(a,b,f,d){v(a,b,f,d);C(f,d,f,d)},H[0]=null,H[3]=function(a,b,f,d){v(a,b,f,d);X(f,d,f,d)},H[2]=v,H[4]=D,H),x[1]=(M={},M[5]=t,M[6]=t,M[1]=D,M[0]=null,M[3]=function(a,b,f,d){t(a,b,f,d);X(f,d,f,d)},M[2]=t,M[4]=function(a,b,f,d){t(a,b,f,d);A(f,d,f,d)},M),x[0]=(I={},I[5]=null,I[6]=null,I[1]=null,I[0]=D,I[3]=null,I[2]=null,I[4]=null,I),x[6]=(L={},L[5]=null,
L[6]=D,L[1]=C,L[0]=null,L[3]=null,L[2]=D,L[4]=A,L),x);c.getProjector=O;var F={spatialReference:null,spatialReferenceId:0},U={spatialReference:null,spatialReferenceId:0},Y=w(),ea=w(),S=m.deg2rad(1),T=m.rad2deg(1),aa={a:6378137,e2:.006694379990137799,a1:42697.67270715754,a2:1.8230912546075456E9,a3:142.91722289812412,a4:4.557728136518864E9,a5:42840.589930055656,a6:.9933056200098622},u=g.vec3f64.create(),W=g.vec3f64.create(),z=g.vec3f64.create(),ca=g.vec3f64.create(),ba=g.vec3f64.create()})},"esri/core/libs/gl-matrix-2/mat4":function(){define(["require",
"exports","./math/mat4"],function(q,c,m){Object.defineProperty(c,"__esModule",{value:!0});c.mat4=m})},"esri/core/libs/gl-matrix-2/math/mat4":function(){define(["require","exports","../factories/vec3f64","./common"],function(q,c,m,e){function n(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a}function h(a,b,d){var f=b[0],l=b[1],e=b[2],r=b[3],c=b[4],D=b[5],h=b[6],g=b[7],k=b[8],n=b[9],C=b[10],p=b[11],m=b[12],v=b[13],q=b[14];
b=b[15];var B=d[0],w=d[1],x=d[2],y=d[3];a[0]=B*f+w*c+x*k+y*m;a[1]=B*l+w*D+x*n+y*v;a[2]=B*e+w*h+x*C+y*q;a[3]=B*r+w*g+x*p+y*b;B=d[4];w=d[5];x=d[6];y=d[7];a[4]=B*f+w*c+x*k+y*m;a[5]=B*l+w*D+x*n+y*v;a[6]=B*e+w*h+x*C+y*q;a[7]=B*r+w*g+x*p+y*b;B=d[8];w=d[9];x=d[10];y=d[11];a[8]=B*f+w*c+x*k+y*m;a[9]=B*l+w*D+x*n+y*v;a[10]=B*e+w*h+x*C+y*q;a[11]=B*r+w*g+x*p+y*b;B=d[12];w=d[13];x=d[14];y=d[15];a[12]=B*f+w*c+x*k+y*m;a[13]=B*l+w*D+x*n+y*v;a[14]=B*e+w*h+x*C+y*q;a[15]=B*r+w*g+x*p+y*b;return a}function k(a,b,d){var f=
b[0],l=b[1],e=b[2],r=b[3],c=f+f,D=l+l,h=e+e;b=f*c;var g=f*D,f=f*h,k=l*D,l=l*h,e=e*h,c=r*c,D=r*D,r=r*h;a[0]=1-(k+e);a[1]=g+r;a[2]=f-D;a[3]=0;a[4]=g-r;a[5]=1-(b+e);a[6]=l+c;a[7]=0;a[8]=f+D;a[9]=l-c;a[10]=1-(b+k);a[11]=0;a[12]=d[0];a[13]=d[1];a[14]=d[2];a[15]=1;return a}function g(a,b,d){a[0]=b[0]-d[0];a[1]=b[1]-d[1];a[2]=b[2]-d[2];a[3]=b[3]-d[3];a[4]=b[4]-d[4];a[5]=b[5]-d[5];a[6]=b[6]-d[6];a[7]=b[7]-d[7];a[8]=b[8]-d[8];a[9]=b[9]-d[9];a[10]=b[10]-d[10];a[11]=b[11]-d[11];a[12]=b[12]-d[12];a[13]=b[13]-
d[13];a[14]=b[14]-d[14];a[15]=b[15]-d[15];return a}Object.defineProperty(c,"__esModule",{value:!0});c.copy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];a[9]=b[9];a[10]=b[10];a[11]=b[11];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a};c.set=function(a,b,d,f,l,e,r,c,D,h,g,k,n,p,m,A,v){a[0]=b;a[1]=d;a[2]=f;a[3]=l;a[4]=e;a[5]=r;a[6]=c;a[7]=D;a[8]=h;a[9]=g;a[10]=k;a[11]=n;a[12]=p;a[13]=m;a[14]=A;a[15]=v;return a};c.identity=n;c.transpose=
function(a,b){if(a===b){var d=b[1],f=b[2],l=b[3],e=b[6],r=b[7],c=b[11];a[1]=b[4];a[2]=b[8];a[3]=b[12];a[4]=d;a[6]=b[9];a[7]=b[13];a[8]=f;a[9]=e;a[11]=b[14];a[12]=l;a[13]=r;a[14]=c}else a[0]=b[0],a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=b[1],a[5]=b[5],a[6]=b[9],a[7]=b[13],a[8]=b[2],a[9]=b[6],a[10]=b[10],a[11]=b[14],a[12]=b[3],a[13]=b[7],a[14]=b[11],a[15]=b[15];return a};c.invert=function(a,b){var d=b[0],f=b[1],l=b[2],e=b[3],r=b[4],c=b[5],D=b[6],h=b[7],g=b[8],k=b[9],n=b[10],p=b[11],m=b[12],A=b[13],v=b[14];
b=b[15];var q=d*c-f*r,B=d*D-l*r,w=d*h-e*r,x=f*D-l*c,y=f*h-e*c,G=l*h-e*D,K=g*A-k*m,H=g*v-n*m,M=g*b-p*m,I=k*v-n*A,L=k*b-p*A,N=n*b-p*v,F=q*N-B*L+w*I+x*M-y*H+G*K;if(!F)return null;F=1/F;a[0]=(c*N-D*L+h*I)*F;a[1]=(l*L-f*N-e*I)*F;a[2]=(A*G-v*y+b*x)*F;a[3]=(n*y-k*G-p*x)*F;a[4]=(D*M-r*N-h*H)*F;a[5]=(d*N-l*M+e*H)*F;a[6]=(v*w-m*G-b*B)*F;a[7]=(g*G-n*w+p*B)*F;a[8]=(r*L-c*M+h*K)*F;a[9]=(f*M-d*L-e*K)*F;a[10]=(m*y-A*w+b*q)*F;a[11]=(k*w-g*y-p*q)*F;a[12]=(c*H-r*I-D*K)*F;a[13]=(d*I-f*H+l*K)*F;a[14]=(A*B-m*x-v*q)*F;
a[15]=(g*x-k*B+n*q)*F;return a};c.adjoint=function(a,b){var d=b[0],f=b[1],l=b[2],e=b[3],r=b[4],c=b[5],h=b[6],g=b[7],k=b[8],n=b[9],p=b[10],m=b[11],t=b[12],q=b[13],v=b[14];b=b[15];a[0]=c*(p*b-m*v)-n*(h*b-g*v)+q*(h*m-g*p);a[1]=-(f*(p*b-m*v)-n*(l*b-e*v)+q*(l*m-e*p));a[2]=f*(h*b-g*v)-c*(l*b-e*v)+q*(l*g-e*h);a[3]=-(f*(h*m-g*p)-c*(l*m-e*p)+n*(l*g-e*h));a[4]=-(r*(p*b-m*v)-k*(h*b-g*v)+t*(h*m-g*p));a[5]=d*(p*b-m*v)-k*(l*b-e*v)+t*(l*m-e*p);a[6]=-(d*(h*b-g*v)-r*(l*b-e*v)+t*(l*g-e*h));a[7]=d*(h*m-g*p)-r*(l*m-
e*p)+k*(l*g-e*h);a[8]=r*(n*b-m*q)-k*(c*b-g*q)+t*(c*m-g*n);a[9]=-(d*(n*b-m*q)-k*(f*b-e*q)+t*(f*m-e*n));a[10]=d*(c*b-g*q)-r*(f*b-e*q)+t*(f*g-e*c);a[11]=-(d*(c*m-g*n)-r*(f*m-e*n)+k*(f*g-e*c));a[12]=-(r*(n*v-p*q)-k*(c*v-h*q)+t*(c*p-h*n));a[13]=d*(n*v-p*q)-k*(f*v-l*q)+t*(f*p-l*n);a[14]=-(d*(c*v-h*q)-r*(f*v-l*q)+t*(f*h-l*c));a[15]=d*(c*p-h*n)-r*(f*p-l*n)+k*(f*h-l*c);return a};c.determinant=function(a){var b=a[0],d=a[1],f=a[2],l=a[3],e=a[4],c=a[5],h=a[6],g=a[7],k=a[8],n=a[9],p=a[10],m=a[11],q=a[12],t=a[13],
A=a[14];a=a[15];return(b*c-d*e)*(p*a-m*A)-(b*h-f*e)*(n*a-m*t)+(b*g-l*e)*(n*A-p*t)+(d*h-f*c)*(k*a-m*q)-(d*g-l*c)*(k*A-p*q)+(f*g-l*h)*(k*t-n*q)};c.multiply=h;c.translate=function(a,b,d){var f=d[0],l=d[1];d=d[2];var e=void 0,c=void 0,h=void 0,g=void 0,k=void 0,n=void 0,p=void 0,m=void 0,q=void 0,t=void 0,A=void 0,v=void 0;b===a?(a[12]=b[0]*f+b[4]*l+b[8]*d+b[12],a[13]=b[1]*f+b[5]*l+b[9]*d+b[13],a[14]=b[2]*f+b[6]*l+b[10]*d+b[14],a[15]=b[3]*f+b[7]*l+b[11]*d+b[15]):(e=b[0],c=b[1],h=b[2],g=b[3],k=b[4],n=
b[5],p=b[6],m=b[7],q=b[8],t=b[9],A=b[10],v=b[11],a[0]=e,a[1]=c,a[2]=h,a[3]=g,a[4]=k,a[5]=n,a[6]=p,a[7]=m,a[8]=q,a[9]=t,a[10]=A,a[11]=v,a[12]=e*f+k*l+q*d+b[12],a[13]=c*f+n*l+t*d+b[13],a[14]=h*f+p*l+A*d+b[14],a[15]=g*f+m*l+v*d+b[15]);return a};c.scale=function(a,b,d){var f=d[0],l=d[1];d=d[2];a[0]=b[0]*f;a[1]=b[1]*f;a[2]=b[2]*f;a[3]=b[3]*f;a[4]=b[4]*l;a[5]=b[5]*l;a[6]=b[6]*l;a[7]=b[7]*l;a[8]=b[8]*d;a[9]=b[9]*d;a[10]=b[10]*d;a[11]=b[11]*d;a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a};c.rotate=
function(a,b,d,f){var l=f[0],c=f[1];f=f[2];var r=Math.sqrt(l*l+c*c+f*f),h=void 0,g=void 0,k=void 0,n=void 0,p=void 0,m=void 0,q=void 0,t=void 0,A=void 0,v=void 0,O=void 0,B=void 0,w=void 0,x=void 0,y=void 0,G=void 0,K=void 0,H=void 0,M=void 0,I=void 0,L=void 0,N=void 0,g=h=void 0;if(r<e.EPSILON)return null;r=1/r;l*=r;c*=r;f*=r;h=Math.sin(d);g=Math.cos(d);k=1-g;n=b[0];p=b[1];m=b[2];q=b[3];t=b[4];A=b[5];v=b[6];O=b[7];B=b[8];w=b[9];x=b[10];y=b[11];G=l*l*k+g;K=c*l*k+f*h;H=f*l*k-c*h;M=l*c*k-f*h;I=c*c*
k+g;L=f*c*k+l*h;N=l*f*k+c*h;h=c*f*k-l*h;g=f*f*k+g;a[0]=n*G+t*K+B*H;a[1]=p*G+A*K+w*H;a[2]=m*G+v*K+x*H;a[3]=q*G+O*K+y*H;a[4]=n*M+t*I+B*L;a[5]=p*M+A*I+w*L;a[6]=m*M+v*I+x*L;a[7]=q*M+O*I+y*L;a[8]=n*N+t*h+B*g;a[9]=p*N+A*h+w*g;a[10]=m*N+v*h+x*g;a[11]=q*N+O*h+y*g;b!==a&&(a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);return a};c.rotateX=function(a,b,d){var f=Math.sin(d);d=Math.cos(d);var l=b[4],e=b[5],c=b[6],h=b[7],g=b[8],k=b[9],n=b[10],p=b[11];b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],
a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[4]=l*d+g*f;a[5]=e*d+k*f;a[6]=c*d+n*f;a[7]=h*d+p*f;a[8]=g*d-l*f;a[9]=k*d-e*f;a[10]=n*d-c*f;a[11]=p*d-h*f;return a};c.rotateY=function(a,b,d){var f=Math.sin(d);d=Math.cos(d);var l=b[0],e=b[1],c=b[2],h=b[3],g=b[8],k=b[9],n=b[10],p=b[11];b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[0]=l*d-g*f;a[1]=e*d-k*f;a[2]=c*d-n*f;a[3]=h*d-p*f;a[8]=l*f+g*d;a[9]=e*f+k*d;a[10]=c*f+n*d;a[11]=h*f+p*d;return a};c.rotateZ=function(a,
b,d){var f=Math.sin(d);d=Math.cos(d);var l=b[0],e=b[1],c=b[2],h=b[3],g=b[4],k=b[5],n=b[6],p=b[7];b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[0]=l*d+g*f;a[1]=e*d+k*f;a[2]=c*d+n*f;a[3]=h*d+p*f;a[4]=g*d-l*f;a[5]=k*d-e*f;a[6]=n*d-c*f;a[7]=p*d-h*f;return a};c.fromTranslation=function(a,b){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=b[0];a[13]=b[1];a[14]=b[2];a[15]=1;return a};c.fromScaling=function(a,
b){a[0]=b[0];a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b[1];a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=b[2];a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};c.fromRotation=function(a,b,d){var f=d[0],l=d[1];d=d[2];var c=Math.sqrt(f*f+l*l+d*d),h=void 0,g=void 0,k=void 0;if(c<e.EPSILON)return null;c=1/c;f*=c;l*=c;d*=c;h=Math.sin(b);g=Math.cos(b);k=1-g;a[0]=f*f*k+g;a[1]=l*f*k+d*h;a[2]=d*f*k-l*h;a[3]=0;a[4]=f*l*k-d*h;a[5]=l*l*k+g;a[6]=d*l*k+f*h;a[7]=0;a[8]=f*d*k+l*h;a[9]=l*d*k-f*h;a[10]=d*d*k+g;a[11]=0;a[12]=0;a[13]=0;
a[14]=0;a[15]=1;return a};c.fromXRotation=function(a,b){var d=Math.sin(b);b=Math.cos(b);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b;a[6]=d;a[7]=0;a[8]=0;a[9]=-d;a[10]=b;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};c.fromYRotation=function(a,b){var d=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=0;a[2]=-d;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=d;a[9]=0;a[10]=b;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};c.fromZRotation=function(a,b){var d=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=d;a[2]=0;a[3]=0;a[4]=
-d;a[5]=b;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};c.fromRotationTranslation=k;c.fromQuat2=function(a,b){var d=p,f=-b[0],l=-b[1],e=-b[2],c=b[3],h=b[4],g=b[5],n=b[6],m=b[7],q=f*f+l*l+e*e+c*c;0<q?(d[0]=2*(h*c+m*f+g*e-n*l)/q,d[1]=2*(g*c+m*l+n*f-h*e)/q,d[2]=2*(n*c+m*e+h*l-g*f)/q):(d[0]=2*(h*c+m*f+g*e-n*l),d[1]=2*(g*c+m*l+n*f-h*e),d[2]=2*(n*c+m*e+h*l-g*f));k(a,b,d);return a};var p=m.create();c.getTranslation=function(a,b){a[0]=b[12];a[1]=b[13];a[2]=b[14];return a};
c.getScaling=function(a,b){var d=b[0],f=b[1],l=b[2],e=b[4],c=b[5],h=b[6],g=b[8],k=b[9];b=b[10];a[0]=Math.sqrt(d*d+f*f+l*l);a[1]=Math.sqrt(e*e+c*c+h*h);a[2]=Math.sqrt(g*g+k*k+b*b);return a};c.getRotation=function(a,b){var d=b[0]+b[5]+b[10],f=0;0<d?(f=2*Math.sqrt(d+1),a[3]=.25*f,a[0]=(b[6]-b[9])/f,a[1]=(b[8]-b[2])/f,a[2]=(b[1]-b[4])/f):b[0]>b[5]&&b[0]>b[10]?(f=2*Math.sqrt(1+b[0]-b[5]-b[10]),a[3]=(b[6]-b[9])/f,a[0]=.25*f,a[1]=(b[1]+b[4])/f,a[2]=(b[8]+b[2])/f):b[5]>b[10]?(f=2*Math.sqrt(1+b[5]-b[0]-b[10]),
a[3]=(b[8]-b[2])/f,a[0]=(b[1]+b[4])/f,a[1]=.25*f,a[2]=(b[6]+b[9])/f):(f=2*Math.sqrt(1+b[10]-b[0]-b[5]),a[3]=(b[1]-b[4])/f,a[0]=(b[8]+b[2])/f,a[1]=(b[6]+b[9])/f,a[2]=.25*f);return a};c.fromRotationTranslationScale=function(a,b,d,f){var l=b[0],e=b[1],c=b[2],h=b[3],g=l+l,k=e+e,n=c+c;b=l*g;var p=l*k,l=l*n,m=e*k,e=e*n,c=c*n,g=h*g,k=h*k,h=h*n,n=f[0],q=f[1];f=f[2];a[0]=(1-(m+c))*n;a[1]=(p+h)*n;a[2]=(l-k)*n;a[3]=0;a[4]=(p-h)*q;a[5]=(1-(b+c))*q;a[6]=(e+g)*q;a[7]=0;a[8]=(l+k)*f;a[9]=(e-g)*f;a[10]=(1-(b+m))*
f;a[11]=0;a[12]=d[0];a[13]=d[1];a[14]=d[2];a[15]=1;return a};c.fromRotationTranslationScaleOrigin=function(a,b,d,f,l){var e=b[0],c=b[1],h=b[2],g=b[3],k=e+e,n=c+c,p=h+h;b=e*k;var m=e*n,q=e*p,e=c*n,c=c*p,t=h*p,h=g*k,n=g*n,A=g*p,v=f[0],O=f[1],p=f[2];f=l[0];g=l[1];l=l[2];var k=(1-(e+t))*v,B=(m+A)*v,v=(q-n)*v,m=(m-A)*O,t=(1-(b+t))*O,O=(c+h)*O,q=(q+n)*p,c=(c-h)*p;b=(1-(b+e))*p;a[0]=k;a[1]=B;a[2]=v;a[3]=0;a[4]=m;a[5]=t;a[6]=O;a[7]=0;a[8]=q;a[9]=c;a[10]=b;a[11]=0;a[12]=d[0]+f-(k*f+m*g+q*l);a[13]=d[1]+g-(B*
f+t*g+c*l);a[14]=d[2]+l-(v*f+O*g+b*l);a[15]=1;return a};c.fromQuat=function(a,b){var d=b[0],f=b[1],l=b[2];b=b[3];var e=d+d,c=f+f,h=l+l,d=d*e,g=f*e,f=f*c,k=l*e,n=l*c,l=l*h,e=b*e,c=b*c;b*=h;a[0]=1-f-l;a[1]=g+b;a[2]=k-c;a[3]=0;a[4]=g-b;a[5]=1-d-l;a[6]=n+e;a[7]=0;a[8]=k+c;a[9]=n-e;a[10]=1-d-f;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};c.frustum=function(a,b,d,f,e,c,h){var l=1/(d-b),g=1/(e-f),k=1/(c-h);a[0]=2*c*l;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=2*c*g;a[6]=0;a[7]=0;a[8]=(d+b)*l;a[9]=(e+f)*g;a[10]=
(h+c)*k;a[11]=-1;a[12]=0;a[13]=0;a[14]=h*c*2*k;a[15]=0;return a};c.perspective=function(a,b,d,f,e){b=1/Math.tan(b/2);var l=void 0;a[0]=b/d;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[11]=-1;a[12]=0;a[13]=0;a[15]=0;null!=e&&Infinity!==e?(l=1/(f-e),a[10]=(e+f)*l,a[14]=2*e*f*l):(a[10]=-1,a[14]=-2*f);return a};c.perspectiveFromFieldOfView=function(a,b,d,f){var e=Math.tan(b.upDegrees*Math.PI/180),c=Math.tan(b.downDegrees*Math.PI/180),h=Math.tan(b.leftDegrees*Math.PI/180);b=Math.tan(b.rightDegrees*
Math.PI/180);var g=2/(h+b),k=2/(e+c);a[0]=g;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=k;a[6]=0;a[7]=0;a[8]=-((h-b)*g*.5);a[9]=(e-c)*k*.5;a[10]=f/(d-f);a[11]=-1;a[12]=0;a[13]=0;a[14]=f*d/(d-f);a[15]=0;return a};c.ortho=function(a,b,d,f,e,c,h){var l=1/(b-d),g=1/(f-e),k=1/(c-h);a[0]=-2*l;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=-2*g;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=2*k;a[11]=0;a[12]=(b+d)*l;a[13]=(e+f)*g;a[14]=(h+c)*k;a[15]=1;return a};c.lookAt=function(a,b,d,f){var l=void 0,c=void 0,h=void 0,g=void 0,k=void 0,p=void 0,
m=void 0,q=void 0,E=void 0,C=void 0,t=b[0],A=b[1];b=b[2];h=f[0];g=f[1];f=f[2];m=d[0];q=d[1];d=d[2];if(Math.abs(t-m)<e.EPSILON&&Math.abs(A-q)<e.EPSILON&&Math.abs(b-d)<e.EPSILON)return n(a);m=t-m;q=A-q;E=b-d;C=1/Math.sqrt(m*m+q*q+E*E);m*=C;q*=C;E*=C;l=g*E-f*q;c=f*m-h*E;h=h*q-g*m;(C=Math.sqrt(l*l+c*c+h*h))?(C=1/C,l*=C,c*=C,h*=C):h=c=l=0;g=q*h-E*c;k=E*l-m*h;p=m*c-q*l;(C=Math.sqrt(g*g+k*k+p*p))?(C=1/C,g*=C,k*=C,p*=C):p=k=g=0;a[0]=l;a[1]=g;a[2]=m;a[3]=0;a[4]=c;a[5]=k;a[6]=q;a[7]=0;a[8]=h;a[9]=p;a[10]=E;
a[11]=0;a[12]=-(l*t+c*A+h*b);a[13]=-(g*t+k*A+p*b);a[14]=-(m*t+q*A+E*b);a[15]=1;return a};c.targetTo=function(a,b,d,f){var e=b[0],c=b[1];b=b[2];var h=f[0],g=f[1],k=f[2];f=e-d[0];var n=c-d[1];d=b-d[2];var p=f*f+n*n+d*d;0<p&&(p=1/Math.sqrt(p),f*=p,n*=p,d*=p);var m=g*d-k*n,k=k*f-h*d,h=h*n-g*f,p=m*m+k*k+h*h;0<p&&(p=1/Math.sqrt(p),m*=p,k*=p,h*=p);a[0]=m;a[1]=k;a[2]=h;a[3]=0;a[4]=n*h-d*k;a[5]=d*m-f*h;a[6]=f*k-n*m;a[7]=0;a[8]=f;a[9]=n;a[10]=d;a[11]=0;a[12]=e;a[13]=c;a[14]=b;a[15]=1;return a};c.str=function(a){return"mat4("+
a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};c.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};c.add=function(a,b,
d){a[0]=b[0]+d[0];a[1]=b[1]+d[1];a[2]=b[2]+d[2];a[3]=b[3]+d[3];a[4]=b[4]+d[4];a[5]=b[5]+d[5];a[6]=b[6]+d[6];a[7]=b[7]+d[7];a[8]=b[8]+d[8];a[9]=b[9]+d[9];a[10]=b[10]+d[10];a[11]=b[11]+d[11];a[12]=b[12]+d[12];a[13]=b[13]+d[13];a[14]=b[14]+d[14];a[15]=b[15]+d[15];return a};c.subtract=g;c.multiplyScalar=function(a,b,d){a[0]=b[0]*d;a[1]=b[1]*d;a[2]=b[2]*d;a[3]=b[3]*d;a[4]=b[4]*d;a[5]=b[5]*d;a[6]=b[6]*d;a[7]=b[7]*d;a[8]=b[8]*d;a[9]=b[9]*d;a[10]=b[10]*d;a[11]=b[11]*d;a[12]=b[12]*d;a[13]=b[13]*d;a[14]=b[14]*
d;a[15]=b[15]*d;return a};c.multiplyScalarAndAdd=function(a,b,d,f){a[0]=b[0]+d[0]*f;a[1]=b[1]+d[1]*f;a[2]=b[2]+d[2]*f;a[3]=b[3]+d[3]*f;a[4]=b[4]+d[4]*f;a[5]=b[5]+d[5]*f;a[6]=b[6]+d[6]*f;a[7]=b[7]+d[7]*f;a[8]=b[8]+d[8]*f;a[9]=b[9]+d[9]*f;a[10]=b[10]+d[10]*f;a[11]=b[11]+d[11]*f;a[12]=b[12]+d[12]*f;a[13]=b[13]+d[13]*f;a[14]=b[14]+d[14]*f;a[15]=b[15]+d[15]*f;return a};c.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&
a[8]===b[8]&&a[9]===b[9]&&a[10]===b[10]&&a[11]===b[11]&&a[12]===b[12]&&a[13]===b[13]&&a[14]===b[14]&&a[15]===b[15]};c.equals=function(a,b){var d=a[0],f=a[1],l=a[2],c=a[3],h=a[4],g=a[5],k=a[6],n=a[7],p=a[8],m=a[9],q=a[10],C=a[11],t=a[12],A=a[13],v=a[14];a=a[15];var O=b[0],B=b[1],w=b[2],x=b[3],y=b[4],G=b[5],K=b[6],H=b[7],M=b[8],I=b[9],L=b[10],N=b[11],F=b[12],U=b[13],Y=b[14];b=b[15];return Math.abs(d-O)<=e.EPSILON*Math.max(1,Math.abs(d),Math.abs(O))&&Math.abs(f-B)<=e.EPSILON*Math.max(1,Math.abs(f),Math.abs(B))&&
Math.abs(l-w)<=e.EPSILON*Math.max(1,Math.abs(l),Math.abs(w))&&Math.abs(c-x)<=e.EPSILON*Math.max(1,Math.abs(c),Math.abs(x))&&Math.abs(h-y)<=e.EPSILON*Math.max(1,Math.abs(h),Math.abs(y))&&Math.abs(g-G)<=e.EPSILON*Math.max(1,Math.abs(g),Math.abs(G))&&Math.abs(k-K)<=e.EPSILON*Math.max(1,Math.abs(k),Math.abs(K))&&Math.abs(n-H)<=e.EPSILON*Math.max(1,Math.abs(n),Math.abs(H))&&Math.abs(p-M)<=e.EPSILON*Math.max(1,Math.abs(p),Math.abs(M))&&Math.abs(m-I)<=e.EPSILON*Math.max(1,Math.abs(m),Math.abs(I))&&Math.abs(q-
L)<=e.EPSILON*Math.max(1,Math.abs(q),Math.abs(L))&&Math.abs(C-N)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(N))&&Math.abs(t-F)<=e.EPSILON*Math.max(1,Math.abs(t),Math.abs(F))&&Math.abs(A-U)<=e.EPSILON*Math.max(1,Math.abs(A),Math.abs(U))&&Math.abs(v-Y)<=e.EPSILON*Math.max(1,Math.abs(v),Math.abs(Y))&&Math.abs(a-b)<=e.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};c.mul=h;c.sub=g})},"esri/views/3d/support/earthUtils":function(){define("require exports ../../../core/mathUtils ../../../core/wgs84Constants ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Point ./projectionUtils".split(" "),
function(q,c,m,e,n,h,k,g){function p(a,b,d,e){var f,l;a instanceof k&&b instanceof k&&(d=b.longitude,e=b.latitude,l=a.latitude,f=a.longitude);a=m.deg2rad(l);e=m.deg2rad(e);f=m.deg2rad(f);b=m.deg2rad(d);d=Math.sin((a-e)/2);f=Math.sin((f-b)/2);d=2*m.asinClamped(Math.sqrt(d*d+Math.cos(a)*Math.cos(e)*f*f))*c.earthRadius;return Math.round(1E4*d)/1E4}function a(a,b){a/=15;b||(a=Math.round(a));return a}Object.defineProperty(c,"__esModule",{value:!0});c.earthRadius=e.wgs84Radius;c.halfEarthRadius=c.earthRadius/
2;c.halfEarthCircumference=Math.PI*c.earthRadius;c.earthCircumference=2*c.halfEarthCircumference;c.metersPerDegree=c.halfEarthCircumference/180;c.getGreatCircleDistance=p;c.getGreatCircleSpanAt=function(a,b,d){var f=b.spatialReference,e=new k(b.x,a.y,f),c=new k(d.x,a.y,f);b=new k(a.x,b.y,f);a=new k(a.x,d.y,f);return{lon:p(e,c),lat:p(b,a)}};c.getLonDeltaForDistance=function(a,b){b/=c.earthRadius;a=m.deg2rad(a);b=Math.sin(b/2);a=Math.cos(a);a=2*m.asinClamped(Math.sqrt(b*b/(a*a)));return m.rad2deg(a)};
c.getLatDeltaForDistance=function(a){return m.rad2deg(a/c.earthRadius)};c.getMaxCameraAltitude=function(a){a=m.deg2rad(a/2);return(1-Math.sin(a))*c.earthRadius/Math.sin(a)};c.getViewExtentDistance=function(a,b){b=m.deg2rad(b/2);return 2*m.acosClamped((Math.pow(a+c.earthRadius,2)+Math.pow(c.earthRadius,2)-Math.pow((a+c.earthRadius)*Math.cos(b)-Math.sqrt(Math.pow(Math.cos(b)*(a+c.earthRadius),2)-a*a-2*a*c.earthRadius),2))/(2*(a+c.earthRadius)*c.earthRadius))*c.earthRadius};c.computeCartesianDistance=
function(a,e){a=g.wgs84ComparableLonLatToECEF(b,a.longitude,a.latitude,a.z||0);e=g.wgs84ComparableLonLatToECEF(d,e.longitude,e.latitude,e.z||0);e=[e[0]-a[0],e[1]-a[1],e[2]-a[2]];return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])};c.longitudeToTimezone=a;c.positionToTimezone=function(b,d){d||(d={hours:0,minutes:0,seconds:0});d.hours=a(b[0],!0);b=d.hours%1;d.hours-=b;d.minutes=60*b;b=d.minutes%1;d.minutes-=b;d.seconds=Math.round(60*b);return d};c.distanceToIdealHorizon=function(a,b){b=b||c.earthRadius;
a=n.vec3.dot(a,a);return Math.sqrt(Math.abs(a-b*b))};var b=h.vec3f64.create(),d=h.vec3f64.create()})},"esri/views/3d/webgl-engine/lib/BufferVectorMath":function(){define(["require","exports"],function(q,c){Object.defineProperty(c,"__esModule",{value:!0});(function(c){c.length=function(e,c){var h=e[c],k=e[c+1];e=e[c+2];return Math.sqrt(h*h+k*k+e*e)};c.normalize=function(e,c){var h=e[c],k=e[c+1],g=e[c+2],h=1/Math.sqrt(h*h+k*k+g*g);e[c]*=h;e[c+1]*=h;e[c+2]*=h};c.scale=function(e,c,h){e[c]*=h;e[c+1]*=
h;e[c+2]*=h};c.add=function(e,c,h,k,g,p){void 0===p&&(p=c);g=g||e;g[p]=e[c]+h[k];g[p+1]=e[c+1]+h[k+1];g[p+2]=e[c+2]+h[k+2]};c.subtract=function(e,c,h,k,g,p){void 0===p&&(p=c);g=g||e;g[p]=e[c]-h[k];g[p+1]=e[c+1]-h[k+1];g[p+2]=e[c+2]-h[k+2]}})(c.Vec3Compact||(c.Vec3Compact={}))})},"esri/views/support/spatialReferenceSupport":function(){define(["require","exports"],function(q,c){Object.defineProperty(c,"__esModule",{value:!0});c.isSpatialReferenceSupported=function(c,e){return null==c?!1:"2d"===e?!0:
"local"===e?!c.isGeographic:c.isWebMercator||c.isWGS84||4490===c.wkid}})},"esri/webdoc/support/thumbnailUtils":function(){define(["require","exports"],function(q,c){Object.defineProperty(c,"__esModule",{value:!0});var m={width:600,height:400};c.getOptimalThumbnailSize=function(e,c){c=c||m;var h=c.width;c=c.height;var k=h/c;1.5>k?c=h/1.5:1.5<k&&(h=1.5*c);h>e.width&&(c*=e.width/h,h=e.width);c>e.height&&(h*=e.height/c,c=e.height);return{width:Math.round(h),height:Math.round(c)}}})},"esri/webscene/ApplicationProperties":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/accessorSupport/decorators ../webdoc/applicationProperties/Viewing".split(" "),
function(q,c,m,e,n,h,k){return function(c){function g(a){a=c.call(this,a)||this;a.viewing=null;return a}m(g,c);a=g;g.prototype.clone=function(){return new a({viewing:this.viewing?this.viewing.clone():null})};var a;e([h.property({type:k,json:{write:!0}})],g.prototype,"viewing",void 0);return g=a=e([h.subclass("esri.webscene.ApplicationProperties")],g)}(h.declared(n.JSONSupport))})},"esri/webdoc/applicationProperties/Viewing":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ./Search".split(" "),
function(q,c,m,e,n,h,k,g){return function(c){function a(a){a=c.call(this,a)||this;a.search=null;return a}m(a,c);b=a;a.prototype.clone=function(){return new b(h.clone({search:this.search}))};var b;e([k.property({type:g,json:{write:!0}})],a.prototype,"search",void 0);return a=b=e([k.subclass("esri.webdoc.applicationProperties.Viewing")],a)}(k.declared(n.JSONSupport))})},"esri/webdoc/applicationProperties/Search":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Collection ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ./SearchLayer".split(" "),
function(q,c,m,e,n,h,k,g,p){var a=n.ofType(p);return function(b){function d(d){d=b.call(this,d)||this;d.addressSearchEnabled=!0;d.enabled=!0;d.hintText=null;d.layers=new a;return d}m(d,b);f=d;d.prototype.readAddressSearchEnabled=function(a){return!a};d.prototype.writeAddressSearchEnabled=function(a,b,d){b[d]=!a};d.prototype.clone=function(){return new f(k.clone({addressSearchEnabled:this.addressSearchEnabled,enabled:this.enabled,hintText:this.hintText,layers:this.layers}))};var f;e([g.property({type:Boolean,
json:{read:{source:"disablePlaceFinder"},write:{target:"disablePlaceFinder"},default:!0,origins:{"web-scene":{read:!1,write:!1}}}})],d.prototype,"addressSearchEnabled",void 0);e([g.reader("addressSearchEnabled")],d.prototype,"readAddressSearchEnabled",null);e([g.writer("addressSearchEnabled")],d.prototype,"writeAddressSearchEnabled",null);e([g.property({type:Boolean,json:{write:!0,default:!0}})],d.prototype,"enabled",void 0);e([g.property({type:String,json:{write:!0}})],d.prototype,"hintText",void 0);
e([g.property({type:a,json:{write:{enabled:!0,isRequired:!0}}})],d.prototype,"layers",void 0);return d=f=e([g.subclass("esri.webdoc.applicationProperties.Search")],d)}(g.declared(h.JSONSupport))})},"esri/webdoc/applicationProperties/SearchLayer":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ./SearchLayerField".split(" "),
function(q,c,m,e,n,h,k,g,p){return function(a){function b(b){b=a.call(this,b)||this;b.field=null;b.id=null;b.subLayer=null;return b}m(b,a);d=b;b.prototype.clone=function(){return new d(h.clone({field:this.field,id:this.id,subLayer:this.subLayer}))};var d;e([k.property({type:p,json:{write:{enabled:!0,isRequired:!0}}})],b.prototype,"field",void 0);e([k.property({type:String,json:{write:{enabled:!0,isRequired:!0}}})],b.prototype,"id",void 0);e([k.property({type:g.Integer,json:{write:!0}})],b.prototype,
"subLayer",void 0);return b=d=e([k.subclass("esri.webdoc.applicationProperties.SearchLayer")],b)}(k.declared(n.JSONSupport))})},"esri/webdoc/applicationProperties/SearchLayerField":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ../../layers/support/fieldType".split(" "),function(q,c,m,e,n,h,k){return function(c){function g(a){a=c.call(this,a)||this;a.exactMatch=!1;a.name=
null;a.type=null;return a}m(g,c);a=g;g.prototype.clone=function(){return new a({exactMatch:this.exactMatch,type:this.type,name:this.name})};var a;e([h.property({type:Boolean,json:{write:!0}})],g.prototype,"exactMatch",void 0);e([h.property({type:String,json:{write:!0}})],g.prototype,"name",void 0);e([h.enumeration.serializable()(k.kebabDict)],g.prototype,"type",void 0);return g=a=e([h.subclass("esri.webdoc.applicationProperties.SearchLayerField")],g)}(h.declared(n.JSONSupport))})},"esri/webscene/Environment":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators ./Lighting ./background/utils".split(" "),
function(q,c,m,e,n,h,k,g,p){var a=function(a,d,f){return{enabled:!f||!f.isPresentation}};return function(b){function d(a){a=b.call(this,a)||this;a.lighting=new g;a.background=null;a.atmosphereEnabled=!0;a.starsEnabled=!0;return a}m(d,b);f=d;d.prototype.clone=function(){return new f(this.cloneConstructProperties())};d.prototype.cloneConstructProperties=function(){return{lighting:g.prototype.clone.call(this.lighting),background:h.clone(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled}};
var f;e([k.property({type:g,json:{write:!0}})],d.prototype,"lighting",void 0);e([k.property(p.backgroundProperty)],d.prototype,"background",void 0);e([k.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:a}}})],d.prototype,"atmosphereEnabled",void 0);e([k.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:a}}})],d.prototype,"starsEnabled",void 0);return d=f=e([k.subclass("esri.webscene.Environment")],d)}(k.declared(n.JSONSupport))})},"esri/webscene/Lighting":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/accessorSupport/decorators".split(" "),
function(q,c,m,e,n,h){return function(c){function g(a){a=c.call(this,a)||this;a.date=null;a.directShadowsEnabled=!1;a.displayUTCOffset=null;return a}m(g,c);k=g;g.prototype.readDate=function(a,b){return null!=b.datetime&&new Date(b.datetime)||null};g.prototype.writeDate=function(a,b,d){b[d]=a.getTime()};g.prototype.readDirectShadowsEnabled=function(a,b){return!!b.directShadows};g.prototype.writedirectShadowsEnabled=function(a,b,d){a&&(b[d]=a)};g.prototype.writeDisplayUTCOffset=function(a,b){null!=
a&&(b.displayUTCOffset=a)};g.prototype.clone=function(){return new k(this.cloneConstructProperties())};g.prototype.cloneConstructProperties=function(){var a={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null};null!=this.date&&(a.date=new Date(this.date.getTime()));return a};var k;e([h.property({type:Date,json:{type:Number,write:{target:"datetime"}}})],g.prototype,"date",void 0);e([h.reader("date",["datetime"])],g.prototype,"readDate",
null);e([h.writer("date")],g.prototype,"writeDate",null);e([h.property({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],g.prototype,"directShadowsEnabled",void 0);e([h.reader("directShadowsEnabled",["directShadows"])],g.prototype,"readDirectShadowsEnabled",null);e([h.writer("directShadowsEnabled")],g.prototype,"writedirectShadowsEnabled",null);e([h.property({type:Number,json:{write:!0}})],g.prototype,"displayUTCOffset",void 0);e([h.writer("displayUTCOffset")],g.prototype,"writeDisplayUTCOffset",
null);return g=k=e([h.subclass("esri.webscene.Lighting")],g)}(h.declared(n.JSONSupport))})},"esri/webscene/background/utils":function(){define(["require","exports","./Background","./ColorBackground"],function(q,c,m,e){Object.defineProperty(c,"__esModule",{value:!0});q={base:m,key:"type",typeMap:{color:e}};c.backgroundProperty={types:q,json:{read:function(c){return function(e,k,g){if(!e)return e;for(var h in c.typeMap)if(e.type===h)return k=new c.typeMap[h],k.read(e,g),k}}(q),write:{overridePolicy:function(c,
e,k){return{enabled:!k||!k.isPresentation}}}}}})},"esri/webscene/background/Background":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/jsonMap ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(q,c,m,e,n,h,k,g){var p=h.strict()({color:"color"});return function(a){function b(b){return a.call(this,b)||this}m(b,a);b.prototype.normalizeCtorArgs=function(a){a&&a.type&&
(a=n({},a),delete a.type);return a};b.prototype.clone=function(){};e([g.property({type:p.apiValues,readOnly:!0,json:{type:p.jsonValues,read:!1,write:p.write}})],b.prototype,"type",void 0);return b=e([g.subclass("esri.webscene.background.Background")],b)}(g.declared(k.JSONSupport))})},"esri/webscene/background/ColorBackground":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../Color ../../core/accessorSupport/decorators ../../symbols/support/materialUtils ./Background".split(" "),
function(q,c,m,e,n,h,k,g,p){var a=n({},g.colorAndTransparencyProperty,{nonNullable:!0});return function(b){function d(a){a=b.call(this,a)||this;a.type="color";a.color=new h([0,0,0,1]);return a}m(d,b);f=d;d.prototype.clone=function(){return new f(this.cloneProperties())};d.prototype.cloneProperties=function(){return{color:this.color.clone()}};var f;e([k.enumeration.serializable()({color:"color"})],d.prototype,"type",void 0);e([k.property(a)],d.prototype,"color",void 0);return d=f=e([k.subclass("esri.webscene.background.ColorBackground")],
d)}(k.declared(p))})},"esri/webscene/InitialViewProperties":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../Viewpoint ../core/Accessor ../core/accessorSupport/decorators ../geometry/SpatialReference ./Environment".split(" "),function(q,c,m,e,n,h,k,g,p){return function(a){function b(b){b=a.call(this,b)||this;b.environment=new p;b.spatialReference=null;b.viewpoint=null;return b}m(b,a);d=b;Object.defineProperty(b.prototype,"viewingMode",{set:function(a){this._set("viewingMode",
a)},enumerable:!0,configurable:!0});b.prototype.clone=function(){return new d({environment:this.environment.clone(),spatialReference:this.spatialReference?this.spatialReference.clone():null,viewingMode:this.viewingMode,viewpoint:this.viewpoint?this.viewpoint.clone():null})};var d;e([k.property({type:p,json:{write:{isRequired:!0}}})],b.prototype,"environment",void 0);e([k.property({type:g})],b.prototype,"spatialReference",void 0);e([k.property({type:["local","global"]})],b.prototype,"viewingMode",
null);e([k.property({type:n,json:{write:{isRequired:!0}}})],b.prototype,"viewpoint",void 0);return b=d=e([k.subclass("esri.webscene.InitialViewProperties")],b)}(k.declared(h))})},"esri/webscene/Presentation":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Collection ../core/collectionUtils ../core/JSONSupport ../core/accessorSupport/decorators ./Slide".split(" "),function(q,c,m,e,n,h,k,g,p){var a=n.ofType(p);return function(b){function d(d){d=
b.call(this,d)||this;d.slides=new a;return d}m(d,b);Object.defineProperty(d.prototype,"slides",{set:function(b){b&&(b=b.filter(function(a){return!!a.viewpoint}));this._set("slides",h.referenceSetter(b,this._get("slides"),a))},enumerable:!0,configurable:!0});d.prototype.clone=function(){return new this.constructor({slides:this.slides.clone()})};e([g.property({type:a,nonNullable:!0,json:{write:!0}}),g.cast(h.castForReferenceSetter)],d.prototype,"slides",null);return d=e([g.subclass("esri.webscene.Presentation")],
d)}(g.declared(k.JSONSupport))})},"esri/webscene/Slide":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/generatorHelper ../core/tsSupport/awaiterHelper ../Basemap ../Viewpoint ../core/asyncUtils ../core/Collection ../core/collectionUtils ../core/JSONSupport ../core/Logger ../core/promiseUtils ../core/accessorSupport/decorators ../core/accessorSupport/ensureType ../core/libs/gl-matrix-2/vec3 ../core/libs/gl-matrix-2/vec3f64 ../layers/Layer ../support/basemapUtils ../views/3d/support/mathUtils ../webdoc/support/Thumbnail ./Environment ./Lighting ./support/Description ./support/SlideGround ./support/SlideVisibleLayer ./support/Title".split(" "),
function(q,c,m,e,n,h,k,g,p,a,b,d,f,l,P,r,R,D,V,X,Z,E,C,t,A,v,O,B,w){function x(a){if("building-scene"===a.type||"map-image"===a.type)return a.allSublayers}function y(a){if(a=x(a))return a.filter(function(a){return a.visible}).map(function(a){return a.id}).toArray()}function G(a,b){a=b-a;a>L&&(a-=I);a<-L&&(a+=I);return a}var K=0,H=b.ofType(B.default),M=l.getLogger("esri.webscene.Slide"),I=86400,L=43200;return function(f){function c(a){a=f.call(this,a)||this;a._applyToController=null;a.id=Date.now().toString(16)+
"-slide-"+K++;a.title=new w.default;a.description=new v.default;a.thumbnail=new C.default;a.viewpoint=null;a.basemap=null;a.ground=null;a.environment=new t;a.visibleLayers=new H;return a}e(c,f);c.prototype.castTitle=function(a){return"string"===typeof a?new w.default({text:a}):R.ensureType(w.default,a)};c.prototype.castDescription=function(a){return"string"===typeof a?new v.default({text:a}):R.ensureType(v.default,a)};c.prototype.castThumbnail=function(a){return"string"===typeof a?new C.default({url:a}):
R.ensureType(C.default,a)};c.prototype.castBasemap=function(a){return Z.ensureType(a)};Object.defineProperty(c.prototype,"visibleLayers",{set:function(a){this._set("visibleLayers",d.referenceSetter(a,this._get("visibleLayers"),H))},enumerable:!0,configurable:!0});c.prototype.castVisibleLayers=function(a){return a&&"function"===typeof a.map?a.map(function(a){if("string"===typeof a)return{id:a};if(a instanceof X){var b=y(a);return{id:a.id,sublayerIds:b}}if(a.id)return{id:a.id,sublayerIds:a.sublayerIds};
M.warn('Invalid visible layer, expected { id }, Layer or "id"');return a}):null};c.prototype.clone=function(){return new this.constructor({id:this.id,title:this.title.clone(),thumbnail:this.thumbnail.clone(),description:this.description&&this.description.clone()||null,viewpoint:this.viewpoint&&this.viewpoint.clone()||null,basemap:this.basemap&&this.basemap.clone()||null,ground:this.ground&&this.ground.clone()||null,visibleLayers:this.visibleLayers.clone(),environment:this.environment&&this.environment.clone()||
null})};c.prototype._updateVisibleLayersFrom=function(a){var b=this,d=[];return P.eachAlways(this._allLayers(a.map).map(function(b){return a.whenLayerView(b).then(function(a){if(a.visible){var c=y(b);d.push(new B.default({id:a.layer.id,sublayerIds:c}))}})}).toArray()).then(function(){b.visibleLayers.removeAll();b.visibleLayers.addMany(d)})};c.prototype.updateFrom=function(a,b){var d=this;b={screenshot:m({format:"jpeg",quality:80,width:120,height:75,disableSlice:!0},b&&b.screenshot)};return a.when(function(){d.viewpoint=
a.viewpoint.clone();d.environment.lighting=A.prototype.clone.apply(a.environment.lighting);d.basemap=a.map.basemap&&a.map.basemap.clone()||null;d.ground=a.map.ground?O.default.fromGround(a.map.ground):null;return d._updateVisibleLayersFrom(a)}).then(function(){return a.takeScreenshot(b.screenshot)}).then(function(a){d.thumbnail=new C.default({url:a.dataUrl});return d})};c.prototype.applyTo=function(a,b){return k(this,void 0,void 0,function(){var d,c,f;return h(this,function(e){this._applyToController&&
this._applyToController.abort();this._applyToController=d=P.createAbortController();P.onAbortOrThrow(b,function(){return d.abort()});c=m({animate:!0},b,{signal:this._applyToController.signal});f=P.createDeferred(function(){return d.abort()});this._applyTo(a,c,d).then(f.resolve,f.reject);return[2,f.promise]})})};c.prototype._applyTo=function(b,d,c){return k(this,void 0,void 0,function(){var f,e=this;return h(this,function(g){switch(g.label){case 0:return[4,a.result(function(){return k(e,void 0,void 0,
function(){return h(this,function(a){switch(a.label){case 0:return[4,this._applyBasemap(b,d)];case 1:return a.sent(),this._applyLayerVisibility(b),this._applyGround(b),[4,this._applyViewpoint(b,d)];case 2:return a.sent(),[2]}})})}())];case 1:f=g.sent();this._applyToController===c&&(this._applyToController=null);if(!1===f.ok)throw f.error;return[2,this]}})})};c.prototype._applyBasemap=function(a,b){return k(this,void 0,void 0,function(){var d;return h(this,function(c){switch(c.label){case 0:if(!this.basemap)return[3,
5];c.label=1;case 1:return c.trys.push([1,3,,4]),[4,this.basemap.load(b)];case 2:return c.sent(),[3,4];case 3:d=c.sent();if(P.isAbortError(d))throw d;return[3,4];case 4:a.map.basemap=Z.clonePreservingTiledLayers(this.basemap,a.map.basemap),c.label=5;case 5:return[2]}})})};c.prototype._applyGround=function(a){this.ground&&(a.map.ground=this.ground.cloneAndApplyTo(a.map.ground))};c.prototype._allLayers=function(a){var d=new b;this._collectLayers(a,d);this._collectLayers(a.ground,d);return d};c.prototype._collectLayers=
function(a,b){var d=this;a.layers.forEach(function(a){b.add(a);a.layers&&d._collectLayers(a,b)})};c.prototype._applyLayerVisibility=function(a){var b=this;this.visibleLayers&&this._allLayers(a.map).forEach(function(a){var d=b.visibleLayers.find(function(b){return b.id===a.id});a.visible=null!=d;var c=d&&d.sublayerIds,d=x(a);c&&d&&d.forEach(function(a){return a.visible=0<=c.indexOf(a.id)})})};c.prototype._applyViewpoint=function(a,b){return k(this,void 0,void 0,function(){return h(this,function(d){switch(d.label){case 0:if(!this.viewpoint||
b.ignoreViewpoint)return[3,5];this.viewpoint.camera.fov=a.camera.fov;return b.animate&&this.get("environment.lighting.date")?[4,this._animateToLighting(a,b)]:[3,2];case 1:return d.sent(),[2];case 2:if(!b.animate)return[3,4];a.environment.updateLighting(this.environment.lighting.clone());return[4,a.goTo(this.viewpoint,b)];case 3:d.sent(),d.label=4;case 4:a.viewpoint=this.viewpoint,d.label=5;case 5:return a.environment.updateLighting(this.environment.lighting.clone()),[2]}})})};c.prototype._animateToLighting=
function(a,b){return k(this,void 0,void 0,function(){var d,c,f,e=this;return h(this,function(h){d=null;"global"===a.viewingMode&&(d=this._animateLightingWithCamera(a));a.environment.lighting.cameraTrackingEnabled=!1;a.environment.lighting.directShadowsEnabled=this.environment.lighting.directShadowsEnabled;null!=this.environment.lighting.displayUTCOffset&&(a.environment.lighting.displayUTCOffset=this.environment.lighting.displayUTCOffset);c=a.goTo(this.viewpoint,b);f=function(){d&&d.remove();a.environment.lighting.cameraTrackingEnabled=
!0};return[2,c.then(function(){a.environment.updateLighting(e.environment.lighting.clone());f()},function(a){f();throw a;})]})})};c.prototype._getTime=function(a){var b=a.getTime();a=3600*a.getUTCHours()+60*a.getUTCMinutes()+a.getUTCSeconds();return[b,a]};c.prototype._setTime=function(a,b,d){a.setTime(b);a.setUTCHours(d/3600);a.setUTCMinutes(d%3600/60);a.setUTCSeconds(d%3600%60);return a};c.prototype._animateLightingWithCamera=function(a){var b=this,d=this._getTime(new Date(a.environment.lighting.date.toString())),
c=d[0],f=d[1],d=this._getTime(this.environment.lighting.date),e=d[0],h=G(f,d[1]),g=a.renderCoordsHelper,z=V.vec3f64.create();g.toRenderCoords(a.camera.position,z);var k=V.vec3f64.create();g.toRenderCoords(this.viewpoint.camera.position,k);var l=V.vec3f64.create(),n=new Date;return a.watch("camera",function(d){g.toRenderCoords(d.position,l);var m=D.vec3.squaredDistance(z,l),p=D.vec3.squaredDistance(k,l);d=0;0!==m+p&&(d=m/(m+p));m=c+(e-c)*d;d=E.moduloPositive(f+h*d,I);a.environment.lighting.date=b._setTime(n,
m,d)})};c.createFrom=function(a,b){return(new this).updateFrom(a,b)};n([r.property({type:String,json:{write:{isRequired:!0}}})],c.prototype,"id",void 0);n([r.property({type:w.default,json:{default:function(){return new w.default({text:""})},write:{isRequired:!0}}})],c.prototype,"title",void 0);n([r.cast("title")],c.prototype,"castTitle",null);n([r.property({type:v.default,json:{write:{overridePolicy:function(a){return{enabled:!(!a||!a.text)}}}}})],c.prototype,"description",void 0);n([r.cast("description")],
c.prototype,"castDescription",null);n([r.property({type:C.default,json:{default:function(){return new C.default({url:""})},write:{isRequired:!0}}})],c.prototype,"thumbnail",void 0);n([r.cast("thumbnail")],c.prototype,"castThumbnail",null);n([r.property({type:p,nonNullable:!0,json:{write:{isRequired:!0}}})],c.prototype,"viewpoint",void 0);n([r.property({type:g,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],c.prototype,"basemap",void 0);n([r.cast("basemap")],c.prototype,"castBasemap",null);
n([r.property({type:O.default,json:{write:!0}})],c.prototype,"ground",void 0);n([r.property({type:H,json:{write:{isRequired:!0}}})],c.prototype,"visibleLayers",null);n([r.cast("visibleLayers")],c.prototype,"castVisibleLayers",null);n([r.property({type:t,json:{write:!0}})],c.prototype,"environment",void 0);return c=n([r.subclass("esri.webscene.Slide")],c)}(r.declared(f.JSONSupport))})},"esri/webdoc/support/Thumbnail":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(q,c,m,e,n,h){Object.defineProperty(c,"__esModule",{value:!0});q=function(c){function g(){var a=null!==c&&c.apply(this,arguments)||this;a.url="";return a}m(g,c);k=g;g.prototype.clone=function(){return new k({url:this.url})};var k;e([h.property({type:String,json:{write:{isRequired:!0}}})],g.prototype,"url",void 0);return g=k=e([h.subclass("esri.webdoc.support.Thumbnail")],g)}(h.declared(n.JSONSupport));c.default=q})},"esri/webscene/support/Description":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(q,c,m,e,n,h){Object.defineProperty(c,"__esModule",{value:!0});q=function(c){function g(){var a=null!==c&&c.apply(this,arguments)||this;a.text="";return a}m(g,c);k=g;g.prototype.clone=function(){return new k({text:this.text})};var k;e([h.property({type:String,json:{write:!0}})],g.prototype,"text",void 0);return g=k=e([h.subclass("esri.webscene.support.Description")],g)}(h.declared(n.JSONSupport));c.default=q})},"esri/webscene/support/SlideGround":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../Ground ../../core/JSONSupport ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../webdoc/support/opacityUtils".split(" "),
function(q,c,m,e,n,h,k,g,p){Object.defineProperty(c,"__esModule",{value:!0});q=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.opacity=null;return b}m(b,a);d=b;b.prototype.clone=function(){return new d({opacity:this.opacity})};b.prototype.cloneAndApplyTo=function(a){if(null==this.opacity)return a;a=null!=a?a.clone():new n;a.opacity=this.opacity;return a};b.fromGround=function(a){return new d({opacity:a.opacity})};var d;e([k.property({type:Number,json:{type:g.Integer,read:{reader:p.transparencyToOpacity,
source:"transparency"},write:{writer:function(a,b){b.transparency=p.opacityToTransparency(a)},target:"transparency"}}})],b.prototype,"opacity",void 0);return b=d=e([k.subclass("esri.webscene.support.SlideGround")],b)}(k.declared(h.JSONSupport));c.default=q})},"esri/webscene/support/SlideVisibleLayer":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType".split(" "),
function(q,c,m,e,n,h,k,g){Object.defineProperty(c,"__esModule",{value:!0});q=function(c){function a(a){a=c.call(this,a)||this;a.id="";a.sublayerIds=null;return a}m(a,c);b=a;a.prototype.clone=function(){return new b({id:this.id,sublayerIds:h.clone(this.sublayerIds)})};var b;e([k.property({type:String,json:{write:!0}})],a.prototype,"id",void 0);e([k.property({type:[g.Integer],json:{read:{source:"subLayerIds"},write:{target:"subLayerIds"}}})],a.prototype,"sublayerIds",void 0);return a=b=e([k.subclass("esri.webscene.support.SlideVisibleLayer")],
a)}(k.declared(n.JSONSupport));c.SlideVisibleLayer=q;c.default=q})},"esri/webscene/support/Title":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(q,c,m,e,n,h){Object.defineProperty(c,"__esModule",{value:!0});q=function(c){function g(){var a=null!==c&&c.apply(this,arguments)||this;a.text="";return a}m(g,c);k=g;g.prototype.clone=function(){return new k({text:this.text})};
var k;e([h.property({type:String,json:{write:{isRequired:!0}}})],g.prototype,"text",void 0);return g=k=e([h.subclass("esri.webscene.support.Title")],g)}(h.declared(n.JSONSupport));c.default=q})},"esri/webscene/TransportationNetwork":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/accessorSupport/decorators".split(" "),function(q,c,m,e,n,h){return function(c){function g(a){return c.call(this,a)||this}m(g,c);k=g;
g.prototype.clone=function(){return new k({name:this.name,path:this.path,title:this.title})};var k;e([h.property({json:{write:!0}})],g.prototype,"name",void 0);e([h.property({json:{write:!0}})],g.prototype,"path",void 0);e([h.property({json:{write:!0}})],g.prototype,"title",void 0);return g=k=e([h.subclass("esri.webscene.TransportationNetwork")],g)}(h.declared(n.JSONSupport))})},"esri/webscene/Version":function(){define(["require","exports","../core/tsSupport/extendsHelper","../core/Version"],function(q,
c,m,e){Object.defineProperty(c,"__esModule",{value:!0});q=function(c){function e(e,h){return c.call(this,e,h,"webscene")||this}m(e,c);Object.defineProperty(e.prototype,"supportsGround",{get:function(){return this.since(1,8)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"supportsVisibleElevationLayersInSlides",{get:function(){return this.lessThan(1,8)},enumerable:!0,configurable:!0});return e}(e.Version);c.Version=q;c.default=q})},"esri/core/Version":function(){define(["require",
"exports","./Error"],function(q,c,m){Object.defineProperty(c,"__esModule",{value:!0});q=function(){function c(c,e,k){void 0===k&&(k="");this.major=c;this.minor=e;this._context=k}c.prototype.lessThan=function(c,e){return this.major<c||c===this.major&&this.minor<e};c.prototype.since=function(c,e){return!this.lessThan(c,e)};c.prototype.validate=function(c){if(this.major!==c.major)throw new m((this._context&&this._context+":")+"unsupported-version","Required major "+(this._context&&this._context+" ")+
"version is '"+this.major+"', but got '${version.major}.${version.minor}'",{version:c});};c.prototype.clone=function(){return new c(this.major,this.minor,this._context)};c.parse=function(e,h){void 0===h&&(h="");var k=e.split("."),g=k[0],k=k[1],n=/^\s*\d+\s*$/;if(!g||!g.match||!g.match(n))throw new m((h&&h+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:e});if(!k||!k.match||!k.match(n))throw new m((h&&h+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",
{version:e});e=parseInt(g,10);g=parseInt(k,10);return new c(e,g,h)};return c}();c.Version=q})},"*noref":1}});
define("require exports ./core/tsSupport/declareExtendsHelper ./core/tsSupport/decorateHelper ./core/tsSupport/paramHelper ./core/tsSupport/assignHelper ./core/tsSupport/generatorHelper ./core/tsSupport/awaiterHelper ./kernel ./Map ./Viewpoint ./core/Collection ./core/Error ./core/Handles ./core/has ./core/JSONSupport ./core/lang ./core/Loadable ./core/loadAll ./core/Logger ./core/Promise ./core/promiseUtils ./core/urlUtils ./core/accessorSupport/decorators ./core/accessorSupport/originUtils ./core/accessorSupport/read ./geometry/Extent ./geometry/HeightModelInfo ./geometry/SpatialReference ./geometry/support/heightModelInfoUtils ./geometry/support/jsonUtils ./portal/Portal ./portal/PortalItem ./support/webSceneUtils ./views/3d/support/projectionUtils ./views/support/spatialReferenceSupport ./webdoc/support/thumbnailUtils ./webscene/ApplicationProperties ./webscene/Environment ./webscene/InitialViewProperties ./webscene/Presentation ./webscene/TransportationNetwork ./webscene/Version".split(" "),function(q,
c,m,e,n,h,k,g,p,a,b,d,f,l,P,r,R,D,V,X,Z,E,C,t,A,v,O,B,w,x,y,G,K,H,M,I,L,N,F,U,Y,ea,S){var T=X.getLogger("esri.WebScene"),aa=new S.default(1,19);return function(a){function c(b){b=a.call(this,b)||this;b._handles=new l;b.applicationProperties=null;b.clippingArea=null;b.clippingEnabled=!1;b.heightModelInfo=null;b.sourceVersion=null;b.supportsHeightModelInfo=!0;b.transportationNetworks=null;b.presentation=new Y;b.initialViewProperties=new U;b.portalItem=null;b.resourceInfo=null;b.authoringApp=null;b.authoringAppVersion=
null;b._isAuthoringAppSetByUser=!1;b._isAuthoringAppVersionSetByUser=!1;return b}m(c,a);c.prototype.initialize=function(){var a=this;this.when().catch(function(a){T.error("#load()","Failed to load web scene",a)});if(this.resourceInfo){var b=void 0;try{b=this._validateJSON(this.resourceInfo)}catch(ba){this.addResolvingPromise(E.reject(ba));return}this.read(b);this.addResolvingPromise(this._validateSpatialReference());this.addResolvingPromise(this._validateHeightModelInfo())}this._handles.add(this.allLayers.on("change",
function(){return a._scheduleLayersIdGC()}))};c.prototype.destroy=function(){this._unscheduleLayersIdGC();this._handles.destroy()};c.prototype.writeClippingArea=function(a,b){b.clippingArea||(b.clippingArea={});b.clippingArea.geometry=a.toJSON()};c.prototype.readClippingEnabled=function(a,b){return b.clippingArea?!!b.clippingArea.clip:!1};c.prototype.writeClippingEnabled=function(a,b){this.clippingArea&&(b.clippingArea||(b.clippingArea={}),b.clippingArea.clip=a)};c.prototype.writeLayers=function(a,
b,c,d){var f=this,e=h({},d,{layerContainerType:"operational-layers"});a=a.map(function(a){return f.verifyWriteLayer(a,d)?a.write(null,e):null}).filter(function(a){return!!a});b[c]=a.toArray()};c.prototype.verifyWriteLayer=function(a,b){return"write"in a?!0:(b&&b.messages&&b.messages.push(new f("layer:unsupported","Layers ("+a.title+", "+a.id+") of type '"+a.declaredClass+"' cannot be persisted in web scenes",{layer:a})),!1)};c.prototype.readSourceVersion=function(a,b){a=b.version.split(".");b=a[1];
return new S.default(parseInt(a[0],10),parseInt(b,10))};c.prototype.writeSourceVersion=function(a,b,c){b[c]=aa.major+"."+aa.minor};Object.defineProperty(c.prototype,"thumbnailUrl",{get:function(){return this.portalItem&&this.portalItem.thumbnailUrl||null},set:function(a){a?this._override("thumbnailUrl",a):this._clearOverride("thumbnailUrl")},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"authoringApp",{set:function(a){this._isAuthoringAppSetByUser=!0;this._set("authoringApp",a)},
enumerable:!0,configurable:!0});c.prototype.writeAuthoringApp=function(a,b){b.authoringApp=a&&this._isAuthoringAppSetByUser?a:"ArcGIS API for JavaScript"};Object.defineProperty(c.prototype,"authoringAppVersion",{set:function(a){this._isAuthoringAppVersionSetByUser=!0;this._set("authoringAppVersion",a)},enumerable:!0,configurable:!0});c.prototype.writeAuthoringAppVersion=function(a,b){b.authoringAppVersion=a&&this._isAuthoringAppVersionSetByUser?a:p.version};c.prototype.writeGround=function(a,b,c,
d){b[c]=a?a.write(null,d):{transparency:0,layers:[]}};c.prototype.readInitialViewProperties=function(a,c){a={};c.initialState&&c.initialState.environment&&(a.environment=F.fromJSON(c.initialState.environment));a.spatialReference=c.spatialReference?w.fromJSON(c.spatialReference):w.WebMercator;a.viewingMode=c.viewingMode||"global";c.initialState&&c.initialState.viewpoint&&(a.viewpoint=b.fromJSON(c.initialState.viewpoint));return new U(a)};c.prototype.writeInitialViewProperties=function(a,b,c,d){a&&
(c={},a.environment&&(c.environment=a.environment.write({},d)),a.viewpoint&&(c.viewpoint=a.viewpoint.write({},d)),0!==Object.keys(c).length&&(b.initialState=c),b.spatialReference=a.spatialReference?a.spatialReference.write({},d):w.WebMercator.toJSON(),b.viewingMode=null!=a.viewingMode?a.viewingMode:"global")};c.prototype.load=function(a){this.addResolvingPromise(this._loadFromSource());return E.resolve(this)};c.prototype.loadAll=function(){var a=this;return V.default(this,function(b){var c=a.presentation&&
a.presentation.slides;b(a.ground,a.basemap,a.layers,c&&c.map(function(a){return a.basemap}))})};c.prototype.read=function(a,b){var c=this;b=h({},b,{origin:"web-scene"});var d=this._isAuthoringAppVersionSetByUser,f=this._isAuthoringAppSetByUser,e=arguments;v.readLoadable(this,a,function(b){return c.inherited(e,[a,b])},b);f||(this._isAuthoringAppSetByUser=!1);d||(this._isAuthoringAppVersionSetByUser=!1);if(a.baseMap&&Array.isArray(a.baseMap.elevationLayers)&&this.sourceVersion.supportsVisibleElevationLayersInSlides){var d=
a.baseMap.elevationLayers.map(function(a){return{id:a.id}}),g=this.presentation.slides,k=function(a,b){return a.visibleLayers.some(function(a){return a.id===b})},l=d.filter(function(a){return!g.some(function(b){return k(b,a.id)})});g.forEach(function(a){a.visibleLayers.addMany(l)})}};c.prototype._writeBasemapElevationLayers=function(a){var b=a.ground&&a.ground.layers;!a.baseMap&&b&&b.length&&(a.baseMap={title:"Basemap",baseMapLayers:[]});a.baseMap&&(a.baseMap.elevationLayers=R.clone(b))};c.prototype.write=
function(a,b){if("loaded"!==this.loadStatus){var c=new f("webscene:not-loaded","Web scene must be loaded before it can be serialized");T.error("#toJSON()","Web scene must be loaded before it can be serialized",this.loadError||this.loadStatus);throw c;}this._runLayersIdGC();b=h({},b,{origin:"web-scene"});c=this.inherited(arguments,[a,b]);this._writeBasemapElevationLayers(c);return c};c.prototype.save=function(a){return g(this,void 0,void 0,function(){var b,c,d;return k(this,function(e){switch(e.label){case 0:if(this.portalItem)return[3,
2];T.error("save(): requires the .portalItem property to be set");return[4,E.reject(new f("webscene:portal-item-not-set","Portal item to save to has not been set on the WebScene"))];case 1:e.sent(),e.label=2;case 2:return"Web Scene"===this.portalItem.type?[3,4]:[4,E.reject(new f("webscene:portal-item-wrong-type",'Portal item needs to have type "Web Scene"'))];case 3:e.sent(),e.label=4;case 4:return b=this._updateFromPromise,[4,this.load()];case 5:return e.sent(),[4,this._loadObjectsWithLayers()];
case 6:return e.sent(),c=this._enableVerifyItemRelativeUrls({origin:"web-scene",url:this.portalItem.itemUrl&&C.urlToObject(this.portalItem.itemUrl),messages:[],portal:this.portalItem.portal||G.getDefault(),writtenProperties:[],blockedRelativeUrls:[]}),d=this.write(null,c),[4,this._verifySave(d,c,a)];case 7:return e.sent(),this._updateTypeKeywords(this.portalItem),[4,this.portalItem.update({data:d})];case 8:return e.sent(),A.updateOrigins(c),b?[4,b]:[3,10];case 9:e.sent(),e.label=10;case 10:return[4,
this._saveThumbnail()];case 11:return e.sent(),[2,this.portalItem]}})})};c.prototype.saveAs=function(a,b){return g(this,void 0,void 0,function(){var c,d,e,g,h,l;return k(this,function(k){switch(k.label){case 0:if(c=K.from(a))return[3,2];T.error("saveAs(portalItem): requires a portal item parameter");return[4,E.reject(new f("webscene:portal-item-required","saveAs requires a portal item to save to"))];case 1:k.sent(),k.label=2;case 2:return c.id&&(c=c.clone(),c.id=null),d=c.portal||G.getDefault(),[4,
this.load()];case 3:return k.sent(),[4,this._loadObjectsWithLayers()];case 4:return k.sent(),e=this._enableVerifyItemRelativeUrls({origin:"web-scene",url:null,messages:[],portal:d,writtenProperties:[],blockedRelativeUrls:[]}),g=this.write(null,e),[4,this._verifySaveAs(g,e,b)];case 5:return k.sent(),[4,d._signIn()];case 6:return k.sent(),h=this.thumbnailUrl,l=!this._isOverridden("thumbnailUrl"),c.type="Web Scene",c.portal=d,this._updateTypeKeywords(c),[4,d.user.addItem({item:c,folder:b&&b.folder,data:g})];
case 7:return k.sent(),this.portalItem=c,r.JSONSupport.prototype.read.call(this,{version:g.version,authoringApp:g.authoringApp,authoringAppVersion:g.authoringAppVersion},{name:"web-scene",ignoreDefaults:!0,url:c.itemUrl&&C.urlToObject(c.itemUrl)}),A.updateOrigins(e),h&&(this.thumbnailUrl=l?C.addQueryParameter(h,"w","8192"):h),[4,this._saveThumbnail()];case 8:return k.sent(),[2,c]}})})};c.prototype._saveThumbnail=function(){return g(this,void 0,void 0,function(){return k(this,function(a){switch(a.label){case 0:return this._isOverridden("thumbnailUrl")?
[4,this.portalItem.updateThumbnail({thumbnail:this.thumbnailUrl})]:[3,2];case 1:a.sent(),this._clearOverride("thumbnailUrl"),a.label=2;case 2:return[2]}})})};c.prototype._verifySave=function(a,b,c,d){void 0===d&&(d=!1);var e=b.messages.filter(function(a){return"error"===a.type}).map(function(a){return new f(a.name,a.message,a.details)});b.blockedRelativeUrls&&(e=e.concat(b.blockedRelativeUrls.map(function(a){return new f("url:unsupported","Relative url '"+a+"' is not supported in Web Scene")})));
c&&c.ignoreUnsupported&&(e=e.filter(function(a){return"layer:unsupported"!==a.name&&"symbol:unsupported"!==a.name&&"symbol-layer:unsupported"!==a.name&&"property:unsupported"!==a.name&&"url:unsupported"!==a.name}));c&&c.strictSchemaValidationEnabled||(e=e.filter(function(a){return"web-document-write:property-required"!==a.name}));var g=c&&c.strictSchemaValidationEnabled;return(g?E.create(function(a){return q(["./webscene/validator"],a)}).then(function(b){b=b.validate(a);if(0<b.length){var c="webscene did not validate:\n"+
b.join("\n");T.error((d?"saveAs":"save")+"(): "+c)}return b.map(function(a){return new f("webscene:schema-validation",a)})}).then(function(a){if(g&&0<a.length)throw H.createSchemaValidationError(a.concat(e));return e}):E.resolve(e)).then(function(a){if(0<a.length)return E.reject(new f("webscene:save","Failed to save webscene due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:a}))})};c.prototype._verifySaveAs=function(a,b,c){return this.canSaveAs(b)?
E.reject(H.createCopyError()):this._verifySave(a,b,c,!0)};c.prototype.verifySaveAs=function(a){var b=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),c=this.write(null,b);return this._verifySaveAs(c,b,a)};c.prototype.canSaveAs=function(a){a||(a=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),this.write(null,a));return a.verifyItemRelativeUrls&&0<a.verifyItemRelativeUrls.writtenUrls.length};c.prototype.updateFrom=function(a,b){void 0===b&&(b={});return g(this,
void 0,void 0,function(){var c,d;return k(this,function(f){switch(f.label){case 0:return this._updateFromPromise=c=this._updateFromInternal(a,b),[4,c];case 1:f.sent();if(d=this._updateFromPromise===c)this._updateFromPromise=null;return[2]}})})};c.prototype._updateFromInternal=function(a,b){void 0===b&&(b={});return g(this,void 0,void 0,function(){return k(this,function(c){switch(c.label){case 0:return[4,a.whenReady()];case 1:return c.sent(),!b.environmentExcluded&&a.environment&&(this.initialViewProperties.environment=
F.prototype.clone.apply(a.environment)),!b.viewpointExcluded&&a.viewpoint&&(this.initialViewProperties.viewpoint=a.viewpoint.clone()),this.initialViewProperties.spatialReference=a.spatialReference.clone(),this.initialViewProperties.viewingMode=a.viewingMode,a.clippingArea?a.clippingArea!==this.clippingArea&&(this.clippingArea=a.clippingArea.clone(),this.clippingEnabled=!0):this.clippingEnabled=!1,a.heightModelInfo&&(this.heightModelInfo=a.heightModelInfo.clone()),a.map===this&&a.allLayerViews.forEach(function(a){a.layer.visible=
a.visible}),!1===b.thumbnailExcluded||null==b.thumbnailExcluded&&!b.viewpointExcluded?[4,this._updateFromThumbnail(a,b.thumbnailSize||void 0)]:[3,3];case 2:c.sent(),c.label=3;case 3:return[2]}})})};c.prototype._updateFromThumbnail=function(a,b){return g(this,void 0,void 0,function(){var c,d;return k(this,function(f){switch(f.label){case 0:return c=L.getOptimalThumbnailSize(a,b),[4,a.takeScreenshot({format:"jpg",width:c.width,height:c.height,disableSlice:!0})];case 1:return d=f.sent(),this.thumbnailUrl=
d.dataUrl,[2]}})})};c.prototype._loadFromSource=function(){return this.resourceInfo?this._loadFromJSON(this.resourceInfo,{origin:"web-scene"}):this.portalItem&&this.portalItem.id?this._loadFromItem(this.portalItem):this._loadObjectsWithLayers()};c.prototype._readAndLoadFromJSON=function(a,b){a=this._validateJSON(a);this.read(a,b);return this._loadFromJSON(a,b)};c.prototype._extractOperationalLayers=function(a){var b=this,c=[];if(!this.sourceVersion.supportsGround&&a.baseMap&&Array.isArray(a.baseMap.elevationLayers))for(var d=
0,f=a.baseMap.elevationLayers;d<f.length;d++)c.push(f[d]);var e=[],g=function(a){a.layers&&(a.layers=a.layers.filter(g));return"ArcGISTiledElevationServiceLayer"===a.layerType?(b.sourceVersion.supportsGround||e.push(a),!1):!0};return{operationalLayers:a.operationalLayers?a.operationalLayers.filter(g):[],operationalElevationLayers:e,basemapElevationLayers:c}};c.prototype._loadFromJSON=function(a,b){var c=this,f=new d;return this._validateSpatialReference().then(function(){return c._validateHeightModelInfo()}).then(function(){return E.create(function(a){return q(["./portal/support/layersCreator"],
a)})}).then(function(d){var e=c._extractOperationalLayers(a),g=e.operationalLayers,k=e.operationalElevationLayers,e=e.basemapElevationLayers,l=[],m={context:h({},b,{layerContainerType:"operational-layers"})};c.portalItem&&(m.context.portal=c.portalItem.portal||G.getDefault());if(0<e.length){var n=h({},m,{context:h({},m.context,{layerContainerType:"ground"})});n.defaultLayerType="ArcGISTiledElevationServiceLayer";l.push(d.populateOperationalLayers(c.ground.layers,e,n))}0<k.length&&(n=h({},m,{context:h({},
m.context,{layerContainerType:"ground"})}),n.defaultLayerType="ArcGISTiledElevationServiceLayer",l.push(d.populateOperationalLayers(f,k,n)));g&&0<g.length&&l.push(d.populateOperationalLayers(c.layers,g,m));return E.eachAlways(l).then(function(){})}).then(function(){return c._loadObjectsWithLayers()}).then(function(){c.ground.layers.addMany(f)})};c.prototype._loadObjectsWithLayers=function(){var a=[];this.ground&&a.push(this.ground.load());this.basemap&&a.push(this.basemap.load());this.presentation.slides.forEach(function(b){b.basemap&&
a.push(b.basemap.load())});return E.eachAlways(a).then(function(){})};c.prototype._loadFromItem=function(a){var b=this;return a.load().catch(function(a){throw new f("webscene:load-portal-item","Failed to load portal item",{error:a});}).then(function(){if("Web Scene"!==a.type)throw new f("webscene:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Scene'",{type:a.type});}).then(function(){return a.fetchData()}).then(function(c){b.resourceInfo=c;return b._readAndLoadFromJSON(c,
{origin:"web-scene",url:C.urlToObject(a.itemUrl),portal:a.portal||G.getDefault()})})};c.prototype._validateSpatialReference=function(){var a=this.initialViewProperties,b=this._sceneSpatialReference,c;if("local"!==a.viewingMode){if(!I.isSpatialReferenceSupported(b,"global"))return E.reject(new f("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in global mode, only Web Mercator, WGS84 GCS or CGCS2000 are supported",{spatialReference:b,viewingMode:a.viewingMode}));
c=function(a){return!a||M.canProject(a,b)}}else{if(!I.isSpatialReferenceSupported(b,"local"))return E.reject(new f("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in local mode, only projected coordinate systems are supported",{spatialReference:b,viewingMode:a.viewingMode}));c=function(a){return!a||a.equals(b)}}var d=function(a){return a&&(a.camera&&a.camera.position&&a.camera.position.spatialReference||a.targetGeometry&&a.targetGeometry.spatialReference)},
e=d(a.viewpoint);return e&&!c(e)?E.reject(new f("webscene:incompatible-camera-spatial-reference","Camera spatial reference (${cameraSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{cameraSpatialReference:e,sceneSpatialReference:b,viewingMode:a.viewingMode})):(e=this.presentation.slides.find(function(a){return!c(d(a.viewpoint))}))?(e=d(e.viewpoint),E.reject(new f("webscene:incompatible-slide-spatial-reference","Slide spatial reference (${slideSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",
{slideSpatialReference:e,sceneSpatialReference:b,viewingMode:a.viewingMode}))):E.resolve()};c.prototype._validateHeightModelInfo=function(){var a=x.validateWebSceneError(this.heightModelInfo,this._sceneSpatialReference);return a?E.reject(a):E.resolve()};c.prototype._validateJSON=function(a){var b=S.default.parse(a.version||"","webscene");aa.validate(b);a.version=b.major+"."+b.minor;1===b.major&&2>=b.minor&&(a.spatialReference=w.WebMercator.toJSON());return a};c.prototype._updateTypeKeywords=function(a){"local"===
this.initialViewProperties.viewingMode?a.typeKeywords?-1===a.typeKeywords.indexOf("ViewingMode-Local")&&a.typeKeywords.push("ViewingMode-Local"):a.typeKeywords=["ViewingMode-Local"]:"global"===this.initialViewProperties.viewingMode&&a.typeKeywords&&(a.typeKeywords=a.typeKeywords.filter(function(a){return"ViewingMode-Local"!==a}));a.typeKeywords&&(a.typeKeywords=a.typeKeywords.filter(function(a,b,c){return c.indexOf(a)===b}))};Object.defineProperty(c.prototype,"_sceneSpatialReference",{get:function(){return this.initialViewProperties.spatialReference||
w.WebMercator},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"_verifyItemRelativeRootPath",{get:function(){return this.portalItem&&this.portalItem.itemUrl?C.urlToObject(this.portalItem.itemUrl).path:null},enumerable:!0,configurable:!0});c.prototype._enableVerifyItemRelativeUrls=function(a){var b=this._verifyItemRelativeRootPath;b&&(a.verifyItemRelativeUrls={rootPath:b,writtenUrls:[]});return a};c.prototype._unscheduleLayersIdGC=function(){this._layersIdGCTimeoutId&&(clearTimeout(this._layersIdGCTimeoutId),
this._layersIdGCTimeoutId=0)};c.prototype._scheduleLayersIdGC=function(){var a=this;this._unscheduleLayersIdGC();this._layersIdGCTimeoutId=setTimeout(function(){a._layersIdGCTimeoutId=0;a._runLayersIdGC()},3E3)};c.prototype._runLayersIdGC=function(){var a=this;this._unscheduleLayersIdGC();var b=this.applicationProperties&&this.applicationProperties.viewing&&this.applicationProperties.viewing.search,c=function(b){return!!a.allLayers.find(function(a){return a.id===b})};b&&b.layers&&(b.layers=b.layers.filter(function(a){return c(a.id)}));
(b=this.presentation&&this.presentation.slides)&&b.forEach(function(a){a.visibleLayers&&(a.visibleLayers=a.visibleLayers.filter(function(a){return c(a.id)}))})};c.fromJSON=function(a){if(!a)throw new f("webscene:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:a})};c.VERSION=aa;e([t.property({type:N,json:{write:!0}})],c.prototype,"applicationProperties",void 0);e([t.property({json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],c.prototype,"basemap",
void 0);e([t.property({type:O,json:{read:{source:"clippingArea.geometry",reader:y.fromJSON},write:{target:"clippingArea.geometry"}}})],c.prototype,"clippingArea",void 0);e([t.writer("clippingArea")],c.prototype,"writeClippingArea",null);e([t.property({type:Boolean,json:{write:{target:"clippingArea.clip"}}})],c.prototype,"clippingEnabled",void 0);e([t.reader("clippingEnabled",["clippingArea"])],c.prototype,"readClippingEnabled",null);e([t.writer("clippingEnabled")],c.prototype,"writeClippingEnabled",
null);e([t.property({type:B,json:{write:!0}})],c.prototype,"heightModelInfo",void 0);e([t.property({json:{write:{target:"operationalLayers"}}})],c.prototype,"layers",void 0);e([t.writer("layers")],c.prototype,"writeLayers",null);e([t.property({readOnly:!0,type:S.default,json:{type:String,write:{allowNull:!0,target:"version",isRequired:!0}}})],c.prototype,"sourceVersion",void 0);e([t.reader("sourceVersion",["version"])],c.prototype,"readSourceVersion",null);e([t.writer("sourceVersion")],c.prototype,
"writeSourceVersion",null);e([t.property({dependsOn:["portalItem.thumbnailUrl"]})],c.prototype,"thumbnailUrl",null);e([t.property({type:String,json:{write:{allowNull:!0}}})],c.prototype,"authoringApp",null);e([t.writer("authoringApp")],c.prototype,"writeAuthoringApp",null);e([t.property({type:String,json:{write:{allowNull:!0}}})],c.prototype,"authoringAppVersion",null);e([t.writer("authoringAppVersion")],c.prototype,"writeAuthoringAppVersion",null);e([t.property({json:{write:{isRequired:!0,allowNull:!0,
enabled:!0}}})],c.prototype,"ground",void 0);e([t.writer("ground")],c.prototype,"writeGround",null);e([t.property({type:d.ofType(ea),json:{write:!0}})],c.prototype,"transportationNetworks",void 0);e([t.property({type:Y,nonNullable:!0,json:{write:function(a,b,c,d){a.slides&&0<a.slides.length&&(c=h({},d,{isPresentation:!0}),b.presentation=a.write(null,c))}}})],c.prototype,"presentation",void 0);e([t.property({type:U,nonNullable:!0,json:{default:function(){return new U({viewingMode:"global",spatialReference:w.WebMercator})}}})],
c.prototype,"initialViewProperties",void 0);e([t.reader("initialViewProperties",["initialState.environment","spatialReference","viewingMode","initialState.viewpoint"])],c.prototype,"readInitialViewProperties",null);e([t.writer("initialViewProperties",{"initialState.environment":{type:F},spatialReference:{type:w},viewingMode:{type:String},"initialState.viewpoint":{type:b}})],c.prototype,"writeInitialViewProperties",null);e([t.property({type:K})],c.prototype,"portalItem",void 0);e([t.property()],c.prototype,
"resourceInfo",void 0);return c=e([t.subclass("esri.WebScene")],c)}(t.declared(D.LoadableMixin(Z.EsriPromiseMixin(r.JSONSupportMixin(a)))))});