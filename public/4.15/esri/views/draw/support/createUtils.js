// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.15/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../geometry ../../../core/arrayUtils ../../../core/lang ../../../core/maybe ../../../core/unitUtils ../../../core/libs/gl-matrix-2/mat2d ../../../core/libs/gl-matrix-2/mat2df64 ../../../core/libs/gl-matrix-2/quat ../../../core/libs/gl-matrix-2/quatf64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Circle ../../../geometry/geometryEngine ../../../geometry/support/coordsUtils ../../../geometry/support/spatialReferenceUtils".split(" "),
function(r,f,w,J,m,D,E,x,F,G,u,y,z,n,k,H,A,t,I){function p(a,d,e){void 0===e&&(e=null);return x.isSome(e)?[a,d,e]:[a,d]}function g(a,d,e){void 0===e&&(e=null);return x.isSome(e)?{x:a,y:d,z:e}:{x:a,y:d}}function v(a,d){d=new m.Point({x:a[0],y:a[1],spatialReference:d});2<a.length&&(d.z=a[2]);return d}function q(a,d,e,b){void 0===b&&(b=!0);a=E.clone(a);a.forEach(function(a){D.equals(a[0],a[a.length-1])||a.push(a[0])});a=new m.Polygon({rings:a,spatialReference:d});a.rings.forEach(function(a){t.isClockwise(a,
!1,!1)||a.reverse()});e&&t.unnormalizeGeometryOnDatelineCrossing(a);b&&a.isSelfIntersecting&&I.isValid(d)&&(a=A.simplify(a));return a}Object.defineProperty(f,"__esModule",{value:!0});f.makeMapPoint=p;f.makeSurfacePoint=g;r=function(){function a(a){this.spatialReference=a}a.prototype.mapToLocalMultiple=function(a){var e=this;return a.map(function(a){return e.mapToLocal(a)})};Object.defineProperty(a.prototype,"doUnnormalization",{get:function(){return!1},enumerable:!0,configurable:!0});return a}();
f.SurfaceCoordinateSystem=r;var B=function(a){function d(e,b,c){void 0===c&&(c=null);b=a.call(this,b)||this;b.defaultZ=c;b.transform=u.mat2df64.create();b.transformInv=u.mat2df64.create();b.transform=u.mat2df64.clone(e);G.mat2d.invert(b.transformInv,b.transform);return b}w(d,a);d.prototype.makeMapPoint=function(a,b){return p(a,b,this.defaultZ)};d.prototype.mapToLocal=function(a){return g(this.transform[0]*a[0]+this.transform[2]*a[1]+this.transform[4],this.transform[1]*a[0]+this.transform[3]*a[1]+
this.transform[5])};d.prototype.localToMap=function(a){return p(this.transformInv[0]*a.x+this.transformInv[2]*a.y+this.transformInv[4],this.transformInv[1]*a.x+this.transformInv[3]*a.y+this.transformInv[5],this.defaultZ)};return d}(r);f.AffineCoordinateSystem=B;var C=function(a){function d(e,b){var c=a.call(this,e.spatialReference)||this;c.view=e;c.defaultZ=null;c.pWS=k.vec3f64.create();c.tangentFrameUpWS=k.vec3f64.create();c.tangentFrameRightWS=k.vec3f64.create();c.tangentFrameForwardWS=k.vec3f64.create();
c.localFrameRightWS=k.vec3f64.create();c.localFrameUpWS=k.vec3f64.create();c.worldToLocalTransform=z.quatf64.create();c.localToWorldTransform=z.quatf64.create();c.scale=1;c.scale=e.resolution;c.referenceMapPoint=b;c.defaultZ=b.hasZ?b.z:null;e=e.state.camera.viewRight;c.view.renderCoordsHelper.toRenderCoords(c.referenceMapPoint,c.pWS);c.view.renderCoordsHelper.worldBasisAtPosition(c.pWS,0,c.tangentFrameRightWS);c.view.renderCoordsHelper.worldBasisAtPosition(c.pWS,1,c.tangentFrameUpWS);c.view.renderCoordsHelper.worldBasisAtPosition(c.pWS,
2,c.tangentFrameForwardWS);b=k.vec3f64.create();n.vec3.scale(b,c.tangentFrameForwardWS,n.vec3.dot(e,c.tangentFrameForwardWS));n.vec3.subtract(c.localFrameRightWS,e,b);n.vec3.normalize(c.localFrameRightWS,c.localFrameRightWS);n.vec3.cross(c.localFrameUpWS,c.tangentFrameForwardWS,c.localFrameRightWS);y.quat.rotationTo(c.worldToLocalTransform,c.localFrameRightWS,c.tangentFrameRightWS);y.quat.invert(c.localToWorldTransform,c.worldToLocalTransform);return c}w(d,a);Object.defineProperty(d.prototype,"doUnnormalization",
{get:function(){return"global"===this.view.viewingMode},enumerable:!0,configurable:!0});d.prototype.makeMapPoint=function(a,b){return p(a,b,this.defaultZ)};d.prototype.mapToLocal=function(a){var b=k.vec3f64.create();this.view.renderCoordsHelper.toRenderCoords(new m.Point({x:a[0],y:a[1],spatialReference:this.spatialReference}),b);n.vec3.transformQuat(b,b,this.worldToLocalTransform);a=this.view.renderCoordsHelper.fromRenderCoords(b,this.view.spatialReference);return g(a.x/this.scale,a.y/this.scale)};
d.prototype.localToMap=function(a){var b=k.vec3f64.create();this.view.renderCoordsHelper.toRenderCoords(new m.Point({x:a.x*this.scale,y:a.y*this.scale,spatialReference:this.spatialReference}),b);n.vec3.transformQuat(b,b,this.localToWorldTransform);a=this.view.renderCoordsHelper.fromRenderCoords(b,this.view.spatialReference);return p(a.x,a.y,this.defaultZ)};return d}(r);f.SceneViewCoordinateSystem=C;f.createViewAlignedCoordinateSystem=function(a,d){return"2d"===a.type?new B(a.state.transform,a.spatialReference,
2<d.length?d[2]:null):"3d"===a.type?(d=2<d.length?new m.Point({x:d[0],y:d[1],z:d[2],spatialReference:a.spatialReference}):new m.Point({x:d[0],y:d[1],spatialReference:a.spatialReference}),new C(a,d)):null};f.createPoint=v;f.createMultipoint=function(a,d){return new m.Multipoint({points:a,spatialReference:d})};f.createPolyline=function(a,d,e){a=new m.Polyline({paths:a,spatialReference:d});e&&t.unnormalizeGeometryOnDatelineCrossing(a);return a};f.createPolygon=q;f.createSquare=function(a,d,e){var b=
d.mapToLocalMultiple(a);a=[];var c=b[0].x,l=b[0].y,h=Math.round(b[1].x-c),f=Math.round(b[1].y-l),b=Math.max(Math.abs(h),Math.abs(f));e?(e=c+b,h=l+b,c-=b,l-=b,a.push(g(e,l),g(c,l),g(c,h),g(e,h))):(e=0<h?c+b:c-b,b=0<f?l+b:l-b,a.push(g(c,l),g(e,l),g(e,b),g(c,b)));return q([a.map(function(a){return d.localToMap(a)})],d.spatialReference,d.doUnnormalization,!0)};f.createRectangle=function(a,d,e){var b=d.mapToLocalMultiple(a);1===b.length&&(a=b[0],b=[g(a.x-48,a.y+48),g(a.x+48,a.y-48),g(a.x+48,a.y-48),g(a.x-
48,a.y+48)]);a=[];var c=b[0].x,f=b[0].y,h=b[1].x,b=b[1].y;if(e){e=Math.round(h-c);var k=Math.round(b-f);a.push(g(c-e,f-k),g(h,f-k),g(h,b),g(c-e,b))}else a.push(g(c,f),g(h,f),g(h,b),g(c,b));return q([a.map(function(a){return d.localToMap(a)})],d.spatialReference,d.doUnnormalization,!0)};f.createCircle=function(a,d,e){var b=d.mapToLocalMultiple(a),c=a=null;e?(a=b[0],c=b[1]):(a=b[0],b=b[1],e=Math.round(b.x-a.x),b=Math.round(b.y-a.y),c=Math.max(Math.abs(e),Math.abs(b)),a=g(0<e?a.x+c/2:a.x-c/2,0<b?a.y+
c/2:a.y-c/2),c=g(Math.abs(e)>Math.abs(b)?a.x-c/2:a.x,Math.abs(e)>Math.abs(b)?a.y:a.y-c/2));a=d.localToMap(a);e=d.localToMap(c);d.doUnnormalization&&t.unnormalizeVerticesOnDatelineCrossing([[a,e]],d.spatialReference);a=v(a,d.spatialReference);e=v(e,d.spatialReference);e=F.getMetersPerUnitForSR(d.spatialReference)*A.distance(a,e,null);d=new H({center:a,radius:e,radiusUnit:"meters",spatialReference:d.spatialReference});return q(d.rings,d.spatialReference,!1)};f.createEllipse=function(a,d,e){var b=d.mapToLocalMultiple(a);
a=b[0];var c=b[1],b=Math.round(c.x-a.x),c=Math.round(c.y-a.y);a=g(e?a.x:a.x+b/2,e?a.y:a.y+c/2);b=e?b:b/2;e=e?c:c/2;for(var c=[],f=2*Math.PI/60,h=0;60>h;h++){var k=g(b*Math.cos(h*f)+a.x,e*Math.sin(h*f)+a.y);c.push(k)}c.push(c[0]);return q([c.map(function(a){return d.localToMap(a)})],d.spatialReference,d.doUnnormalization,!1)}});