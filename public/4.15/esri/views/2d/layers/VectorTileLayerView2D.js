// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.15/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/engine/vectorTiles/TileHandler":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../request ../../../../core/has ../../../../core/ItemCache ../../../../core/maybe ../../../../core/MemCache ../../../../core/promiseUtils ../../../../core/workers ../../../../geometry/support/aaBoundingRect ../vectorTiles/VectorTile ./GeometryUtils ./GlyphMosaic ./GlyphSource ./SpriteMosaic ./TileIndex ../../tiling/TileKey".split(" "),
function(q,h,k,g,c,f,a,b,d,e,l,p,z,D,t,r,x,F,B,y){Object.defineProperty(h,"__esModule",{value:!0});var w=new b(10),m=new Map;q=function(){function b(a,d,b,e,l,p){this._vectorTileLayer=a;this.devicePixelRatio=d;this.allowUpdates=b;this._container=e;this._memCache=l;this._enableCachingWorkerTiles=p;this._connection=this._glyphMosaic=this._spriteMosaic=null;this._updateToAbortController=new Map;this._ongoingTileRequests=new Map;this._ongoingRequestToController=new Map}b.prototype.destroy=function(){this._updateToAbortController&&
this._updateToAbortController.forEach(function(a){return a.abort()});this._ongoingTileRequests&&this.abortAll();this._connection&&(this._connection.close(),this._connection=null);this._vectorTileLayer=null;this._spriteMosaic&&(this._spriteMosaic.dispose(),this._spriteMosaic=null);this._glyphMosaic&&(this._glyphMosaic.dispose(),this._glyphMosaic=null)};Object.defineProperty(b.prototype,"spriteMosaic",{get:function(){var a=this;return this._spriteSourcePromise.then(function(){return a._spriteMosaic})},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"glyphMosaic",{get:function(){return this._glyphMosaic},enumerable:!0,configurable:!0});b.prototype.start=function(a){return c(this,void 0,void 0,function(){var d,b,e,c,A,f=this;return g(this,function(n){d=this._vectorTileLayer.sourceNameToSource;b=[];for(e in d)b.push(this._fetchTileMap(d[e],a));this._spriteSourcePromise=this._vectorTileLayer.loadSpriteSource(this.devicePixelRatio,a);this._spriteSourcePromise.then(function(a){f._spriteMosaic=
new F(1024,1024,250);f._spriteMosaic.setSpriteSource(a)});c=this._vectorTileLayer.styleRepository;A=new x(c.glyphs);this._glyphMosaic=new r(1024,1024,A);this._broadcastPromise=p.open("WorkerTileHandler",{client:this,scheduler:a.scheduler,signal:a.signal}).then(function(d){f._connection=d;return l.all(f._connection.broadcast("setLayers",{style:c.styleJSON,enableCachingTiles:f._enableCachingWorkerTiles},k({},a)))});return[2,l.all(b)]})})};b.prototype.updateStyle=function(){return c(this,void 0,void 0,
function(){var a,d=this;return g(this,function(b){switch(b.label){case 0:return[4,this._broadcastPromise];case 1:return b.sent(),this._updateToAbortController.forEach(function(a){return a.abort()}),this._updateToAbortController.clear(),a=this._vectorTileLayer.styleRepository,this._broadcastPromise=l.create(function(b,e){l.all(d._connection.broadcast("updateStyle",a.styleJSON)).then(b,e)}),[2,this._broadcastPromise]}})})};b.prototype.abortTileUpdate=function(a){this._updateToAbortController.has(a)&&
(this._updateToAbortController.get(a).abort(),this._updateToAbortController.delete(a))};b.prototype.updateTile=function(a,d){return c(this,void 0,void 0,function(){var b,e,n,c,p=this;return g(this,function(u){switch(u.label){case 0:return this.allowUpdates&&a.isReady?[4,this._broadcastPromise]:[2];case 1:u.sent();b=Math.round(t.degToByte(d.state.rotation));if(a.rotation===b)return[2,null];n=a.key;this._updateToAbortController.has(n.id)&&(e=this._updateToAbortController.get(n.id),e.abort(),this._updateToAbortController.delete(n.id));
e=l.createAbortController();a.rotation=b;c=a.client.invoke("updateSymbols",{key:a.id,rotation:b},{signal:e.signal}).then(function(b){p._updateToAbortController.delete(n.id);a.isReady&&a.updateSymbolData(b)}).catch(function(a){l.isAbortError(a)||p._updateToAbortController.delete(n.id)});this._updateToAbortController.set(a.id,e);return[2,c]}})})};b.prototype.updateTileData=function(a){for(var b=a.tileId,d=this._container.children,e,l=0;l<d.length;l++)if(e=d[l],e.id===b){e.updateTileData(a.tileData);
break}};b.prototype.getVectorTile=function(a,b,p,f){return c(this,void 0,void 0,function(){var n,c,u,A,C,r,m;return g(this,function(G){switch(G.label){case 0:return n=new y(a,b,p,0),d.isSome(this._memCache)&&(c=this._memCache.get(n.id))?(c.reference(),[2,c]):[4,this._getVectorTileData(n)];case 1:u=G.sent();l.throwIfAborted(f);if(d.isSome(this._memCache)&&(A=this._memCache.get(n.id)))return A.reference(),[2,A];C=this._vectorTileLayer.tileInfo;r=C.getTileBounds(z.create(),n);m=new D.VectorTile(n,this._vectorTileLayer.styleRepository,
r,[512,512],0,!1);u&&u.tileData?(m.setData(u.tileData,u.client),d.isSome(this._memCache)&&(m.reference(),this._memCache.put(m.key.id,m,m.getMemoryUsage()*m.referenced,e.MIN_PRIORITY))):m.setData(null,null);return[2,m]}})})};b.prototype.releaseVectorTile=function(a){d.isNone(this._memCache)||a.release()||this._memCache.updateSize(a.key.id,a,a.getMemoryUsage()*a.referenced)};b.prototype.fetchTileData=function(a,b){return c(this,void 0,void 0,function(){var d,e,n,l;return g(this,function(c){switch(c.label){case 0:return[4,
this._getRefKeys(a,b)];case 1:d=c.sent();e=this._vectorTileLayer.sourceNameToSource;n=[];for(l in e)n.push(l);return[2,this._getSourcesData(n,d,b)]}})})};b.prototype.parseTileData=function(b,d,e){return c(this,void 0,void 0,function(){var n,l,c,p,u,f,A,r,m=this;return g(this,function(C){switch(C.label){case 0:n=b&&b.data;if(!n)return[2,null];l=n.sourceName2DataAndRefKey;c=n.transferList;return 0===Object.keys(l).length?[2,null]:[4,this._broadcastPromise];case 1:return C.sent(),p=Math.round(t.degToByte(d)),
u=this._connection.getAvailableClient(),[4,u.invoke("createTileAndParse",{key:b.key.id,rotation:p,cacheTile:this.allowUpdates,sourceName2DataAndRefKey:l},k({},e,{transferList:c})).catch(function(){m._enableCachingWorkerTiles&&u.invoke("destructTileData",b.key.id).catch(function(){});return null})];case 2:f=C.sent();if(a("esri-vector-tiles-debug")){A={};for(r in l)A[r]=l[r].refKey;return[2,{tileData:f,client:u,refKeys:A}]}return[2,{tileData:f,client:u}]}})})};Object.defineProperty(b.prototype,"updating",
{get:function(){return 0<this._ongoingTileRequests.size},enumerable:!0,configurable:!0});b.prototype.abortAll=function(){this._ongoingRequestToController.forEach(function(a){return a.abort()});this._ongoingRequestToController.clear();this._ongoingTileRequests.clear()};b.prototype.getSprites=function(a){return c(this,void 0,void 0,function(){return g(this,function(b){switch(b.label){case 0:return[4,this._spriteSourcePromise];case 1:return b.sent(),[2,this._spriteMosaic.getSpriteItems(a)]}})})};b.prototype.getGlyphs=
function(a){return this._glyphMosaic.getGlyphItems(a.font,a.codePoints)};b.prototype.getStyleRepository=function(){return this._vectorTileLayer.styleRepository};b.prototype._getTilePayload=function(a,b,d){return c(this,void 0,void 0,function(){var e,n,l,c,p;return g(this,function(u){switch(u.label){case 0:return e=y.pool.acquire(a.id),n=this._vectorTileLayer.sourceNameToSource,l=n[b],c=l.getSourceTileUrl(e.level,e.row,e.col),y.pool.release(e),[4,f(c,k({responseType:"array-buffer"},d))];case 1:return p=
u.sent(),[2,{protobuff:p.data,sourceName:b}]}})})};b.prototype._fetchTileMap=function(a,b){if(a.capabilities.operations.supportsTileMap&&a.tileIndex||!a.tileMapURL)return l.resolve();var d=w.get(a.tileMapURL);if(d)return a.tileIndex=d,l.resolve();if(m.has(a.tileMapURL))return m.get(a.tileMapURL).then(function(b){a.tileIndex=new B(b.data)});b=f(a.tileMapURL,b);b.then(function(b){a.tileIndex=new B(b.data);m["delete"](a.tileMapURL);w.put(a.tileMapURL,a.tileIndex)});m.set(a.tileMapURL,b);return b};b.prototype._getRefKeys=
function(a,b){return c(this,void 0,void 0,function(){var d,e,n,c,p;return g(this,function(f){d=this._vectorTileLayer.sourceNameToSource;e=[];for(n in d)c=d[n],p=c.getRefKey(a,b),e.push(p);return[2,l.eachAlways(e)]})})};b.prototype._getSourcesData=function(a,b,d){return c(this,void 0,void 0,function(){var e,n,c,p,f,u,r;return g(this,function(m){switch(m.label){case 0:e=[];for(n=0;n<b.length;n++)null==b[n].value||null==a[n]?e.push(null):(c=this._getTilePayload(b[n].value,a[n],d),e.push(c));return[4,
l.eachAlways(e)];case 1:p=m.sent();f={};u=[];for(n=0;n<p.length;n++)p[n].value&&p[n].value&&p[n].value.protobuff&&0<p[n].value.protobuff.byteLength&&(r=b[n].value.id,f[p[n].value.sourceName]={refKey:r,protobuff:p[n].value.protobuff},u.push(p[n].value.protobuff));return[2,{sourceName2DataAndRefKey:f,transferList:u}]}})})};b.prototype._getVectorTileData=function(a){return c(this,void 0,void 0,function(){var b,d,e,p,c=this;return g(this,function(n){b=a.id;if(this._ongoingTileRequests.has(b))return[2,
this._ongoingTileRequests.get(b)];d=new AbortController;e={signal:d.signal};p=this._getParsedVectorTileData(a,e).then(function(a){c._ongoingTileRequests.delete(b);c._ongoingRequestToController.delete(b);return a}).catch(function(){c._ongoingTileRequests.delete(b);c._ongoingRequestToController.delete(b);return null});this._ongoingTileRequests.set(b,p);this._ongoingRequestToController.set(b,d);return[2,p]})})};b.prototype._getParsedVectorTileData=function(a,b){return c(this,void 0,void 0,function(){var d;
return g(this,function(e){switch(e.label){case 0:return[4,this.fetchTileData(a,b)];case 1:return d=e.sent(),[2,this.parseTileData({key:a,data:d},0,b)]}})})};return b}();h.TileHandler=q})},"esri/core/ItemCache":function(){define(["require","exports","./MemCache"],function(q,h,k){return function(){function g(c,f){this._storage=new k.MemCacheStorage;this._storage.maxSize=c;f&&this._storage.registerRemoveFunc("",f)}g.prototype.put=function(c,f){this._storage.put(c,f,1,1)};g.prototype.pop=function(c){return this._storage.pop(c)};
g.prototype.get=function(c){return this._storage.get(c)};g.prototype.clear=function(){this._storage.clearAll()};g.prototype.destroy=function(){this._storage.clearAll()};return g}()})},"esri/views/2d/engine/vectorTiles/VectorTile":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/now ../../../webgl ./RenderBucket ../webgl/TiledDisplayObject".split(" "),function(q,h,k,g,c,f,a){Object.defineProperty(h,"__esModule",{value:!0});q=function(a){function e(e,d,c,
l,f,x){c=a.call(this,e,c,l,[4096,4096])||this;c._referenced=0;c._symbolFadeHold=null;c._vectorTileData=null;c._setData=!1;c._symbolUpdateData=null;c._memoryUsed=b;c.rotation=0;c.layerData={};c.status="loading";c._referenced=1;c.styleLayers=d;c.id=e.id;c.rotation=f;c._cacheWorkerTiles=x;return c}k(e,a);Object.defineProperty(e.prototype,"hasSymbolBuckets",{get:function(){return!1},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"isHoldingForFade",{get:function(){return null!==this._symbolFadeHold},
enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"isSymbolFadeDone",{get:function(){return!this._symbolFadeHold||this._symbolFadeHold<g()},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"wasRequested",{get:function(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status},enumerable:!0,configurable:!0});e.prototype.setData=function(a,e,d){this._vectorTileData=a;this.client=e;this.refKeys=d;this._memoryUsed=b;this.ready();this._setData=
!0};e.prototype.updateSymbolData=function(a){a&&(this._symbolUpdateData=a,this.requestRender())};e.prototype.updateTileData=function(a){this._vectorTileData=a;this.stage.requestRender();this._memoryUsed=b};e.prototype.clearSymbolFadeHold=function(){this._symbolFadeHold=null};e.prototype.setSymbolHoldDuration=function(a){this._symbolFadeHold=g()+a};e.prototype.hasData=function(){return 0<Object.keys(this.layerData).length};e.prototype.dispose=function(){this._cacheWorkerTiles&&this.client&&this.client.invoke("destructTileData",
this.id).catch(function(){});this._deleteBufferMemory();this.destroy();this._memoryUsed=b};e.prototype.release=function(){return 0===--this._referenced?(this.dispose(),this.attached=!1,this.stage=null,!0):!1};e.prototype.reference=function(){++this._referenced};Object.defineProperty(e.prototype,"referenced",{get:function(){return this._referenced},enumerable:!0,configurable:!0});e.prototype.getMemoryUsage=function(){var a=this;this._memoryUsed===b&&(this._memoryUsed=d.reduce(function(b,e){return a[e]?
b+a[e].size:b},0),this.texture&&(this._memoryUsed+=this.texture.descriptor.width*this.texture.descriptor.height*4),this._vectorTileData&&this._vectorTileData.bufferData&&(this._memoryUsed+=this._vectorTileData.bufferData.reduce(function(a,b){return a+b.byteLength},this._vectorTileData.bufferDataInfo.byteLength+this._vectorTileData.bucketDataInfo.byteLength)));return this._memoryUsed/(this._referenced||1)};e.prototype.commitChanges=function(){if(this._vectorTileData||this._symbolUpdateData)this._vectorTileData?
(this._deleteBufferMemory(),this._createRenderBuckets(),this._createBufferObjects(),this._vectorTileData=null):this._symbolUpdateData&&(this._updateSymbolData(this._symbolUpdateData),this._symbolUpdateData=null)};e.prototype._deleteBufferMemory=function(){for(var a=0,b="fillVertexArrayObject fillDDVertexArrayObject outlineVertexArrayObject lineVertexArrayObject lineDDVertexArrayObject iconVertexArrayObject iconDDVertexArrayObject textVertexArrayObject textDDVertexArrayObject circleVertexArrayObject fillVertexBuffer fillDDVertexBuffer fillIndexBuffer outlineVertexBuffer outlineDDVertexBuffer outlineIndexBuffer lineVertexBuffer lineDDVertexBuffer lineIndexBuffer iconVertexBuffer iconDDVertexBuffer iconIndexBuffer textVertexBuffer textDDVertexBuffer textIndexBuffer circleVertexBuffer circleIndexBuffer texture".split(" ");a<
b.length;a++){var e=b[a];this[e]&&(this[e].dispose(),this[e]=null)}this.layerData={};this.triangleCount=0};e.prototype._createRenderBuckets=function(){for(var a=new Uint32Array(this._vectorTileData.bucketDataInfo),b=a.length,e=0;e<b;){var d=a[e];switch(a[e+1]){case 0:(new f.BackgroundRenderBucket).layerID=d;e+=2;break;case 1:var c=new f.FillRenderBucket;c.layerID=d;c.triangleElementStart=a[e+2];c.triangleElementCount=a[e+3];c.outlineElementStart=a[e+4];c.outlineElementCount=a[e+5];if(0!==c.triangleElementCount||
0!==c.outlineElementCount)this.layerData[d]=c;e+=6;break;case 2:c=new f.LineRenderBucket;c.layerID=d;c.triangleElementStart=a[e+2];c.triangleElementCount=a[e+3];0<c.triangleElementCount&&(this.layerData[d]=c);e+=4;break;case 3:c=new f.SymbolRenderBucket;c.layerID=d;c.isSDF=0!==a[e+2];var l=e+3,g=a[l];l++;for(var h=0;h<g;h++){var k=a[l],w=a[l+1],m=a[l+2];c.iconPerPageElementsMap.set(k,[w,m]);l+=3}var v=a[l];l++;for(h=0;h<v;h++)k=a[l],w=a[l+1],m=a[l+2],c.glyphPerPageElementsMap.set(k,[w,m]),l+=3;if(0<
c.iconPerPageElementsMap.size||0<c.glyphPerPageElementsMap.size)this.layerData[d]=c;e+=5+3*g+3*v;break;case 4:c=new f.CircleRenderBucket;c.layerID=d;c.triangleElementStart=a[e+2];c.triangleElementCount=a[e+3];0<c.triangleElementCount&&(this.layerData[d]=c);e+=4;break;default:console.error("Bad bucket type!"),e+=2}}};e.prototype.attach=function(){return this._setData};e.prototype.attachWithContext=function(a){this.stage={context:a};this.attached=this.attach()};e.prototype._updateSymbolData=function(a){if(!a||
!a.bucketDataInfo)return!0;var e=new Uint32Array(a.bucketDataInfo),b=e.length;if(0===b)return!0;if(!this.isReady)return this.requestRender(),!1;for(var d=this.stage.context,l=new Uint32Array(a.bufferDataInfo),p=l.length,g=0,h=0;h<p;h+=2,g++)switch(l[h]){case 10:this.iconVertexBuffer&&(this.iconVertexBuffer.dispose(),this.iconVertexBuffer=null);this.iconVertexBuffer=c.BufferObject.createVertex(d,35044,a.bufferData[g]);break;case 11:this.iconDDVertexBuffer&&(this.iconDDVertexBuffer.dispose(),this.iconDDVertexBuffer=
null);this.iconDDVertexBuffer=c.BufferObject.createVertex(d,35044,a.bufferData[g]);break;case 12:this.iconIndexBuffer&&(this.iconIndexBuffer.dispose(),this.iconIndexBuffer=null);this.iconIndexBuffer=c.BufferObject.createIndex(d,35044,a.bufferData[g]);break;case 13:this.textVertexBuffer&&(this.textVertexBuffer.dispose(),this.textVertexBuffer=null);this.textVertexBuffer=c.BufferObject.createVertex(d,35044,a.bufferData[g]);break;case 14:this.textDDVertexBuffer&&(this.textDDVertexBuffer.dispose(),this.textDDVertexBuffer=
null);this.textDDVertexBuffer=c.BufferObject.createVertex(d,35044,a.bufferData[g]);break;case 15:this.textIndexBuffer&&(this.textIndexBuffer.dispose(),this.textIndexBuffer=null),this.textIndexBuffer=c.BufferObject.createIndex(d,35044,a.bufferData[g])}a={};for(var k in this.layerData)3!==this.layerData[k].type&&(a[k]=this.layerData[k]);this.layerData=a;d=this.styleLayers.layers;for(l=0;l<b;){k=e[l];p=new f.SymbolRenderBucket;p.layerID=k;p.isSDF=0!==e[l+2];d.length>p.layerID&&d[p.layerID].type===p.type&&
(a[p.layerID]=p);var w=l+3;k=e[w];w++;for(g=0;g<k;g++){var h=e[w],m=e[w+1],v=e[w+2];p.iconPerPageElementsMap.set(h,[m,v]);w+=3}var A=e[w];w++;for(g=0;g<A;g++)h=e[w],m=e[w+1],v=e[w+2],p.glyphPerPageElementsMap.set(h,[m,v]),w+=3;l+=5+3*k+3*A}this.iconVertexArrayObject&&(this.iconVertexArrayObject.dispose(),this.iconVertexArrayObject=null);this.iconDDVertexArrayObject&&(this.iconDDVertexArrayObject.dispose(),this.iconDDVertexArrayObject=null);this.textVertexArrayObject&&(this.textVertexArrayObject.dispose(),
this.textVertexArrayObject=null);this.textDDVertexArrayObject&&(this.textDDVertexArrayObject.dispose(),this.textDDVertexArrayObject=null);return!0};e._createBufferToObject=function(){var a=[];a[1]={create:c.BufferObject.createVertex,var:"fillVertexBuffer"};a[2]={create:c.BufferObject.createVertex,var:"fillDDVertexBuffer"};a[3]={create:c.BufferObject.createIndex,var:"fillIndexBuffer"};a[4]={create:c.BufferObject.createVertex,var:"outlineVertexBuffer"};a[5]={create:c.BufferObject.createVertex,var:"outlineDDVertexBuffer"};
a[6]={create:c.BufferObject.createIndex,var:"outlineIndexBuffer"};a[7]={create:c.BufferObject.createVertex,var:"lineVertexBuffer"};a[8]={create:c.BufferObject.createVertex,var:"lineDDVertexBuffer"};a[9]={create:c.BufferObject.createIndex,var:"lineIndexBuffer"};a[10]={create:c.BufferObject.createVertex,var:"iconVertexBuffer"};a[11]={create:c.BufferObject.createVertex,var:"iconDDVertexBuffer"};a[12]={create:c.BufferObject.createIndex,var:"iconIndexBuffer"};a[13]={create:c.BufferObject.createVertex,
var:"textVertexBuffer"};a[14]={create:c.BufferObject.createVertex,var:"textDDVertexBuffer"};a[15]={create:c.BufferObject.createIndex,var:"textIndexBuffer"};a[16]={create:c.BufferObject.createVertex,var:"circleVertexBuffer"};a[17]={create:c.BufferObject.createIndex,var:"circleIndexBuffer"};return a};e.prototype._createBufferObjects=function(){for(var a=this.stage.context,b=new Uint32Array(this._vectorTileData.bufferDataInfo),d=b.length,c=0;c<d;c+=2){var l=c/2;if(!(0>=b[c+1]||0===this._vectorTileData.bufferData[l].byteLength)){var f=
b[c],g=e.bufferToObject[f];g?this[g.var]?this[g.var].setData(this._vectorTileData.bufferData[l]):this[g.var]=g.create(a,35044,this._vectorTileData.bufferData[l]):console.error("Bad buffer type "+f)}}};e.bufferToObject=e._createBufferToObject();return e}(a.TiledDisplayObject);h.VectorTile=q;var b=-1,d="fillVertexBuffer fillDDVertexBuffer fillIndexBuffer outlineVertexBuffer outlineDDVertexBuffer outlineIndexBuffer lineVertexBuffer lineDDVertexBuffer lineIndexBuffer iconVertexBuffer iconDDVertexBuffer iconIndexBuffer textVertexBuffer textDDVertexBuffer textIndexBuffer circleVertexBuffer circleIndexBuffer".split(" ")})},
"esri/views/2d/engine/vectorTiles/RenderBucket":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper"],function(q,h,k){Object.defineProperty(h,"__esModule",{value:!0});q=function(){return function(c){this.type=c}}();h.RenderBucket=q;var g=function(c){function f(){var a=c.call(this,2)||this;a.triangleElementStart=0;a.triangleElementCount=0;return a}k(f,c);f.prototype.hasData=function(){return 0<this.triangleElementCount};f.prototype.triangleCount=function(){return this.triangleElementCount/
3};return f}(q);h.LineRenderBucket=g;g=function(c){function f(){var a=c.call(this,1)||this;a.triangleElementStart=0;a.triangleElementCount=0;a.outlineElementStart=0;a.outlineElementCount=0;return a}k(f,c);f.prototype.hasData=function(){return 0<this.triangleElementCount||0<this.outlineElementCount};f.prototype.triangleCount=function(){return(this.triangleElementCount+this.outlineElementCount)/3};return f}(q);h.FillRenderBucket=g;g=function(c){function f(){var a=c.call(this,3)||this;a.iconPerPageElementsMap=
new Map;a.glyphPerPageElementsMap=new Map;a.isSDF=!1;return a}k(f,c);f.prototype.hasData=function(){return 0<this.iconPerPageElementsMap.size||0<this.glyphPerPageElementsMap.size};f.prototype.triangleCount=function(){var a=0;this.iconPerPageElementsMap.forEach(function(b){a+=b[1]});this.glyphPerPageElementsMap.forEach(function(b){a+=b[1]});return a/3};return f}(q);h.SymbolRenderBucket=g;g=function(c){function f(){var a=c.call(this,4)||this;a.triangleElementStart=0;a.triangleElementCount=0;return a}
k(f,c);f.prototype.hasData=function(){return 0<this.triangleElementCount};f.prototype.triangleCount=function(){return this.triangleElementCount/3};return f}(q);h.CircleRenderBucket=g;q=function(c){function f(){return c.call(this,0)||this}k(f,c);f.prototype.hasData=function(){return!0};f.prototype.triangleCount=function(){return 2};return f}(q);h.BackgroundRenderBucket=q})},"esri/views/2d/engine/vectorTiles/GeometryUtils":function(){define(["require","exports"],function(q,h){function k(c,f){c%=f;return 0<=
c?c:c+f}Object.defineProperty(h,"__esModule",{value:!0});h.C_INFINITY=Number.POSITIVE_INFINITY;h.C_PI=Math.PI;h.C_2PI=2*h.C_PI;h.C_PI_BY_2=h.C_PI/2;h.C_RAD_TO_256=128/h.C_PI;h.C_256_TO_RAD=h.C_PI/128;h.C_DEG_TO_256=256/360;h.C_DEG_TO_RAD=h.C_PI/180;h.C_SQRT2=1.414213562;h.C_SQRT2_INV=1/h.C_SQRT2;var g=1/Math.LN2;h.positiveMod=k;h.radToByte=function(c){return k(c*h.C_RAD_TO_256,256)};h.degToByte=function(c){return k(c*h.C_DEG_TO_256,256)};h.log2=function(c){return Math.log(c)*g};h.sqr=function(c){return c*
c};h.interpolate=function(c,f,a){return c*(1-a)+f*a};h.between=function(c,f,a){return c>=f&&c<=a||c>=a&&c<=f}})},"esri/views/2d/engine/vectorTiles/GlyphMosaic":function(){define("require exports ../../../../core/has ../../../../core/promiseUtils ../../../webgl ./RectangleBinPack ../webgl/Rect".split(" "),function(q,h,k,g,c,f,a){return function(){function b(a,e,b){this.height=this.width=0;this._dirties=[];this._glyphData=[];this._currentPage=0;this._glyphIndex={};this._textures=[];this._rangePromises=
new Map;this.width=a;this.height=e;this._glyphSource=b;this._binPack=new f(a-4,e-4);this._glyphData.push(new Uint8Array(a*e));this._dirties.push(!0);this._textures.push(void 0)}b.prototype.getGlyphItems=function(b,e){for(var d=this,c=[],h=this._glyphSource,k=new Set,t=1/256,r=0;r<e.length;r++)k.add(Math.floor(e[r]*t));var x=[];k.forEach(function(a){if(256>=a){var e=b+a;d._rangePromises.has(e)?x.push(d._rangePromises.get(e)):(a=h.getRange(b,a).then(function(){d._rangePromises["delete"](e)},function(){d._rangePromises["delete"](e)}),
d._rangePromises.set(e,a),x.push(a))}});return g.all(x).then(function(){var l,p=d._glyphIndex[b];p||(p={},d._glyphIndex[b]=p);for(var g=0;g<e.length;g++){l=e[g];var k=p[l];if(k)c[l]={sdf:!0,rect:k.rect,metrics:k.metrics,page:k.page,code:l};else{var m=h.getGlyph(b,l);if(m&&m.metrics){var k=m.metrics,v=void 0;if(0===k.width)v=new a.default(0,0,0,0);else{var A=k.width+6,n=k.height+6,u=A%4?4-A%4:4,C=n%4?4-n%4:4;1===u&&(u=5);1===C&&(C=5);v=d._binPack.allocate(A+u,n+C);v.isEmpty&&(d._dirties[d._currentPage]||
(d._glyphData[d._currentPage]=null),d._currentPage=d._glyphData.length,d._glyphData.push(new Uint8Array(d.width*d.height)),d._dirties.push(!0),d._textures.push(void 0),d._binPack=new f(d.width-4,d.height-4),v=d._binPack.allocate(A+u,n+C));var u=d._glyphData[d._currentPage],m=m.bitmap,G=C=void 0;if(m)for(var r=0;r<n;r++)for(var C=A*r,G=d.width*(v.y+r+1)+v.x,z=0;z<A;z++)u[G+z+1]=m[C+z]}p[l]={rect:v,metrics:k,tileIDs:null,page:d._currentPage};c[l]={sdf:!0,rect:v,metrics:k,page:d._currentPage,code:l};
d._dirties[d._currentPage]=!0}}}return c})};b.prototype.removeGlyphs=function(a){for(var e in this._glyphIndex){var b=this._glyphIndex[e];if(b){var d=void 0,c;for(c in b)if(d=b[c],d.tileIDs["delete"](a),0===d.tileIDs.size){for(var f=this._glyphData[d.page],g=d.rect,k=void 0,h=void 0,q=0;q<g.height;q++)for(k=this.width*(g.y+q)+g.x,h=0;h<g.width;h++)f[k+h]=0;delete b[c];this._dirties[d.page]=!0}}}};b.prototype.bind=function(a,e,b,f){void 0===f&&(f=0);this._textures[b]||(this._textures[b]=new c.Texture(a,
{pixelFormat:6406,dataType:5121,width:this.width,height:this.height},new Uint8Array(this.width*this.height)));var d=this._textures[b];d.setSamplingMode(e);this._dirties[b]&&d.setData(this._glyphData[b]);a.bindTexture(d,f);this._dirties[b]=!1};b.prototype.dispose=function(){this._binPack=null;for(var a=0,e=this._textures;a<e.length;a++){var b=e[a];b&&b.dispose()}this._textures.length=0};return b}()})},"esri/views/2d/engine/vectorTiles/RectangleBinPack":function(){define(["require","exports","../webgl/Rect"],
function(q,h,k){return function(){function g(c,f){this._height=this._width=0;this._free=[];this._width=c;this._height=f;this._free.push(new k.default(0,0,c,f))}Object.defineProperty(g.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0});g.prototype.allocate=function(c,f){if(c>this._width||f>this._height)return new k.default;for(var a=null,b=-1,d=0;d<this._free.length;++d){var e=
this._free[d];c<=e.width&&f<=e.height&&(null===a||e.y<=a.y&&e.x<=a.x)&&(a=e,b=d)}if(null===a)return new k.default;this._free.splice(b,1);a.width<a.height?(a.width>c&&this._free.push(new k.default(a.x+c,a.y,a.width-c,f)),a.height>f&&this._free.push(new k.default(a.x,a.y+f,a.width,a.height-f))):(a.width>c&&this._free.push(new k.default(a.x+c,a.y,a.width-c,a.height)),a.height>f&&this._free.push(new k.default(a.x,a.y+f,c,a.height-f)));return new k.default(a.x,a.y,c,f)};g.prototype.release=function(c){for(var f=
0;f<this._free.length;++f){var a=this._free[f];if(a.y===c.y&&a.height===c.height&&a.x+a.width===c.x)a.width+=c.width;else if(a.x===c.x&&a.width===c.width&&a.y+a.height===c.y)a.height+=c.height;else if(c.y===a.y&&c.height===a.height&&c.x+c.width===a.x)a.x=c.x,a.width+=c.width;else if(c.x===a.x&&c.width===a.width&&c.y+c.height===a.y)a.y=c.y,a.height+=c.height;else continue;this._free.splice(f,1);this.release(c)}this._free.push(c)};return g}()})},"esri/views/2d/engine/vectorTiles/GlyphSource":function(){define("require exports ../../../../request ../../../../core/has ../../../../core/pbf ../../../../core/promiseUtils".split(" "),
function(q,h,k,g,c,f){var a=function(){function a(a){this._metrics=[];this._bitmaps=[];if(a)for(;a.next();)switch(a.tag()){case 1:for(var b=a.getMessage();b.next();)switch(b.tag()){case 3:for(var e=b.getMessage(),d=void 0,c=void 0,f=void 0,g=void 0,k=void 0,h=void 0,q=void 0;e.next();)switch(e.tag()){case 1:d=e.getUInt32();break;case 2:c=e.getBytes();break;case 3:f=e.getUInt32();break;case 4:g=e.getUInt32();break;case 5:k=e.getSInt32();break;case 6:h=e.getSInt32();break;case 7:q=e.getUInt32();break;
default:e.skip()}e.release();d&&(this._metrics[d]={width:f,height:g,left:k,top:h,advance:q},this._bitmaps[d]=c);break;default:b.skip()}b.release();break;default:a.skip()}}a.prototype.getMetrics=function(a){return this._metrics[a]};a.prototype.getBitmap=function(a){return this._bitmaps[a]};return a}(),b=function(){function a(){this._ranges=[]}a.prototype.getRange=function(a){return this._ranges[a]};a.prototype.addRange=function(a,b){this._ranges[a]=b};return a}();return function(){function d(a){this._glyphInfo=
{};this._baseURL=a}d.prototype.getRange=function(b,d){var e=this._getFontStack(b);if(e.getRange(d))return f.resolve();var l=256*d,g=l+255;b=this._baseURL.replace("{fontstack}",b).replace("{range}",l+"-"+g);return k(b,{responseType:"array-buffer"}).then(function(b){e.addRange(d,new a(new c(new Uint8Array(b.data),new DataView(b.data))))}).catch(function(){e.addRange(d,new a)})};d.prototype.getGlyph=function(a,b){if(a=this._getFontStack(a)){var e=Math.floor(b/256);if(!(256<e)&&(a=a.getRange(e)))return{metrics:a.getMetrics(b),
bitmap:a.getBitmap(b)}}};d.prototype._getFontStack=function(a){var e=this._glyphInfo[a];e||(e=this._glyphInfo[a]=new b);return e};return d}()})},"esri/views/2d/engine/vectorTiles/SpriteMosaic":function(){define(["require","exports","../../../webgl","./RectangleBinPack","../webgl/Rect"],function(q,h,k,g,c){return function(){function f(a,b,d){void 0===d&&(d=0);this._size=[];this._mosaicsData=[];this._textures=[];this._dirties=[];this._pageHeight=this._pageWidth=this._currentPage=this._maxItemSize=0;
this._mosaicRects={};this.pixelRatio=1;(0>=a||0>=b)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!");this._pageWidth=a;this._pageHeight=b;0<d&&(this._maxItemSize=d);this._binPack=new g(a-4,b-4)}f.prototype.getWidth=function(a){return a>=this._size.length?-1:this._size[a][0]};f.prototype.getHeight=function(a){return a>=this._size.length?-1:this._size[a][1]};f.prototype.setSpriteSource=function(a){this.dispose();this.pixelRatio=a.devicePixelRatio;if(0===this._mosaicsData.length){this._binPack=
new g(this._pageWidth-4,this._pageHeight-4);var b=new Uint32Array(Math.floor(this._pageWidth)*Math.floor(this._pageHeight));this._mosaicsData[0]=b;this._dirties.push(!0);this._size.push([this._pageWidth,this._pageHeight]);this._textures.push(void 0)}this._sprites=a};f.prototype.getSpriteItem=function(a,b){void 0===b&&(b=!1);var d=this._mosaicRects[a];if(d)return d;if(!this._sprites||"loaded"!==this._sprites.loadStatus)return null;d=this._sprites.getSpriteInfo(a);if(!d||!d.width||!d.height||0>d.width||
0>d.height)return null;var e=d.width,c=d.height,f=this._allocateImage(e,c),g=f[0],k=f[1];if(0>=g.width)return null;this._copy(g,d,k,f[2],b);d={rect:g,width:e,height:c,sdf:d.sdf,simplePattern:!1,pixelRatio:d.pixelRatio,page:k};return this._mosaicRects[a]=d};f.prototype.preloadSpriteItems=function(){for(var a=0,b=this._sprites.spriteNames;a<b.length;a++)this.getSpriteItem(b[a],!0)};f.prototype.getSpriteItems=function(a){for(var b={},d=0;d<a.length;d++){var e=a[d];b[e]=this.getSpriteItem(e)}return b};
f.prototype.getMosaicItemPosition=function(a,b){b=(a=this.getSpriteItem(a,b))&&a.rect;if(!b)return null;b.width=a.width;b.height=a.height;return{size:[a.width,a.height],tl:[(b.x+2)/this._size[a.page][0],(b.y+2)/this._size[a.page][1]],br:[(b.x+2+a.width)/this._size[a.page][0],(b.y+2+a.height)/this._size[a.page][1]],page:a.page}};f.prototype.bind=function(a,b,d,e){void 0===d&&(d=0);void 0===e&&(e=0);this._textures[d]||(this._textures[d]=new k.Texture(a,{pixelFormat:6408,dataType:5121,wrapMode:33071,
width:this._size[d][0],height:this._size[d][1]},new Uint8Array(this._mosaicsData[d].buffer)));var c=this._textures[d];c.setSamplingMode(b);this._dirties[d]&&c.setData(new Uint8Array(this._mosaicsData[d].buffer));a.bindTexture(c,e);this._dirties[d]=!1};f._copyBits=function(a,b,d,e,c,f,g,k,h,r,x){var l=e*b+d;g=k*f+g;if(x)for(g-=f,x=-1;x<=r;x++,l=((x+r)%r+e)*b+d,g+=f)for(k=-1;k<=h;k++)c[g+k]=a[l+(k+h)%h];else for(x=0;x<r;x++){for(k=0;k<h;k++)c[g+k]=a[l+k];l+=b;g+=f}};f.prototype._copy=function(a,b,d,
e,c,g){if(this._sprites&&"loaded"===this._sprites.loadStatus&&!(d>=this._mosaicsData.length)){var l=new Uint32Array(g?g.buffer:this._sprites.image.buffer),k=this._mosaicsData[d];k&&l||console.error("Source or target images are uninitialized!");f._copyBits(l,g?b.width:this._sprites.width,b.x,b.y,k,e[0],a.x+2,a.y+2,b.width,b.height,c);this._dirties[d]=!0}};f.prototype._allocateImage=function(a,b){a+=2;b+=2;var d=Math.max(a,b);if(this._maxItemSize&&this._maxItemSize<d)return d=new c.default(0,0,a,b),
this._mosaicsData.push(new Uint32Array(a*b)),this._dirties.push(!0),this._size.push([a,b]),this._textures.push(void 0),[d,this._mosaicsData.length-1,[a,b]];var d=a%4?4-a%4:4,e=b%4?4-b%4:4;1===d&&(d=5);1===e&&(e=5);d=this._binPack.allocate(a+d,b+e);return 0>=d.width?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,
this._pageHeight]),this._textures.push(void 0),this._binPack=new g(this._pageWidth-4,this._pageHeight-4),this._allocateImage(a,b)):[d,this._currentPage,[this._pageWidth,this._pageHeight]]};f.prototype.dispose=function(){this._binPack=null;this._mosaicRects={};for(var a=0,b=this._textures;a<b.length;a++){var d=b[a];d&&d.dispose()}this._textures.length=0};return f}()})},"esri/views/2d/engine/vectorTiles/TileIndex":function(){define(["require","exports","../../../../core/promiseUtils","../../../../layers/support/TilemapCache",
"../../tiling/TileKey"],function(q,h,k,g,c){return function(){function f(a){if(a instanceof g.TilemapCache)this._tilemapCache=a;else if(a&&"index"in a)this._tilemap=a.index;else throw Error("Invalid tilemap!");}f.prototype.dataKey=function(a,b){if(this._tilemapCache){var d=a.level,e=a.row,f=a.col,g=new c(a);return this._tilemapCache.fetchAvailabilityUpsample(d,e,f,g,b).then(function(){return g}).catch(function(a){if(k.isAbortError(a))throw a;g.level=d;g.row=e;g.col=f;return g})}return this._getIndexedDataKey(a)};
f.prototype.forEach=function(a,b,d,e,c){this._callback=c;this._maxLevel=b+a;this._forEach(this._tilemap,b,d,e)};f.prototype._forEach=function(a,b,d,e){0!==a&&(this._callback(b,d,e),b!==this._maxLevel&&"object"===typeof a&&(this._forEach(a[0],b+1,2*d,2*e),this._forEach(a[1],b+1,2*d,2*e+1),this._forEach(a[2],b+1,2*d+1,2*e),this._forEach(a[3],b+1,2*d+1,2*e+1)))};f.prototype._getIndexedDataKey=function(a){var b=[a];if(0>a.level||0>a.row||0>a.col||0<a.row>>a.level||0<a.col>>a.level)return k.resolve(null);
for(;0!==a.level;)a=new c(a.level-1,a.row>>1,a.col>>1,a.world),b.push(a);a=this._tilemap;var d=b.pop(),e,f;if(1===a)return k.resolve(d);for(;b.length;)if(e=b.pop(),f=(e.col&1)+((e.row&1)<<1),a){if(0===a[f]){d=null;break}if(1===a[f]){d=e;break}d=e;a=a[f]}return k.resolve(d)};return f}()})},"esri/layers/support/TilemapCache":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../request ../../core/Accessor ../../core/Error ../../core/Handles ../../core/Logger ../../core/LRUCache ../../core/PooledArray ../../core/promiseUtils ../../core/scheduling ../../core/urlUtils ../../core/watchUtils ../../core/accessorSupport/decorators ./Tilemap".split(" "),
function(q,h,k,g,c,f,a,b,d,e,l,p,z,D,t,r,x,F,B,y){Object.defineProperty(h,"__esModule",{value:!0});h.TILEMAP_SIZE_EXP=5;var w=p.getLogger("esri.layers.support.TilemapCache");q=function(d){function m(a){a=d.call(this,a)||this;a._handles=new l;a._pendingTilemapRequests={};a._availableLevels={};a.levels=5;a.cacheByteSize=2097152;a.request=b;a._prefetchingEnabled=!0;return a}g(m,d);p=m;m.prototype.initialize=function(){var a=this;this._tilemapCache=new z(this.cacheByteSize);this._handles.add([this.watch(["layer.parsedUrl",
"layer.tileServers?"],function(){return a._initializeTilemapDefinition()}),F.init(this,"layer.tileInfo.lods",function(b){return a._initializeAvailableLevels(b)},!0)]);this._initializeTilemapDefinition()};m.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null)};m.prototype.castLevels=function(a){return 2>=a?(w.error("Minimum levels for Tilemap is 3, but got ",a),3):a};Object.defineProperty(m.prototype,"size",{get:function(){return 1<<this.levels},enumerable:!0,configurable:!0});
m.prototype.fetchTilemap=function(a,b,d,c){var n=this;if(!this._availableLevels[a])return t.reject(new e("tilemap-cache:level-unavailable","Level "+a+" is unavailable in the service"));var f=this._tmpTilemapDefinition;if(a=this._tilemapFromCache(a,b,d,f))return t.resolve(a);var g=c&&c.signal;c=k({},c,{signal:null});return t.create(function(a,b){t.onAbort(g,function(){return b(t.createAbortError())});var e=y.tilemapDefinitionId(f),d=n._pendingTilemapRequests[e];if(!d){var d=y.Tilemap.fromDefinition(f,
c).then(function(a){n._tilemapCache.put(e,a,a.byteSize);return a}),u=function(){return delete n._pendingTilemapRequests[e]};n._pendingTilemapRequests[e]=d;d.then(u,u)}d.then(a,b)})};m.prototype.getAvailability=function(a,b,e){return this._availableLevels[a]?(a=this._tilemapFromCache(a,b,e,this._tmpTilemapDefinition))?a.getAvailability(b,e):"unknown":"unavailable"};m.prototype.getAvailabilityUpsample=function(a,b,e,d){d.level=a;d.row=b;d.col=e;a=this.layer.tileInfo;for(a.updateTileInfo(d);;)if(b=this.getAvailability(d.level,
d.row,d.col),"unavailable"===b){if(!a.upsampleTile(d))return"unavailable"}else return b};m.prototype.fetchAvailability=function(a,b,d,c){return this._availableLevels[a]?this.fetchTilemap(a,b,d,c).catch(function(a){return a}).then(function(c){if(c instanceof y.Tilemap)return c=c.getAvailability(b,d),"unavailable"===c?t.reject(new e("tile-map:tile-unavailable","Tile is not available",{level:a,row:b,col:d})):c;if(t.isAbortError(c))throw c;return"unknown"}):t.reject(new e("tilemap-cache:level-unavailable",
"Level "+a+" is unavailable in the service"))};m.prototype.fetchAvailabilityUpsample=function(a,b,d,e,c){var f=this;e.level=a;e.row=b;e.col=d;var n=this.layer.tileInfo;n.updateTileInfo(e);var g=this.fetchAvailability(a,b,d,c).catch(function(a){if(t.isAbortError(a))throw a;if(n.upsampleTile(e))return f.fetchAvailabilityUpsample(e.level,e.row,e.col,e);throw a;});this._fetchAvailabilityUpsamplePrefetch(e.id,a,b,d,c,g);return g};m.prototype._fetchAvailabilityUpsamplePrefetch=function(b,e,d,c,g,l){return a(this,
void 0,void 0,function(){var a,n,m,u,h,A,C,v,x,q;return f(this,function(f){switch(f.label){case 0:if(!this._prefetchingEnabled)return[2];a="prefetch-"+b;if(this._handles.has(a))return[2];n=t.createAbortController();l.then(function(){return n.abort()},function(){return n.abort()});m=!1;u={remove:function(){m||(m=!0,n.abort())}};this._handles.add(u,a);f.label=1;case 1:return f.trys.push([1,3,,4]),[4,r.waitTicks(10,n.signal)];case 2:return f.sent(),[3,4];case 3:return f.sent(),[3,4];case 4:m||(m=!0,
this._handles.remove(a));if(t.isAborted(n))return[2];h={id:b,level:e,row:d,col:c};A=k({},g,{signal:n.signal});C=this.layer.tileInfo;v=function(a){var b=x.fetchAvailability(h.level,h.row,h.col,A);p._prefetches.push(b);a=function(){p._prefetches.removeUnordered(b)};b.then(a,a)};x=this;for(q=0;p._prefetches.length<p._maxPrefetch&&C.upsampleTile(h);++q)v(q);return[2]}})})};m.prototype._initializeTilemapDefinition=function(){if(this.layer.parsedUrl){var a=this.layer.parsedUrl,b=a.query;this._tilemapCache.clear();
this._tmpTilemapDefinition={service:{url:a.path,query:b?x.objectToQuery(b):null,tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}};m.prototype._tilemapFromCache=function(a,b,e,d){a=this._getTilemapDefinition(a,b,e,d);a=y.tilemapDefinitionId(a);return this._tilemapCache.get(a)};m.prototype._getTilemapDefinition=function(a,b,e,d){d.level=a;a=a>h.TILEMAP_SIZE_EXP;d.row=a?b-b%this.size:b;d.col=a?e-e%this.size:e;return d};
m.prototype._initializeAvailableLevels=function(a){var b=this;this._availableLevels={};a&&a.forEach(function(a){return b._availableLevels[a.level]=!0})};Object.defineProperty(m.prototype,"test",{get:function(){var a=this;return{get prefetchingEnabled(){return a._prefetchingEnabled},set prefetchingEnabled(b){a._prefetchingEnabled=b},hasTilemap:function(b,e,d){return!!a._tilemapFromCache(b,e,d,a._tmpTilemapDefinition)}}},enumerable:!0,configurable:!0});var p;m._maxPrefetch=4;m._prefetches=new D({initialSize:p._maxPrefetch});
c([B.property({constructOnly:!0,type:Number})],m.prototype,"levels",void 0);c([B.cast("levels")],m.prototype,"castLevels",null);c([B.property({readOnly:!0,dependsOn:["levels"],type:Number})],m.prototype,"size",null);c([B.property({constructOnly:!0,type:Number})],m.prototype,"cacheByteSize",void 0);c([B.property({constructOnly:!0})],m.prototype,"layer",void 0);c([B.property({constructOnly:!0})],m.prototype,"request",void 0);return m=p=c([B.subclass("esri.layers.support.TilemapCache")],m)}(B.declared(d));
h.TilemapCache=q})},"esri/layers/support/Tilemap":function(){define("require exports ../../core/tsSupport/assignHelper ../../request ../../core/arrayUtils ../../core/Error ../../core/lang".split(" "),function(q,h,k,g,c,f,a){function b(a){var b;"vector-tile"===a.service.type?b=a.service.url+"/tilemap/"+a.level+"/"+a.row+"/"+a.col+"/"+a.width+"/"+a.height:(b=a.service.tileServers,b=(b&&b.length?b[a.row%b.length]:a.service.url)+"/tilemap/"+a.level+"/"+a.row+"/"+a.col+"/"+a.width+"/"+a.height);(a=a.service.query)&&
(b=b+"?"+a);return b}Object.defineProperty(h,"__esModule",{value:!0});q=function(){function d(){this.location={left:0,top:0,width:0,height:0};this._allAvailability="unknown";this.byteSize=40}d.prototype.getAvailability=function(a,b){if("unknown"!==this._allAvailability)return this._allAvailability;a=(a-this.location.top)*this.location.width+(b-this.location.left);b=a>>3;var e=this._tileAvailabilityBitSet;return 0>b||b>e.length?"unknown":e[b]&1<<a%8?"available":"unavailable"};d.prototype._updateFromData=
function(a){for(var b=!0,e=!0,d=new Uint8Array(Math.ceil(this.location.width*this.location.height/8)),c=0,f=0;f<a.length;f++){var g=f%8;a[f]?(e=!1,d[c]|=1<<g):b=!1;7===g&&++c}e?this._allAvailability="unavailable":b?this._allAvailability="available":(this._allAvailability="unknown",this._tileAvailabilityBitSet=d,this.byteSize+=d.length)};d.fromDefinition=function(a,l){var e=a.service.request||g,h=a.row,q=a.col,t=a.width,r=a.height,x={query:{f:"json"}};l=l?k({},x,l):x;return e(b(a),l).then(function(a){return a.data}).catch(function(a){if(a&&
a.details&&422===a.details.httpStatus)return{location:{top:h,left:q,width:t,height:r},valid:!0,data:c.constant(t*r,0)};throw a;}).then(function(a){if(a.location&&(a.location.top!==h||a.location.left!==q||a.location.width!==t||a.location.height!==r))throw new f("tilemap:location-mismatch","Tilemap response for different location than requested",{response:a,definition:{top:h,left:q,width:t,height:r}});return d.fromJSON(a)})};d.fromJSON=function(b){d.validateJSON(b);var e=new d;e.location=Object.freeze(a.clone(b.location));
e._updateFromData(b.data);return Object.freeze(e)};d.validateJSON=function(a){if(!a||!a.location)throw new f("tilemap:missing-location","Location missing from tilemap response");if(!1===a.valid)throw new f("tilemap:invalid","Tilemap response was marked as invalid");if(!a.data)throw new f("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(a.data))throw new f("tilemap:data-mismatch","Data must be an array of numbers");if(a.data.length!==a.location.width*a.location.height)throw new f("tilemap:data-mismatch",
"Number of data items does not match width/height of tilemap");};return d}();h.Tilemap=q;h.tilemapDefinitionId=function(a){return a.level+"/"+a.row+"/"+a.col+"/"+a.width+"/"+a.height};h.tilemapDefinitionUrl=b;h.default=q})},"esri/views/2d/engine/vectorTiles/TileManager":function(){define(["require","exports","../../../../core/LRUCache","../../tiling/TileCoverage","../../tiling/TileKey"],function(q,h,k,g,c){Object.defineProperty(h,"__esModule",{value:!0});var f=function(a,b){return a+1/(1<<2*b)};q=
function(){function a(a,d){this._tiles=new Map;this._tileCache=new k(40,function(a){return a.dispose()});this._viewSize=[0,0];this.fadeDuration=300;this.acquireTile=a.acquireTile;this.releaseTile=a.releaseTile;this.tileInfoView=a.tileInfoView;a.fadeDuration&&(this.fadeDuration=a.fadeDuration);this._container=d}a.prototype.destroy=function(){this._tiles.clear();this._tiles=null;this._tileCache.clear();this._tileCache=null};a.prototype.update=function(a){var b=this;this._updateCacheSize(a);a=this.tileInfoView.getTileCoverage(a.state,
0,"smallest");for(var e=a.spans,f=a.lodInfo,k=f.level,h=new Set,q=new Set,t=0;t<e.length;t++)for(var r=e[t],x=r.row,F=r.colTo,B=r.colFrom;B<=F;B++){var r=c.getId(k,x,f.normalizeCol(B),f.getWorldForColumn(B)),y=this._getOrAcquireTile(r);h.add(r);y.hasData()?this._container.addChild(y):q.add(new c(r))}q.forEach(function(a){return b._findPlaceholdersForMissingTiles(a,h)});h.forEach(function(a){b._tiles.get(a).clearSymbolFadeHold()});var w=[];this._tiles.forEach(function(a,b){h.has(b)||w.push(b)});for(e=
0;e<w.length;e++)r=w[e],y=this._tiles.get(r),y.hasSymbolBuckets&&!y.isHoldingForFade?y.setSymbolHoldDuration(this.fadeDuration):y.hasSymbolBuckets&&!y.isSymbolFadeDone||this._releaseTile(r);g.pool.release(a)};a.prototype._findPlaceholdersForMissingTiles=function(a,d){var b=this,c=[];this._tiles.forEach(function(e){b._addPlaceholderChild(c,e,a,d)});var g=c.reduce(f,0);1E-6>Math.abs(1-g)||this._addPlaceholderParent(a.id,d)};a.prototype._addPlaceholderChild=function(a,d,e,c){if(!(d.key.level<=e.level)&&
d.hasData()){var b=d.key,f=b.level-e.level;e.row===b.row>>f&&e.col===b.col>>f&&e.world===b.world&&(this._container.addChild(d),c.add(d.id),a.push(d.key.level-e.level))}};a.prototype._addPlaceholderParent=function(a,d){for(;;){var b=a.split("/");a=b[1];var c=b[2],f=b[3],b=parseInt(b[0],10);a=0===b?null:b-1+"/"+(parseInt(a,10)>>1)+"/"+(parseInt(c,10)>>1)+"/"+parseInt(f,10);if(!a||d.has(a))break;if((c=this._getTile(a))&&c.hasData()){this._container.addChild(c);d.add(c.id);break}}};a.prototype._getOrAcquireTile=
function(a){var b=this._tiles.get(a);if(b)return b;(b=this._tileCache.pop(a))||(b=this.acquireTile(new c(a)));this._tiles.set(a,b);return b};a.prototype._getTile=function(a){var b=this._tiles.get(a);if(b)return b;(b=this._tileCache.pop(a))&&this._tiles.set(a,b);return b};a.prototype._releaseTile=function(a){var b=this._tiles.get(a);this.releaseTile(b);this._container.removeChild(b);this._tiles.delete(a);b.hasData()?this._tileCache.put(a,b,1):b.dispose()};a.prototype._updateCacheSize=function(a){a=
a.state.size;if(a[0]!==this._viewSize[0]||a[1]!==this._viewSize[1]){var b=Math.ceil(a[0]/512)+1,c=Math.ceil(a[1]/512)+1;this._viewSize[0]=a[0];this._viewSize[1]=a[1];this._tileCache.maxSize=5*b*c}};return a}();h.TileManager=q})},"esri/views/2d/engine/vectorTiles/VectorTileContainer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/MapUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../geometry/support/aaBoundingRect ../../../webgl ../../engine ./FadeRecorder ../webgl/definitions ../webgl/enums ../webgl/TiledDisplayObject ../../tiling/TileCoverage ../../tiling/TileKey".split(" "),
function(q,h,k,g,c,f,a,b,d,e,l,p,z,D,t,r,x,F){function B(a,b){if(a){var c=a.getLayoutProperty("visibility");if(!c||"none"!==c.getValue()&&(void 0===a.minzoom||a.minzoom<b+1E-6)&&(void 0===a.maxzoom||a.maxzoom>=b-1E-6))return!0}return!1}Object.defineProperty(h,"__esModule",{value:!0});q=function(h){function l(a,b){a=h.call(this,a,b)||this;a._backgroundTiles=[];a._fadeRecorder=new z.FadeRecorder(400);a._pointToCallbacks=new Map;a._parsedDataQueue=new Map;return a}k(l,h);l.prototype.destroy=function(){this.removeAllChildren();
this.children.forEach(function(a){return a.destroy()})};l.prototype.dispose=function(){this._spriteMosaic&&this._spriteMosaic.dispose();this._glyphMosaic&&this._glyphMosaic.dispose();h.prototype.dispose.call(this)};Object.defineProperty(l.prototype,"updating",{get:function(){return 0<this._parsedDataQueue.size},enumerable:!0,configurable:!0});l.prototype.setStyleResources=function(a,b,c){this._spriteMosaic=a;this._glyphMosaic=b;this._styleRepository=c};l.prototype.hitTest=function(a,b){return f(this,
void 0,void 0,function(){var e,f;return c(this,function(c){e=[a,b];f=d.createResolver();this._pointToCallbacks.set(e,f);this.requestRender();return[2,f.promise]})})};l.prototype.setTileData=function(a,b){var c=this.stage;c.dataUploadCounter<D.MAX_GPU_UPLOADS_PER_FRAME&&b?(a.setData(b.tileData,b.client,b.refKeys),c.dataUploadCounter++):b?this._parsedDataQueue.set(a,b):a.setData(null,null)};l.prototype.createRenderParams=function(a){return g({},h.prototype.createRenderParams.call(this,a),{renderPass:null,
styleLayer:null,styleLayerId:-1,glyphMosaic:this._glyphMosaic,spriteMosaic:this._spriteMosaic,fadeRecorder:this._fadeRecorder,hasClipping:!!this._clippingInfos})};l.prototype.doRender=function(a){!this.visible||a.drawPhase!==t.WGLDrawPhase.MAP&&a.drawPhase!==t.WGLDrawPhase.DEBUG||void 0===this._spriteMosaic||h.prototype.doRender.call(this,a)};l.prototype.removeChild=function(a){this._parsedDataQueue.has(a)&&this._parsedDataQueue.delete(a);return h.prototype.removeChild.call(this,a)};l.prototype.renderChildren=
function(b){if(b.drawPhase===t.WGLDrawPhase.DEBUG)h.prototype.renderChildren.call(this,b);else{var c=this.stage;if(0<this._parsedDataQueue.size&&c.dataUploadCounter<D.MAX_GPU_UPLOADS_PER_FRAME)for(var e=a.pairsOfMap(this._parsedDataQueue),d=0;d<e.length&&c.dataUploadCounter<D.MAX_GPU_UPLOADS_PER_FRAME;d++){var f=e[d][0],g=e[d][1];f.setData(g.tileData,g.client,g.refKeys);this._parsedDataQueue.delete(f);c.dataUploadCounter++}this._fadeRecorder.recordLevel(b.displayLevel);this._doRender(b);(0<this._parsedDataQueue.size||
this._fadeRecorder.needsRedraw())&&this.requestRender();0<this._pointToCallbacks.size&&(c=b.context,e=c.getBoundFramebufferObject(),b.drawPhase=t.WGLDrawPhase.HITTEST,d=b.painter.effects.hittest,d.bind(b),this._doRender(b),d.draw(b,this._pointToCallbacks,6),c.bindFramebuffer(e))}};l.prototype.removeAllChildren=function(){this._parsedDataQueue.clear();for(var a=0;a<this.children.length;a++)this.children[a].dispose();h.prototype.removeAllChildren.call(this)};l.prototype._doRender=function(a){var b=
a.context,c=this._styleRepository,e=c.layers;0<c.backgroundBucketIds.length&&(a.renderPass="background",this._renderBackgroundLayers(a,c.backgroundBucketIds));h.prototype.renderChildren.call(this,a);for(var c=this.children.filter(function(a){return a.visible}),d=0;d<c.length;d++){var f=c[d];f.triangleCount=0;f.commitChanges()}b.setStencilWriteMask(0);b.setColorMask(!0,!0,!0,!0);b.setStencilOp(7680,7680,7681);b.setStencilTestEnabled(!0);b.setBlendingEnabled(!1);b.setDepthTestEnabled(!0);b.setDepthWriteEnabled(!0);
b.setDepthFunction(515);b.setClearDepth(1);b.clear(b.gl.DEPTH_BUFFER_BIT);a.renderPass="opaque";for(d=e.length-1;0<=d;d--)this._renderStyleLayer(d,a,c);b.setDepthWriteEnabled(!1);b.setBlendingEnabled(!0);b.setBlendFunctionSeparate(1,771,1,771);a.renderPass="translucent";for(d=0;d<e.length;d++)this._renderStyleLayer(d,a,c);b.setDepthTestEnabled(!1);a.renderPass="symbol";for(d=0;d<e.length;d++)this._renderStyleLayer(d,a,c);b.bindVAO();b.setStencilTestEnabled(!0)};l.prototype._renderStyleLayer=function(a,
b,c){var d=b.painter,e=b.renderPass,f=this._styleRepository.layers[a];if(void 0!==f){var g;switch(f.type){case 0:return;case 1:if("opaque"!==e&&"translucent"!==b.renderPass)return;g="vtlFill";break;case 2:if("translucent"!==e)return;g="vtlLine";break;case 4:if("symbol"!==e)return;g="vtlCircle";break;case 3:if("symbol"!==e)return;g="vtlSymbol"}e=b.displayLevel;if(!(0===c.length||void 0!==f.minzoom&&f.minzoom>=e+1E-6||void 0!==f.maxzoom&&f.maxzoom<e-1E-6))for(b.styleLayerId=a,b.styleLayer=f,f=0;f<c.length;f++)if(c[f].layerData[a]){d.renderObjects(b,
c,g);break}}};l.prototype._renderBackgroundLayers=function(a,c){for(var d=a.context,f=a.displayLevel,g=a.painter,l=a.state,h=this._styleRepository,k=!1,p=0;p<c.length;p++){var m=c[p];if(B(h.layers[m],f)){k=!0;break}}if(k){var k=this._tileInfoView.getTileCoverage(a.state,0,"smallest"),m=k.spans,q=k.lodInfo,t=q.level,w=e.create(),p=[];if(this._renderPasses){var z=this._renderPasses[0];b.isSome(this._clippingInfos)&&(z.brushes[0].prepareState(a,this._clippingInfos[0]),z.brushes[0].drawMany(a,this._clippingInfos))}for(var z=
this._backgroundTiles,y=0,v,D=0;D<m.length;D++)for(var E=m[D],H=E.row,I=E.colTo,E=E.colFrom;E<=I;E++)y<z.length?(v=z[y],v.key.set(t,H,q.normalizeCol(E),q.getWorldForColumn(E)),this._tileInfoView.getTileBounds(w,v.key,!1),v.bounds=w,v.coords[0]=w[0],v.coords[1]=w[3]):(v=new F(t,H,q.normalizeCol(E),q.getWorldForColumn(E)),v=new r.TiledDisplayObject(v,this._tileInfoView.getTileBounds(e.create(),v),[512,512],[4096,4096]),z.push(v)),v.setTransform(l,this._tileInfoView.getTileResolution(v.key)),p.push(v),
y++;d.setStencilWriteMask(0);d.setColorMask(!0,!0,!0,!0);d.setStencilOp(7680,7680,7681);d.setStencilFunction(514,0,255);d.setStencilTestEnabled(!0);for(d=0;d<c.length;d++)m=c[d],l=h.layers[m],B(l,f)&&(a.styleLayerId=m,a.styleLayer=l,g.renderObjects(a,p,"vtlBackground"));x.pool.release(k)}};return l}(p.TileContainer);h.VectorTileContainer=q})},"esri/views/2d/engine/vectorTiles/FadeRecorder":function(){define(["require","exports","../../../../core/now"],function(q,h,k){Object.defineProperty(h,"__esModule",
{value:!0});(function(){return function(g,c){this.level=g;this.now=c}})();q=function(){return function(g,c,f,a){this.fadeSpeed=g;this.minfadeLevel=c;this.maxfadeLevel=f;this.fadeChange=a}}();h.FadeProperties=q;q=function(){function g(c,f){void 0===c&&(c=300);void 0===f&&(f=!1);this._levelSnapshots=[];this._duration=c;this._ignoreSpeed=f}g.prototype.recordLevel=function(c){var f=k(),a=this._levelSnapshots;0===a.length&&(a.push({level:c,now:0}),a.push({level:c,now:0}));2!==a.length&&a[0].level===c||
a.push({level:c,now:f})};g.prototype.needsRedraw=function(){if(0===this._levelSnapshots.length)return!1;for(var c=this._duration,f=this._levelSnapshots,a=f.length,b=f[a-1],d=-1;a>d+1&&f[d+1].now+c<b.now;)d++;for(0>d&&(d=0);d<a;d++)if(f[d].level!==b.level)return!0;return!1};g.prototype.getFadeValues=function(){for(var c=this._duration,f=k(),a=this._levelSnapshots;3<a.length&&a[1].now+c<f;)a.shift();a[1].now+c<f&&(a[0].level=a[1].level);var b=a[0].level,d=a[a.length-1],e=d.level,g=Math.min(b,e),b=Math.max(b,
e),a=(d.level-a[1].level)/((d.now-a[1].now)/c);return this._ignoreSpeed?{fadeSpeed:0,minfadeLevel:g,maxfadeLevel:b,fadeChange:0}:{fadeSpeed:a,minfadeLevel:g,maxfadeLevel:b,fadeChange:(f-d.now)/c*a}};return g}();h.FadeRecorder=q})},"esri/views/2d/layers/LayerView2D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Collection ../../../core/collectionUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../layers/support/ClipArea ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(q,h,k,g,c,f,a,b,d,e,l,p){Object.defineProperty(h,"__esModule",{value:!0});var z=c.ofType({key:"type",base:d,typeMap:{rect:e,path:p,geometry:l}});h.LayerView2D=function(c){return function(c){function d(){var a=null!==c&&c.apply(this,arguments)||this;a.clips=new z;a.moving=!1;a.attached=!1;a.lastUpdateId=-1;a.updateRequested=!1;return a}k(d,c);d.prototype.initialize=function(){var b=this;this.when(function(){b.requestUpdate()},function(){});var c=function(){return b.notifyChange("rendering")};
this.handles.add([a.init(this,"suspended",function(a){b.container&&(b.container.visible=!a);b.view&&!a&&b.updateRequested&&b.view.requestLayerViewUpdate(b)},!0),a.init(this,["fullOpacity","container"],function(){b.container&&(b.container.opacity=b.fullOpacity)},!0),a.on(this,"container","post-render",c),a.on(this,"container","will-render",c)])};d.prototype.destroy=function(){this.attached&&(this.attached=!1,this.detach());this.handles.remove("initialize");this.updateRequested=!1;this.view=this.layer=
null};Object.defineProperty(d.prototype,"rendering",{get:function(){return this.attached&&!this.suspended&&(this.moving||this.container.renderRequested||this.isRendering())},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"updating",{get:function(){return!this.suspended&&(!this.attached||this.updateRequested||this.isUpdating())},enumerable:!0,configurable:!0});d.prototype.isVisibleAtScale=function(a){var b=!0,c=this.layer,d=c.minScale,c=c.maxScale;if(null!=d&&null!=c){var b=!d,e=
!c;!b&&a<=d&&(b=!0);!e&&a>=c&&(e=!0);b=b&&e}return b};d.prototype.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestLayerViewUpdate(this))};d.prototype.processUpdate=function(a){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",a),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(a)))};d.prototype.isUpdating=function(){return!1};d.prototype.isRendering=function(){return!1};d.prototype.canResume=
function(){var a=this.inherited(arguments);a&&(a=this.isVisibleAtScale(this.view.scale));return a};g([b.property({type:z,set:function(a){a=f.referenceSetter(a,this._get("clips"),z);this._set("clips",a)}})],d.prototype,"clips",void 0);g([b.property()],d.prototype,"moving",void 0);g([b.property({dependsOn:["attached","suspended","moving"]})],d.prototype,"rendering",null);g([b.property()],d.prototype,"attached",void 0);g([b.property()],d.prototype,"container",void 0);g([b.property({dependsOn:["view.scale",
"layer.minScale","layer.maxScale"]})],d.prototype,"suspended",void 0);g([b.property({readOnly:!0})],d.prototype,"updateParameters",void 0);g([b.property()],d.prototype,"updateRequested",void 0);g([b.property({dependsOn:["updateRequested","attached","suspended"]})],d.prototype,"updating",null);g([b.property()],d.prototype,"view",void 0);return d=g([b.subclass("esri.views.2d.layers.LayerView2D")],d)}(b.declared(c))}})},"esri/views/layers/support/ClipArea":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/JSONSupport ../../../core/accessorSupport/decorators".split(" "),
function(q,h,k,g,c,f){return function(a){function b(){return null!==a&&a.apply(this,arguments)||this}g(b,a);return b=k([f.subclass("esri.views.layers.support.ClipArea")],b)}(f.declared(c.JSONSupport))})},"esri/views/layers/support/ClipRect":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/accessorSupport/decorators ./ClipArea".split(" "),function(q,h,k,g,c,f){return function(a){function b(){var b=null!==a&&a.apply(this,
arguments)||this;b.type="rect";b.left=null;b.right=null;b.top=null;b.bottom=null;return b}g(b,a);d=b;b.prototype.clone=function(){return new d({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};Object.defineProperty(b.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0});var d;k([c.property({type:[Number,String],json:{write:!0}})],b.prototype,"left",void 0);k([c.property({type:[Number,String],json:{write:!0}})],b.prototype,"right",
void 0);k([c.property({type:[Number,String],json:{write:!0}})],b.prototype,"top",void 0);k([c.property({type:[Number,String],json:{write:!0}})],b.prototype,"bottom",void 0);k([c.property({readOnly:!0,dependsOn:["left","right","top","bottom"]})],b.prototype,"version",null);return b=d=k([c.subclass("esri.views.layers.support.ClipRect")],b)}(c.declared(f))})},"esri/views/layers/support/Geometry":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../geometry ../../../core/accessorSupport/decorators ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea".split(" "),
function(q,h,k,g,c,f,a,b,d){var e={base:a,key:"type",typeMap:{extent:c.Extent,polygon:c.Polygon}};return function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;b.type="geometry";b.geometry=null;return b}g(c,a);d=c;Object.defineProperty(c.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0});c.prototype.clone=function(){return new d({geometry:this.geometry.clone()})};var d;k([f.property({types:e,json:{read:b.fromJSON,write:!0}})],c.prototype,
"geometry",void 0);k([f.property({readOnly:!0,dependsOn:["geometry"]})],c.prototype,"version",null);return c=d=k([f.subclass("esri.views.layers.support.Geometry")],c)}(f.declared(d))})},"esri/views/layers/support/Path":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/accessorSupport/decorators ./ClipArea".split(" "),function(q,h,k,g,c,f){return function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;
b.type="path";b.path=[];return b}g(b,a);Object.defineProperty(b.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0});k([c.property({type:[[[Number]]],json:{write:!0}})],b.prototype,"path",void 0);k([c.property({readOnly:!0,dependsOn:["path"]})],b.prototype,"version",null);return b=k([c.subclass("esri.views.layers.support.Path")],b)}(c.declared(f))})},"esri/views/2d/tiling/TileInfoViewPOT":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../layers/support/TileInfo ./TileInfoView ./TileKey".split(" "),
function(q,h,k,g,c,f,a){return function(b){function d(){var a=null!==b&&b.apply(this,arguments)||this;a._fullCacheLodInfos=null;a._levelByScale={};return a}k(d,b);d.prototype.getTileParentId=function(b){b=a.pool.acquire(b);var c=0===b.level?null:a.getId(b.level-1,b.row>>1,b.col>>1,b.world);a.pool.release(b);return c};d.prototype.getTileCoverage=function(a,c,d){a=b.prototype.getTileCoverage.call(this,a,c,d);if(!a)return a;var e=1<<a.lodInfo.level;a.spans=a.spans.filter(function(a){return 0<=a.row&&
a.row<e});return a};d.prototype.scaleToLevel=function(a){this._fullCacheLodInfos||this._initializeFullCacheLODs(this._lodInfos);if(this._levelByScale[a])return this._levelByScale[a];var b=this._fullCacheLodInfos;if(a>b[0].scale)return b[0].level;for(var c=void 0,d=void 0,c=0;c<b.length-1;c++)if(d=b[c+1],a>d.scale)return c=b[c],c.level+(c.scale-a)/(c.scale-d.scale);return b[b.length-1].level};d.prototype._initializeFullCacheLODs=function(a){a=0===a[0].level?a.map(function(a){return{level:a.level,resolution:a.resolution,
scale:a.scale}}):c.create({size:this.tileInfo.size[0],spatialReference:this.tileInfo.spatialReference}).lods.map(function(a){return{level:a.level,resolution:a.resolution,scale:a.scale}});for(var b=0;b<a.length;b++)this._levelByScale[a[b].scale]=a[b].level;this._fullCacheLodInfos=a};return d}(f)})},"*noref":1}});
define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../Graphic ../../../core/Error ../../../core/Handles ../../../core/Logger ../../../core/promiseUtils ../../../core/accessorSupport/decorators ../../../geometry/support/aaBoundingRect ../engine/vectorTiles/TileHandler ../engine/vectorTiles/TileManager ../engine/vectorTiles/VectorTile ../engine/vectorTiles/VectorTileContainer ./LayerView2D ../tiling/TileInfoViewPOT ../tiling/TileQueue ../../layers/LayerView".split(" "),function(q,
h,k,g,c,f,a,b,d,e,l,p,z,D,t,r,x,F,B,y,w){var m=e.getLogger("esri.views.2d.layers.VectorTileLayerView2D");return function(e){function h(){var a=null!==e&&e.apply(this,arguments)||this;a._handles=new d;a._fetchQueue=null;a._parseQueue=null;a._isTileHandlerPromiseFulfilled=!1;a._invalidateStyle=!1;return a}k(h,e);h.prototype.initialize=function(){var a=this,c=this.layer.tileInfo,d=this.view.constraints.rotationEnabled;(c&&c.spatialReference).equals(this.view.spatialReference)?(this._tileInfoView=new B(this.layer.tileInfo,
this.layer.fullExtent),this.container=new x.VectorTileContainer(this._tileInfoView,this.clips),this._tileHandler=new D.TileHandler(this.layer,window.devicePixelRatio||1,!0,this.container,null,d),this.container.visible=this.layer.visible,this.handles.add([this.watch("layer.currentStyleInfo",function(){return a._start()}),this.watch("layer.visible",function(){return a.container.visible=a.layer.visible}),this.clips.on("change",function(){return a.container.setClips(a.clips)})])):this.addResolvingPromise(l.reject(new b("layerview:spatial-reference-incompatible",
"The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer})))};h.prototype.destroy=function(){this._stop();this.container.dispose();this._tileHandler&&(this._tileHandler.destroy(),this._tileHandler=null)};h.prototype.hitTest=function(b,d){return f(this,void 0,void 0,function(){var e,f,g,h,n;return c(this,function(c){switch(c.label){case 0:return this.suspended||!this._tileHandlerPromise?[2,null]:[4,this._tileHandlerPromise];case 1:return c.sent(),[4,this.container.hitTest(b,
d)];case 2:e=c.sent();if(!e||0===e.length)return[2,null];f=e[0];g=this._tileHandler.getStyleRepository().layers;if(f>=g.length)return[2,null];h=g[f];n=new a({attributes:{layerId:f,layerName:h.id}});n.layer=this.layer;n.sourceLayer=this.layer;return[2,n]}})})};h.prototype.update=function(a){var b=this;this.notifyChange("updating");var c=this._tileHandlerPromise;c&&c.then(function(){if(a.pixelRatio!==b._tileHandler.devicePixelRatio)b._start(),b._tileHandler.devicePixelRatio=a.pixelRatio;else{b._invalidateStyle?
(b._issueStyleInvalidation(),b._invalidateStyle=!1):(b._fetchQueue.pause(),b._parseQueue.pause(),b._fetchQueue.state=a.state,b._parseQueue.state=a.state,b._tileManager.update(a),b._parseQueue.resume(),b._fetchQueue.resume());for(var c=0,d=b.container.children;c<d.length;c++)b._tileHandler.updateTile(d[c],a)}})};h.prototype.attach=function(){var a=this;this._start();this._handles.add(this.layer.on("paint-change",function(){return a.container.requestRender()}));this._handles.add(this.layer.on("layout-change",
function(){a._invalidateStyle=!0;a.requestUpdate()}))};h.prototype.detach=function(){this._stop();this._handles.removeAll()};h.prototype.moveStart=function(){this.requestUpdate()};h.prototype.viewChange=function(){this.requestUpdate()};h.prototype.moveEnd=function(){this.requestUpdate()};h.prototype.canResume=function(){var a=this.inherited(arguments),b=this.layer;if(a&&b.currentStyleInfo){var c=this.view.scale;(b=b.currentStyleInfo)&&b.layerDefinition&&(b=b.layerDefinition,b.minScale&&b.minScale<
c&&(a=!1),b.maxScale&&b.maxScale>c&&(a=!1))}return a};h.prototype.isUpdating=function(){return!this._isTileHandlerPromiseFulfilled||this._fetchQueue.updating||this._parseQueue.updating||this.container.updating};h.prototype.acquireTile=function(a){var b=this,c=this._createVectorTile(a);this._tileHandlerPromise.then(function(){b.notifyChange("updating");b._fetchQueue.push(c.key).then(function(a){return b._parseQueue.push(a)}).then(function(a){c.once("attach",function(){return b.requestUpdate()});b.container.setTileData(c,
a);b.container.addChild(c);b.notifyChange("updating")}).catch(function(a){b.notifyChange("updating");l.isAbortError(a)||m.error(a);c.destroy()})});return c};h.prototype.releaseTile=function(a){a=a.key.id;this._fetchQueue.abort(a);this._parseQueue.abort(a);this._tileHandler.abortTileUpdate(a);this.requestUpdate();this.notifyChange("updating")};h.prototype._start=function(){var a=this;this._stop();this._tileManager=new t.TileManager({acquireTile:function(b){return a.acquireTile(b)},releaseTile:function(b){return a.releaseTile(b)},
tileInfoView:this._tileInfoView,fadeDuration:300},this.container);if(this.layer.currentStyleInfo&&this.attached){var b=new AbortController,c=this._tileHandler.start({signal:b.signal}).then(function(){a._fetchQueue=new y({tileInfoView:a._tileInfoView,process:function(b,c){return a._getTileData(b,c)},concurrency:15});a._parseQueue=new y({tileInfoView:a._tileInfoView,process:function(b,c){return a._parseTileData(b,c)},concurrency:8});a.requestUpdate();a._isTileHandlerPromiseFulfilled=!0});this._tileHandler.spriteMosaic.then(function(b){a.container.setStyleResources(b,
a._tileHandler.glyphMosaic,a.layer.styleRepository);a.requestUpdate()});this._tileHandlerAbortController=b;this._tileHandlerPromise=c}};h.prototype._stop=function(){if(this._tileHandlerAbortController){var a=this._tileHandlerAbortController;a&&a.abort();this._tileHandlerPromise=null;this._isTileHandlerPromiseFulfilled=!1;this._fetchQueue&&(this._fetchQueue.destroy(),this._fetchQueue=null);this._parseQueue&&(this._parseQueue.destroy(),this._parseQueue=null);this._tileManager&&(this._tileManager.destroy(),
this._tileManager=null);this.container.removeAllChildren()}};h.prototype._getTileData=function(a,b){return f(this,void 0,void 0,function(){var d;return c(this,function(c){switch(c.label){case 0:return[4,this._tileHandler.fetchTileData(a,b)];case 1:return d=c.sent(),this.notifyChange("updating"),[2,{key:a,data:d}]}})})};h.prototype._parseTileData=function(a,b){return f(this,void 0,void 0,function(){return c(this,function(c){return[2,this._tileHandler.parseTileData(a,this.updateParameters.state.rotation,
b)]})})};h.prototype._issueStyleInvalidation=function(){var a=this;this.notifyChange("updating");this._tileHandlerPromise=this._tileHandler.updateStyle().then(function(){a._tileHandler.spriteMosaic.then(function(b){return a.container.setStyleResources(b,a._tileHandler.glyphMosaic,a.layer.styleRepository)});a._fetchQueue.pause();a._parseQueue.pause();a._fetchQueue.clear();a._parseQueue.clear();a._parseQueue.resume();a._fetchQueue.resume();a.notifyChange("updating");a.requestUpdate()})};h.prototype._createVectorTile=
function(a){var b=this.view.constraints.rotationEnabled,c=this._tileInfoView.getTileBounds(z.create(),a);return new r.VectorTile(a,this.layer.styleRepository,c,[512,512],this.view.rotation,b)};g([p.property({dependsOn:["view.scale","layer.currentStyleInfo"]})],h.prototype,"suspended",void 0);return h=g([p.subclass("esri.views.2d.layers.VectorTileLayerView2D")],h)}(p.declared(F.LayerView2D(w)))});