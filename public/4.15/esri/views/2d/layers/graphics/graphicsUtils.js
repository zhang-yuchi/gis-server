// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.15/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/mat2d ../../../../core/libs/gl-matrix-2/mat2df32 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f32 ../../../../geometry/SpatialReference ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/boundsUtils ../../../../geometry/support/intersects ../../../../geometry/support/jsonUtils ../../../../geometry/support/normalizeUtils ../../../../geometry/support/spatialReferenceUtils ../../../../geometry/support/spatialReferenceUtils ../../engine ../../engine".split(" "),
function(fa,q,V,p,n,W,f,u,y,X,K,L,r,M,Y,Z,C,D){function N(b,d,c,a,e,g){var m,h,k=p.pt2px(c.xoffset),E=p.pt2px(c.yoffset),aa=t*c.angle;g*=t;switch(c.type){case "simple-marker":m=h=p.pt2px(c.size);break;case "picture-marker":m=p.pt2px(c.width),h=p.pt2px(c.height)}.04>e&&(a=.04*a/e);c=n.mat2d.identity(F);n.mat2d.translate(c,c,f.vec2.set(l,b,d));n.mat2d.rotate(c,c,g-aa);n.mat2d.scale(c,c,f.vec2.set(l,a,-a));n.mat2d.translate(c,c,f.vec2.set(l,k,-E));b=[0,0];f.vec2.transformMat2d(b,f.vec2.set(l,-.5*m,-.5*
h),c);d=[0,0];f.vec2.transformMat2d(d,f.vec2.set(l,-.5*m,.5*h),c);a=[0,0];f.vec2.transformMat2d(a,f.vec2.set(l,.5*m,-.5*h),c);k=[0,0];f.vec2.transformMat2d(k,f.vec2.set(l,.5*m,.5*h),c);return{rings:[[b,a,k,d,b]]}}function O(b,d,c,a,e,g){var m=C.CIMSymbolHelper.getEnvelope(c.data);if(!m)return null;.04>e&&(a=.04*a/e);e=p.pt2px(m.width);var h=p.pt2px(m.height);c=p.pt2px(m.x);var m=p.pt2px(m.y),k=0*t,E=t*g;g=n.mat2d.identity(F);n.mat2d.translate(g,g,f.vec2.set(l,b,d));n.mat2d.rotate(g,g,E-k);n.mat2d.scale(g,
g,f.vec2.set(l,a,a));b=[0,0];f.vec2.transformMat2d(b,f.vec2.set(l,c,m+h),g);d=[0,0];f.vec2.transformMat2d(d,f.vec2.set(l,c,m),g);a=[0,0];f.vec2.transformMat2d(a,f.vec2.set(l,c+e,m+h),g);h=[0,0];f.vec2.transformMat2d(h,f.vec2.set(l,c+e,m),g);return{rings:[[b,a,h,d,b]]}}function P(b,d,c,a,e,g){var m=p.pt2px(c.xoffset),h=p.pt2px(c.yoffset);c=t*c.angle;var k=t*g;g=n.mat2d.identity(F);n.mat2d.translate(g,g,f.vec2.set(l,b,d));n.mat2d.rotate(g,g,k);n.mat2d.scale(g,g,f.vec2.set(l,e,-e));b=a[0]+a[2]/2;d=a[1]+
a[3]/2;n.mat2d.translate(g,g,f.vec2.set(l,m,-h));n.mat2d.translate(g,g,f.vec2.set(l,b,d));n.mat2d.rotate(g,g,c);n.mat2d.translate(g,g,f.vec2.set(l,-b,-d));m=[0,0];f.vec2.transformMat2d(m,f.vec2.set(l,a[0],a[1]),g);h=[0,0];f.vec2.transformMat2d(h,f.vec2.set(l,a[0],a[1]+a[3]),g);c=[0,0];f.vec2.transformMat2d(c,f.vec2.set(l,a[0]+a[2],a[1]),g);b=[0,0];f.vec2.transformMat2d(b,f.vec2.set(l,a[0]+a[2],a[1]+a[3]),g);return{rings:[[m,c,b,h,m]]}}function G(b,d,c){if(!c||0===c.glyphMosaicItems.length)return b;
var a=C.bidiText(d.text)[1];d=D.shapeGlyphs(c.glyphMosaicItems,a,{scale:p.pt2px(d.font.size)/24,angle:d.angle,xOffset:d.xoffset,yOffset:d.yoffset,hAlign:D.alignmentUtils.getXAnchorDirection(d.horizontalAlignment||"center"),vAlign:D.alignmentUtils.getYAnchorDirection(d.verticalAlignment||"baseline"),maxLineWidth:Math.max(32,Math.min(d.lineWidth||512,512)),lineHeight:30*Math.max(.25,Math.min(d.lineHeight||1,4)),decoration:d.font.decoration||"none",isCIM:!1}).bounds;b[0]=d.x-d.halfWidth;b[1]=d.y-d.halfHeight;
b[2]=d.width;b[3]=d.height;return b}function v(b,d){return Math.ceil((b-d)/(2*d))}function ba(b,d){var c;c=r.isPolygon(b)?b.rings:b.paths;for(var a=0;a<c.length;a++)for(var e=0,g=c[a];e<g.length;e++)g[e][0]+=d;return b}function ca(b,d){if(!d)return b;var c=da(b,d).map(function(a){return a.extent});return 2>c.length?c[0]||b:2<c.length?(b.xmin=d.valid[0],b.xmax=d.valid[1],b):{rings:c.map(function(a){return[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]]})}}function da(b,
d){var c=[],a=b.ymin,e=b.ymax,g=b.xmax-b.xmin,m=b.xmin,h=b.xmax,k,f=d.valid,l=f[0],n=f[1];k=Q(b.xmin,d);var p=k.x,f=k.frameId;k=Q(b.xmax,d);d=k.x;b=k.frameId;k=p===d&&0<g;if(g>2*n){g={xmin:m<h?p:d,ymin:a,xmax:n,ymax:e};m={xmin:l,ymin:a,xmax:m<h?d:p,ymax:e};h={xmin:0,ymin:a,xmax:n,ymax:e};a={xmin:l,ymin:a,xmax:0,ymax:e};e=[];l=[];z(g,h)&&e.push(f);z(g,a)&&l.push(f);z(m,h)&&e.push(b);z(m,a)&&l.push(b);for(n=f+1;n<b;n++)e.push(n),l.push(n);c.push({extent:g,frameIds:[f]},{extent:m,frameIds:[b]},{extent:h,
frameIds:e},{extent:a,frameIds:l})}else p>d||k?c.push({extent:{xmin:p,ymin:a,xmax:n,ymax:e},frameIds:[f]},{extent:{xmin:l,ymin:a,xmax:d,ymax:e},frameIds:[b]}):c.push({extent:{xmin:p,ymin:a,xmax:d,ymax:e},frameIds:[f]});return c}function Q(b,d){var c=d.valid;d=c[0];var a=c[1],c=2*a,e=0;b>a?(d=Math.ceil(Math.abs(b-a)/c),b-=d*c,e=d):b<d&&(d=Math.ceil(Math.abs(b-d)/c),b+=d*c,e=-d);return{x:b,frameId:e}}function z(b,d){var c=d.xmin,a=d.ymin,e=d.xmax;d=d.ymax;return A(b,c,a)&&A(b,c,d)&&A(b,e,d)&&A(b,e,
a)}function A(b,d,c){return d>=b.xmin&&d<=b.xmax&&c>=b.ymin&&c<=b.ymax?!0:!1}function R(b,d,c){if(Array.isArray(b)){var a=b[0];if(a>d){var e=v(a,d);b[0]=a+-2*e*d}else a<c&&(e=v(a,c),b[0]=a+-2*e*c)}else a=b.x,a>d?(e=v(a,d),b.x+=-2*e*d):a<c&&(e=v(a,c),b.x+=-2*e*c);return b}Object.defineProperty(q,"__esModule",{value:!0});var t=Math.PI/180,F=W.mat2df32.create(),l=u.vec2f32.create(),w=X.create();q.getBounds=function(b,d,c,a,e,g,f){if(!a||!c.symbol)return b[0]=b[1]=b[2]=b[3]=0,d[0]=d[1]=d[2]=d[3]=0,b;
if(r.isPoint(a)){var h=a.x;a=a.y;"text"===c.symbol.type&&0===d[2]&&0===d[3]&&G(d,c.symbol,c.mosaicItem);c=c.symbol;var k;switch(c.type){case "simple-marker":case "picture-marker":k=N(h,a,c,e,g,0);break;case "text":k=P(h,a,c,d,e,0);break;case "cim":case "expanded-cim":k=O(h,a,c,e,g,0)}for(e=d=0;e<k.rings[0].length-1;e++)c=k.rings[0][e],c=(h-c[0])*(h-c[0])+(a-c[1])*(a-c[1]),d=Math.max(d,c);d=Math.sqrt(d);e=M.normalizeMapX(h-d,f);h=M.normalizeMapX(h+d,f);e>h&&(f=Z.getInfo(f))&&(e=f.valid,f=e[1],e=e[0],
h=f);b[0]=e;b[1]=a-d;b[2]=h;b[3]=a+d}else{K.getBoundsXY(b,a);a=d[0];if(0===a){a:switch(a=0,c.symbol.type){case "simple-fill":case "picture-fill":a=c.symbol.outline;if(!a){a=0;break a}a=a.width;break;case "simple-line":a=c.symbol.width;break;case "simple-marker":a=c.symbol.size;break;case "picture-marker":a=Math.max(c.symbol.width,c.symbol.height);break;case "text":a=[0,0,0,0];G(a,c.symbol,c.mosaicItem);a=Math.max(a[2],a[3])+Math.max(Math.abs(a[0]),Math.abs(a[1]));break;case "cim":case "expanded-cim":a=
C.CIMSymbolHelper.getEnvelope(c.symbol.data),a=Math.sqrt(a.width*a.width+a.height*a.height)}d[0]=a}a=e*a/2;b[0]-=a;b[1]-=a;b[2]+=a;b[3]+=a}return b};q.isMarkerSymbol=function(b){return"simple-marker"===b||"picture-marker"===b||"text"===b};q.graphicGeometryToNumber=function(b){switch(V.expect(b.geometry).type){case "polyline":return 1;case "polygon":case "extent":return 2}return 0};var H=u.vec2f32.create(),S=u.vec2f32.create(),T=u.vec2f32.create(),x=u.vec2f32.create(),I=u.vec2f32.create(),U=u.vec2f32.create(),
J=u.vec2f32.create();q.isPointOnPolyline=function(b,d,c,a){f.vec2.set(T,d,c);b=b.paths;for(var e,g,m,h,k,l,n,p,q=Infinity,u=0;u<b.length;u++){var r=b[u];if(!(2>r.length))for(var t=1;t<r.length;t++)e=r[t-1][0],m=r[t-1][1],g=r[t][0],h=r[t][1],k=Math.min(e,g)-a,l=Math.min(m,h)-a,n=Math.max(e,g)+a,p=Math.max(m,h)+a,d<k||d>n||c<l||c>p||(f.vec2.set(H,e,m),f.vec2.set(S,g,h),f.vec2.subtract(x,S,H),f.vec2.subtract(I,H,T),f.vec2.scale(U,x,f.vec2.dot(x,I)/f.vec2.dot(x,x)),f.vec2.subtract(J,I,U),e=f.vec2.dot(J,
J),q>e&&(q=e))}return Math.sqrt(q)<=a};q.getMarkerSymbolBounds=N;q.getCIMMarkerBounds=O;q.getTextSymbolBounds=P;q.normalizeCentralMeridian=function(b){var d,c,a,e,g,f=null;if(!b)return null;d=b.spatialReference;c=Y.getInfo(d);g=d.isWebMercator?102100:4326;a=B[g].maxX;e=B[g].minX;d=B[g].plus180Line;g=B[g].minus180Line;var h,k=b.toJSON();if(!c)return k;"mesh"===b.type?h=k:r.isPoint(k)?h=R(k,a,e):r.isMultipoint(k)?(k.points=k.points.map(function(b){return R(b,a,e)}),h=k):r.isExtent(k)?h=ca(k,c):r.isPolygon(k)||
r.isPolyline(k)?(K.getBoundsXY(w,k),b={xmin:w[0],ymin:w[1],xmax:w[2],ymax:w[3]},c=2*v(b.xmin,e)*a,k=0===c?k:ba(k,c),b.xmin+=c,b.xmax+=c,L.extentIntersectsPolyline(b,d)&&b.xmax!==a?f=k:L.extentIntersectsPolyline(b,g)&&b.xmin!==e?f=k:h=k):h=b.clone();return null!==f?(new ea).cut(f,a):h};q.getTextSymbolSize=G;var B={102100:{maxX:2.0037508342788905E7,minX:-2.0037508342788905E7,plus180Line:{paths:[[[2.0037508342788905E7,-2.0037508342788905E7],[2.0037508342788905E7,2.0037508342788905E7]]],spatialReference:y.WebMercator},
minus180Line:{paths:[[[-2.0037508342788905E7,-2.0037508342788905E7],[-2.0037508342788905E7,2.0037508342788905E7]]],spatialReference:y.WebMercator}},4326:{maxX:180,minX:-180,plus180Line:{paths:[[[180,-180],[180,180]]],spatialReference:y.WGS84},minus180Line:{paths:[[[-180,-180],[-180,180]]],spatialReference:y.WGS84}}},ea=function(){function b(){}b.prototype.cut=function(b,c){var a;if(b.rings)this.closed=!0,a=b.rings,this.minPts=4;else if(b.paths)this.closed=!1,a=b.paths,this.minPts=2;else return null;
var d=a.length;c*=-2;for(var g=0;g<d;g++){var f=a[g];if(f&&f.length>=this.minPts){for(var h=[],k=0;k<f.length;k++){var l=f[k];h.push([l[0]+c,l[1]])}a.push(h)}}this.closed?b.rings=a:b.paths=a;return b};return b}()});