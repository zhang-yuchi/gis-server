// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.15/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/layers/BitmapLayerView2D":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/accessorSupport/decorators ../engine/BitmapContainer".split(" "),function(r,d,h,e,b,f){Object.defineProperty(d,"__esModule",{value:!0});d.BitmapLayerView2D=function(c){return function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c.container=new f.BitmapContainer(c.clips);return c}e(c,a);c.prototype.initialize=
function(){var a=this;this.handles.add(this.clips.on("change",function(){return a.container.setClips(a.clips)}))};return c=h([b.subclass("esri.views.2d.layers.BitmapLayerView2D")],c)}(b.declared(c))}})},"esri/views/2d/layers/LayerView2D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Collection ../../../core/collectionUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../layers/support/ClipArea ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(r,d,h,e,b,f,c,a,n,k,v,p){Object.defineProperty(d,"__esModule",{value:!0});var w=b.ofType({key:"type",base:n,typeMap:{rect:k,path:p,geometry:v}});d.LayerView2D=function(b){return function(b){function g(){var a=null!==b&&b.apply(this,arguments)||this;a.clips=new w;a.moving=!1;a.attached=!1;a.lastUpdateId=-1;a.updateRequested=!1;return a}h(g,b);g.prototype.initialize=function(){var a=this;this.when(function(){a.requestUpdate()},function(){});var b=function(){return a.notifyChange("rendering")};
this.handles.add([c.init(this,"suspended",function(c){a.container&&(a.container.visible=!c);a.view&&!c&&a.updateRequested&&a.view.requestLayerViewUpdate(a)},!0),c.init(this,["fullOpacity","container"],function(){a.container&&(a.container.opacity=a.fullOpacity)},!0),c.on(this,"container","post-render",b),c.on(this,"container","will-render",b)])};g.prototype.destroy=function(){this.attached&&(this.attached=!1,this.detach());this.handles.remove("initialize");this.updateRequested=!1;this.view=this.layer=
null};Object.defineProperty(g.prototype,"rendering",{get:function(){return this.attached&&!this.suspended&&(this.moving||this.container.renderRequested||this.isRendering())},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"updating",{get:function(){return!this.suspended&&(!this.attached||this.updateRequested||this.isUpdating())},enumerable:!0,configurable:!0});g.prototype.isVisibleAtScale=function(a){var c=!0,b=this.layer,e=b.minScale,b=b.maxScale;if(null!=e&&null!=b){var c=!e,f=
!b;!c&&a<=e&&(c=!0);!f&&a>=b&&(f=!0);c=c&&f}return c};g.prototype.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestLayerViewUpdate(this))};g.prototype.processUpdate=function(a){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",a),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(a)))};g.prototype.isUpdating=function(){return!1};g.prototype.isRendering=function(){return!1};g.prototype.canResume=
function(){var a=this.inherited(arguments);a&&(a=this.isVisibleAtScale(this.view.scale));return a};e([a.property({type:w,set:function(a){a=f.referenceSetter(a,this._get("clips"),w);this._set("clips",a)}})],g.prototype,"clips",void 0);e([a.property()],g.prototype,"moving",void 0);e([a.property({dependsOn:["attached","suspended","moving"]})],g.prototype,"rendering",null);e([a.property()],g.prototype,"attached",void 0);e([a.property()],g.prototype,"container",void 0);e([a.property({dependsOn:["view.scale",
"layer.minScale","layer.maxScale"]})],g.prototype,"suspended",void 0);e([a.property({readOnly:!0})],g.prototype,"updateParameters",void 0);e([a.property()],g.prototype,"updateRequested",void 0);e([a.property({dependsOn:["updateRequested","attached","suspended"]})],g.prototype,"updating",null);e([a.property()],g.prototype,"view",void 0);return g=e([a.subclass("esri.views.2d.layers.LayerView2D")],g)}(a.declared(b))}})},"esri/views/layers/support/ClipArea":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/JSONSupport ../../../core/accessorSupport/decorators".split(" "),
function(r,d,h,e,b,f){return function(c){function a(){return null!==c&&c.apply(this,arguments)||this}e(a,c);return a=h([f.subclass("esri.views.layers.support.ClipArea")],a)}(f.declared(b.JSONSupport))})},"esri/views/layers/support/ClipRect":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/accessorSupport/decorators ./ClipArea".split(" "),function(r,d,h,e,b,f){return function(c){function a(){var a=null!==c&&c.apply(this,
arguments)||this;a.type="rect";a.left=null;a.right=null;a.top=null;a.bottom=null;return a}e(a,c);f=a;a.prototype.clone=function(){return new f({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};Object.defineProperty(a.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0});var f;h([b.property({type:[Number,String],json:{write:!0}})],a.prototype,"left",void 0);h([b.property({type:[Number,String],json:{write:!0}})],a.prototype,"right",
void 0);h([b.property({type:[Number,String],json:{write:!0}})],a.prototype,"top",void 0);h([b.property({type:[Number,String],json:{write:!0}})],a.prototype,"bottom",void 0);h([b.property({readOnly:!0,dependsOn:["left","right","top","bottom"]})],a.prototype,"version",null);return a=f=h([b.subclass("esri.views.layers.support.ClipRect")],a)}(b.declared(f))})},"esri/views/layers/support/Geometry":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../geometry ../../../core/accessorSupport/decorators ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea".split(" "),
function(r,d,h,e,b,f,c,a,n){var k={base:c,key:"type",typeMap:{extent:b.Extent,polygon:b.Polygon}};return function(c){function b(){var a=null!==c&&c.apply(this,arguments)||this;a.type="geometry";a.geometry=null;return a}e(b,c);n=b;Object.defineProperty(b.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0});b.prototype.clone=function(){return new n({geometry:this.geometry.clone()})};var n;h([f.property({types:k,json:{read:a.fromJSON,write:!0}})],b.prototype,
"geometry",void 0);h([f.property({readOnly:!0,dependsOn:["geometry"]})],b.prototype,"version",null);return b=n=h([f.subclass("esri.views.layers.support.Geometry")],b)}(f.declared(n))})},"esri/views/layers/support/Path":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/accessorSupport/decorators ./ClipArea".split(" "),function(r,d,h,e,b,f){return function(c){function a(){var a=null!==c&&c.apply(this,arguments)||this;
a.type="path";a.path=[];return a}e(a,c);Object.defineProperty(a.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0});h([b.property({type:[[[Number]]],json:{write:!0}})],a.prototype,"path",void 0);h([b.property({readOnly:!0,dependsOn:["path"]})],a.prototype,"version",null);return a=h([b.subclass("esri.views.layers.support.Path")],a)}(b.declared(f))})},"esri/views/2d/layers/support/ExportStrategy":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators ../../../../geometry/Extent ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../../../layers/support/TileInfo ../../engine ../../viewStateUtils ../../tiling/TileInfoView ../../tiling/TileKey".split(" "),
function(r,d,h,e,b,f,c,a,n,k,v,p,w,t,z,g,A,B){var q=p.create(),u=[0,0],x=new B(0,0,0,0);return function(a){function l(c){var m=a.call(this,c)||this;m._imagePromise=null;m.hidpi=!1;m.imageMaxWidth=2048;m.imageMaxHeight=2048;m.imageRotationSupported=!1;m.imageNormalizationSupported=!1;m.update=n.debounce(function(a,c){return b(m,void 0,void 0,function(){var b,m,f,l,C,n,k,h,y,d=this;return e(this,function(e){b=a.state;m=w.getInfo(b.spatialReference);f=this.hidpi?a.pixelRatio:1;if(!a.stationary||this.destroyed)return[2];
this.imageRotationSupported?(u[0]=b.size[0],u[1]=b.size[1]):g.getOuterSize(u,b);l=Math.floor(u[0]*f)>this.imageMaxWidth||Math.floor(u[1]*f)>this.imageMaxHeight;C=m&&(b.extent.xmin<m.valid[0]||b.extent.xmax>m.valid[1]);n=!this.imageNormalizationSupported&&C;k=!l&&!n;h=this.imageRotationSupported?b.rotation:0;k?this._imagePromise=this._singleExport(b,u,h,f,c):(y=Math.min(this.imageMaxWidth,this.imageMaxHeight),n&&(y=Math.min(b.worldScreenWidth,y)),this._imagePromise=this._tiledExport(b,y,h,f,c));return[2,
this._imagePromise.then(function(a){d._imagePromise=null;var c=d.container.children.slice();d.container.removeAllChildren();a.forEach(d.container.addChild,d.container);d.disposeSource&&c.forEach(function(a){d.disposeSource(a.source)},d)}).catch(function(a){d._imagePromise=null;throw a;})]})})},5E3);return m}f(l,a);l.prototype.destroy=function(){};Object.defineProperty(l.prototype,"updating",{get:function(){return null!==this._imagePromise},enumerable:!0,configurable:!0});l.prototype.updateExports=
function(a){for(var c=0,b=this.container.children;c<b.length;c++){var m=b[c];if(!m.visible||!m.attached)break;a(m)?console.error("ExportStrategy.updateExports doesn't support promise yet"):(m.invalidateTexture(),m.requestRender())}};l.prototype._export=function(a,c,b,e,f,l){var m=this;return n.resolve().then(function(){return m.fetchSource(a,Math.floor(c*f),Math.floor(b*f),{rotation:e,pixelRatio:f,signal:l})}).then(function(b){b=new z.Bitmap(b);b.x=a.xmin;b.y=a.ymax;b.resolution=a.width/c;b.rotation=
e;b.pixelRatio=f;return b})};l.prototype._singleExport=function(a,b,c,f,e){g.getBBox(q,a.center,a.resolution,b);a=new v(q[0],q[1],q[2],q[3],a.spatialReference);return this._export(a,b[0],b[1],c,f,e).then(function(a){return[a]})};l.prototype._tiledExport=function(a,b,c,f,e){var m=this,l=t.create({size:b,spatialReference:a.spatialReference,scales:[a.scale]}),g=new A(l),l=g.getTileCoverage(a);if(!l)return null;var d=[];l.forEach(function(l,n,k,h){x.set(l,n,k,h);g.getTileBounds(q,x);l=new v(q[0],q[1],
q[2],q[3],a.spatialReference);d.push(m._export(l,b,b,c,f,e))});return n.all(d)};c([k.property()],l.prototype,"_imagePromise",void 0);c([k.property()],l.prototype,"container",void 0);c([k.property()],l.prototype,"disposeSource",void 0);c([k.property()],l.prototype,"fetchSource",void 0);c([k.property()],l.prototype,"hidpi",void 0);c([k.property()],l.prototype,"imageMaxWidth",void 0);c([k.property()],l.prototype,"imageMaxHeight",void 0);c([k.property()],l.prototype,"imageRotationSupported",void 0);c([k.property()],
l.prototype,"imageNormalizationSupported",void 0);c([k.property()],l.prototype,"requestUpdate",void 0);c([k.property({dependsOn:["_imagePromise"]})],l.prototype,"updating",null);return l=c([k.subclass("esri.views.2d.layers.support.ExportStrategy")],l)}(k.declared(a))})},"esri/views/2d/viewStateUtils":function(){define(["require","exports"],function(r,d){Object.defineProperty(d,"__esModule",{value:!0});var h=Math.PI/180;d.snapToPixel=function(e,b,f){var c=f.resolution;f=f.size;e[0]=c*(Math.round(b[0]/
c)+f[0]%2*.5);e[1]=c*(Math.round(b[1]/c)+f[1]%2*.5);return e};d.getOuterSize=function(e,b){var f=b.rotation*h,c=Math.abs(Math.cos(f)),f=Math.abs(Math.sin(f)),a=b.size;b=a[0];a=a[1];e[0]=Math.round(a*f+b*c);e[1]=Math.round(a*c+b*f);return e};d.getBBox=function(e,b,f,c){var a=b[0];b=b[1];var d=c[0];c=c[1];f*=.5;e[0]=a-f*d;e[1]=b-f*c;e[2]=a+f*d;e[3]=b+f*c;return e};d.bboxIntersects=function(e,b){var f=e[1],c=e[2],a=e[3],d=b[0],k=b[1],h=b[3];return!(e[0]>b[2]||c<d||f>h||a<k)}})},"esri/views/layers/ImageryLayerView":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/Error ../../core/maybe ../../core/promiseUtils ../../core/accessorSupport/decorators ../../geometry/Point ../../layers/support/timeUtils ../../tasks/support/Query ./support/popupUtils".split(" "),
function(r,d,h,e,b,f,c,a,n,k,v,p,w,t){Object.defineProperty(d,"__esModule",{value:!0});d.ImageryLayerView=function(d){return function(g){function d(){var a=null!==g&&g.apply(this,arguments)||this;a.view=null;return a}h(d,g);d.prototype.fetchPopupFeatures=function(e,d){return f(this,void 0,void 0,function(){var f,g,h,l,m,k,p,y,q,r,D;return b(this,function(b){switch(b.label){case 0:f=this.layer;if(!e)return[2,n.reject(new c("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:f}))];
g=f.popupEnabled;h=t.getFetchPopupTemplate(f,d);if(!g||!a.isSome(h))throw new c("imagerylayerview:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:g,popupTemplate:h});return[4,h.getRequiredFields()];case 1:return l=b.sent(),m=new w,m.geometry=e,m.outFields=l,m.outSpatialReference=e.spatialReference,k=this.view.resolution,p="2d"===this.view.type?new v(k,k,this.view.spatialReference):new v(.5*k,.5*k,this.view.spatialReference),y=h.layerOptions||{returnTopmostRaster:!0,
showNoDataRecords:!1},q=y.returnTopmostRaster,r=y.showNoDataRecords,D={returnDomainValues:!0,returnTopmostRaster:q,pixelSize:p,showNoDataRecords:r},[2,f.queryVisibleRasters(m,D).then(function(a){return a})]}})})};e([k.property()],d.prototype,"layer",void 0);e([k.property()],d.prototype,"view",void 0);e([k.property(p.combinedViewLayerTimeExtentProperty)],d.prototype,"timeExtent",void 0);return d=e([k.subclass("esri.views.layers.ImageryLayerView")],d)}(k.declared(d))}})},"esri/views/layers/support/popupUtils":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper @dojo/framework/shim/array ../../../core/maybe ../../../layers/support/fieldUtils".split(" "),
function(r,d,h,e,b,f,c){Object.defineProperty(d,"__esModule",{value:!0});d.getRequiredFields=function(a,d){void 0===d&&(d=a.popupTemplate);return e(this,void 0,void 0,function(){var e,n,p,r,t,z,g,A,B,q,u,x;return h(this,function(h){switch(h.label){case 0:return f.isSome(d)?[4,d.getRequiredFields(a.fields)]:[2,[]];case 1:e=h.sent();n=d.lastEditInfoEnabled;p=a.objectIdField;r=a.typeIdField;t=a.globalIdField;z=a.relationships;if(b.includes(e,"*"))return[2,["*"]];A=c.fixFields;B=[a.fields];u=(q=e).concat;
return(x=n)?[4,c.getFeatureEditFields(a)]:[3,3];case 2:x=h.sent(),h.label=3;case 3:return g=A.apply(void 0,B.concat([u.apply(q,[x||null])])),r&&g.push(r),g&&p&&c.hasField(a.fields,p)&&-1===g.indexOf(p)&&g.push(p),g&&t&&c.hasField(a.fields,t)&&-1===g.indexOf(t)&&g.push(t),z&&z.forEach(function(b){b=b.keyField;g&&b&&c.hasField(a.fields,b)&&-1===g.indexOf(b)&&g.push(b)}),[2,g]}})})};d.getFetchPopupTemplate=function(a,b){return a.popupTemplate?a.popupTemplate:f.isSome(b)&&b.defaultPopupTemplateEnabled&&
f.isSome(a.defaultPopupTemplate)?a.defaultPopupTemplate:null}})},"*noref":1}});
define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../Graphic ../../../core/Logger ../../../core/promiseUtils ../../../core/screenUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../layers/support/rasterFunctions/pixelUtils ../engine/ImageryBitmapSource ./BitmapLayerView2D ./LayerView2D ./support/ExportStrategy ../../layers/ImageryLayerView ../../layers/LayerView ../../layers/RefreshableLayerView".split(" "),function(r,
d,h,e,b,f,c,a,n,k,v,p,w,t,z,g,A,B,q,u){var x=a.getLogger("esri.views.2d.layers.ImageryLayerView2D");return function(a){function d(){var b=null!==a&&a.apply(this,arguments)||this;b._exportImageVersion=-1;return b}h(d,a);Object.defineProperty(d.prototype,"pixelData",{get:function(){if(this.updating)return null;var a=this.strategy.container.children;if(1===a.length&&a[0].source)return{extent:a[0].source.extent,pixelBlock:a[0].source.originalPixelBlock};if(1<a.length){var b=this.view.extent,a=a.map(function(a){return a.source}).filter(function(a){return a.extent&&
a.extent.intersects(b)}).map(function(a){return{extent:a.extent,pixelBlock:a.originalPixelBlock}});return(a=w.mosaicPixelData(a,b))?{extent:a.extent,pixelBlock:a.pixelBlock}:null}return null},enumerable:!0,configurable:!0});d.prototype.hitTest=function(a,b){if(this.suspended)return n.resolve(null);a=this.view.toMap(k.createScreenPoint(a,b));return n.resolve(new c({attributes:{},geometry:a}))};d.prototype.update=function(a){this.strategy.update(a).catch(function(a){n.isAbortError(a)||x.error(a)})};
d.prototype.attach=function(){var a=this;this.layer.increaseRasterJobHandlerUsage();this.strategy=new A({container:this.container,imageNormalizationSupported:10<=this.layer.version,imageMaxHeight:10.1<=this.layer.version?this.layer.imageMaxHeight:2048,imageMaxWidth:10.1<=this.layer.version?this.layer.imageMaxWidth:2048,fetchSource:this.fetchImage.bind(this),requestUpdate:function(){return a.requestUpdate()}});this.handles.add([v.init(this,"layer.exportImageServiceParameters.version",function(b){a._exportImageVersion!==
b&&(a._exportImageVersion=b,a.requestUpdate())}),this.watch("timeExtent",function(){return a.requestUpdate()}),this.layer.on("redraw",function(){a.strategy.updateExports(function(b){b.source instanceof HTMLImageElement?b.requestRender():a.layer.applyRenderer({pixelBlock:b.source.pixelBlock}).then(function(c){var d=b.source;d.pixelBlock=c.pixelBlock;d.filter=function(b){return a.layer.applyFilter(b)};a.container.requestRender()})})})],"imagerylayerview-update")};d.prototype.detach=function(){this.layer.decreaseRasterJobHandlerUsage();
this.strategy.destroy();this.container.removeAllChildren();this.handles.remove("imagerylayerview-update");this._exportImageVersion=-1};d.prototype.moveStart=function(){};d.prototype.viewChange=function(){};d.prototype.moveEnd=function(){this.requestUpdate()};d.prototype.doRefresh=function(){return f(this,void 0,void 0,function(){return b(this,function(a){this.requestUpdate();return[2]})})};d.prototype.isUpdating=function(){return this.attached&&(this.strategy.updating||this.updateRequested)};d.prototype.fetchImage=
function(a,b,c,d){var e=this;this._exportImageVersion=this.get("layer.exportImageServiceParameters.version");d=d||{};d.timeExtent=this.timeExtent;d.requestAsImageElement=!0;return this.layer.fetchImage(a,b,c,d).then(function(a){return a.imageElement?a.imageElement:e.layer.applyRenderer(a.pixelData,{signal:d.signal}).then(function(b){b=new t.default(b.pixelBlock,b.extent.clone(),a.pixelData.pixelBlock);b.filter=function(a){return e.layer.applyFilter(a)};return b})})};e([p.property({dependsOn:["updating"]})],
d.prototype,"pixelData",null);e([p.property()],d.prototype,"strategy",void 0);e([p.property({dependsOn:["strategy.updating"]})],d.prototype,"updating",void 0);return d=e([p.subclass("esri.views.2d.layers.ImageryLayerView2D")],d)}(p.declared(B.ImageryLayerView(u.RefreshableLayerView(z.BitmapLayerView2D(g.LayerView2D(q))))))});