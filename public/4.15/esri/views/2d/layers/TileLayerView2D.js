// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.15/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/layers/BitmapTileLayerView2D":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/accessorSupport/decorators ../engine/BitmapTileContainer ../engine/Container".split(" "),function(m,d,g,k,h,a,c){Object.defineProperty(d,"__esModule",{value:!0});d.BitmapTileLayerView2D=function(b){return function(b){function e(){var a=null!==b&&b.apply(this,arguments)||this;a.container=new c.Container;return a}
k(e,b);e.prototype.attach=function(){var b=this;this.view.timeline.record(this.layer.title+" (BitmapTileLayer) Attach");this._bitmapView=new a.BitmapTileContainer(this._tileInfoView,this.clips);this.handles.add(this.clips.on("change",function(){return b._bitmapView.setClips(b.clips)}),"watchClips");this.container.addChild(this._bitmapView)};e.prototype.detach=function(){this.container.removeChild(this._bitmapView);this._bitmapView.removeAllChildren();this.handles.remove("watchClips")};return e=g([h.subclass("esri.views.2d.layers.BitmapTileLayerView2D")],
e)}(h.declared(b))}})},"esri/views/2d/layers/LayerView2D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Collection ../../../core/collectionUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../layers/support/ClipArea ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),function(m,d,g,k,h,a,c,b,e,f,n,l){Object.defineProperty(d,"__esModule",{value:!0});
var p=h.ofType({key:"type",base:e,typeMap:{rect:f,path:l,geometry:n}});d.LayerView2D=function(e){return function(e){function f(){var a=null!==e&&e.apply(this,arguments)||this;a.clips=new p;a.moving=!1;a.attached=!1;a.lastUpdateId=-1;a.updateRequested=!1;return a}g(f,e);f.prototype.initialize=function(){var a=this;this.when(function(){a.requestUpdate()},function(){});var b=function(){return a.notifyChange("rendering")};this.handles.add([c.init(this,"suspended",function(b){a.container&&(a.container.visible=
!b);a.view&&!b&&a.updateRequested&&a.view.requestLayerViewUpdate(a)},!0),c.init(this,["fullOpacity","container"],function(){a.container&&(a.container.opacity=a.fullOpacity)},!0),c.on(this,"container","post-render",b),c.on(this,"container","will-render",b)])};f.prototype.destroy=function(){this.attached&&(this.attached=!1,this.detach());this.handles.remove("initialize");this.updateRequested=!1;this.view=this.layer=null};Object.defineProperty(f.prototype,"rendering",{get:function(){return this.attached&&
!this.suspended&&(this.moving||this.container.renderRequested||this.isRendering())},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"updating",{get:function(){return!this.suspended&&(!this.attached||this.updateRequested||this.isUpdating())},enumerable:!0,configurable:!0});f.prototype.isVisibleAtScale=function(a){var b=!0,f=this.layer,c=f.minScale,f=f.maxScale;if(null!=c&&null!=f){var b=!c,e=!f;!b&&a<=c&&(b=!0);!e&&a>=f&&(e=!0);b=b&&e}return b};f.prototype.requestUpdate=function(){this.updateRequested||
(this.updateRequested=!0,this.suspended||this.view.requestLayerViewUpdate(this))};f.prototype.processUpdate=function(a){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",a),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(a)))};f.prototype.isUpdating=function(){return!1};f.prototype.isRendering=function(){return!1};f.prototype.canResume=function(){var a=this.inherited(arguments);a&&(a=this.isVisibleAtScale(this.view.scale));return a};
k([b.property({type:p,set:function(b){b=a.referenceSetter(b,this._get("clips"),p);this._set("clips",b)}})],f.prototype,"clips",void 0);k([b.property()],f.prototype,"moving",void 0);k([b.property({dependsOn:["attached","suspended","moving"]})],f.prototype,"rendering",null);k([b.property()],f.prototype,"attached",void 0);k([b.property()],f.prototype,"container",void 0);k([b.property({dependsOn:["view.scale","layer.minScale","layer.maxScale"]})],f.prototype,"suspended",void 0);k([b.property({readOnly:!0})],
f.prototype,"updateParameters",void 0);k([b.property()],f.prototype,"updateRequested",void 0);k([b.property({dependsOn:["updateRequested","attached","suspended"]})],f.prototype,"updating",null);k([b.property()],f.prototype,"view",void 0);return f=k([b.subclass("esri.views.2d.layers.LayerView2D")],f)}(b.declared(e))}})},"esri/views/layers/support/ClipArea":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/JSONSupport ../../../core/accessorSupport/decorators".split(" "),
function(m,d,g,k,h,a){return function(c){function b(){return null!==c&&c.apply(this,arguments)||this}k(b,c);return b=g([a.subclass("esri.views.layers.support.ClipArea")],b)}(a.declared(h.JSONSupport))})},"esri/views/layers/support/ClipRect":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/accessorSupport/decorators ./ClipArea".split(" "),function(m,d,g,k,h,a){return function(a){function b(){var b=null!==a&&a.apply(this,
arguments)||this;b.type="rect";b.left=null;b.right=null;b.top=null;b.bottom=null;return b}k(b,a);e=b;b.prototype.clone=function(){return new e({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};Object.defineProperty(b.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0});var e;g([h.property({type:[Number,String],json:{write:!0}})],b.prototype,"left",void 0);g([h.property({type:[Number,String],json:{write:!0}})],b.prototype,"right",
void 0);g([h.property({type:[Number,String],json:{write:!0}})],b.prototype,"top",void 0);g([h.property({type:[Number,String],json:{write:!0}})],b.prototype,"bottom",void 0);g([h.property({readOnly:!0,dependsOn:["left","right","top","bottom"]})],b.prototype,"version",null);return b=e=g([h.subclass("esri.views.layers.support.ClipRect")],b)}(h.declared(a))})},"esri/views/layers/support/Geometry":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../geometry ../../../core/accessorSupport/decorators ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea".split(" "),
function(m,d,g,k,h,a,c,b,e){var f={base:c,key:"type",typeMap:{extent:h.Extent,polygon:h.Polygon}};return function(e){function c(){var a=null!==e&&e.apply(this,arguments)||this;a.type="geometry";a.geometry=null;return a}k(c,e);h=c;Object.defineProperty(c.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0});c.prototype.clone=function(){return new h({geometry:this.geometry.clone()})};var h;g([a.property({types:f,json:{read:b.fromJSON,write:!0}})],c.prototype,
"geometry",void 0);g([a.property({readOnly:!0,dependsOn:["geometry"]})],c.prototype,"version",null);return c=h=g([a.subclass("esri.views.layers.support.Geometry")],c)}(a.declared(e))})},"esri/views/layers/support/Path":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/accessorSupport/decorators ./ClipArea".split(" "),function(m,d,g,k,h,a){return function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;
b.type="path";b.path=[];return b}k(b,a);Object.defineProperty(b.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0});g([h.property({type:[[[Number]]],json:{write:!0}})],b.prototype,"path",void 0);g([h.property({readOnly:!0,dependsOn:["path"]})],b.prototype,"version",null);return b=g([h.subclass("esri.views.layers.support.Path")],b)}(h.declared(a))})},"esri/views/layers/TileLayerView":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/Error ../../core/maybe ../../core/promiseUtils ../../core/accessorSupport/decorators ../../renderers/support/clickToleranceUtils".split(" "),
function(m,d,g,k,h,a,c,b,e,f,n){Object.defineProperty(d,"__esModule",{value:!0});d.TileLayerView=function(d){return function(d){function l(){return null!==d&&d.apply(this,arguments)||this}g(l,d);l.prototype.fetchPopupFeatures=function(f,k){return a(this,void 0,void 0,function(){var g,d,l,p=this;return h(this,function(m){g=this.layer;if(!f)return[2,e.reject(new c("tilelayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:g}))];if("tile"!==g.type)return[2,e.reject(new c("tilelayerview:fetchPopupFeatures",
"Layer type should be 'tile'",{type:g.type}))];d=this.get("view.scale");l=g.allSublayers.toArray().filter(function(a){var b=0===a.minScale||d<=a.minScale,f=0===a.maxScale||d>=a.maxScale;return a.popupTemplate&&a.popupEnabled&&a.visible&&b&&f});return[2,e.eachAlways(l.map(function(c){return a(p,void 0,void 0,function(){var a,e,g,d,q;return h(this,function(r){switch(r.label){case 0:return a=c.createQuery(),e=b.isSome(k)?k.event:null,g=n.calculateTolerance({renderer:c.renderer,event:e}),a.geometry=this.createFetchPopupFeaturesQueryGeometry(f,
g),d=a,[4,c.popupTemplate.getRequiredFields()];case 1:return d.outFields=r.sent(),[4,c.queryFeatures(a)];case 2:return q=r.sent(),[2,q.features]}})})})).then(function(a){return[].concat.apply([],a.map(function(a){return a.value}).filter(Boolean))})]})})};k([f.property()],l.prototype,"layer",void 0);return l=k([f.subclass("esri.layers.mixins.TileLayerView")],l)}(f.declared(d))}})},"esri/renderers/support/clickToleranceUtils":function(){define(["require","exports"],function(m,d){function g(a,c){return c?
"xoffset"in c&&c.xoffset?Math.max(a,Math.abs(c.xoffset)):"yoffset"in c&&c.yoffset?Math.max(a,Math.abs(c.yoffset||0)):a:a}function k(a,c){if("number"===typeof a)return a;if(a&&a.stops&&a.stops.length){a=a.stops;for(var b=c=0,e=0;e<a.length;e++){var f=a[e].size;"number"===typeof f&&(c+=f,b++)}return c/b}return c}function h(a,c){if(!c)return a;c=c.filter(function(a){return"size"===a.type}).map(function(b){var c=b.minSize;return(k(b.maxSize,a)+k(c,a))/2});var b=0,e=c.length;if(0===e)return a;for(var f=
0;f<e;f++)b+=c[f];return Math.max(Math.floor(b/e),a)}Object.defineProperty(d,"__esModule",{value:!0});d.calculateTolerance=function(a){var c=a&&a.renderer;a="touch"===(a&&a.event&&a.event.pointerType)?9:6;if(!c)return a;a="visualVariables"in c?h(a,c.visualVariables):a;if("simple"===c.type)return g(a,c.symbol);if("unique-value"===c.type){var b=a;c.uniqueValueInfos.forEach(function(a){b=g(b,a.symbol)});return b}if("class-breaks"===c.type){var e=a;c.classBreakInfos.forEach(function(a){e=g(e,a.symbol)});
return e}return a}})},"esri/views/support/drapedUtils":function(){define("require exports ../../geometry ../../core/maybe ../../core/unitUtils ../../renderers/support/clickToleranceUtils".split(" "),function(m,d,g,k,h,a){function c(a,b,c,k){void 0===k&&(k=new g.Extent);var f;if("2d"===c.type)f=b*c.resolution;else if("3d"===c.type){var e=c.basemapTerrain,d=e.overlayManager,d=d?d.overlayPixelSizeInMapUnits(a):1;f=e&&!e.spatialReference.equals(c.spatialReference)?h.getMetersPerUnitForSR(e.spatialReference)/
h.getMetersPerUnitForSR(c.spatialReference):b*d}b=a.x-f;e=a.y-f;d=a.x+f;a=a.y+f;c=c.spatialReference;k.xmin=Math.min(b,d);k.ymin=Math.min(e,a);k.xmax=Math.max(b,d);k.ymax=Math.max(e,a);k.spatialReference=c;return k}Object.defineProperty(d,"__esModule",{value:!0});d.createQueryGeometry=c;d.intersectsDrapedGeometry=function(e,f,d){e=d.toMap(e);if(k.isNone(e))return null;var g=a.calculateTolerance();return c(e,g,d,b).intersects(f)?e:null};var b=new g.Extent})},"*noref":1}});
define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/Error ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators ../engine/Container ./BitmapTileLayerView2D ./LayerView2D ../tiling/TileInfoView ../tiling/TileKey ../tiling/TileQueue ../tiling/TileStrategy ../../layers/LayerView ../../layers/RefreshableLayerView ../../layers/TileLayerView ../../support/drapedUtils".split(" "),function(m,
d,g,k,h,a,c,b,e,f,n,l,p,u,v,t,w,x,y,z,A,B){var C=b.getLogger("esri.views.2d.layers.TileLayerView2D"),D=[0,0];return function(b){function d(){var a=null!==b&&b.apply(this,arguments)||this;a._tileStrategy=null;a._fetchQueue=null;a.container=new l.Container;a.layer=null;return a}g(d,b);d.prototype.initialize=function(){var a=this,b=this.layer.tileInfo,b=b&&b.spatialReference,d;b||(d=new c("layerview:tiling-information-missing","The layer doesn't provide tiling information",{layer:this.layer}));b.equals(this.view.spatialReference)||
(d=new c("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}));this.watch("resampling",function(){a.refresh()});d&&this.addResolvingPromise(f.reject(d))};Object.defineProperty(d.prototype,"resampling",{get:function(){return!("resampling"in this.layer)||!1!==this.layer.resampling},enumerable:!0,configurable:!0});d.prototype.hitTest=function(){return null};d.prototype.update=function(a){this._fetchQueue.pause();
this._fetchQueue.state=a.state;this._tileStrategy.update(a);this._fetchQueue.resume();this.notifyChange("updating")};d.prototype.attach=function(){var a=this,b="tileServers"in this.layer?this.layer.tileServers:null;this._tileInfoView=new v(this.layer.tileInfo,this.layer.fullExtent);this._fetchQueue=new w({tileInfoView:this._tileInfoView,concurrency:b&&10*b.length||10,process:function(b,c){return a.fetchTile(b,c)}});this._tileStrategy=new x({cachePolicy:"keep",resampling:this.resampling,acquireTile:function(b){return a.acquireTile(b)},
releaseTile:function(b){return a.releaseTile(b)},tileInfoView:this._tileInfoView});this.requestUpdate();this.container.requestRender();this.inherited(arguments)};d.prototype.detach=function(){this.inherited(arguments);this._tileStrategy.destroy();this._fetchQueue.clear();this.container.removeAllChildren();this._fetchQueue=this._tileStrategy=this._tileInfoView=null};d.prototype.moveStart=function(){this.requestUpdate()};d.prototype.viewChange=function(){this.requestUpdate()};d.prototype.moveEnd=function(){this.requestUpdate()};
d.prototype.createFetchPopupFeaturesQueryGeometry=function(a,b){return B.createQueryGeometry(a,b,this.view)};d.prototype.doRefresh=function(){return a(this,void 0,void 0,function(){var a=this;return h(this,function(b){if(this.updateRequested||this.suspended)return[2];this._fetchQueue.reset();this._tileStrategy.tiles.forEach(function(b){return a._enqueueTileFetch(b)});this.notifyChange("updating");return[2]})})};d.prototype.isUpdating=function(){return 0<this._fetchQueue.length};d.prototype.acquireTile=
function(a){var b;a=this._bitmapView.createTile(a);var c=a.bitmap;b=this._tileInfoView.getTileCoords(D,a.key);c.x=b[0];c.y=b[1];c.resolution=this._tileInfoView.getTileResolution(a.key);b=this._tileInfoView.tileInfo.size;c.width=b[0];c.height=b[1];this._enqueueTileFetch(a);this.requestUpdate();return a};d.prototype.releaseTile=function(a){var b=this;this._fetchQueue.abort(a.key.id);this._bitmapView.removeChild(a);a.once("detach",function(){a.destroy();b.requestUpdate()});this.requestUpdate()};d.prototype.fetchTile=
function(b,c){return a(this,void 0,void 0,function(){var a,d,k,g,q,r,l,m,n;return h(this,function(h){switch(h.label){case 0:a="tilemapCache"in this.layer?this.layer.tilemapCache:null;d=!e.isNone(c)&&c.signal;if(a)return[3,4];h.label=1;case 1:return h.trys.push([1,3,,4]),[4,this._fetchImage(b,d)];case 2:return[2,h.sent()];case 3:k=h.sent();if(!f.isAbortError(k)&&!this.resampling)return[2,this._createBlankImage()];throw k;case 4:g=t.pool.acquire(),h.label=5;case 5:return h.trys.push([5,8,,10]),[4,a.fetchAvailabilityUpsample(b.level,
b.row,b.col,g,{signal:d})];case 6:return h.sent(),g.level===b.level||this.resampling?[4,this._fetchImage(g,d)]:[2,this._createBlankImage()];case 7:return q=h.sent(),[3,10];case 8:r=h.sent();if(f.isAbortError(r))throw t.pool.release(g),r;return[4,this._fetchImage(b,d)];case 9:return q=h.sent(),[3,10];case 10:return l=g.level,m=g.row,n=g.col,t.pool.release(g),this.resampling&&l!==b.level?[2,this._resampleImage(q,l,m,n,b.level,b.row,b.col)]:[2,q]}})})};d.prototype._enqueueTileFetch=function(b){return a(this,
void 0,void 0,function(){var a,c,d=this;return h(this,function(e){switch(e.label){case 0:if(this._fetchQueue.has(b.key.id))return[2];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this._fetchQueue.push(b.key)];case 2:return a=e.sent(),b.bitmap.source=a,b.bitmap.width=this._tileInfoView.tileInfo.size[0],b.bitmap.height=this._tileInfoView.tileInfo.size[1],b.once("attach",function(){return d.requestUpdate()}),this._bitmapView.addChild(b),[3,4];case 3:return c=e.sent(),f.isAbortError(c)||C.error(c),
[3,4];case 4:return this.requestUpdate(),[2]}})})};d.prototype._fetchImage=function(b,c){return a(this,void 0,void 0,function(){return h(this,function(a){return[2,this.layer.fetchTile(b.level,b.row,b.col,{timestamp:this.refreshTimestamp,signal:c})]})})};d.prototype._resampleImage=function(a,b,c,d,e,f,g){var h=this._tileInfoView.tileInfo.size,k=this._tileInfoView.getTileResolution(b),l=this._tileInfoView.getTileResolution(e);e=this._tileInfoView.getLODInfoAt(e);g=e.getXForColumn(g);f=e.getYForRow(f);
e=this._tileInfoView.getLODInfoAt(b);b=e.getXForColumn(d);d=e.getYForRow(c);c=Math.round((g-b)/k);b=Math.round(-(f-d)/k);d=Math.round(l/k*h[0]);k=Math.round(l/k*h[1]);l=this._createBlankImage();l.getContext("2d").drawImage(a,c,b,d,k,0,0,h[0],h[1]);return l};d.prototype._createBlankImage=function(){var a=this._tileInfoView.tileInfo.size,b=document.createElement("canvas");b.width=a[0];b.height=a[1];return b};k([n.property({dependsOn:["layer.resampling?"]})],d.prototype,"resampling",null);return d=k([n.subclass("esri.views.2d.layers.TileLayerView2D")],
d)}(n.declared(A.TileLayerView(z.RefreshableLayerView(p.BitmapTileLayerView2D(u.LayerView2D(y))))))});