// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.15/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../../core/libs/gl-matrix-2/mat2d ../../../../../../core/libs/gl-matrix-2/mat2df32 ../../../../../../core/libs/gl-matrix-2/vec2 ../../../../../../core/libs/gl-matrix-2/vec2f32 ../../.. ../../alignmentUtils ../../number ../../collisions/BoundingBox".split(" "),function(H,y,l,r,w,C,E,F,m,z){Object.defineProperty(y,"__esModule",{value:!0});var B=function(){function b(a,c,d,g){this._rotationT=r.mat2df32.create();this.minZoom=this._yBounds=this._xBounds=0;this.maxZoom=
255;var b=d.rect,f=new Float32Array(8);a*=g;c*=g;var h=d.code?b.width*g:d.metrics.width,n=d.code?b.height*g:d.metrics.height;f[0]=a;f[1]=c;f[2]=a+h;f[3]=c;f[4]=a;f[5]=c+n;f[6]=a+h;f[7]=c+n;this._data=f;this._setTextureCoords(b);this._scale=g;this._mosaic=d;this.x=a;this.y=c}Object.defineProperty(b.prototype,"width",{get:function(){return this._mosaic.metrics.width*this._scale},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"mosaic",{get:function(){return this._mosaic},enumerable:!0,
configurable:!0});Object.defineProperty(b.prototype,"angle",{get:function(){return this._angle},set:function(a){this._angle=a;l.mat2d.identity(this._rotationT);l.mat2d.rotate(this._rotationT,this._rotationT,-a);this._setOffsets(this._data)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"xTopLeft",{get:function(){return this._data[0]},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"yTopLeft",{get:function(){return this._data[1]},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"xBottomRight",{get:function(){return this._data[6]},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"yBottomRight",{get:function(){return this._data[7]},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"texcoords",{get:function(){return this._texcoords},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"textureBinding",{get:function(){return this._mosaic.textureBinding},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"offsets",{get:function(){this._offsets||this._setOffsets(this._data);return this._offsets},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"char",{get:function(){return String.fromCharCode(this._mosaic.code)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"code",{get:function(){return this._mosaic.code},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"bounds",{get:function(){var a=this._mosaic.metrics,c=a.width*this._scale,d=Math.abs(a.height)*
this._scale,a=new Float32Array(8);a[0]=this.x;a[1]=this.y;a[2]=this.x+c;a[3]=this.y;a[4]=this.x;a[5]=this.y+d;a[6]=this.x+c;a[7]=this.y+d;c=l.mat2d.multiply(r.mat2df32.create(),this._rotationT,this._T);r.mat2df32.transformMany(a,a,c);for(var d=c=Infinity,b=0,e=0,f=0;4>f;f++)var h=a[2*f],n=a[2*f+1],c=Math.min(c,h),d=Math.min(d,n),b=Math.max(b,h),e=Math.max(e,n);a=b-c;e-=d;return new z.default(c+a/2,d+e/2,a,e)},enumerable:!0,configurable:!0});b.prototype.setTransform=function(a){this._T=a;this._offsets=
null};b.prototype._setOffsets=function(a){this._offsets||(this._offsets={upperLeft:0,upperRight:0,lowerLeft:0,lowerRight:0});var c=this._offsets,d=new Float32Array(8),b=l.mat2d.multiply(r.mat2df32.create(),this._rotationT,this._T);r.mat2df32.transformMany(d,a,b);c.upperLeft=m.i1616to32(8*d[0],8*d[1]);c.upperRight=m.i1616to32(8*d[2],8*d[3]);c.lowerLeft=m.i1616to32(8*d[4],8*d[5]);c.lowerRight=m.i1616to32(8*d[6],8*d[7])};b.prototype._setTextureCoords=function(a){var c=a.x,d=a.y,b=a.width;a=a.height;
this._texcoords={upperLeft:m.i1616to32(c,d),upperRight:m.i1616to32(c+b,d),lowerLeft:m.i1616to32(c,d+a),lowerRight:m.i1616to32(c+b,d+a)}};return b}();y.ShapedGlyph=B;var G=function(b,a){return{code:0,page:0,sdf:!0,rect:new E.Rect(0,0,11,8),textureBinding:a,metrics:{advance:0,height:4,width:b,left:0,top:0}}},D=function(){function b(a,c,b){this._decorate(a,c,b);this.glyphs=a;this.bounds=this._createBounds(a);this.isMultiline=1<c.length;this._hasRotation=0!==b.angle;this._T=this._createGlyphTransform(this.bounds,
b);for(c=0;c<a.length;c++)a[c].setTransform(this._T)}b.prototype._decorate=function(a,c,b){if("none"!==b.decoration&&a.length){var d=b.scale;b="underline"===b.decoration?30:20;for(var e=a[0].textureBinding,f=0;f<c.length;f++){var h=c[f];a.push(new B(h.startX*d,h.startY*d+b*d,G((h.width+h.glyphWidthEnd)*d,e),1))}}};Object.defineProperty(b.prototype,"boundsT",{get:function(){var a=this.bounds,c=w.vec2.set(C.vec2f32.create(),a.x,a.y);w.vec2.transformMat2d(c,c,this._T);return this._hasRotation?(a=Math.max(a.width,
a.height),new z.default(c[0],c[1],a,a)):new z.default(c[0],c[1],a.width,a.height)},enumerable:!0,configurable:!0});b.prototype._createBounds=function(a){for(var c=Infinity,b=Infinity,g=0,e=0,f=0;f<a.length;f++)var h=a[f],c=Math.min(c,h.xTopLeft),b=Math.min(b,h.yTopLeft),g=Math.max(g,h.xTopLeft+h.width),e=Math.max(e,h.yBottomRight);a=g-c;e-=b;return new z.default(c+a/2,b+e/2,a,e)};b.prototype._createGlyphTransform=function(a,b){var c=b.angle*Math.PI/180,g=r.mat2df32.create(),e=C.vec2f32.create();l.mat2d.translate(g,
g,w.vec2.set(e,b.xOffset,-b.yOffset));b.isCIM?l.mat2d.rotate(g,g,c):(l.mat2d.translate(g,g,w.vec2.set(e,a.x,a.y)),l.mat2d.rotate(g,g,c),l.mat2d.translate(g,g,w.vec2.set(e,-a.x,-a.y)));return g};return b}();y.ShapingInfo=D;var A=function(){return function(b,a,c,d,g,e){this.startY=this.startX=this.glyphWidthEnd=0;this.start=Math.max(0,Math.min(a,c));this.end=Math.max(0,Math.max(a,c));this.end<b.length&&(this.glyphWidthEnd=b[this.end].metrics.width);this.width=d;this.yMin=g;this.yMax=e}}();y.shapeGlyphs=
function(b,a,c){var d=c.scale,g=[],e=[],f=1/c.scale*c.maxLineWidth,h=a?b.length-1:0,n=a?-1:b.length;a=a?-1:1;for(var k=h,q=0,l=0,p=k,m=p,r=0,t=Infinity,u=0;k!==n;){var v=b[k],x=v.code,v=v.metrics,w=Math.abs(v.top);10!==x&&32!==x&&(t=Math.min(t,w),u=Math.max(u,w+v.height));10===x?(k!==h&&(e.push(new A(b,p,k-a,q,t,u)),t=Infinity,u=0),q=0,p=k+a,m=k+a,l=0):32===x?(m=k+a,l=0,r=v.advance,q+=v.advance):(q>f&&(m!==p?(x=m-2*a,q-=r,e.push(new A(b,p,x,q-l,t,u)),t=Infinity,u=0,p=m,q=l):(e.push(new A(b,p,k-a,
q,t,u)),t=Infinity,u=0,m=p=k,q=0)),q+=v.advance,l+=v.advance);k+=a}f=new A(b,p,k-a,q,t,u);0<=f.start&&f.end<b.length&&e.push(f);for(f=0;f<e.length;f++);h=e[0].yMin;n=c.vAlign;f=c.hAlign;a=n===F.VAlign.Baseline?1:0;h=(1-a)*-h+(e[e.length-1].yMax+c.lineHeight*(e.length-1)+("underline"===c.decoration?4:0)-h)/2*(a?0:n-1)+-26*(a?1:0);for(n=0;n<e.length;n++)for(k=e[n],l=k.start,a=k.end,k=k.width/2*(f+1)*-1-3,q=n*c.lineHeight+h-3,e[n].startX=k,e[n].startY=q;l<=a;l++)p=b[l],10!==p.code&&(m=new B(k+p.metrics.left,
q-p.metrics.top,p,d),k+=p.metrics.advance,g.push(m));return new D(g,e,c)}});