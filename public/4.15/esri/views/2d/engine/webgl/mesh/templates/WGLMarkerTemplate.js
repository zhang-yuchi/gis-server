// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.15/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/maybe ../../../../../../core/screenUtils ../../../../../../core/libs/gl-matrix-2/mat2d ../../../../../../core/libs/gl-matrix-2/mat2df32 ../../../../../../core/libs/gl-matrix-2/vec2 ../../../../../../core/libs/gl-matrix-2/vec2f32 ../../../../../../symbols/cim/enums ../../color ../../definitions ../../number ../../materialKey/MaterialKey ./WGLBaseMarkerTemplate ./WGLMeshTemplate".split(" "),function(u,y,G,
H,f,D,I,q,E,z,w,J,c,F,K,L){Object.defineProperty(y,"__esModule",{value:!0});u=function(u){function m(l,a,e,f,h,k,n,p,g,m,B,x,w,C,b,v,r,t,A){var d=u.call(this)||this;d.height=n;d.width=k;d.xOffset=a*A;d.yOffset=e*A;a=E.vec2f32.create();e=I.mat2df32.create();B=(C===z.Alignment.MAP?1:0)|(B?1:0)<<1|(w?1:0)<<2|(x?1:0)<<3;x=b&&b.sdf;D.mat2d.translate(e,e,E.vec2f32.fromValues(d.xOffset,-d.yOffset));f&&D.mat2d.rotate(e,e,3.14159265359/180*f);l=F.MarkerMaterialKey.load(F.createMaterialKey(d.geometryType,l,
!1));l.sdf=x;l.pattern=!0;l.textureBinding=b.textureBinding;d._materialKey=l.data;d._fillColor=h;d._outlineColor=g;d._sizeOutlineWidth=c.i8888to32(Math.round(Math.sqrt(256*k)),Math.round(Math.sqrt(256*n)),Math.round(Math.sqrt(256*m)),Math.round(Math.sqrt(256*p)));h=b.rect.x;p=b.rect.y;g=h+b.rect.width;m=p+b.rect.height;v=.5-((.5+v)*b.width+1)/b.rect.width;r=.5-((.5+r)*b.height+1)/b.rect.height;l=Math.round(Math.min(64*t,255));k*=b.rect.width/b.width*t*A;n*=b.rect.height/b.height*t*A;b=(v-.5)*k;r=
(r-.5)*n;d._bitestAndDistRatio=c.i8888to32(0,0,B,l);q.vec2.set(a,b,r);q.vec2.transformMat2d(a,a,e);d._offsetUpperLeft=c.i1616to32(16*a[0],16*a[1]);d._texUpperLeft=c.i1616to32(h,p);q.vec2.set(a,b+k,r);q.vec2.transformMat2d(a,a,e);d._offsetUpperRight=c.i1616to32(16*a[0],16*a[1]);d._texUpperRight=c.i1616to32(g,p);q.vec2.set(a,b,r+n);q.vec2.transformMat2d(a,a,e);d._offsetBottomLeft=c.i1616to32(16*a[0],16*a[1]);d._texBottomLeft=c.i1616to32(h,m);q.vec2.set(a,b+k,r+n);q.vec2.transformMat2d(a,a,e);d._offsetBottomRight=
c.i1616to32(16*a[0],16*a[1]);d._texBottomRight=c.i1616to32(g,m);return d}G(m,u);m.fromCIMMarker=function(l,a,e){var c=a.size,h=(e&&e.width||1)/(e&&e.height||1)*a.scaleX,k=a.scaleSymbolsProportionally&&a.frameHeight?c/a.frameHeight:1,n=w.premultiplyAlphaRGBA(a.color),p=w.premultiplyAlphaRGBA(a.outlineColor),g=f.pt2px(c),q=g*h,u=f.pt2px(a.offsetX||0),x=f.pt2px(a.offsetY||0),k=f.pt2px(a.outlineWidth||0)*k,y=a.alignment||z.Alignment.SCREEN,C=f.pt2px(a.referenceSize),b=a.rotation||0;a.rotateClockwise||
(b=-b);var v=0,r=0,t=a.anchorPoint;t&&(a.isAbsoluteAnchorPoint?c&&(v=-t.x/(c*h),r=t.y/c):(v=t.x,r=t.y));return new m(l,u,x,b,n,q,g,C,p,k,a.colorLocked,a.scaleSymbolsProportionally,!1,y,e,v,r,a.sizeRatio,H.unwrapOr(a.scaleFactor,1))};m.fromPictureMarker=function(l,a,e){var c=Math.round(f.pt2px(a.width)),h=Math.round(f.pt2px(a.height)),k=J.PICTURE_FILL_COLOR,n=Math.round(f.pt2px(a.xoffset||0)),p=Math.round(f.pt2px(a.yoffset||0));return new m(l,n,p,a.angle,k,c,h,h,0,0,!1,!1,!1,z.Alignment.SCREEN,e,0,
0,1,1)};m.fromSimpleMarker=function(c,a,e){var l=w.premultiplyAlphaRGBA(a.color),h=Math.round(f.pt2px(a.size)),k=Math.round(f.pt2px(a.xoffset||0)),n=Math.round(f.pt2px(a.yoffset||0)),p=a.style,g=a.outline,q=(g&&g.color&&w.premultiplyAlphaRGBA(g.color))|0,g=(g&&g.width&&Math.round(f.pt2px(g.width)))|0;c=new m(c,k,n,a.angle,l,h,h,h,q,g,!1,!1,"cross"===p||"x"===p,z.Alignment.SCREEN,e,0,0,1.96875,1);c.boundsType="circle"===p?"circle":"square";return c};return m}(K.default(L.default));y.default=u});