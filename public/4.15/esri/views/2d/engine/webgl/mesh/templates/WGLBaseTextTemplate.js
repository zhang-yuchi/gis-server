// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.15/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/maybe ../../../../engine ../../definitions ../../enums ../../number ../../WGLDisplayRecord ../../materialKey/MaterialKey".split(" "),function(A,k,p,q,r,m,t,u,v,h,w,x){Object.defineProperty(k,"__esModule",{value:!0});var y=r.getLogger("esri.views.2d.engine.webgl.WGLTextTemplate"),z=function(h,f){void 0===f&&(f="mapview-processing");return y.error(q(f,
h))};k.default=function(k){return function(f){function e(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];a=f.apply(this,a)||this;a._isCIM=!1;a.geometryType=v.WGLGeometryType.TEXT;a._aux=h.i8888to32(0,0,a._referenceSize,a._bitset);return a}p(e,f);e.prototype.bindTextInfo=function(a,b){var c=this;this._shapingInfo=a&&a.length?m.andThen(a,function(a){return t.shapeGlyphs(a,b,{scale:c._scale,angle:c._angle,xOffset:c._xOffset,yOffset:c._yOffset,hAlign:c._xAlignD,vAlign:c._yAlignD,maxLineWidth:Math.max(32,
Math.min(c._lineWidth,512)),lineHeight:u.MAGIC_LABEL_LINE_HEIGHT*Math.max(.25,Math.min(c._lineHeight,4)),decoration:c._decoration,isCIM:c._isCIM})}):null};e.prototype.writeMesh=function(a,b,c,d,g){var e=this;switch(c){case "esriGeometryPoint":this._writeGlyphs(a,b,d,g.geometry);break;case "esriGeometryPolygon":m.andThen(g.centroid,function(c){return e._writeGlyphs(a,b,d,c)});break;case "esriGeometryMultipoint":var n=c=0,h=0;for(g=g.geometry.points;h<g.length;h++){var l=g[h],f=l[1];c+=l[0];n+=f;this._writeGlyphs(a,
b,d,{x:c,y:n})}break;default:z("Unable to handle geometryType: "+c)}};e.prototype._writeGlyphs=function(a,b,c,d){var g=this._shapingInfo;if(!m.isNone(g)){var e=x.MaterialKeyBase.load(this._materialKey);d=h.i1616to32(2*d.x,2*d.y);for(var f=0,g=g.glyphs;f<g.length;f++){var k=g[f],l=new w(c,this.geometryType,e.data,0,0);e.textureBinding=k.textureBinding;l.materialKey=e.data;l.indexFrom=b.indexVector.length;l.indexCount=this._writeIndices(b);l.vertexFrom=b.getVector("geometry").vertexCount;l.vertexCount=
this._writeVertex(b,c,d,k);a.push(l)}}};e.prototype._writeVertexCommon=function(a,b,c,d){d=this._color;var e=this._haloColor,f=h.i8888to32(0,0,this._referenceSize,this._bitset),k=h.i8888to32(0,0,this._size,this._haloSize);a.push(c);a.push(b);a.push(d);a.push(e);a.push(k);a.push(f)};e.prototype._writeVertex=function(a,b,c,d){a=a.get("geometry");this._writeVertexCommon(a,b,c,d);a.push(d.offsets.upperLeft);a.push(d.texcoords.upperLeft);this._writeVertexCommon(a,b,c,d);a.push(d.offsets.upperRight);a.push(d.texcoords.upperRight);
this._writeVertexCommon(a,b,c,d);a.push(d.offsets.lowerLeft);a.push(d.texcoords.lowerLeft);this._writeVertexCommon(a,b,c,d);a.push(d.offsets.lowerRight);a.push(d.texcoords.lowerRight);return 4};e.prototype._writeIndices=function(a){var b=a.getVector("geometry").vertexCount;a=a.indexVector;a.push(b+0);a.push(b+1);a.push(b+2);a.push(b+1);a.push(b+3);a.push(b+2);return 6};return e}(k)}});