// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.15/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/declareExtendsHelper ../../../../core/handleUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../core/watchUtils ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../support/elevationInfoUtils ../Manipulator3D ./ManipulatorState ./settings ../visualElements/LaserlineVisualElement ../visualElements/LineVisualElement ../visualElements/OutlineVisualElement ../../layers/graphics/GraphicState".split(" "),
function(N,t,O,P,p,A,q,B,r,C,z,D,E,c,F,G,H,I){function J(a,e,d){var b=a.graphic,f=new H.OutlineVisualElement({view:a.view,geometry:w(b)?b.geometry:null,elevationInfo:z.getGraphicEffectiveElevationInfo(b),attached:!1});a=function(){f.attached=e.displaying&&c.settings.visualElements.lineGraphics.outlineEnabled};d.push(c.settings.visualElements.lineGraphics.outline.bindStyle(f),e.watch("displaying",a),c.settings.visualElements.lineGraphics.watch("outlineEnabled",a),e.watch("isDraped",function(a){return f.isDraped=
a}),e.on("changed",function(){return f.geometry=w(b)?b.geometry:null}),p.destroyHandle(f));a();return f}function K(a,e,d,b){var f=a.graphic,g=a.view,m=z.getGraphicEffectiveElevationInfo(f),n="on-the-ground"===m.mode||!m.offset&&"absolute-height"!==m.mode,h=new E.ManipulatorState,l=new G.LineVisualElement({view:g,infinite:c.settings.visualElements.zVerticalLine.infiniteType,attached:!1}),m=A.deg2rad(c.settings.visualElements.heightPlaneAngleCutoff),v=new F.LaserlineVisualElement({view:g,attached:!1,
angleCutoff:m}),r=L(),x=c.settings.visualElements.lineGraphics.shadowStyle.bindStyle(e),y=c.settings.visualElements.pointGraphics.shadowStyle.bindStyle(l),t=c.settings.visualElements.heightPlane.bindStyle(v),k=function(){h.update(a);r.update(h);l.infinite=c.settings.visualElements.zVerticalLine.infiniteType;if(d.displaying&&(!n||!d.isDraped&&w(f)&&f.geometry.hasZ)){var b=!1;switch(c.settings.visualElements.lineGraphics.shadowEnabled){case "always":b=!0;break;case "grab-xy":b=!!(h.grabbingState&4)}h.grabbingState&
4?x.updateGlobalAlpha(c.settings.visualElements.laserlineAlphaMultiplier):x.updateGlobalAlpha(1);e.laserlineEnabled=b;b=!1;switch(c.settings.visualElements.pointGraphics.shadowEnabled){case "always":b=!0;break;case "grab-xy":b=!!(h.grabbingState&4)}h.grabbingState&4?y.updateGlobalAlpha(c.settings.visualElements.laserlineAlphaMultiplier):y.updateGlobalAlpha(1);b||c.settings.visualElements.zVerticalLine.enabled?(l.laserlineEnabled=b,b=1===h.numSelected?h.firstSelected:1<h.numSelected&&q.isSome(h.firstGrabbedXY)?
h.firstGrabbedXY:null,q.isSome(b)?(c.settings.visualElements.zVerticalLine.infinite&&(l.worldDownAtLocation=b.renderLocation),l.attached=!0):l.attached=!1):l.attached=!1;M(a,e,v,h,t)}else e.laserlineEnabled=!1,l.attached=!1,v.attached=!1};b.push(x,B.init(c.settings.visualElements.lineGraphics,"shadowEnabled",k),d.on("changed",k),d.watch("displaying",k),c.settings.visualElements.zVerticalLine.bindStyle(l),c.settings.visualElements.zVerticalLine.watch(["enabled","infinite"],k),y,c.settings.visualElements.pointGraphics.watch("shadowEnabled",
k),c.settings.zManipulator.watch("enabled",k),t,c.settings.visualElements.heightPlane.watch("enabled",k),e.events.on("attachment-origin-changed",k),p.destroyHandle(l),p.destroyHandle(v),r);var u=[],g=function(){p.handlesGroup(u).remove();u.length=0;a.forEachManipulator(function(a){return u.push(a.events.on("grab-changed",k))});a.forEachManipulator(function(a){return u.push(a.events.on("select-changed",k))});k()};g();b.push(a.onManipulatorsChanged(g),p.refHandle(function(){return p.handlesGroup(u)}))}
function M(a,e,d,b,f){var g=!1;switch(c.settings.visualElements.heightPlane.enabled){case "always":g=!0;break;case "grab-z":g=!!(b.grabbingState&2)}b.grabbingState&2?f.updateGlobalAlpha(c.settings.visualElements.laserlineAlphaMultiplier):f.updateGlobalAlpha(1);if(g)if(0<b.numSelected){r.vec3.set(n,0,0,0);var m=0;a.forEachManipulator(function(a,b){1===b&&a.selected&&a instanceof D.Manipulator3D&&(r.vec3.add(n,n,a.renderLocation),m++)});0<m?(d.heightPlane=r.vec3.scale(n,n,1/m),d.attached=!0):d.attached=
!1}else e=e.attachmentOrigin,q.isSome(e)&&a.view.renderCoordsHelper.toRenderCoords(e,n)?(d.heightPlane=n,d.attached=!0):d.attached=!1;else d.attached=!1}function L(){var a=null;return{remove:p.refHandle(function(){return a}).remove,update:function(e){var d=!1;switch(c.settings.zManipulator.enabled){case "always":d=!0;break;case "not-grab-z":d=!e.grabbingState}d&&q.isSome(a)?(a.remove(),a=null):!d&&q.isNone(a)&&q.isSome(e.zManipulator)&&(a=e.zManipulator.disableDisplay())}}}function w(a){return q.isSome(a.geometry)&&
("polygon"===a.geometry.type||"polyline"===a.geometry.type)}Object.defineProperty(t,"__esModule",{value:!0});t.createVisualElements=function(a){var c=a.view,d=a.graphic,b=new I.GraphicState({graphic:d}),f=[],g=J(a,b,f);K(a,g,b,f);f.push(c.maskOccludee(d));f.push(c.trackGraphicState(b));return{visualElement:g,remove:function(){p.handlesGroup(f).remove()}}};var n=C.vec3f64.create()});