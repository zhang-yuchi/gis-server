// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.15/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../Color ../../symbols ../../core/asyncUtils ../../core/compilerUtils ../../core/has ../../core/maybe ../../core/screenUtils ../../core/libs/gl-matrix-2/vec3f64 ./gfxUtils ./Symbol3DMaterial @dojo/framework/shim/Promise".split(" "),function(w,f,m,n,r,h,x,t,y,k,z,A,B,C){function p(a,b){if(null==b)return a;a=a.toRgba();a[3]*=b;return new r(a)}function D(a,b,c){if(a=a.symbolLayers){var d=function(a){a=
k.isSome(a)?a:null;b=b||a||null!=c&&E;return p(b,c)};a.forEach(function(a){if("object"!==a.type||null==a.resource.href||b)if("water"===a.type)a.color=d(a.color);else{var e=k.isSome(a.material)?a.material.color:null,e=d(e);k.isNone(a.material)?a.material=new C.default({color:e}):a.material.color=e;null!=c&&"outline"in a&&k.isSome(a.outline)&&k.isSome(a.outline.color)&&(a.outline.color=p(a.outline.color,c))}})}}function F(a,b){return n(this,void 0,void 0,function(){var c,d=this;return m(this,function(e){switch(e.label){case 0:return(c=
a.symbolLayers)?[4,x.forEach(c,function(a){return n(d,void 0,void 0,function(){return m(this,function(d){return[2,G(a,b)]})})})]:[2];case 1:return e.sent(),[2]}})})}function G(a,b){return n(this,void 0,void 0,function(){var c;return m(this,function(d){switch(d.label){case 0:c=a.type;switch(c){case "icon":return[3,1];case "line":return[3,1];case "extrude":return[3,1];case "text":return[3,1];case "path":return[3,2];case "object":return[3,3];case "fill":return[3,5];case "water":return[3,5]}return[3,
6];case 1:for(d=0;d<b.length;d++){var e=b[d];if("number"===typeof e){a.size=e;break}}return[3,7];case 2:return d=u(b,A.vec3f64.ONES,[a.width,void 0,a.height]),a.width=q(b[0],a.width,1,d),a.height=q(b[2],a.height,1,d),[3,7];case 3:return[4,H(a,b)];case 4:return d.sent(),[3,7];case 5:return[3,7];case 6:t.neverReached(a),d.label=7;case 7:return[2]}})})}function H(a,b){return n(this,void 0,void 0,function(){var c,d,e,f;return m(this,function(l){switch(l.label){case 0:return[4,I(a)];case 1:return c=l.sent(),
d=c.resourceSize,e=c.symbolSize,f=u(b,d,e),a.width=q(b[0],e[0],d[0],f),a.depth=q(b[1],e[1],d[1],f),a.height=q(b[2],e[2],d[2],f),[2]}})})}function u(a,b,c){for(var d=0;3>d;d++){var e=a[d];switch(e){case "symbol-value":return null!=c[d]?c[d]/b[d]:1;case "proportional":break;default:if(e&&b[d])return e/b[d]}}return 1}function I(a){return n(this,void 0,void 0,function(){var b,c,d,e,f,l,h,g;return m(this,function(k){switch(k.label){case 0:return[4,new Promise(function(a,b){w(["./symbolLayerUtils"],a,b)})];
case 1:return b=k.sent(),[4,b.computeObjectLayerResourceSize(a,10)];case 2:c=k.sent();d=a.width;e=a.height;f=a.depth;l=[d,f,e];h=1;for(g=0;3>g;g++)if(null!=l[g]){h=l[g]/c[g];break}for(g=0;3>g;g++)null==l[g]&&(l[g]=c[g]*h);return[2,{resourceSize:c,symbolSize:l}]}})})}function q(a,b,c,d){switch(a){case "proportional":return c*d;case "symbol-value":return null!=b?b:c;default:return a}}Object.defineProperty(f,"__esModule",{value:!0});var v=/\/resource\/(.*?)\.svg$/,E=new r("white");f.getSymbolOutlineSize=
function(a){if(!a)return 0;if(h.isSymbol3D(a)){var b=a.symbolLayers&&a.symbolLayers.length;b?(a=a.symbolLayers.getItemAt(b-1),a="outline"in a?k.get(a,"outline","size"):void 0):a=void 0;return k.isSome(a)?a:0}return(a=B.getStroke(a))&&z.px2pt(a.width)||0};f.isVolumetricSymbol=function(a){if(!a||!a.symbolLayers)return!1;switch(a.type){case "point-3d":return a.symbolLayers.some(function(a){return"object"===a.type});case "line-3d":return a.symbolLayers.some(function(a){return"path"===a.type});case "polygon-3d":return a.symbolLayers.some(function(a){return"object"===
a.type||"extrude"===a.type});default:return!1}};f.getIconHref=function(a,b){b=b.resource.href;return!y("esri-canvas-svg-support")&&a.styleOrigin&&v.test(b)?b.replace(v,"/resource/png/$1.png"):b};f.applyOpacityToColor=p;f.applyColorToSymbol=function(a,b,c){if(a&&(b||null!=c))if(b&&(b=new r(b)),h.isSymbol3D(a))D(a,b,c);else if(h.isSymbol2D(a)){if(b=b||a.color)a.color=p(b,c);null!=c&&"outline"in a&&a.outline&&a.outline.color&&(a.outline.color=p(a.outline.color,c))}};f.applySizesToSymbol=function(a,b){return n(this,
void 0,void 0,function(){return m(this,function(c){if(!a||!b)return[2];if(h.isSymbol3D(a))return[2,F(a,b)];if(h.isSymbol2D(a)&&(c=b[0],"number"===typeof c))switch(a.type){case "simple-marker":a.size=c;break;case "picture-marker":var d=a.width/a.height;1<d?(a.width=c,a.height=c*d):(a.width=c*d,a.height=c);break;case "simple-line":a.width=c;break;case "text":a.font.size=c;break;case "simple-fill":case "picture-fill":break;case "cim":break;default:t.neverReached(a)}return[2]})})};f.applyRotationToSymbol=
function(a,b,c){a&&null!=b&&(h.isSymbol3D(a)?(a=a.symbolLayers)&&a.forEach(function(a){if(a&&"object"===a.type)switch(c){case "tilt":a.tilt=b;break;case "roll":a.roll=b;break;default:a.heading=b}}):!h.isSymbol2D(a)||"simple-marker"!==a.type&&"picture-marker"!==a.type&&"text"!==a.type||(a.angle=b))}});