// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.15/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/tsSupport/assignHelper ../../core/compilerUtils ../../core/maybe ../../core/promiseUtils ../../support/arcadeOnDemand ./previewCIMSymbol ./previewSymbol2D ./previewSymbol3D ./previewWebStyleSymbol ./utils".split(" "),function(H,q,I,J,K,L,r,M,N,O,P,Q,R,x){function v(b,a){switch(b.type){case "web-style":return R.previewWebStyleSymbol(b,v,a);case "label-3d":case "line-3d":case "mesh-3d":case "point-3d":case "polygon-3d":return Q.previewSymbol3D(b,
a);case "simple-marker":case "simple-line":case "simple-fill":case "picture-marker":case "picture-fill":case "text":return P.previewSymbol2D(b,a);case "cim":return O.previewCIMSymbol(b,a);default:L.neverReached(b)}}function D(b){return b&&"opacity"in b?b.opacity*D(b.parent):1}Object.defineProperty(q,"__esModule",{value:!0});var n=null;q.renderDotDensityPreviewHTML=function(b,a,c){var h=b.backgroundColor,k=b.outline;b=b.dotSize;var f=c&&c.swatchSize||22,d=Math.round(f*f/Math.pow(b,2)*.8),g=window.devicePixelRatio;
c=document.createElement("canvas");var l=f*g;c.width=l;c.height=l;c.style.width=c.width/g+"px";c.style.height=c.height/g+"px";var e=c.getContext("2d");h&&(e.fillStyle=h.toCss(!0),e.fillRect(0,0,l,l),e.fill());e.fillStyle=a.toCss(!0);if(n&&n.length/2===d)for(a=0;a<2*d;a+=2){var h=n[a],m=n[a+1];e.fillRect(h,m,b*g,b*g);e.fill()}else for(n=[],a=0;a<2*d;a+=2)h=Math.floor(Math.random()*(l-0+1)+0),m=Math.floor(Math.random()*(l-0+1)+0),n.push(h,m),e.fillRect(h,m,b*g,b*g),e.fill();k&&(k.color&&(e.strokeStyle=
k.color.toCss(!0)),e.lineWidth=k.width,e.strokeRect(0,0,l,l));k=new Image(f,f);k.src=c.toDataURL();return k};q.renderColorRampPreviewHTML=function(b,a){void 0===a&&(a={});var c="horizontal"===a.align,h=a.width,h=void 0===h?c?75:24:h,k=a.height,k=void 0===k?c?24:75:k;a=a.gradient;var f=void 0===a?!0:a;a=window.devicePixelRatio;var d=h*a,g=k*a;a=document.createElement("canvas");a.width=d;a.height=g;a.style.width=h+"px";a.style.height=k+"px";var l=a.getContext("2d"),e=c?d:0,m=c?0:g;if(f){var t=l.createLinearGradient(0,
0,e,m),r=1/(b.length-1);b.forEach(function(a,b){return t.addColorStop(b*r,a.toString())});l.fillStyle=t;l.fillRect(0,0,d,g)}else for(f=c?d/b.length:d,d=c?g:g/b.length,m=e=g=0;m<b.length;m++)l.fillStyle=b[m].toString(),l.fillRect(g,e,f,d),g=c?g+f:0,e=c?0:e+d;b=document.createElement("div");b.style.width=h+"px";b.style.height=k+"px";b.appendChild(a);return b};q.renderPreviewHTML=v;q.getDisplayedSymbol=function(b,a){return J(this,void 0,void 0,function(){var c,h,k,f,d,g,l,e,m,t,n,q,y,A,u,v,E,F,w,G,z,
B,C;return I(this,function(p){switch(p.label){case 0:if(!b)return[2,void 0];c=D(b.layer||b.sourceLayer);return!r.isSome(b.symbol)||r.isSome(a)&&!0===a.ignoreGraphicSymbol?[3,4]:"web-style"!==b.symbol.type?[3,2]:[4,b.symbol.fetchSymbol(r.isSome(a)?a.abortOptions:null)];case 1:return k=p.sent(),[3,3];case 2:k=b.symbol.clone(),p.label=3;case 3:return h=k,x.applyColorToSymbol(h,null,c),[2,h];case 4:return f=b.get("layer.renderer")||b.get("sourceLayer.renderer"),[4,f.getSymbolAsync(b)];case 5:return(d=
p.sent())?"web-style"!==d.type?[3,7]:[4,d.fetchSymbol(r.isSome(a)?a.abortOptions:null)]:[2,void 0];case 6:return d=p.sent(),[3,8];case 7:d=d.clone(),p.label=8;case 8:if(!("visualVariables"in f)||"visualVariables"in f&&!f.visualVariables||"visualVariables"in f&&f.visualVariables&&!f.visualVariables.length)return[2,d];if(!f.arcadeRequiredForVisualVariables||!r.isNone(a)&&!r.isNone(a.arcade))return[3,10];l=g=K({},r.unwrap(a));return[4,N.loadArcade()];case 9:l.arcade=p.sent(),a=g,p.label=10;case 10:return[4,
M.create(function(a){return H(["../../renderers/visualVariables/support/visualVariableUtils"],a)})];case 11:e=p.sent();m=[];t=[];n=[];q=[];y=0;for(A=f.visualVariables;y<A.length;y++)switch(u=A[y],u.type){case "color":m.push(u);break;case "opacity":t.push(u);break;case "rotation":q.push(u);break;case "size":u.target||n.push(u)}E=(v=!!m.length&&m[m.length-1])?e.getColor(v,b,a):null;w=(F=!!t.length&&t[t.length-1])?e.getOpacity(F,b,a):null;null!=c&&(w=null!=w?w*c:c);x.applyColorToSymbol(d,E,w);if(!n.length)return[3,
13];G=e.getAllSizes(n,b,a);return[4,x.applySizesToSymbol(d,G)];case 12:p.sent(),p.label=13;case 13:z=0;for(B=q;z<B.length;z++)C=B[z],x.applyRotationToSymbol(d,e.getRotationAngle(C,b,a),C.axis);return[2,d]}})})}});