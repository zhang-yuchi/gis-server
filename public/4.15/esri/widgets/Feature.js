// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.15/esri/copyright.txt for details.
//>>built
require({cache:{"esri/widgets/Attachments":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/generatorHelper ../core/tsSupport/awaiterHelper ../core/tsSupport/assignHelper dojo/i18n!./Attachments/nls/Attachments ../core/Error ../core/unitFormatUtils ../core/watchUtils ../core/accessorSupport/decorators ./Widget ./Attachments/AttachmentsViewModel ./Attachments/support/attachmentUtils ./support/widget".split(" "),function(z,
r,h,d,u,x,w,n,B,t,C,l,g,y,D,p){var E={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},q=window.CSS;return function(e){function b(f){f=e.call(this,f)||this;f.abilities=null;f.displayType="list";f.graphic=null;f.label=n.widgetLabel;f.selectedFile=null;f.submitting=!1;f.viewModel=new y;f.visibleElements=w({},E);f._supportsImageOrientation=q&&q.supports&&q.supports("image-orientation","from-image");f._addAttachmentForm=
null;f._updateAttachmentForm=null;return f}h(b,e);b.prototype.postInitialize=function(){var f=this;this.own(C.on(this,"viewModel.attachmentInfos","change",function(){return f.scheduleRender()}),C.init(this,"viewModel.mode",function(){return f._modeChanged()}))};b.prototype.castVisibleElements=function(f){return w({},E,f)};b.prototype.addAttachment=function(){var f=this,v=this._addAttachmentForm,k=this.viewModel;this._set("submitting",!0);this._set("error",null);return k.addAttachment(v).then(function(a){f._set("submitting",
!1);f._set("error",null);k.mode="view";return a}).catch(function(a){f._set("submitting",!1);f._set("error",new B("attachments:add-attachment",n.addErrorMessage,a));throw a;})};b.prototype.deleteAttachment=function(f){var v=this,k=this.viewModel;this._set("submitting",!0);this._set("error",null);return k.deleteAttachment(f).then(function(a){v._set("submitting",!1);v._set("error",null);k.mode="view";return a}).catch(function(a){v._set("submitting",!1);v._set("error",new B("attachments:delete-attachment",
n.deleteErrorMessage,a));throw a;})};b.prototype.updateAttachment=function(){var f=this,v=this.viewModel,k=this._updateAttachmentForm;this._set("submitting",!0);this._set("error",null);return v.updateAttachment(k).then(function(a){f._set("submitting",!1);f._set("error",null);v.mode="view";return a}).catch(function(a){f._set("submitting",!1);f._set("error",new B("attachments:update-attachment",n.updateErrorMessage,a));throw a;})};b.prototype.render=function(){var f=this.submitting,v=this.viewModel.state;
return p.tsx("div",{class:this.classes("esri-attachments","esri-widget")},f?this._renderProgressBar():null,"loading"===v?this._renderLoading():this._renderAttachments(),this._renderErrorMessage())};b.prototype._renderErrorMessage=function(){var f=this.error,v=this.visibleElements;return f&&v.errorMessage?p.tsx("div",{key:"error-message",class:"esri-attachments__error-message"},f.message):null};b.prototype._renderAttachments=function(){var f=this.viewModel,v=f.mode,f=f.activeAttachmentInfo;return"add"===
v?this._renderAddForm():"edit"===v?this._renderDetailsForm(f):this._renderAttachmentContainer()};b.prototype._renderLoading=function(){return p.tsx("div",{class:"esri-attachments__loader-container",key:"loader"},p.tsx("div",{class:"esri-attachments__loader"}))};b.prototype._renderProgressBar=function(){return this.visibleElements.progressBar?p.tsx("div",{class:"esri-attachments__progress-bar",key:"progress-bar"}):null};b.prototype._renderAddForm=function(){var f,v=this.submitting,k=this.selectedFile,
a=v||!k,v=this.visibleElements.cancelAddButton?p.tsx("button",{type:"button",bind:this,disabled:v,onclick:this._cancelForm,class:this.classes("esri-button","esri-button--tertiary","esri-button--small","esri-button--half",v&&"esri-button--disabled")},n.cancel):null,a=this.visibleElements.addSubmitButton?p.tsx("button",{type:"submit",disabled:a,class:this.classes("esri-button","esri-button--secondary","esri-button--small","esri-button--half",(f={},f["esri-button--disabled"]=a,f))},n.add):null;f=k?p.tsx("span",
{key:"file-name",class:"esri-attachments__file-name"},k.name):null;k=p.tsx("form",{bind:this,afterCreate:p.storeNode,afterRemoved:p.discardNode,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},p.tsx("fieldset",{class:"esri-attachments__file-fieldset"},f,p.tsx("label",{class:this.classes("esri-attachments__file-label","esri-button","esri-button--secondary")},k?n.changeFile:n.selectFile,p.tsx("input",{class:"esri-attachments__file-input",type:"file",name:"attachment",bind:this,
onchange:this._handleFileInputChange}))),a,v);return p.tsx("div",{key:"add-form-container",class:"esri-attachments__form-node"},k)};b.prototype._renderDetailsForm=function(f){var v=this,k,a,c,A=this.visibleElements,e=this.selectedFile,b=this.submitting,d=f.contentType,l=f.size,g=f.url,q=this.viewModel.abilities,h=b||!e,C=q.editing&&q.operations.delete&&A.deleteButton?p.tsx("button",{key:"delete-button",type:"button",disabled:b,bind:this,onclick:function(a){return v._submitDeleteAttachment(a,f)},class:this.classes("esri-button",
"esri-button--small","esri-button--tertiary","esri-attachments__delete-button",(k={},k["esri-button--disabled"]=b,k))},n.delete):null;k=q.editing&&q.operations.update&&A.updateButton?p.tsx("button",{disabled:h,key:"update-button",type:"submit",class:this.classes("esri-button","esri-button--small","esri-button--third",(a={},a["esri-button--disabled"]=h,a))},n.update):null;a=this.visibleElements.cancelUpdateButton?p.tsx("button",{disabled:b,key:"cancel-button",type:"button",bind:this,onclick:this._cancelForm,
class:this.classes("esri-button","esri-button--small","esri-button--tertiary","esri-button--third",(c={},c["esri-button--disabled"]=b,c))},n.cancel):null;c=e?p.tsx("span",{key:"file-name",class:"esri-attachments__file-name"},e.name):null;q=q.editing&&q.operations.update?p.tsx("fieldset",{key:"file",class:"esri-attachments__file-fieldset"},c,p.tsx("label",{class:this.classes("esri-attachments__file-label","esri-button","esri-button--secondary")},n.changeFile,p.tsx("input",{class:"esri-attachments__file-input",
type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))):null;l=p.tsx("fieldset",{key:"size",class:"esri-attachments__metadata-fieldset"},p.tsx("label",null,t.formatFileSize(l)));d=p.tsx("fieldset",{key:"content-type",class:"esri-attachments__metadata-fieldset"},p.tsx("label",null,d));C=p.tsx("form",{bind:this,afterCreate:p.storeNode,afterRemoved:p.discardNode,"data-node-ref":"_updateAttachmentForm",onsubmit:this._submitUpdateAttachment},p.tsx("div",{class:"esri-attachments__metadata"},
l,d),q,p.tsx("div",{class:"esri-attachments__actions"},C,a,k));return p.tsx("div",{key:"edit-form-container",class:"esri-attachments__form-node"},p.tsx("a",{class:"esri-attachments__item-link",href:g,rel:"noreferrer",target:"_blank",alt:name},this._renderImageMask({attachmentInfo:f,size:400}),p.tsx("div",{class:"esri-attachments__item-link-overlay"},p.tsx("span",{class:"esri-attachments__item-link-overlay-icon"},p.tsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32"},
p.tsx("path",{d:"M28 13h1v16H3V3h16v1H4v24h24zm-5-9h4.293L15.646 15.638l.707.707L28 4.707V9h1V3h-6z"}),p.tsx("path",{fill:"none",d:"M0 0h32v32H0z"}))))),C)};b.prototype._renderImageMask=function(f){var b=f.attachmentInfo,k=f.size,a,c;f=this.viewModel.supportsResizeAttachments;var e=b.contentType,d=b.url,l=f&&D.isSupportedImage(e),b=(b=this._getCSSTransform(b,l))?{transform:b,"image-orientation":"none"}:{},g=-1===d.indexOf("?")?"?":"\x26",k=l?""+d+g+"w\x3d"+k:D.getIconPath(e),l=(a={},a["esri-attachments__item-mask--icon"]=
!l,a);a=(c={},c["esri-attachments__image--resizable"]=f,c);return p.tsx("div",{class:this.classes(l,"esri-attachments__item-mask")},p.tsx("img",{styles:b,alt:"",src:k,class:this.classes(a,"esri-attachments__image")}))};b.prototype._renderAttachmentInfo=function(f){var b=this,k=f.attachmentInfo,a=this.viewModel.abilities,c=k.name,e=k.url;f=this._renderImageMask({attachmentInfo:k,size:"list"===f.displayType?48:400});var d=a.editing?p.tsx("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-chevron-icon",
p.isRTL()?"esri-icon-left":"esri-icon-right")}):null,c=p.tsx("label",{class:"esri-attachments__label"},p.tsx("span",{class:"esri-attachments__filename"},c||n.noTitle),d),c=[f,c],a=a.editing?p.tsx("button",{key:"details-button",bind:this,class:"esri-attachments__item-button",title:n.attachmentDetails,"aria-label":n.attachmentDetails,"data-attachment-info-id":k.id,onclick:function(){return b._startEditAttachment(k)}},c):p.tsx("a",{key:"details-link",class:"esri-attachments__item-button",href:e,target:"_blank"},
c);return p.tsx("li",{class:"esri-attachments__item",key:k},a)};b.prototype._renderAttachmentContainer=function(){var f=this,b,k=this.displayType,a=this.viewModel,c=this.visibleElements,e=a.attachmentInfos,d=a.abilities,l=e&&e.length,a=(b={},b["esri-attachments__container--list"]="preview"!==k,b["esri-attachments__container--preview"]="preview"===k,b);b=d.editing&&d.operations.add&&c.addButton?p.tsx("button",{bind:this,onclick:function(){return f._startAddAttachment()},class:this.classes("esri-button",
"esri-button--tertiary","esri-attachments__add-attachment-button")},p.tsx("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-add-icon","esri-icon-plus")}),n.add):null;e=l?p.tsx("ul",{class:"esri-attachments__items"},e.toArray().map(function(a){return f._renderAttachmentInfo({attachmentInfo:a,displayType:k})})):p.tsx("div",{class:"esri-widget__content--empty"},n.noAttachments);return p.tsx("div",{key:"attachments-container",class:this.classes("esri-attachments__container",a)},
e,b)};b.prototype._modeChanged=function(){this._set("error",null);this._set("selectedFile",null)};b.prototype._handleFileInputChange=function(f){f=(f=f.target)&&f.files&&f.files.item(0);this._set("selectedFile",f)};b.prototype._submitDeleteAttachment=function(f,b){f.preventDefault();this.deleteAttachment(b)};b.prototype._submitAddAttachment=function(f){f.preventDefault();this.addAttachment()};b.prototype._submitUpdateAttachment=function(f){f.preventDefault();this.updateAttachment()};b.prototype._startEditAttachment=
function(f){var b=this.viewModel;b.activeAttachmentInfo=f;b.mode="edit"};b.prototype._startAddAttachment=function(){this.viewModel.mode="add"};b.prototype._cancelForm=function(f){f.preventDefault();this.viewModel.mode="view"};b.prototype._getCSSTransform=function(f,b){f=f.orientationInfo;return!this._supportsImageOrientation&&b&&f?[f.rotation?"rotate("+f.rotation+"deg)":"",f.mirrored?"scaleX(-1)":""].join(" "):""};d([l.aliasOf("viewModel.abilities")],b.prototype,"abilities",void 0);d([l.property(),
p.renderable()],b.prototype,"displayType",void 0);d([l.aliasOf("viewModel.graphic")],b.prototype,"graphic",void 0);d([l.property()],b.prototype,"label",void 0);d([l.property({readOnly:!0})],b.prototype,"selectedFile",void 0);d([p.renderable(),l.property({readOnly:!0})],b.prototype,"submitting",void 0);d([p.renderable(),l.property({readOnly:!0})],b.prototype,"error",void 0);d([l.property({type:y}),p.renderable("viewModel.activeAttachmentInfo viewModel.mode viewModel.state viewModel.supportsResizeAttachments viewModel.attachmentInfos viewModel.graphic viewModel.abilities viewModel.abilities.editing viewModel.abilities.operations".split(" "))],
b.prototype,"viewModel",void 0);d([l.property(),p.renderable()],b.prototype,"visibleElements",void 0);d([l.cast("visibleElements")],b.prototype,"castVisibleElements",null);return b=d([l.subclass("esri.widgets.Attachments")],b)}(l.declared(g))})},"esri/core/unitFormatUtils":function(){define("require exports dojo/i18n!./nls/Units ./string ./unitUtils ../intl/number".split(" "),function(z,r,h,d,u,x){function w(d,n){return h.units[d][n]}function n(d,n,l,g){void 0===l&&(l=2);void 0===g&&(g="abbr");return x.formatNumber(d,
{minimumFractionDigits:l,maximumFractionDigits:l})+" "+w(n,g)}Object.defineProperty(r,"__esModule",{value:!0});r.unitName=w;r.formatDecimal=n;r.formatMetricLength=function(d,h,l,g){void 0===l&&(l=2);void 0===g&&(g="abbr");var t=u.preferredMetricLengthUnit(d,h);return n(u.convertUnit(d,h,t),t,l,g)};r.formatMetricVerticalLength=function(d,h,l,g){void 0===l&&(l=2);void 0===g&&(g="abbr");var t=u.preferredMetricVerticalLengthUnit(d,h);return n(u.convertUnit(d,h,t),t,l,g)};r.formatImperialLength=function(d,
h,l,g){void 0===l&&(l=2);void 0===g&&(g="abbr");var t=u.preferredImperialLengthUnit(d,h);return n(u.convertUnit(d,h,t),t,l,g)};r.formatImperialVerticalLength=function(d,h,l,g){void 0===l&&(l=2);void 0===g&&(g="abbr");var t=u.preferredImperialVerticalLengthUnit(d,h);return n(u.convertUnit(d,h,t),t,l,g)};r.formatMetricArea=function(d,h,l,g){void 0===l&&(l=2);void 0===g&&(g="abbr");var t=u.preferredMetricAreaUnit(d,h);return n(u.convertUnit(d,h,t),t,l,g)};r.formatImperialArea=function(d,h,l,g){void 0===
l&&(l=2);void 0===g&&(g="abbr");var t=u.preferredImperialAreaUnit(d,h);return n(u.convertUnit(d,h,t),t,l,g)};r.formatDMS=function(d,h,l){void 0===l&&(l=2);d=u.convertUnit(d,h,"degrees");h=d-Math.floor(d);d-=h;h*=60;var g=h-Math.floor(h);h-=g;g*=60;return d.toFixed()+"\u00b0 "+h.toFixed()+"' "+g.toFixed(l)+'"'};z=h.units.bytes;var B=[z.B,z.kB,z.MB,z.GB,z.TB];r.formatFileSize=function(h){var n=0===h?0:Math.floor(Math.log(h)/Math.log(1024));h=x.formatNumber(h/Math.pow(1024,n),{maximumFractionDigits:2});
return d.replace(B[n],{fileSize:h})}})},"esri/widgets/Attachments/AttachmentsViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/awaiterHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/assignHelper ../../Graphic ../../core/Collection ../../core/Error ../../core/HandleOwner ../../core/watchUtils ../../core/accessorSupport/decorators ../../layers/support/AttachmentInfo ../../tasks/support/AttachmentQuery ../Feature/support/featureUtils".split(" "),
function(z,r,h,d,u,x,w,n,B,t,C,l,g,y,D,p){var E={editing:!1,operations:{add:!0,update:!0,delete:!0}},q=B.ofType(y);return function(e){function b(f){var b=e.call(this,f)||this;b._getAttachmentsPromise=null;b._attachmentLayer=null;b.abilities=w({},E);b.activeAttachmentInfo=null;b.attachmentInfos=new q;b.graphic=null;b.mode="view";b.handles.add([l.init(b,"graphic",function(){return b._graphicChanged()})]);return b}h(b,e);b.prototype.destroy=function(){this.graphic=this._attachmentLayer=null};b.prototype.castAbilities=
function(f){return w({},E,f)};Object.defineProperty(b.prototype,"state",{get:function(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"supportsResizeAttachments",{get:function(){return this.get("graphic.layer.capabilities.operations.supportsResizeAttachments")||!1},enumerable:!0,configurable:!0});b.prototype.getAttachments=function(){return u(this,void 0,void 0,function(){var f,b,e,a,c,d,h,l;return x(this,
function(k){switch(k.label){case 0:f=this;b=f._attachmentLayer;e=f.attachmentInfos;if(!b||"function"!==typeof b.queryAttachments)throw new t("invalid-layer","getAttachments(): A valid layer is required.");a=this._getFeatureId();c=new D({objectIds:[a],returnMetadata:!0});d=[];this._getAttachmentsPromise=h=b.queryAttachments(c).then(function(c){return c[a]||d}).catch(function(){return d});this.notifyChange("state");return[4,h];case 1:return l=k.sent(),e.removeAll(),l.length&&e.addMany(l),this._getAttachmentsPromise=
null,this.notifyChange("state"),[2,l]}})})};b.prototype.addAttachment=function(f){return u(this,void 0,void 0,function(){var b,e,a,c,d,l,h,g=this;return x(this,function(k){switch(k.label){case 0:b=this;e=b._attachmentLayer;a=b.attachmentInfos;c=b.graphic;d=b.abilities;if(!f)throw new t("invalid-attachment","addAttachment(): An attachment is required.",{attachment:f});if(!d.operations.add)throw new t("invalid-abilities","addAttachment(): add abilities are required.");if(!e||"function"!==typeof e.addAttachment)throw new t("invalid-layer",
"addAttachment(): A valid layer is required.");l=e.addAttachment(c,f).then(function(a){return g._queryAttachment(a.objectId)});return[4,l];case 1:return h=k.sent(),a.add(h),[2,h]}})})};b.prototype.deleteAttachment=function(b){return u(this,void 0,void 0,function(){var f,e,a,c,d,h,l;return x(this,function(k){switch(k.label){case 0:f=this;e=f._attachmentLayer;a=f.attachmentInfos;c=f.graphic;d=f.abilities;if(!b)throw new t("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",
{attachmentInfo:b});if(!d.operations.delete)throw new t("invalid-abilities","deleteAttachment(): delete abilities are required.");if(!e||"function"!==typeof e.deleteAttachments)throw new t("invalid-layer","deleteAttachment(): A valid layer is required.");h=e.deleteAttachments(c,[b.id]).then(function(){return b});return[4,h];case 1:return l=k.sent(),a.remove(l),[2,l]}})})};b.prototype.updateAttachment=function(b,e){void 0===e&&(e=this.activeAttachmentInfo);return u(this,void 0,void 0,function(){var f,
a,c,d,l,h,v,g,p=this;return x(this,function(k){switch(k.label){case 0:f=this;a=f._attachmentLayer;c=f.attachmentInfos;d=f.graphic;l=f.abilities;if(!b)throw new t("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:b});if(!e)throw new t("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:e});if(!l.operations.update)throw new t("invalid-abilities","updateAttachment(): Update abilities are required.");h=c.findIndex(function(a){return a===
e});if(!a||"function"!==typeof a.updateAttachment)throw new t("invalid-layer","updateAttachment(): A valid layer is required.");v=a.updateAttachment(d,e.id,b).then(function(a){return p._queryAttachment(a.objectId)});return[4,v];case 1:return g=k.sent(),c.splice(h,1,g),[2,g]}})})};b.prototype._queryAttachment=function(b){return u(this,void 0,void 0,function(){var f,e,a;return x(this,function(c){if(!b)throw new t("invalid-attachment-id","Could not query attachment.");f=this._attachmentLayer;e=this._getFeatureId();
a=new D({objectIds:[e],attachmentsWhere:"AttachmentId\x3d"+b,returnMetadata:!0});return[2,f.queryAttachments(a).then(function(a){return a[e][0]})]})})};b.prototype._getFeatureId=function(){var b=this._attachmentLayer,e=this.graphic;if(!b||!e)return null;b=b.objectIdField;return(e=e.attributes)&&e[b]};b.prototype._graphicChanged=function(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(function(){}))};b.prototype._setAttachmentLayer=function(){var b=p.getSourceLayer(this.graphic);
this._attachmentLayer=b?"scene"===b.type&&b.associatedLayer?b.associatedLayer:b:null};d([g.property()],b.prototype,"abilities",void 0);d([g.cast("abilities")],b.prototype,"castAbilities",null);d([g.property()],b.prototype,"activeAttachmentInfo",void 0);d([g.property({readOnly:!0,type:q})],b.prototype,"attachmentInfos",void 0);d([g.property({type:n})],b.prototype,"graphic",void 0);d([g.property()],b.prototype,"mode",void 0);d([g.property({dependsOn:["graphic"],readOnly:!0})],b.prototype,"state",null);
d([g.property({readOnly:!0,dependsOn:["graphic","graphic.layer","graphic.layer.loaded","graphic.layer.capabilities.operations.supportsResizeAttachments"]})],b.prototype,"supportsResizeAttachments",null);return b=d([g.subclass("esri.widgets.Attachments.AttachmentsViewModel")],b)}(g.declared(C.HandleOwner))})},"esri/widgets/Feature/support/featureUtils":function(){define(["require","exports"],function(z,r){Object.defineProperty(r,"__esModule",{value:!0});r.getSourceLayer=function(h){if(h)return h.get("sourceLayer")||
h.get("layer")}})},"esri/widgets/Attachments/support/attachmentUtils":function(){define(["require","exports"],function(z,r){Object.defineProperty(r,"__esModule",{value:!0});var h=z.toUrl("../../../themes/base/images/files/");r.isSupportedImage=function(d){d=d.toLowerCase();return"image/bmp"===d||"image/emf"===d||"image/exif"===d||"image/gif"===d||"image/x-icon"===d||"image/jpeg"===d||"image/png"===d||"image/tiff"===d||"image/x-wmf"===d};r.getIconPath=function(d){return d?"text/plain"===d?h+"text-32.svg":
"application/pdf"===d?h+"pdf-32.svg":"text/csv"===d?h+"csv-32.svg":"application/gpx+xml"===d?h+"gpx-32.svg":"application/x-dwf"===d?h+"cad-32.svg":"application/postscript"===d||"application/json"===d||"text/xml"===d||"model/vrml"===d?h+"code-32.svg":"application/x-zip-compressed"===d||"application/x-7z-compressed"===d||"application/x-gzip"===d||"application/x-tar"===d||"application/x-gtar"===d||"application/x-bzip2"===d||"application/gzip"===d||"application/x-compress"===d||"application/x-apple-diskimage"===
d||"application/x-rar-compressed"===d||"application/zip"===d?h+"zip-32.svg":-1!==d.indexOf("image/")?h+"image-32.svg":-1!==d.indexOf("audio/")?h+"sound-32.svg":-1!==d.indexOf("video/")?h+"video-32.svg":-1!==d.indexOf("msexcel")||-1!==d.indexOf("ms-excel")||-1!==d.indexOf("spreadsheetml")?h+"excel-32.svg":-1!==d.indexOf("msword")||-1!==d.indexOf("ms-word")||-1!==d.indexOf("wordprocessingml")?h+"word-32.svg":-1!==d.indexOf("powerpoint")||-1!==d.indexOf("presentationml")?h+"report-32.svg":h+"generic-32.svg":
h+"generic-32.svg"}})},"esri/widgets/Feature/FeatureViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../Graphic ../../intl ../../core/Error ../../core/Handles ../../core/lang ../../core/Logger ../../core/promiseUtils ../../core/string ../../core/throttle ../../core/watchUtils ../../core/accessorSupport/decorators ../../intl/date ../../intl/number ../../layers/support/fieldUtils ../../popup/content/TextContent ../../popup/content/support/ChartMediaInfoValueSeries ../../popup/support/FieldInfoFormat ../Attachments/AttachmentsViewModel ./support/featureUtils ./support/RelatedFeatures ../support/widget".split(" "),
function(z,r,h,d,u,x,w,n,B,t,C,l,g,y,D,p,E,q,e,b,f,v,k,a,c,A,M,K){function N(){return w(this,void 0,void 0,function(){return x(this,function(a){return[2,y.create(function(a){z(["../../support/arcadeUtils"],function(m){a(m)})})]})})}function G(a){var c=/(\n)/gi;return"string"===typeof a?a.replace(c,'\x3cbr class\x3d"esri-text-new-line" /\x3e'):a}function H(a,c){return a&&"function"===typeof a.getField?a.getField(c):null}function I(a){return a.replace(/[\u00A0-\u9999<>\&]/gim,function(a){return"\x26#"+
a.charCodeAt(0)+";"})}var O=["$datastore","$map","$layer"],F=g.getLogger("esri.widgets.FeatureViewModel"),L=/^\s*expression\//i,J=e.convertDateFormatToIntlOptions("short-date-short-time");return function(e){function g(a){var m=e.call(this,a)||this;m._handles=new C;m._featureAbortController=null;m._graphicChangedThrottled=p.throttle(m._graphicChanged,1,m);m._effectivePopupTemplate=null;m._graphic=null;m._fieldInfoMap=null;m.attachmentsViewModel=new c;m.content=null;m.defaultPopupTemplateEnabled=!1;
m.formattedAttributes=null;m.graphic=null;m.lastEditInfo=null;m.title="";m.view=null;m._handles.add(E.init(m,"graphic graphic.sourceLayer.popupTemplate.title graphic.sourceLayer.popupTemplate.content graphic.sourceLayer.popupTemplate.expressionInfos graphic.sourceLayer.popupTemplate.fieldInfos graphic.sourceLayer.popupTemplate.lastEditInfoEnabled graphic.sourceLayer.popupTemplate.outFields graphic.sourceLayer.popupTemplate.relatedRecordsInfo graphic.popupTemplate.title graphic.popupTemplate.content graphic.popupTemplate.expressionInfos graphic.popupTemplate.fieldInfos graphic.popupTemplate.lastEditInfoEnabled graphic.popupTemplate.outFields graphic.popupTemplate.relatedRecordsInfo".split(" "),
function(){return m._graphicChangedThrottled()}));return m}h(g,e);g.prototype.destroy=function(){this._clear();this._cancelFeatureQuery();this._handles.destroy();this._graphic=this.graphic=this._handles=null;this._destroyAttachmentsViewModel();this._set("attachmentsViewModel",null)};Object.defineProperty(g.prototype,"spatialReference",{get:function(){return this.get("view.spatialReference")||null},set:function(a){void 0===a?this._clearOverride("spatialReference"):this._override("spatialReference",
a)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"map",{get:function(){return this.get("view.map")||null},set:function(a){void 0===a?this._clearOverride("map"):this._override("map",a)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"waitingForContent",{get:function(){return!!this._featureAbortController},enumerable:!0,configurable:!0});g.prototype._clear=function(){this._set("title","");this._set("content",null);this._set("formattedAttributes",null)};g.prototype._graphicChanged=
function(){return w(this,void 0,void 0,function(){var a,c,b,e;return x(this,function(m){switch(m.label){case 0:this._cancelFeatureQuery();this._clear();this._graphic=c=(a=this.graphic)?a.clone():null;if(!c)return[2];this._featureAbortController=b=y.createAbortController();m.label=1;case 1:return m.trys.push([1,3,,4]),[4,this._queryFeature({signal:b.signal})];case 2:return m.sent(),[3,4];case 3:return e=m.sent(),F.error("error","error loading template",e),[3,4];case 4:return this._featureAbortController=
null,[2]}})})};g.prototype._cancelFeatureQuery=function(){var a=this._featureAbortController;a&&a.abort();this._featureAbortController=null};g.prototype._compileContent=function(a){var m=this;if(a&&(a.nodeName||a&&K.hasDomNode(a)||K.isWidget(a)))return a;if(this._graphic){if("string"===typeof a)return this._compileText(new v({text:a})).text;if(Array.isArray(a))return a.map(function(a){if("attachments"===a.type)return m._compileAttachments(a);if("fields"===a.type)return m._compileFields(a);if("media"===
a.type)return m._compileMedia(a);if("text"===a.type)return m._compileText(a)});a&&F.warn("invalid content type.")}};g.prototype._destroyAttachmentsViewModel=function(){var a=this.attachmentsViewModel;a&&!a.destroyed&&a.destroy()};g.prototype._compileAttachments=function(a){this.attachmentsViewModel.graphic=this.graphic;return a};g.prototype._compileFields=function(a){var m=this,c=this._effectivePopupTemplate;a=l.clone(a);var b=c&&c.expressionInfos,c=a.fieldInfos?void 0:c&&c.fieldInfos,c=a.fieldInfos||
l.clone(c),e=[];c&&c.forEach(function(a){var c=a.fieldName.toLowerCase();if(!a.hasOwnProperty("visible")||a.visible)c=m._isExpressionField(c)?m._getExpressionInfo(b,c):null,a.label=c?c.title:a.label,e.push(a)});a.fieldInfos=e;return a};g.prototype._setImageValue=function(a){var c=a.value,m=a.formattedAttributes;a=a.layer;var b=c.linkURL,e=c.sourceURL;e&&(e=this._fixTokens(e,a),c.sourceURL=this._substituteAttributes(m,e));b&&(a=this._fixTokens(b,a),c.linkURL=this._substituteAttributes(m,a))};g.prototype._compileMedia=
function(a){var c=this,m=this._graphic;a=l.clone(a);var b=a.mediaInfos,e=m.attributes,f=A.getSourceLayer(m),d=this.formattedAttributes.global,g=u({},d,e);a.mediaInfos=b&&b.map(function(a){if(a=l.clone(a)){var m=a.title?c._processFieldsInLinks(a.title,g):"",b=a.caption?c._processFieldsInLinks(a.caption,g):"";a.title=m?c._substituteAttributes(d,m):"";a.caption=b?c._substituteAttributes(d,b):"";if("image"===a.type)return m=a.value,c._setImageValue({value:m,formattedAttributes:d,layer:f}),a.value.sourceURL?
a:void 0;if("pie-chart"===a.type||"line-chart"===a.type||"column-chart"===a.type||"bar-chart"===a.type)return m=a.value,c._setChartValue({value:m,chartType:a.type,attributes:e,formattedAttributes:d,layer:f}),a}}).filter(Boolean);return a};g.prototype._normalizeTemplateFields=function(a){var c=this._fieldInfoMap.get(a.toLowerCase());return"{"+(c&&c.fieldName||a)+"}"};g.prototype._substituteAttributes=function(a,c){var m=this;return(""+this._removeEmptyHref(D.replace(D.replace(c,function(a){return m._normalizeTemplateFields(a)}),
a))).trim()};g.prototype._compileText=function(a){if((a=l.clone(a))&&a.text){var c=this.formattedAttributes.global,b=this._processFieldsInLinks(a.text,u({},c,this._graphic.attributes));a.text=this._substituteAttributes(c,b)}return a};g.prototype._formatEditInfo=function(a,c){var b=a.creatorField,m=a.creationDateField,e=a.editorField;if(c){a=c[a.editDateField];if("number"===typeof a)return c=c[e],b=B.formatDate(a,J),{type:"edit",date:b,user:c};m=c[m];if("number"===typeof m)return c=c[b],b=B.formatDate(m,
J),{type:"create",date:b,user:c}}};g.prototype._compileLastEditInfo=function(){var a=this._effectivePopupTemplate,c=this._graphic;if(a){var a=a.lastEditInfoEnabled,b=c.get("sourceLayer.editFieldsInfo");if(a&&b)return this._formatEditInfo(b,c.attributes)}};g.prototype._compileTitle=function(a){var c=this._graphic.attributes,b=this.formattedAttributes.global;return a?(a=this._processFieldsInLinks(a,u({},b,c)),this._substituteAttributes(b,a)):""};g.prototype._getExpressionInfo=function(a,c){if(this._isExpressionField(c)){var b=
c.replace(L,"").toLowerCase(),m;a.some(function(a){return a.name.toLowerCase()===b?(m=a,!0):!1});return m}};g.prototype._fixTokens=function(a,c){return a.replace(/(\{([^\{\r\n]+)\})/g,function(a,b,m){return(a=H(c,m))?"{"+a.name+"}":b})};g.prototype._encodeAttributes=function(a){var c=a?l.clone(a):{};Object.keys(c).forEach(function(a){var b=c[a];"string"===typeof b&&(b=encodeURIComponent(b).replace(/\'/g,"\x26apos;"),c[a]=b)});return c};g.prototype._createfieldInfoMap=function(a,c){var b=this,m=new Map;
a&&a.forEach(function(a){var e=b._getFixedFieldName(a.fieldName,c);a.fieldName=e;m.set(e.toLowerCase(),a)});return m};g.prototype._formatAttributeValue=function(a){var c=a.value,b=a.fieldName,e=a.fieldInfos,m=a.fieldInfoMap;a=a.layer;if(null==c)return c;var f=this._getDomainName(b,c);return f||(f=this._getTypeName(b))?f:m.get(b.toLowerCase())?this._formatValueToFieldInfo(c,{fieldInfos:e,fieldName:b,layer:a}):(e=a&&a.fieldsIndex)&&e.isDateField(b)?B.formatDate(c,J):G(c)};g.prototype._formatAttributes=
function(a){var c=this,b=this._graphic,e=A.getSourceLayer(b),m=l.clone(b.attributes);this.addRelatedFeatureAttributes(m);var f=this._createfieldInfoMap(a,e);this._fieldInfoMap=f;Object.keys(m).forEach(function(b){m[b]=c._formatAttributeValue({fieldName:b,fieldInfos:a,fieldInfoMap:f,layer:e,value:m[b]})});return m};g.prototype._parseNumberFromString=function(a,c){return"string"!==typeof a||!c||null!=c.dateFormat||null==c.places&&null==c.digitSeparator||(c=Number(a),isNaN(c))?a:c};g.prototype._formatValueToFieldInfo=
function(c,e){var m=e.fieldName,f=this._getFieldInfo(e.fieldInfos,m),d=l.clone(f),f=e.preventPlacesFormatting;(e=H(e.layer,m))&&"date"===e.type&&(e=d.format||new a,e.dateFormat=e.dateFormat||"short-date-short-time",d.format=e);d=d&&d.format;c=this._parseNumberFromString(c,d);return"string"===typeof c||null==c||null==d?c:f?b.formatNumber(c,u({},b.convertNumberFormatToIntlOptions(d),{minimumFractionDigits:0,maximumFractionDigits:20})):d.format(c)};g.prototype._getDomainName=function(a,c){if(this.isRelatedField(a))return null;
var b=this._graphic,e=A.getSourceLayer(b);return e&&"function"===typeof e.getFieldDomain?(a=e.getFieldDomain(a,{feature:b}))&&"coded-value"===a.type?a.getName(c):null:null};g.prototype._getFieldInfo=function(a,c){if(a&&a.length&&c){var b=c.toLowerCase(),e=void 0;a.some(function(a){return a.fieldName&&a.fieldName.toLowerCase()===b?(e=a,!0):!1});return e}};g.prototype._getTypeName=function(a){if(this.isRelatedField(a))return null;var c=this._graphic,b=A.getSourceLayer(c);if(!b||"function"!==typeof b.getFeatureType)return null;
var e=b.typeIdField;return e&&a===e?(a=b.getFeatureType(c))?a.name:null:null};g.prototype._removeEmptyHref=function(a){return a.replace(/href=(""|'')/gi,"")};g.prototype._processFieldsInLinks=function(a,c){var b=this.get("_graphic.layer");a=this._fixTokens(a,b);var e=this._encodeAttributes(c),b=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi;return a?a.replace(b,function(a,b,f){b=(""+(b||f)).trim();return D.replace(a,b&&"{"===b[0]?c:e)}):a};g.prototype._getTitle=function(){var a=this._effectivePopupTemplate,
c=this._graphic,a=a&&a.title,c="function"===typeof a?a.call(null,{graphic:c}):a;return y.isPromiseLike(c)?c:y.resolve(c)};g.prototype._getContent=function(){var a=this._effectivePopupTemplate,c=this._graphic,a=a&&a.content,c="function"===typeof a?a.call(null,{graphic:c}):a;return y.isPromiseLike(c)?c:y.resolve(c)};g.prototype._querySourceLayer=function(a,c){var b=a.layer,e=a.graphic,f=a.outFields;a=a.objectIds;var d=a[0];if("number"!==typeof d)return c="Could not query required fields for the specified feature. The feature's ID is invalid.",
b={layer:b,graphic:e,objectId:d,requiredFields:f},f=new t("layer-query-features-invalid-objectid",c,b),F.warn(c,b),y.reject(f);if("function"!==typeof b.queryFeatures)return c="The specified layer does not support the method 'queryFeatures'. The following fields will not be available.",b={layer:b,graphic:e,requiredFields:f},f=new t("layer-query-features-unsupported",c,b),F.warn(c,b),y.reject(f);e=b.createQuery();e.objectIds=a;e.outFields=f;e.returnGeometry=!0;return b.queryFeatures(e,c).then(function(a){return a.features[0]})};
g.prototype._queryRequiredFieldsFeature=function(a){var c=this,b=this._graphic,e=this._effectivePopupTemplate,d=b.sourceLayer;return d&&e?("function"===typeof d.load?d.load(a):y.resolve()).then(function(){var g=[b.attributes[d.objectIdField]];return e.getRequiredFields(d.fields).then(function(e){return f.featureHasFields(e,b)?null:c._querySourceLayer({layer:d,graphic:b,outFields:e,objectIds:g},a)})}):y.resolve(null)};g.prototype._queryFeature=function(a){var c=this,b=this._featureAbortController,
e=this._graphic;this._effectivePopupTemplate=e&&e.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled);return y.eachAlways({content:this._getContent(),title:this._getTitle()}).then(function(f){var d=f.content.value,g=f.title.value;if(b===c._featureAbortController&&e){f=c._checkForRelatedFeatures(d,a);var m=c._createFormattedExpressions().then(function(a){e.attributes=u({},e.attributes,a)}),k=c._queryRequiredFieldsFeature(a).then(function(a){a&&(e.geometry=a.geometry,e.attributes=u({},e.attributes,
a.attributes))});return y.eachAlways([f,m,k]).then(function(){if(b===c._featureAbortController&&e){c._set("formattedAttributes",c._createFormattedAttributes(d));c._set("title",c._compileTitle(g));var a=c._compileLastEditInfo();c._set("lastEditInfo",a||null);a=c._compileContent(d);c._set("content",a||null);return a}})}})};g.prototype._isExpressionField=function(a){return L.test(a)};g.prototype._formatArcadeArray=function(a){return'\x3cul class\x3d"esri-widget__list"\x3e'+a.map(function(a){return"\x3cli\x3e"+
("string"===typeof a?G(I(a)):a)+"\x3c/li\x3e"}).join("")+"\x3c/ul\x3e"};g.prototype._formatArcadeDictionary=function(a){return'\x3ctable class\x3d"esri-widget__table"\x3e'+a.keys().map(function(c){var b=a.field(c),b="string"===typeof b?G(I(b)):b;return"\x3ctr\x3e\x3cth\x3e"+c+"\x3c/th\x3e\x3ctd\x3e"+b+"\x3c/td\x3e\x3c/tr\x3e"}).join("")+"\x3c/table\x3e"};g.prototype._createFormattedExpressions=function(){return w(this,void 0,void 0,function(){var a,c,b,e,f,d,g,k,A,l,h,v=this;return x(this,function(m){switch(m.label){case 0:return a=
this,c=a._effectivePopupTemplate,b=a._graphic,e=c&&c.expressionInfos,f=[],d={},e&&e.length?[4,N()]:[2,d];case 1:g=m.sent();k=function(a){var c="expression/"+a.name,e=g.createSyntaxTree(a.expression),k=O.filter(function(a){return g.hasVariable(e,a)});a=g.loadScriptDependencies(e,!0,k).then(function(){return w(v,void 0,void 0,function(){var a,f,m,A,l=this;return x(this,function(h){a=this.spatialReference;f=g.getViewInfo({spatialReference:a});m=g.createExecContext(b,f);m.useAsync=!0;this._addVarsToContext(g,
k,m,f);A=g.createFunction(e,m);return[2,g.executeAsyncFunction(A,m).then(function(a){d[c]="string"===typeof a?G(I(a)):Array.isArray(a)?l._formatArcadeArray(a):a&&"esri.arcade.Dictionary"===a.declaredClass?l._formatArcadeDictionary(a):a},function(a){return F.error("arcade-execution-error",a)})]})})});f.push(a)};A=0;for(l=e;A<l.length;A++)h=l[A],k(h);return[2,y.eachAlways(f).then(function(){return d})]}})})};g.prototype._addVarsToContext=function(a,c,b,e){var f=this.graphic,d=this.map;c.forEach(function(c){c=
c.toLowerCase();var g={map:d,spatialReference:e.sr};"$map"===c&&(b.vars[c]=a.convertMapToFeatureSetCollection(g));"$layer"===c&&(b.vars[c]=a.convertFeatureLayerToFeatureSet(f.sourceLayer,e.sr));"$datastore"===c&&(b.vars[c]=a.convertServiceUrlToWorkspace(f.sourceLayer.url,e.sr))})};g.prototype._createFormattedAttributes=function(a){var c=this,b=this._effectivePopupTemplate,e={global:this._formatAttributes(b&&b.fieldInfos),content:[]};Array.isArray(a)&&a.forEach(function(a,b){"fields"===a.type&&a.fieldInfos&&
(e.content[b]=c._formatAttributes(a.fieldInfos))});return e};g.prototype._getAllFieldInfos=function(a){var c=this._effectivePopupTemplate,b=[];(c=c&&c.fieldInfos)&&b.push.apply(b,c);if(!a||!Array.isArray(a))return b;a.forEach(function(a){"fields"===a.type&&b.push.apply(b,a&&a.fieldInfos)});return b};g.prototype._checkForRelatedFeatures=function(a,c){var b=this._graphic;a=this._getAllFieldInfos(a);return this.queryRelatedInfos(b,a,c)};g.prototype._getTooltip=function(a){var c=a.label;return"pie-chart"===
a.chartType?c:c+": "+a.value};g.prototype._getChartOption=function(a){var c=a.value,b=a.attributes,e=a.formattedAttributes,f=a.fieldName,d=a.relatedFieldName,g=a.fieldInfos,m=a.index;a=a.chartType;var l=A.getSourceLayer(this._graphic),h=c.normalizeField,c=c.tooltipField,h=h?this.isRelatedField(h)?b[this.getRelatedFieldInfo(h).fieldName]:b[h]:null,v=d&&void 0!==b[d]?b[d]:void 0!==b[f]?b[f]:e[f],v=void 0===v?null:v&&h?v/h:v,m=new k({x:m,y:v});if(this.isRelatedField(f))return e=this.getRelatedFieldInfo(f),
f=(f=this.getRelatedFieldInfo(c))?f.fieldName:null,g=this._formatValueToFieldInfo(v,{fieldInfos:g,fieldName:d,layer:l,preventPlacesFormatting:!!h}),d=e?e.label||e.fieldName:d,m.tooltip=this._getTooltip({label:f&&void 0!==b[f]?b[f]:d,value:g,chartType:a}),m;b=this._getFieldInfo(g,f);d=this._getFixedFieldName(f,l);b=b?b.label||b.fieldName:f;m.tooltip=this._getTooltip({label:c&&void 0!==e[c]?e[c]:b,value:e[d],chartType:a});return m};g.prototype._getFixedFieldName=function(a,c){return(c=H(c,a))?c.name:
a};g.prototype._getFixedFieldNames=function(a,c){var b=this;return a&&a.map(function(a){return b._getFixedFieldName(a,c)})};g.prototype._setChartValue=function(a){var c=this,b=a.value,e=a.attributes,f=a.formattedAttributes,d=a.chartType;a=a.layer;var g=this._effectivePopupTemplate,k=this.relatedInfoCount,A=b.fields,h=b.normalizeField;b.fields=this._getFixedFieldNames(A,a);h&&(b.normalizeField=this._getFixedFieldName(h,a));if(A.some(function(a){return!!(null!=f[a]||c.isRelatedField(a)&&k)})){var l=
g&&g.fieldInfos;A.forEach(function(a,g){c.isRelatedField(a)?b.series=b.series.concat(c._getRelatedChartInfos({fieldInfos:l,fieldName:a,formattedAttributes:f,chartType:d,value:b})):(a=c._getChartOption({value:b,index:g,attributes:e,chartType:d,formattedAttributes:f,fieldName:a,fieldInfos:l}),b.series.push(a))})}};g.prototype._getRelatedChartInfos=function(a){var c=this,b=a.fieldInfos,e=a.fieldName,f=a.formattedAttributes,d=a.chartType,g=a.value,k=[];a=this.getRelatedFieldInfo(e);var A=a.fieldName,
h=this.getRelatedInfo(a.layerId);if(!h)return k;a=h.relatedFeatures;h=h.relation;if(!h||!a)return k;h=h.cardinality;a.forEach(function(a,h){var l=a.attributes;l&&Object.keys(l).forEach(function(a){a===A&&k.push(c._getChartOption({value:g,index:h,attributes:l,formattedAttributes:f,fieldName:e,chartType:d,relatedFieldName:a,fieldInfos:b}))})});return"one-to-many"===h||"many-to-many"===h?k:[k[0]]};d([q.property()],g.prototype,"_featureAbortController",void 0);d([q.property({type:c})],g.prototype,"attachmentsViewModel",
void 0);d([q.property({readOnly:!0})],g.prototype,"content",void 0);d([q.property({type:Boolean})],g.prototype,"defaultPopupTemplateEnabled",void 0);d([q.property({readOnly:!0})],g.prototype,"formattedAttributes",void 0);d([q.property({type:n})],g.prototype,"graphic",void 0);d([q.property({readOnly:!0})],g.prototype,"lastEditInfo",void 0);d([q.property({dependsOn:["view"]})],g.prototype,"spatialReference",null);d([q.property({readOnly:!0})],g.prototype,"title",void 0);d([q.property({dependsOn:["view"]})],
g.prototype,"map",null);d([q.property({readOnly:!0,dependsOn:["_featureAbortController"]})],g.prototype,"waitingForContent",null);d([q.property()],g.prototype,"view",void 0);return g=d([q.subclass("esri.widgets.FeatureViewModel")],g)}(q.declared(M))})},"esri/widgets/Feature/support/RelatedFeatures":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../request ../../../core/Accessor ../../../core/Error ../../../core/Logger ../../../core/promiseUtils ../../../core/accessorSupport/decorators ../../../tasks/QueryTask ../../../tasks/support/Query ../../../tasks/support/StatisticDefinition ./featureUtils".split(" "),
function(z,r,h,d,u,x,w,n,B,t,C,l,g,y){var D=new Map,p=n.getLogger("esri.widgets.Popup.support.RelatedFeatures");return function(n){function q(e){e=n.call(this,e)||this;e.relatedInfoCount=null;e.relatedInfos=new Map;return e}h(q,n);q.prototype.destroy=function(){this.relatedInfos.clear()};q.prototype.addRelatedFeatureAttributes=function(e){var b=this;this.relatedInfos.forEach(function(f){return b._addRelatedFeatureAttribute(e,f)})};q.prototype.getRelatedFieldInfo=function(e){if(-1===e.indexOf("relationships/"))return null;
e=e.split("/").slice(1);return{layerId:e[0],fieldName:e[1]}};q.prototype.getRelatedInfo=function(e){return this.relatedInfos.get(e.toString())};q.prototype.isRelatedField=function(e){void 0===e&&(e="");return e?-1!==e.indexOf("relationships/"):!1};q.prototype.queryRelatedInfos=function(e,b,f){var d=this;this.relatedInfos.clear();var g=y.getSourceLayer(e);if(!g)return B.resolve();var a=b.filter(function(a){return a&&d.isRelatedField(a.fieldName)});if(!a||!a.length)return B.resolve();this._createRelatedInfos(b,
g);return this._queryLayerInfos(g,f).then(function(a){d._updateRelatedInfoLayerInfos(a);return d._queryRelatedFeatureMap(e,f).then(function(a){Object.keys(a).forEach(function(c){d._setRelatedFeatures(a[c],c.toString())});return a})})};q.prototype._addRelatedFeatureAttribute=function(e,b){var f=this;e&&b&&(b.relatedFeatures&&b.relatedFeatures&&b.relatedFeatures.forEach(function(d){return f._addAttributesFromFeature(e,d,b)}),b.relatedStatsFeatures&&b.relatedStatsFeatures&&b.relatedStatsFeatures.forEach(function(d){return f._addAttributesFromFeature(e,
d,b)}))};q.prototype._updateRelatedInfoLayerInfo=function(e,b){if(e=e.value)this.getRelatedInfo(b).layerInfo=e.data};q.prototype._updateRelatedInfoLayerInfos=function(e){var b=this;Object.keys(e).forEach(function(f){return b._updateRelatedInfoLayerInfo(e[f],f.toString())})};q.prototype._addAttributesFromFeature=function(e,b,f){var d=this;e&&b&&f&&Object.keys(b.attributes).forEach(function(g){var a=d._relatedFieldInfoToString({layerId:f.relation.id.toString(),fieldName:g});e[a]=b.attributes[g]})};
q.prototype._relatedFieldInfoToString=function(e){return e?"relationships/"+e.layerId+"/"+e.fieldName:""};q.prototype._createRelatedInfoForFieldInfo=function(e,b){var f=this.getRelatedFieldInfo(e.fieldName);if(f){var d=f.layerId,f=f.fieldName;d&&(b=this.getRelatedInfo(d)||this._createRelatedInfo(d,b))&&(b.relatedFields.push(f),e.statisticType&&(e=new g({statisticType:e.statisticType,onStatisticField:f,outStatisticFieldName:f}),b.outStatistics.push(e)))}};q.prototype._createRelatedInfos=function(e,
b){var f=this;e.forEach(function(e){return f._createRelatedInfoForFieldInfo(e,b)})};q.prototype._queryRelatedFeatureMap=function(e,b){var f=this,d={};this.relatedInfos.forEach(function(g,a){g.layerInfo&&(d[a]=f._queryRelatedLayerFeatures(e,g,b))});return B.eachAlways(d)};q.prototype._queryLayerInfos=function(e,b){var f=this,d={};this.relatedInfos.forEach(function(g,a){g=g.relation;if(!g)throw a=new w("relation-required","A relation is required on a layer to retrieve related records."),p.error(a),
a;g=g.relatedTableId;if(!g)throw a=new w("A related table ID is required on a layer to retrieve related records."),p.error(a),a;g=e.url+"/"+g;var c=D.get(g),k=c?c:f._queryLayerInfo(g,b);c||D.set(g,k);d[a]=k});return B.eachAlways(d)};q.prototype._queryLayerInfo=function(e,b){return u(e,{query:{f:"json"},signal:b&&b.signal})};q.prototype._queryRelatedLayerFeatures=function(e,b,f){var d=y.getSourceLayer(e).layerId.toString(),g=b.layerInfo,a=b.queryTask,c=b.relation;if(d=this._getDestinationRelation(g,
d)){var c=c.keyField,h=d.keyField,d="string"===this._getDestinationFieldType(g,d)?h+"\x3d'"+e.attributes[c]+"'":h+"\x3d"+e.attributes[c];e=a.execute(new l({where:d,outFields:b.relatedFields}),f);b=b.outStatistics&&0<b.outStatistics.length&&g.supportsStatistics?a.execute(new l({where:d,outFields:b.relatedFields,outStatistics:b.outStatistics}),f):null;return B.eachAlways({features:e,statsFeatures:b?b:B.resolve()})}return B.resolve()};q.prototype._setRelatedFeatures=function(e,b){if(b=this.getRelatedInfo(b)){var d=
e.value;d&&(e=d.features,d=d.statsFeatures,e=e&&e.value,b.relatedFeatures=e?e.features:[],e=d&&d.value,b.relatedStatsFeatures=e?e.features:[])}};q.prototype._getRelation=function(e,b){if(!b.relationships)return null;var d=null;b.relationships.some(function(b){return b.id===parseInt(e,10)?(d=b,!0):!1});return d};q.prototype._createRelatedInfo=function(e,b){var d=this._getRelation(e,b);if(d){var g=b.url+"/"+d.relatedTableId;b=new C({url:g,sourceSpatialReference:b.spatialReference});d={url:g,queryTask:b,
relation:d,relatedFields:[],outStatistics:[]};this.relatedInfos.set(e,d);return d}};q.prototype._getDestinationRelation=function(e,b){var d;e&&e.relationships&&e.relationships.some(function(e){return""+e.relatedTableId===b?(d=e,!0):!1});return d};q.prototype._getDestinationFieldType=function(e,b){var d=void 0;e.fields.some(function(e){return e.name===b.keyField?(d=-1!==["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].indexOf(e.type)?"number":"string",
!0):!1});return d};d([t.aliasOf("relatedInfos.size")],q.prototype,"relatedInfoCount",void 0);d([t.property()],q.prototype,"relatedInfos",void 0);return q=d([t.subclass("esri.widgets.Popup.support.RelatedFeatures")],q)}(t.declared(x))})},"esri/widgets/support/chartUtils":function(){define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper dojo/_base/kernel @dojo/framework/shim/Promise".split(" "),function(z,r,h,d,u){function x(){var d=u.locale;if(!d)return"en_US";
var h;if(!(h=r.locales[d])){d=d.split("-")[0].toLowerCase();h=null;for(var n=0,l=Object.keys(r.locales);n<l.length;n++){var g=l[n];if(-1<g.indexOf(d)){h=r.locales[g];break}}}return h||"en_US"}Object.defineProperty(r,"__esModule",{value:!0});r.locales={ar:"ar","bs-ba":"bs_BA","ca-es":"ca_ES","cs-cz":"cs_CZ","da-dk":"da_DK","de-ch":"de_CH","de-de":"de_DE","el-gr":"el_GR","en-ca":"en_CA","en-us":"en_US","es-es":"es_ES","et-ee":"et_EE","fi-fi":"fi_FI","fr-fr":"fr_FR","he-il":"he_IL","hr-hr":"hr_HR","hu-hu":"hu_HU",
"id-id":"id_ID","it-it":"it_IT","ja-jp":"ja_JP","ko-kr":"ko_KR","lt-lt":"lt_LT","lv-lv":"lv_LV","nb-no":"nb_NO","nl-nl":"nl_NL","pl-pl":"pl_PL","pt-br":"pt_BR","pt-pt":"pt_PT","ro-ro":"ro_RO","ru-ru":"ru_RU","sl-sl":"sl_SL","sr-rs":"sr_RS","sv-se":"sv_SE","th-th":"th_TH","tr-tr":"tr_TR","uk-ua":"uk_UA","vi-vn":"vi_VN","zh-cn":"zh_Hans","zh-hk":"zh_Hant","zh-tw":"zh_Hant"};r.getChartLocale=x;var w,n;r.loadChartsModule=function(u){void 0===u&&(u=x());return d(this,void 0,void 0,function(){var t=this;
return h(this,function(r){if(w&&u===n)return[2,w];n=u;w=Promise.all([new Promise(function(d,g){z(["../../libs/amcharts4/index"],d,g)}),new Promise(function(d,g){z(["../../libs/amcharts4/lang/"+u],d,g)})]).then(function(l){var g=l[0],r=l[1];return d(t,void 0,void 0,function(){var d,l;return h(this,function(h){switch(h.label){case 0:return d=g.am4core,n===u&&(d.options.defaultLocale=r.default),"function"===typeof Object.assign?[3,2]:[4,new Promise(function(d,e){z(["@dojo/framework/shim/object"],d,e)})];
case 1:l=h.sent(),Object.defineProperty(Object,"assign",{value:l.assign,writable:!0,configurable:!0}),h.label=2;case 2:return[2,g]}})})},function(){return n=w=null});return[2,w]})})}})},"esri/widgets/support/uriUtils":function(){define(["require","exports","dojo/i18n!./nls/uriUtils","../../core/string"],function(z,r,h,d){function u(d){var h=null;x.some(function(n){n.pattern.test(d)&&(h=n);return!!h});return h}Object.defineProperty(r,"__esModule",{value:!0});var x=[{id:"http",pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,
target:"_blank",label:h.view},{id:"tel",pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{id:"mailto",pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{id:"arcgis-appstudio-player",pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:h.openInApp,appName:"App Studio Player"},{id:"arcgis-collector",pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:h.openInApp,appName:"Collector"},{id:"arcgis-explorer",pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:h.openInApp,
appName:"Explorer"},{id:"arcgis-navigator",pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:h.openInApp,appName:"Navigator"},{id:"arcgis-survey123",pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:h.openInApp,appName:"Survey123"},{id:"arcgis-trek2there",pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:h.openInApp,appName:"Trek2There"},{id:"arcgis-workforce",pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:h.openInApp,appName:h.workforce},{id:"iform",pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,
label:h.openInApp,appName:"iForm"},{id:"flow",pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:h.openInApp,appName:"FlowFinity"},{id:"lfmobile",pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:h.openInApp,appName:"Laserfische"},{id:"mspbi",pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:h.openInApp,appName:"Microsoft Power Bi"}];r.autoLink=function(h){if("string"!==typeof h||!h)return h;var n=u(h);if(!n)return h;var r=h.match(n.pattern),r=d.replace(n.label,{appName:n.appName,hierPart:r&&r[2]});return h.replace(n.pattern,
"\x3ca "+(n.target?'target\x3d"'+n.target+'"':"")+' href\x3d"$1" '+("_blank"===n.target?'rel\x3d"noreferrer"':"")+"\x3e"+r+"\x3c/a\x3e")}})},"*now":function(z){z(['dojo/i18n!*preload*esri/widgets/nls/Feature*["ar","bs","ca","cs","da","de","de-ch","el","en-au","en-ca","en-gb","en-us","es","es-mx","et","fi","fr","fr-ch","he","hr","hu","id","it","it-ch","ja","ko","lt","lv","nl","nb","pl","pt","pt-br","pt-pt","ro","ru","sl","sr","sv","th","tr","uk","vi","zh-cn","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper ../core/tsSupport/generatorHelper ../core/tsSupport/awaiterHelper dojo/i18n!./Feature/nls/Feature ../intl ../core/events ../core/throttle ../core/watchUtils ../core/accessorSupport/decorators ./Attachments ./Widget ./Feature/FeatureViewModel ./support/chartUtils ./support/uriUtils ./support/widget ./support/widgetUtils".split(" "),function(z,r,h,d,u,x,w,n,B,t,C,l,g,y,D,p,
E,q,e,b){var f={title:!0,content:!0,lastEditedInfo:!0};return function(r){function k(a){var c=r.call(this,a)||this;c._chartUIds=new Map;c._contentElementCharts=new Map;c._activeMediaMap=new Map;c._refreshTimers=new Map;c._mediaInfo=new Map;c._renderChartThrottled=C.throttle(function(a){return c._renderChart(a)},100);c._attachmentsWidgets=[];c.graphic=null;c.defaultPopupTemplateEnabled=!1;c.label=n.widgetLabel;c.spatialReference=null;c.title=null;c.visibleElements=u({},f);c.map=null;c.view=null;c.viewModel=
new p;c._addTargetToAnchors=function(a){a.querySelectorAll("a").forEach(function(a){c._shouldOpenInNewTab(a.href)&&!a.hasAttribute("target")&&a.setAttribute("target","_blank")})};return c}h(k,r);k.prototype.postInitialize=function(){var a=this;this.own(l.init(this,"viewModel.content",function(){a._setupMediaRefreshTimers();a._setupAttachmentWidgets()}),l.init(this,"viewModel.graphic",function(){return a._disposeCharts()}))};k.prototype.destroy=function(){this._clearMediaRefreshTimers();this._activeMediaMap.clear();
this._activeMediaMap=null;this._destroyAttachmentWidgets();this._disposeCharts()};k.prototype.castVisibleElements=function(a){return u({},f,a)};k.prototype.render=function(){var a=e.tsx("div",{key:"loading-container",class:"esri-feature__loading-container"},e.tsx("span",{class:this.classes("esri-icon-loading-indicator esri-rotating","esri-feature__loading-spinner")})),c=this.visibleElements,b=this.viewModel,d=b.waitingForContent,b=b.title,b=c.title?e.tsx("h4",{class:"esri-feature__title",innerHTML:b}):
null,c=c.content?e.tsx("div",{class:"esri-feature__main-container"},[this._renderContent(),this._renderLastEditInfo()]):null;return e.tsx("div",{class:this.classes("esri-feature","esri-widget")},e.tsx("div",{class:"esri-feature__size-container"},b,d?a:c))};k.prototype.goToMedia=function(a,c){this._setContentElementMedia(a,c)};k.prototype.nextMedia=function(a){this._pageContentElementMedia(a,"next")};k.prototype.previousMedia=function(a){this._pageContentElementMedia(a,"previous")};k.prototype._buildKey=
function(a){for(var c=[],b=1;b<arguments.length;b++)c[b-1]=arguments[b];b=this.get("viewModel.graphic.uid")||"0";c=c.join("-");return a+"__"+b+"-"+c};k.prototype._disposeCharts=function(){return w(this,void 0,void 0,function(){return x(this,function(a){this._chartUIds.forEach(function(a){return a.dispose()});this._chartUIds.clear();this._contentElementCharts.forEach(function(a){return a.dispose()});this._contentElementCharts.clear();return[2]})})};k.prototype._renderContent=function(){var a=this.viewModel.content;
return a?"string"===typeof a?e.tsx("div",{key:"content-string",innerHTML:a}):e.isWidget(a)?e.tsx("div",{key:"content-widget"},a.render()):a instanceof HTMLElement?e.tsx("div",{key:"content-html-element",bind:a,afterCreate:this._attachToNode}):e.hasDomNode(a)?e.tsx("div",{key:"content-dijit",bind:a.domNode,afterCreate:this._attachToNode}):Array.isArray(a)?a.length?e.tsx("div",{key:"content-content-elements"},a.map(this._renderContentElement,this)):null:null:null};k.prototype._renderContentElement=
function(a,c){var b=this.visibleElements;if("boolean"!==typeof b.content&&!b.content[a.type])return null;switch(a.type){case "attachments":return this._renderAttachments(c);case "fields":return this._renderFields(a,c);case "media":return this._renderMedia(a,c);case "text":return this._renderText(a,c);default:return null}};k.prototype._renderAttachments=function(a){var c=this._attachmentsWidgets[a];if(!c||c.destroyed)return null;var b=c.viewModel,d=b.attachmentInfos;return"loading"===b.state||0<d.length?
e.tsx("div",{key:this._buildKey("attachments-element",a),class:this.classes("esri-feature__attachments","esri-feature__content-element")},e.tsx("h2",null,n.attach),c.render()):null};k.prototype._forceLTR=function(a){return"\x26lrm;"+a};k.prototype._renderFieldInfo=function(a,c){var b,d=this.viewModel.formattedAttributes,f=d?d.content[c]||d.global:null,g=a.fieldName,d=a.label||g,f=f?null==f[g]?"":f[g]:"";a=!(!a.format||!a.format.dateFormat);f="number"!==typeof f||a?q.autoLink(f):this._forceLTR(f);
a=(b={},b["esri-feature__field-data--date"]=a,b);return e.tsx("tr",{key:this._buildKey("fields-element-info-row",c)},e.tsx("th",{key:this._buildKey("fields-element-info-row-header",c),class:"esri-feature__field-header",innerHTML:d}),e.tsx("td",{key:this._buildKey("fields-element-info-row-data",c),class:this.classes("esri-feature__field-data",a),innerHTML:f}))};k.prototype._renderFields=function(a,c){var b=this;return(a=a.fieldInfos)?e.tsx("div",{key:this._buildKey("fields-element",c),class:this.classes("esri-feature__fields",
"esri-feature__content-element")},e.tsx("table",{class:"esri-widget__table",summary:n.fieldsSummary,key:this._buildKey("fields-element-table",c)},e.tsx("tbody",{key:this._buildKey("fields-element-table-body",c)},a.map(function(a){return b._renderFieldInfo(a,c)})))):null};k.prototype._shouldOpenInNewTab=function(a){void 0===a&&(a="");if(a)return!/^(?:mailto:|tel:)/.test(a.trim().toLowerCase())};k.prototype._clearMediaRefreshTimers=function(){this._refreshTimers.forEach(function(a){return clearTimeout(a)});
this._refreshTimers.clear()};k.prototype._clearMediaRefreshTimer=function(a){var c=this._refreshTimers.get(a);c&&(clearTimeout(c),this._refreshTimers.delete(a))};k.prototype._getImageSource=function(a,c){var b=-1!==a.indexOf("?")?"\x26":"?";a=a.split("#");var e=a[1],e=void 0===e?"":e;return""+a[0]+b+"timestamp\x3d"+c+(e?"#":"")+e};k.prototype._setupMediaRefreshTimer=function(a){var c=this.get("viewModel.content");if(Array.isArray(c)&&(c=c[a])&&"media"===c.type){var b=this._activeMediaMap.get(a);isNaN(b)&&
(b=0);(c=c.mediaInfos[b])&&"image"===c.type&&c.refreshInterval&&this._setRefreshTimeout(a,c)}};k.prototype._destroyAttachmentWidgets=function(){this._attachmentsWidgets.forEach(function(a){return a&&!a.destroyed&&a.destroy()});this._attachmentsWidgets=[]};k.prototype._setupAttachmentWidgets=function(){var a=this;this._destroyAttachmentWidgets();var c=this.get("viewModel.content");if(Array.isArray(c)){var b=this.viewModel.attachmentsViewModel;c.forEach(function(c,e){"attachments"===c.type&&(a._attachmentsWidgets[e]=
new y({displayType:c.displayType,viewModel:b}))},this);this.scheduleRender()}};k.prototype._setupMediaRefreshTimers=function(){var a=this;this._clearMediaRefreshTimers();var c=this.get("viewModel.content");Array.isArray(c)&&c.forEach(function(c,b){return a._setupMediaRefreshTimer(b)})};k.prototype._updateMediaInfoTimestamp=function(a,c){var b=Date.now();this._mediaInfo.set(c,{timestamp:b,sourceURL:this._getImageSource(a,b)});this.scheduleRender()};k.prototype._setRefreshTimeout=function(a,c){var b=
this,e=c.refreshInterval,d=c.value;e&&(c=6E4*e,this._updateMediaInfoTimestamp(d.sourceURL,a),c=setInterval(function(){b._updateMediaInfoTimestamp(d.sourceURL,a)},c),this._refreshTimers.set(a,c))};k.prototype._renderMediaInfoType=function(a){var c=a.mediaInfo,b=a.contentElementIndex;a=a.activeMediaIndex;var d=c.title,d=void 0===d?"":d;if("image"===c.type){var f=c.value,g=c.refreshInterval,h=f.sourceURL,c=f.linkURL,f=this._shouldOpenInNewTab(c)?"_blank":"_self",k="_blank"===f?"noreferrer":"",h=(g=g?
this._mediaInfo.get(b):null)?g.sourceURL:h,b=e.tsx("img",{alt:d,key:this._buildKey("media-image",b,a,g?g.timestamp:0),src:h});return(a=c?e.tsx("a",{title:d,href:c,rel:k,target:f},b):null)?a:b}if(-1!==c.type.indexOf("chart"))return e.tsx("div",{key:this._buildKey("media-chart",b,a),bind:this,"data-media-info":c,"data-content-element-index":b,class:"esri-feature__media-chart",afterCreate:this._getChartDependencies,afterRemoved:this._disposeChartByNode})};k.prototype._getChartDependencies=function(a){var b=
this,e=a["data-media-info"],d=a["data-content-element-index"];this._disposeChartByNode(a);this._disposeChartByContgentElementIndex(d);var f=e.value,g=e.type;E.loadChartsModule().then(function(c){return b._renderChartThrottled({chartDiv:a,contentElementIndex:d,type:g,value:f,chartsModule:c})})};k.prototype._disposeChartByContgentElementIndex=function(a){(a=this._contentElementCharts.get(a))&&a.dispose()};k.prototype._disposeChartByNode=function(a){a=a.getAttribute("data-chart-uid");(a=this._chartUIds.get(a))&&
a.dispose()};k.prototype._customizeChartTooltip=function(a,b){a.label.wrap=!0;a.label.maxWidth=200;a.autoTextColor=!1;a.getFillFromObject=!1;a.label.fill=b.color("#ffffff");a.background.fill=b.color({r:0,g:0,b:0,a:.7})};k.prototype._createPieChart=function(a){var c=a.chartsModule,e=c.am4core,c=c.am4charts;a=e.create(a.chartDiv,c.PieChart);a.rtl=b.isRTL();c=a.series.push(new c.PieSeries);c.labels.template.disabled=!0;c.ticks.template.disabled=!0;c.dataFields.value="y";c.dataFields.category="x";this._customizeChartTooltip(c.tooltip,
e);return a};k.prototype._getMinSeriesValue=function(a){var b=0;a.forEach(function(a){return b=Math.min(a.x,b)});return b};k.prototype._createXYChart=function(a){var c=a.type,e=a.value,d=a.chartsModule,f=d.am4core,d=d.am4charts;a=f.create(a.chartDiv,d.XYChart);a.rtl=b.isRTL();var g=15<e.series.length;if("column-chart"===c){var h=a.xAxes.push(new d.CategoryAxis);h.dataFields.category="x";h.renderer.labels.template.disabled=!0;this._customizeChartTooltip(h.tooltip,f);h.tooltip.events.on("sizechanged",
function(){h.tooltip.dy=-h.tooltip.contentHeight});var k=a.yAxes.push(new d.ValueAxis),l=k.renderer.labels.template;k.renderer.minLabelPosition=.05;k.renderer.maxLabelPosition=.95;k.min=this._getMinSeriesValue(e.series);this._customizeChartTooltip(k.tooltip,f);l.wrap=!0;k=a.series.push(new d.ColumnSeries);k.dataFields.valueY="y";k.dataFields.categoryX="x";a.cursor=new d.XYCursor;g&&(a.scrollbarX=new f.Scrollbar)}if("bar-chart"===c){var n=a.yAxes.push(new d.CategoryAxis);n.dataFields.category="x";
n.renderer.inversed=!0;n.renderer.labels.template.disabled=!0;this._customizeChartTooltip(n.tooltip,f);n.tooltip.events.on("sizechanged",function(){n.tooltip.dx=n.tooltip.contentWidth});k=a.xAxes.push(new d.ValueAxis);l=k.renderer.labels.template;k.renderer.minLabelPosition=.05;k.renderer.maxLabelPosition=.95;k.min=this._getMinSeriesValue(e.series);this._customizeChartTooltip(k.tooltip,f);l.wrap=!0;k=a.series.push(new d.ColumnSeries);k.dataFields.valueX="y";k.dataFields.categoryY="x";a.cursor=new d.XYCursor;
g&&(a.scrollbarY=new f.Scrollbar)}if("line-chart"===c){var p=a.xAxes.push(new d.CategoryAxis);p.dataFields.category="x";p.renderer.labels.template.disabled=!0;this._customizeChartTooltip(p.tooltip,f);p.tooltip.events.on("sizechanged",function(){p.tooltip.dy=-p.tooltip.contentHeight});k=a.yAxes.push(new d.ValueAxis);l=k.renderer.labels.template;k.renderer.minLabelPosition=.05;k.renderer.maxLabelPosition=.95;k.min=this._getMinSeriesValue(e.series);this._customizeChartTooltip(k.tooltip,f);l.wrap=!0;
k=a.series.push(new d.LineSeries);k.dataFields.categoryX="x";k.dataFields.valueY="y";a.cursor=new d.XYCursor;g&&(a.scrollbarX=new f.Scrollbar)}return a};k.prototype._renderChart=function(a){var b=a.type,d=a.contentElementIndex,e=a.value,f=a.chartsModule,g=a.chartDiv;f.am4core.useTheme(f.am4themes_animated);a="pie-chart"===b?this._createPieChart(a):this._createXYChart(a);this._chartUIds.set(a.uid,a);this._contentElementCharts.set(d,a);g.setAttribute("data-chart-uid",a.uid);a.data=e.series.map(function(a){return{x:a.tooltip,
y:a.y}})};k.prototype._renderMediaInfo=function(a){var b=a.mediaInfo,d=a.contentElementIndex;a=this._renderMediaInfoType({mediaInfo:b,contentElementIndex:d,activeMediaIndex:a.activeMediaIndex});var f=b.title?e.tsx("div",{key:this._buildKey("media-title",d),class:"esri-feature__media-item-title",innerHTML:b.title}):null,b=b.caption?e.tsx("div",{key:this._buildKey("media-caption",d),class:"esri-feature__media-item-caption",innerHTML:b.caption}):null;return e.tsx("div",{key:this._buildKey("media-container",
d),class:"esri-feature__media-item-container"},f,b,e.tsx("div",{key:this._buildKey("media-item-container",d),class:"esri-feature__media-item"},a))};k.prototype._renderMediaPageButton=function(a,b){var c=(a="previous"===a)?n.previous:n.next,d=a?this.classes("esri-feature__button","esri-feature__media-previous"):this.classes("esri-feature__button","esri-feature__media-next"),f=a?this.classes("esri-feature__icon","esri-feature__media-previous-icon","esri-icon-left-triangle-arrow"):this.classes("esri-feature__icon",
"esri-feature__media-next-icon","esri-icon-right-triangle-arrow"),g=a?this.classes("esri-feature__icon","esri-feature__media-previous-icon--rtl","esri-icon-right-triangle-arrow"):this.classes("esri-feature__icon","esri-feature__media-next-icon--rtl","esri-icon-left-triangle-arrow"),h=a?this._previousClick:this._nextClick;return e.tsx("div",{key:this._buildKey(a?"media-previous":"media-next",b),title:c,tabIndex:0,role:"button",class:d,"data-content-element-index":b,bind:this,onkeydown:h,onclick:h},
e.tsx("span",{"aria-hidden":"true",class:f}),e.tsx("span",{"aria-hidden":"true",class:g}),e.tsx("span",{class:"esri-icon-font-fallback-text"},c))};k.prototype._handleMediaKeyup=function(a){var b=a.currentTarget["data-content-element-index"],d=t.eventKey(a);"ArrowLeft"===d&&(a.stopPropagation(),this.previousMedia(b));"ArrowRight"===d&&(a.stopPropagation(),this.nextMedia(b))};k.prototype._renderMedia=function(a,b){var c,d=(a=a.mediaInfos)&&a.length||0,f=(c={},c["esri-feature--media-pagination-visible"]=
1<d,c);c=this._renderMediaPageButton("previous",b);var g=this._renderMediaPageButton("next",b),h=this._activeMediaMap.get(b);isNaN(h)&&(this._activeMediaMap.set(b,0),h=0);return d?e.tsx("div",{key:this._buildKey("media-element",b),"data-content-element-index":b,bind:this,onkeyup:this._handleMediaKeyup,class:this.classes("esri-feature__media","esri-feature__content-element",f)},e.tsx("div",{key:this._buildKey("media-element-container",b),class:"esri-feature__media-container"},c,this._renderMediaInfo({mediaInfo:a[h],
contentElementIndex:b,activeMediaIndex:h}),g)):null};k.prototype._renderLastEditInfo=function(){var a=this.visibleElements,b=this.viewModel.lastEditInfo;if(!b||!a.lastEditedInfo)return null;a=b.user;b=B.substitute("edit"===b.type?a?n.lastEditedByUser:n.lastEdited:a?n.lastCreatedByUser:n.lastCreated,{date:b.date,user:a});return e.tsx("div",{key:"edit-info-element",class:this.classes("esri-feature__last-edited-info","esri-feature__content-element")},b)};k.prototype._renderText=function(a,b){return a.text?
e.tsx("div",{key:this._buildKey("text-element",b),innerHTML:a.text,afterCreate:this._addTargetToAnchors,class:this.classes("esri-feature__text","esri-feature__content-element")}):null};k.prototype._attachToNode=function(a){a.appendChild(this)};k.prototype._setContentElementMedia=function(a,b){this._clearMediaRefreshTimer(a);var c=this.viewModel.content;(c=(c=c&&c[a])&&c.mediaInfos)&&c.length&&(this._activeMediaMap.set(a,(b+c.length)%c.length),this._setupMediaRefreshTimer(a),this.scheduleRender())};
k.prototype._pageContentElementMedia=function(a,b){b="previous"===b?-1:1;b=this._activeMediaMap.get(a)+b;this._setContentElementMedia(a,b)};k.prototype._previousClick=function(a){this.previousMedia(a.currentTarget["data-content-element-index"])};k.prototype._nextClick=function(a){this.nextMedia(a.currentTarget["data-content-element-index"])};d([g.aliasOf("viewModel.graphic")],k.prototype,"graphic",void 0);d([g.aliasOf("viewModel.defaultPopupTemplateEnabled")],k.prototype,"defaultPopupTemplateEnabled",
void 0);d([g.property()],k.prototype,"label",void 0);d([g.aliasOf("viewModel.spatialReference")],k.prototype,"spatialReference",void 0);d([g.aliasOf("viewModel.title")],k.prototype,"title",void 0);d([g.property(),e.renderable()],k.prototype,"visibleElements",void 0);d([g.cast("visibleElements")],k.prototype,"castVisibleElements",null);d([g.aliasOf("viewModel.map")],k.prototype,"map",void 0);d([g.aliasOf("viewModel.view")],k.prototype,"view",void 0);d([g.property({type:p}),e.renderable(["viewModel.waitingForContent",
"viewModel.content","viewModel.lastEditInfo"])],k.prototype,"viewModel",void 0);d([e.accessibleHandler()],k.prototype,"_previousClick",null);d([e.accessibleHandler()],k.prototype,"_nextClick",null);return k=d([g.subclass("esri.widgets.Feature")],k)}(g.declared(D))});