// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.15/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/arrayUtils ../../core/Collection ../../core/HandleOwner ../../core/watchUtils ../../core/accessorSupport/decorators ../../layers/FeatureLayer ./AttachmentsColumn ./FieldColumn ./Grid/Grid ./Grid/GridViewModel ./support/FeatureStore".split(" "),function(A,B,r,e,C,k,h,t,u,v,f,d,w,x,l,
y,z,m){return function(n){function c(b){var a=n.call(this,b)||this;a._defaultHiddenFields=["CreationDate","Creator","EditDate","Editor","GlobalID"];a.attachmentsEnabled=!1;a.cellClassNameGenerator=function(a,b){return a.path||null};a.dataProvider=function(b,c){return h(a,void 0,void 0,function(){var a,p,d,e,q,f,h;return k(this,function(g){switch(g.label){case 0:return a=this.store,p=b.page,d=b.pageSize,e=b.sortOrders,q=this._sortOrdersToLayerOrderByFields(e),c?a?[4,a.set({orderByFields:q})]:(c&&c([]),
[2]):[2];case 1:return g.sent(),"loaded"===a.state||"loading"===a.state?[3,3]:[4,a.load()];case 2:g.sent(),g.label=3;case 3:f=c;if(!f)return[3,5];h=c;return[4,a.query({start:p*d,num:d})];case 4:f=h.apply(void 0,[g.sent()]),g.label=5;case 5:return f,[2]}})})};a.grid=new y({viewModel:a});a.hiddenFields=new u;a.relatedRecordsEnabled=!1;a.store=new m;a.store.set({attachmentsEnabled:a.attachmentsEnabled,relatedRecordsEnabled:a.relatedRecordsEnabled});a.hiddenFields.addMany(a._defaultHiddenFields);a.handles.add([f.watch(a,
"attachmentsEnabled",function(b){return a.store.attachmentsEnabled=b}),f.watch(a,"relatedRecordsEnabled",function(b){return a.store.relatedRecordsEnabled=b}),f.watch(a,"layer.loaded",function(b){return b&&a._generateColumns()}),f.watch(a,"layer.definitionExpression",function(b,c){return(b||c)&&a.grid.refresh()})]);return a}r(c,n);c.prototype.destroy=function(){this.handles.removeAll();this.layer=null};Object.defineProperty(c.prototype,"fieldConfigs",{set:function(b){this._set("fieldConfigs",b);this.get("layer.loaded")&&
this._generateColumns()},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"layer",{set:function(b){this._set("layer",b);this.store.set("layer",b);this.store.load();b&&b.load();this.notifyChange("state")},enumerable:!0,configurable:!0});c.prototype.getValue=function(b,a){return(b=(b=this.store.getItemByObjectId(b))&&b.feature)&&b.attributes?b.attributes[a]:null};c.prototype.updateValue=function(b,a,c){return h(this,void 0,void 0,function(){var d=this;return k(this,function(g){return[2,
this.store.update({objectId:b,name:a,value:c}).then(function(){return d.grid.refreshCache()})]})})};c.prototype._generateColumns=function(){var b=this._createFieldColumns();this.attachmentsEnabled&&b.push(this._createAttachmentsColumn());this.columns.removeAll();b.length&&this.columns.addMany(b)};c.prototype._createFieldColumns=function(){return this.fieldConfigs&&this.fieldConfigs.length?this._createColumnsFromConfigs():this._createColumnsFromFields()};c.prototype._createColumnsFromConfigs=function(){var b=
this.fieldConfigs,a=this.hiddenFields,c=this.layer,d=this.get("layer.fields")||[];return b.map(function(b){var e=t.find(d||[],function(a){return b.name===a.name}),f=-1<a.indexOf(e.name);return new l({direction:b?b.direction:null,hidden:f,config:b,field:e,layer:c})})};c.prototype._createColumnsFromFields=function(){var b=this.hiddenFields,a=this.layer;return(this.get("layer.fields")||[]).map(function(c){var d=-1<b.indexOf(c.name);return new l({config:null,hidden:d,field:c,layer:a})})};c.prototype._createAttachmentsColumn=
function(){return new x};c.prototype._sortOrdersToLayerOrderByFields=function(b){return b&&b.length?b.filter(function(a,b,c){return c.map(function(a){return a.path}).indexOf(a.path)===b}).map(function(a){return a.path+" "+a.direction.toUpperCase()}):[]};e([d.property()],c.prototype,"attachmentsEnabled",void 0);e([d.property()],c.prototype,"cellClassNameGenerator",void 0);e([d.property()],c.prototype,"dataProvider",void 0);e([d.property()],c.prototype,"fieldConfigs",null);e([d.property({readOnly:!0})],
c.prototype,"grid",void 0);e([d.property()],c.prototype,"hiddenFields",void 0);e([d.property({type:w})],c.prototype,"layer",null);e([d.property()],c.prototype,"relatedRecordsEnabled",void 0);e([d.property({type:m})],c.prototype,"store",void 0);return c=e([d.subclass("esri.widgets.FeatureTable.FeatureTableViewModel")],c)}(d.declared(v.HandleOwnerMixin(z)))});